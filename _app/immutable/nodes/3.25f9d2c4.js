import{s as ps,B as Ug,f as kt,C as Fn,e as Ar,g as zt,h as Mt,D as Un,d as qe,j as _e,i as ni,x as Ke,E as bv,F as Yi,y as Dn,G as qa,l as Zi,m as Wi,n as On,H as d0,r as Ir,I as wv,a as fi,c as pi,J as Ng,K as Si,L as wd,M as No,N as Za,u as kr,v as zr,w as Pr,O as lc,P as Tv,Q as Ev,R as Mv,o as Xp,S as Ws,T as _d,p as Vo,U as Vg,A as Xs,b as Sv,k as Zn,V as Av,W as Jl,X as Tp}from"../chunks/scheduler.44509d31.js";import{S as ms,i as _s,a as Bt,g as Vr,t as Qt,c as jr,b as Bo,d as Oo,m as Fo,e as Uo,f as Ep}from"../chunks/index.12f1b040.js";function Sr(h){return(h==null?void 0:h.length)!==void 0?h:Array.from(h)}function Cv(h,f){const y={},w={},S={$$scope:1};let k=h.length;for(;k--;){const z=h[k],o=f[k];if(o){for(const L in z)L in o||(w[L]=1);for(const L in o)S[L]||(y[L]=o[L],S[L]=1);h[k]=o}else for(const L in z)S[L]=1}for(const z in w)z in y||(y[z]=void 0);return y}function bd(h,f){return h==null||f==null?NaN:h<f?-1:h>f?1:h>=f?0:NaN}function Iv(h,f){return h==null||f==null?NaN:f<h?-1:f>h?1:f>=h?0:NaN}function Hp(h){let f,y,w;h.length!==2?(f=bd,y=(o,L)=>bd(h(o),L),w=(o,L)=>h(o)-L):(f=h===bd||h===Iv?h:kv,y=h,w=h);function S(o,L,F=0,Q=o.length){if(F<Q){if(f(L,L)!==0)return Q;do{const H=F+Q>>>1;y(o[H],L)<0?F=H+1:Q=H}while(F<Q)}return F}function k(o,L,F=0,Q=o.length){if(F<Q){if(f(L,L)!==0)return Q;do{const H=F+Q>>>1;y(o[H],L)<=0?F=H+1:Q=H}while(F<Q)}return F}function z(o,L,F=0,Q=o.length){const H=S(o,L,F,Q-1);return H>F&&w(o[H-1],L)>-w(o[H],L)?H-1:H}return{left:S,center:z,right:k}}function kv(){return 0}function zv(h){return h===null?NaN:+h}const Pv=Hp(bd),Dv=Pv.right;Hp(zv).center;const Lv=Dv;function Rv(h,f){let y,w;if(f===void 0)for(const S of h)S!=null&&(y===void 0?S>=S&&(y=w=S):(y>S&&(y=S),w<S&&(w=S)));else{let S=-1;for(let k of h)(k=f(k,++S,h))!=null&&(y===void 0?k>=k&&(y=w=k):(y>k&&(y=k),w<k&&(w=k)))}return[y,w]}class jg extends Map{constructor(f,y=Fv){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:y}}),f!=null)for(const[w,S]of f)this.set(w,S)}get(f){return super.get(Gg(this,f))}has(f){return super.has(Gg(this,f))}set(f,y){return super.set(Bv(this,f),y)}delete(f){return super.delete(Ov(this,f))}}function Gg({_intern:h,_key:f},y){const w=f(y);return h.has(w)?h.get(w):y}function Bv({_intern:h,_key:f},y){const w=f(y);return h.has(w)?h.get(w):(h.set(w,y),y)}function Ov({_intern:h,_key:f},y){const w=f(y);return h.has(w)&&(y=h.get(w),h.delete(w)),y}function Fv(h){return h!==null&&typeof h=="object"?h.valueOf():h}const Uv=Math.sqrt(50),Nv=Math.sqrt(10),Vv=Math.sqrt(2);function Td(h,f,y){const w=(f-h)/Math.max(0,y),S=Math.floor(Math.log10(w)),k=w/Math.pow(10,S),z=k>=Uv?10:k>=Nv?5:k>=Vv?2:1;let o,L,F;return S<0?(F=Math.pow(10,-S)/z,o=Math.round(h*F),L=Math.round(f*F),o/F<h&&++o,L/F>f&&--L,F=-F):(F=Math.pow(10,S)*z,o=Math.round(h/F),L=Math.round(f/F),o*F<h&&++o,L*F>f&&--L),L<o&&.5<=y&&y<2?Td(h,f,y*2):[o,L,F]}function jv(h,f,y){if(f=+f,h=+h,y=+y,!(y>0))return[];if(h===f)return[h];const w=f<h,[S,k,z]=w?Td(f,h,y):Td(h,f,y);if(!(k>=S))return[];const o=k-S+1,L=new Array(o);if(w)if(z<0)for(let F=0;F<o;++F)L[F]=(k-F)/-z;else for(let F=0;F<o;++F)L[F]=(k-F)*z;else if(z<0)for(let F=0;F<o;++F)L[F]=(S+F)/-z;else for(let F=0;F<o;++F)L[F]=(S+F)*z;return L}function Lp(h,f,y){return f=+f,h=+h,y=+y,Td(h,f,y)[2]}function Rp(h,f,y){f=+f,h=+h,y=+y;const w=f<h,S=w?Lp(f,h,y):Lp(h,f,y);return(w?-1:1)*(S<0?1/-S:S)}function Gv(h,f){let y;if(f===void 0)for(const w of h)w!=null&&(y<w||y===void 0&&w>=w)&&(y=w);else{let w=-1;for(let S of h)(S=f(S,++w,h))!=null&&(y<S||y===void 0&&S>=S)&&(y=S)}return y}function qv(h,f){let y;if(f===void 0)for(const w of h)w!=null&&(y>w||y===void 0&&w>=w)&&(y=w);else{let w=-1;for(let S of h)(S=f(S,++w,h))!=null&&(y>S||y===void 0&&S>=S)&&(y=S)}return y}function $l(h){return function(){return h}}const Bp=Math.PI,Op=2*Bp,Va=1e-6,Zv=Op-Va;function f0(h){this._+=h[0];for(let f=1,y=h.length;f<y;++f)this._+=arguments[f]+h[f]}function Wv(h){let f=Math.floor(h);if(!(f>=0))throw new Error(`invalid digits: ${h}`);if(f>15)return f0;const y=10**f;return function(w){this._+=w[0];for(let S=1,k=w.length;S<k;++S)this._+=Math.round(arguments[S]*y)/y+w[S]}}class Xv{constructor(f){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=f==null?f0:Wv(f)}moveTo(f,y){this._append`M${this._x0=this._x1=+f},${this._y0=this._y1=+y}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(f,y){this._append`L${this._x1=+f},${this._y1=+y}`}quadraticCurveTo(f,y,w,S){this._append`Q${+f},${+y},${this._x1=+w},${this._y1=+S}`}bezierCurveTo(f,y,w,S,k,z){this._append`C${+f},${+y},${+w},${+S},${this._x1=+k},${this._y1=+z}`}arcTo(f,y,w,S,k){if(f=+f,y=+y,w=+w,S=+S,k=+k,k<0)throw new Error(`negative radius: ${k}`);let z=this._x1,o=this._y1,L=w-f,F=S-y,Q=z-f,H=o-y,ce=Q*Q+H*H;if(this._x1===null)this._append`M${this._x1=f},${this._y1=y}`;else if(ce>Va)if(!(Math.abs(H*L-F*Q)>Va)||!k)this._append`L${this._x1=f},${this._y1=y}`;else{let de=w-z,ye=S-o,Ee=L*L+F*F,Xe=de*de+ye*ye,ut=Math.sqrt(Ee),at=Math.sqrt(ce),Ie=k*Math.tan((Bp-Math.acos((Ee+ce-Xe)/(2*ut*at)))/2),ct=Ie/at,ve=Ie/ut;Math.abs(ct-1)>Va&&this._append`L${f+ct*Q},${y+ct*H}`,this._append`A${k},${k},0,0,${+(H*de>Q*ye)},${this._x1=f+ve*L},${this._y1=y+ve*F}`}}arc(f,y,w,S,k,z){if(f=+f,y=+y,w=+w,z=!!z,w<0)throw new Error(`negative radius: ${w}`);let o=w*Math.cos(S),L=w*Math.sin(S),F=f+o,Q=y+L,H=1^z,ce=z?S-k:k-S;this._x1===null?this._append`M${F},${Q}`:(Math.abs(this._x1-F)>Va||Math.abs(this._y1-Q)>Va)&&this._append`L${F},${Q}`,w&&(ce<0&&(ce=ce%Op+Op),ce>Zv?this._append`A${w},${w},0,1,${H},${f-o},${y-L}A${w},${w},0,1,${H},${this._x1=F},${this._y1=Q}`:ce>Va&&this._append`A${w},${w},0,${+(ce>=Bp)},${H},${this._x1=f+w*Math.cos(k)},${this._y1=y+w*Math.sin(k)}`)}rect(f,y,w,S){this._append`M${this._x0=this._x1=+f},${this._y0=this._y1=+y}h${w=+w}v${+S}h${-w}Z`}toString(){return this._}}function Hv(h){let f=3;return h.digits=function(y){if(!arguments.length)return f;if(y==null)f=null;else{const w=Math.floor(y);if(!(w>=0))throw new RangeError(`invalid digits: ${y}`);f=w}return h},()=>new Xv(f)}function Yv(h){return typeof h=="object"&&"length"in h?h:Array.from(h)}function p0(h){this._context=h}p0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,f){switch(h=+h,f=+f,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,f):this._context.moveTo(h,f);break;case 1:this._point=2;default:this._context.lineTo(h,f);break}}};function Kv(h){return new p0(h)}function Jv(h){return h[0]}function $v(h){return h[1]}function Qv(h,f){var y=$l(!0),w=null,S=Kv,k=null,z=Hv(o);h=typeof h=="function"?h:h===void 0?Jv:$l(h),f=typeof f=="function"?f:f===void 0?$v:$l(f);function o(L){var F,Q=(L=Yv(L)).length,H,ce=!1,de;for(w==null&&(k=S(de=z())),F=0;F<=Q;++F)!(F<Q&&y(H=L[F],F,L))===ce&&((ce=!ce)?k.lineStart():k.lineEnd()),ce&&k.point(+h(H,F,L),+f(H,F,L));if(de)return k=null,de+""||null}return o.x=function(L){return arguments.length?(h=typeof L=="function"?L:$l(+L),o):h},o.y=function(L){return arguments.length?(f=typeof L=="function"?L:$l(+L),o):f},o.defined=function(L){return arguments.length?(y=typeof L=="function"?L:$l(!!L),o):y},o.curve=function(L){return arguments.length?(S=L,w!=null&&(k=S(w)),o):S},o.context=function(L){return arguments.length?(L==null?w=k=null:k=S(w=L),o):w},o}function Yp(h,f){switch(arguments.length){case 0:break;case 1:this.range(h);break;default:this.range(f).domain(h);break}return this}const qg=Symbol("implicit");function m0(){var h=new jg,f=[],y=[],w=qg;function S(k){let z=h.get(k);if(z===void 0){if(w!==qg)return w;h.set(k,z=f.push(k)-1)}return y[z%y.length]}return S.domain=function(k){if(!arguments.length)return f.slice();f=[],h=new jg;for(const z of k)h.has(z)||h.set(z,f.push(z)-1);return S},S.range=function(k){return arguments.length?(y=Array.from(k),S):y.slice()},S.unknown=function(k){return arguments.length?(w=k,S):w},S.copy=function(){return m0(f,y).unknown(w)},Yp.apply(S,arguments),S}function Kp(h,f,y){h.prototype=f.prototype=y,y.constructor=h}function _0(h,f){var y=Object.create(h.prototype);for(var w in f)y[w]=f[w];return y}function Zu(){}var Fu=.7,Ed=1/Fu,ic="\\s*([+-]?\\d+)\\s*",Uu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",jo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eb=/^#([0-9a-f]{3,8})$/,tb=new RegExp(`^rgb\\(${ic},${ic},${ic}\\)$`),ib=new RegExp(`^rgb\\(${jo},${jo},${jo}\\)$`),nb=new RegExp(`^rgba\\(${ic},${ic},${ic},${Uu}\\)$`),rb=new RegExp(`^rgba\\(${jo},${jo},${jo},${Uu}\\)$`),ob=new RegExp(`^hsl\\(${Uu},${jo},${jo}\\)$`),sb=new RegExp(`^hsla\\(${Uu},${jo},${jo},${Uu}\\)$`),Zg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kp(Zu,Nu,{copy(h){return Object.assign(new this.constructor,this,h)},displayable(){return this.rgb().displayable()},hex:Wg,formatHex:Wg,formatHex8:ab,formatHsl:lb,formatRgb:Xg,toString:Xg});function Wg(){return this.rgb().formatHex()}function ab(){return this.rgb().formatHex8()}function lb(){return g0(this).formatHsl()}function Xg(){return this.rgb().formatRgb()}function Nu(h){var f,y;return h=(h+"").trim().toLowerCase(),(f=eb.exec(h))?(y=f[1].length,f=parseInt(f[1],16),y===6?Hg(f):y===3?new Cr(f>>8&15|f>>4&240,f>>4&15|f&240,(f&15)<<4|f&15,1):y===8?gd(f>>24&255,f>>16&255,f>>8&255,(f&255)/255):y===4?gd(f>>12&15|f>>8&240,f>>8&15|f>>4&240,f>>4&15|f&240,((f&15)<<4|f&15)/255):null):(f=tb.exec(h))?new Cr(f[1],f[2],f[3],1):(f=ib.exec(h))?new Cr(f[1]*255/100,f[2]*255/100,f[3]*255/100,1):(f=nb.exec(h))?gd(f[1],f[2],f[3],f[4]):(f=rb.exec(h))?gd(f[1]*255/100,f[2]*255/100,f[3]*255/100,f[4]):(f=ob.exec(h))?Jg(f[1],f[2]/100,f[3]/100,1):(f=sb.exec(h))?Jg(f[1],f[2]/100,f[3]/100,f[4]):Zg.hasOwnProperty(h)?Hg(Zg[h]):h==="transparent"?new Cr(NaN,NaN,NaN,0):null}function Hg(h){return new Cr(h>>16&255,h>>8&255,h&255,1)}function gd(h,f,y,w){return w<=0&&(h=f=y=NaN),new Cr(h,f,y,w)}function cb(h){return h instanceof Zu||(h=Nu(h)),h?(h=h.rgb(),new Cr(h.r,h.g,h.b,h.opacity)):new Cr}function Fp(h,f,y,w){return arguments.length===1?cb(h):new Cr(h,f,y,w??1)}function Cr(h,f,y,w){this.r=+h,this.g=+f,this.b=+y,this.opacity=+w}Kp(Cr,Fp,_0(Zu,{brighter(h){return h=h==null?Ed:Math.pow(Ed,h),new Cr(this.r*h,this.g*h,this.b*h,this.opacity)},darker(h){return h=h==null?Fu:Math.pow(Fu,h),new Cr(this.r*h,this.g*h,this.b*h,this.opacity)},rgb(){return this},clamp(){return new Cr(Wa(this.r),Wa(this.g),Wa(this.b),Md(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yg,formatHex:Yg,formatHex8:ub,formatRgb:Kg,toString:Kg}));function Yg(){return`#${Ga(this.r)}${Ga(this.g)}${Ga(this.b)}`}function ub(){return`#${Ga(this.r)}${Ga(this.g)}${Ga(this.b)}${Ga((isNaN(this.opacity)?1:this.opacity)*255)}`}function Kg(){const h=Md(this.opacity);return`${h===1?"rgb(":"rgba("}${Wa(this.r)}, ${Wa(this.g)}, ${Wa(this.b)}${h===1?")":`, ${h})`}`}function Md(h){return isNaN(h)?1:Math.max(0,Math.min(1,h))}function Wa(h){return Math.max(0,Math.min(255,Math.round(h)||0))}function Ga(h){return h=Wa(h),(h<16?"0":"")+h.toString(16)}function Jg(h,f,y,w){return w<=0?h=f=y=NaN:y<=0||y>=1?h=f=NaN:f<=0&&(h=NaN),new To(h,f,y,w)}function g0(h){if(h instanceof To)return new To(h.h,h.s,h.l,h.opacity);if(h instanceof Zu||(h=Nu(h)),!h)return new To;if(h instanceof To)return h;h=h.rgb();var f=h.r/255,y=h.g/255,w=h.b/255,S=Math.min(f,y,w),k=Math.max(f,y,w),z=NaN,o=k-S,L=(k+S)/2;return o?(f===k?z=(y-w)/o+(y<w)*6:y===k?z=(w-f)/o+2:z=(f-y)/o+4,o/=L<.5?k+S:2-k-S,z*=60):o=L>0&&L<1?0:z,new To(z,o,L,h.opacity)}function hb(h,f,y,w){return arguments.length===1?g0(h):new To(h,f,y,w??1)}function To(h,f,y,w){this.h=+h,this.s=+f,this.l=+y,this.opacity=+w}Kp(To,hb,_0(Zu,{brighter(h){return h=h==null?Ed:Math.pow(Ed,h),new To(this.h,this.s,this.l*h,this.opacity)},darker(h){return h=h==null?Fu:Math.pow(Fu,h),new To(this.h,this.s,this.l*h,this.opacity)},rgb(){var h=this.h%360+(this.h<0)*360,f=isNaN(h)||isNaN(this.s)?0:this.s,y=this.l,w=y+(y<.5?y:1-y)*f,S=2*y-w;return new Cr(Mp(h>=240?h-240:h+120,S,w),Mp(h,S,w),Mp(h<120?h+240:h-120,S,w),this.opacity)},clamp(){return new To($g(this.h),yd(this.s),yd(this.l),Md(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const h=Md(this.opacity);return`${h===1?"hsl(":"hsla("}${$g(this.h)}, ${yd(this.s)*100}%, ${yd(this.l)*100}%${h===1?")":`, ${h})`}`}}));function $g(h){return h=(h||0)%360,h<0?h+360:h}function yd(h){return Math.max(0,Math.min(1,h||0))}function Mp(h,f,y){return(h<60?f+(y-f)*h/60:h<180?y:h<240?f+(y-f)*(240-h)/60:f)*255}const Jp=h=>()=>h;function db(h,f){return function(y){return h+y*f}}function fb(h,f,y){return h=Math.pow(h,y),f=Math.pow(f,y)-h,y=1/y,function(w){return Math.pow(h+w*f,y)}}function pb(h){return(h=+h)==1?y0:function(f,y){return y-f?fb(f,y,h):Jp(isNaN(f)?y:f)}}function y0(h,f){var y=f-h;return y?db(h,y):Jp(isNaN(h)?f:h)}const Qg=function h(f){var y=pb(f);function w(S,k){var z=y((S=Fp(S)).r,(k=Fp(k)).r),o=y(S.g,k.g),L=y(S.b,k.b),F=y0(S.opacity,k.opacity);return function(Q){return S.r=z(Q),S.g=o(Q),S.b=L(Q),S.opacity=F(Q),S+""}}return w.gamma=h,w}(1);function mb(h,f){f||(f=[]);var y=h?Math.min(f.length,h.length):0,w=f.slice(),S;return function(k){for(S=0;S<y;++S)w[S]=h[S]*(1-k)+f[S]*k;return w}}function _b(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)}function gb(h,f){var y=f?f.length:0,w=h?Math.min(y,h.length):0,S=new Array(w),k=new Array(y),z;for(z=0;z<w;++z)S[z]=$p(h[z],f[z]);for(;z<y;++z)k[z]=f[z];return function(o){for(z=0;z<w;++z)k[z]=S[z](o);return k}}function yb(h,f){var y=new Date;return h=+h,f=+f,function(w){return y.setTime(h*(1-w)+f*w),y}}function Sd(h,f){return h=+h,f=+f,function(y){return h*(1-y)+f*y}}function xb(h,f){var y={},w={},S;(h===null||typeof h!="object")&&(h={}),(f===null||typeof f!="object")&&(f={});for(S in f)S in h?y[S]=$p(h[S],f[S]):w[S]=f[S];return function(k){for(S in y)w[S]=y[S](k);return w}}var Up=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sp=new RegExp(Up.source,"g");function vb(h){return function(){return h}}function bb(h){return function(f){return h(f)+""}}function wb(h,f){var y=Up.lastIndex=Sp.lastIndex=0,w,S,k,z=-1,o=[],L=[];for(h=h+"",f=f+"";(w=Up.exec(h))&&(S=Sp.exec(f));)(k=S.index)>y&&(k=f.slice(y,k),o[z]?o[z]+=k:o[++z]=k),(w=w[0])===(S=S[0])?o[z]?o[z]+=S:o[++z]=S:(o[++z]=null,L.push({i:z,x:Sd(w,S)})),y=Sp.lastIndex;return y<f.length&&(k=f.slice(y),o[z]?o[z]+=k:o[++z]=k),o.length<2?L[0]?bb(L[0].x):vb(f):(f=L.length,function(F){for(var Q=0,H;Q<f;++Q)o[(H=L[Q]).i]=H.x(F);return o.join("")})}function $p(h,f){var y=typeof f,w;return f==null||y==="boolean"?Jp(f):(y==="number"?Sd:y==="string"?(w=Nu(f))?(f=w,Qg):wb:f instanceof Nu?Qg:f instanceof Date?yb:_b(f)?mb:Array.isArray(f)?gb:typeof f.valueOf!="function"&&typeof f.toString!="function"||isNaN(f)?xb:Sd)(h,f)}function Tb(h,f){return h=+h,f=+f,function(y){return Math.round(h*(1-y)+f*y)}}function Eb(h){return function(){return h}}function Mb(h){return+h}var ey=[0,1];function ec(h){return h}function Np(h,f){return(f-=h=+h)?function(y){return(y-h)/f}:Eb(isNaN(f)?NaN:.5)}function Sb(h,f){var y;return h>f&&(y=h,h=f,f=y),function(w){return Math.max(h,Math.min(f,w))}}function Ab(h,f,y){var w=h[0],S=h[1],k=f[0],z=f[1];return S<w?(w=Np(S,w),k=y(z,k)):(w=Np(w,S),k=y(k,z)),function(o){return k(w(o))}}function Cb(h,f,y){var w=Math.min(h.length,f.length)-1,S=new Array(w),k=new Array(w),z=-1;for(h[w]<h[0]&&(h=h.slice().reverse(),f=f.slice().reverse());++z<w;)S[z]=Np(h[z],h[z+1]),k[z]=y(f[z],f[z+1]);return function(o){var L=Lv(h,o,1,w)-1;return k[L](S[L](o))}}function x0(h,f){return f.domain(h.domain()).range(h.range()).interpolate(h.interpolate()).clamp(h.clamp()).unknown(h.unknown())}function Ib(){var h=ey,f=ey,y=$p,w,S,k,z=ec,o,L,F;function Q(){var ce=Math.min(h.length,f.length);return z!==ec&&(z=Sb(h[0],h[ce-1])),o=ce>2?Cb:Ab,L=F=null,H}function H(ce){return ce==null||isNaN(ce=+ce)?k:(L||(L=o(h.map(w),f,y)))(w(z(ce)))}return H.invert=function(ce){return z(S((F||(F=o(f,h.map(w),Sd)))(ce)))},H.domain=function(ce){return arguments.length?(h=Array.from(ce,Mb),Q()):h.slice()},H.range=function(ce){return arguments.length?(f=Array.from(ce),Q()):f.slice()},H.rangeRound=function(ce){return f=Array.from(ce),y=Tb,Q()},H.clamp=function(ce){return arguments.length?(z=ce?!0:ec,Q()):z!==ec},H.interpolate=function(ce){return arguments.length?(y=ce,Q()):y},H.unknown=function(ce){return arguments.length?(k=ce,H):k},function(ce,de){return w=ce,S=de,Q()}}function v0(){return Ib()(ec,ec)}function kb(h){return Math.abs(h=Math.round(h))>=1e21?h.toLocaleString("en").replace(/,/g,""):h.toString(10)}function Ad(h,f){if((y=(h=f?h.toExponential(f-1):h.toExponential()).indexOf("e"))<0)return null;var y,w=h.slice(0,y);return[w.length>1?w[0]+w.slice(2):w,+h.slice(y+1)]}function rc(h){return h=Ad(Math.abs(h)),h?h[1]:NaN}function zb(h,f){return function(y,w){for(var S=y.length,k=[],z=0,o=h[0],L=0;S>0&&o>0&&(L+o+1>w&&(o=Math.max(1,w-L)),k.push(y.substring(S-=o,S+o)),!((L+=o+1)>w));)o=h[z=(z+1)%h.length];return k.reverse().join(f)}}function Pb(h){return function(f){return f.replace(/[0-9]/g,function(y){return h[+y]})}}var Db=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Cd(h){if(!(f=Db.exec(h)))throw new Error("invalid format: "+h);var f;return new Qp({fill:f[1],align:f[2],sign:f[3],symbol:f[4],zero:f[5],width:f[6],comma:f[7],precision:f[8]&&f[8].slice(1),trim:f[9],type:f[10]})}Cd.prototype=Qp.prototype;function Qp(h){this.fill=h.fill===void 0?" ":h.fill+"",this.align=h.align===void 0?">":h.align+"",this.sign=h.sign===void 0?"-":h.sign+"",this.symbol=h.symbol===void 0?"":h.symbol+"",this.zero=!!h.zero,this.width=h.width===void 0?void 0:+h.width,this.comma=!!h.comma,this.precision=h.precision===void 0?void 0:+h.precision,this.trim=!!h.trim,this.type=h.type===void 0?"":h.type+""}Qp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Lb(h){e:for(var f=h.length,y=1,w=-1,S;y<f;++y)switch(h[y]){case".":w=S=y;break;case"0":w===0&&(w=y),S=y;break;default:if(!+h[y])break e;w>0&&(w=0);break}return w>0?h.slice(0,w)+h.slice(S+1):h}var b0;function Rb(h,f){var y=Ad(h,f);if(!y)return h+"";var w=y[0],S=y[1],k=S-(b0=Math.max(-8,Math.min(8,Math.floor(S/3)))*3)+1,z=w.length;return k===z?w:k>z?w+new Array(k-z+1).join("0"):k>0?w.slice(0,k)+"."+w.slice(k):"0."+new Array(1-k).join("0")+Ad(h,Math.max(0,f+k-1))[0]}function ty(h,f){var y=Ad(h,f);if(!y)return h+"";var w=y[0],S=y[1];return S<0?"0."+new Array(-S).join("0")+w:w.length>S+1?w.slice(0,S+1)+"."+w.slice(S+1):w+new Array(S-w.length+2).join("0")}const iy={"%":(h,f)=>(h*100).toFixed(f),b:h=>Math.round(h).toString(2),c:h=>h+"",d:kb,e:(h,f)=>h.toExponential(f),f:(h,f)=>h.toFixed(f),g:(h,f)=>h.toPrecision(f),o:h=>Math.round(h).toString(8),p:(h,f)=>ty(h*100,f),r:ty,s:Rb,X:h=>Math.round(h).toString(16).toUpperCase(),x:h=>Math.round(h).toString(16)};function ny(h){return h}var ry=Array.prototype.map,oy=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Bb(h){var f=h.grouping===void 0||h.thousands===void 0?ny:zb(ry.call(h.grouping,Number),h.thousands+""),y=h.currency===void 0?"":h.currency[0]+"",w=h.currency===void 0?"":h.currency[1]+"",S=h.decimal===void 0?".":h.decimal+"",k=h.numerals===void 0?ny:Pb(ry.call(h.numerals,String)),z=h.percent===void 0?"%":h.percent+"",o=h.minus===void 0?"−":h.minus+"",L=h.nan===void 0?"NaN":h.nan+"";function F(H){H=Cd(H);var ce=H.fill,de=H.align,ye=H.sign,Ee=H.symbol,Xe=H.zero,ut=H.width,at=H.comma,Ie=H.precision,ct=H.trim,ve=H.type;ve==="n"?(at=!0,ve="g"):iy[ve]||(Ie===void 0&&(Ie=12),ct=!0,ve="g"),(Xe||ce==="0"&&de==="=")&&(Xe=!0,ce="0",de="=");var Oe=Ee==="$"?y:Ee==="#"&&/[boxX]/.test(ve)?"0"+ve.toLowerCase():"",Ze=Ee==="$"?w:/[%p]/.test(ve)?z:"",He=iy[ve],Be=/[defgprs%]/.test(ve);Ie=Ie===void 0?6:/[gprs]/.test(ve)?Math.max(1,Math.min(21,Ie)):Math.max(0,Math.min(20,Ie));function Ut(Pe){var tt=Oe,St=Ze,Ot,vi,qt;if(ve==="c")St=He(Pe)+St,Pe="";else{Pe=+Pe;var ri=Pe<0||1/Pe<0;if(Pe=isNaN(Pe)?L:He(Math.abs(Pe),Ie),ct&&(Pe=Lb(Pe)),ri&&+Pe==0&&ye!=="+"&&(ri=!1),tt=(ri?ye==="("?ye:o:ye==="-"||ye==="("?"":ye)+tt,St=(ve==="s"?oy[8+b0/3]:"")+St+(ri&&ye==="("?")":""),Be){for(Ot=-1,vi=Pe.length;++Ot<vi;)if(qt=Pe.charCodeAt(Ot),48>qt||qt>57){St=(qt===46?S+Pe.slice(Ot+1):Pe.slice(Ot))+St,Pe=Pe.slice(0,Ot);break}}}at&&!Xe&&(Pe=f(Pe,1/0));var je=tt.length+Pe.length+St.length,dt=je<ut?new Array(ut-je+1).join(ce):"";switch(at&&Xe&&(Pe=f(dt+Pe,dt.length?ut-St.length:1/0),dt=""),de){case"<":Pe=tt+Pe+St+dt;break;case"=":Pe=tt+dt+Pe+St;break;case"^":Pe=dt.slice(0,je=dt.length>>1)+tt+Pe+St+dt.slice(je);break;default:Pe=dt+tt+Pe+St;break}return k(Pe)}return Ut.toString=function(){return H+""},Ut}function Q(H,ce){var de=F((H=Cd(H),H.type="f",H)),ye=Math.max(-8,Math.min(8,Math.floor(rc(ce)/3)))*3,Ee=Math.pow(10,-ye),Xe=oy[8+ye/3];return function(ut){return de(Ee*ut)+Xe}}return{format:F,formatPrefix:Q}}var xd,w0,T0;Ob({thousands:",",grouping:[3],currency:["$",""]});function Ob(h){return xd=Bb(h),w0=xd.format,T0=xd.formatPrefix,xd}function Fb(h){return Math.max(0,-rc(Math.abs(h)))}function Ub(h,f){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(rc(f)/3)))*3-rc(Math.abs(h)))}function Nb(h,f){return h=Math.abs(h),f=Math.abs(f)-h,Math.max(0,rc(f)-rc(h))+1}function Vb(h,f,y,w){var S=Rp(h,f,y),k;switch(w=Cd(w??",f"),w.type){case"s":{var z=Math.max(Math.abs(h),Math.abs(f));return w.precision==null&&!isNaN(k=Ub(S,z))&&(w.precision=k),T0(w,z)}case"":case"e":case"g":case"p":case"r":{w.precision==null&&!isNaN(k=Nb(S,Math.max(Math.abs(h),Math.abs(f))))&&(w.precision=k-(w.type==="e"));break}case"f":case"%":{w.precision==null&&!isNaN(k=Fb(S))&&(w.precision=k-(w.type==="%")*2);break}}return w0(w)}function jb(h){var f=h.domain;return h.ticks=function(y){var w=f();return jv(w[0],w[w.length-1],y??10)},h.tickFormat=function(y,w){var S=f();return Vb(S[0],S[S.length-1],y??10,w)},h.nice=function(y){y==null&&(y=10);var w=f(),S=0,k=w.length-1,z=w[S],o=w[k],L,F,Q=10;for(o<z&&(F=z,z=o,o=F,F=S,S=k,k=F);Q-- >0;){if(F=Lp(z,o,y),F===L)return w[S]=z,w[k]=o,f(w);if(F>0)z=Math.floor(z/F)*F,o=Math.ceil(o/F)*F;else if(F<0)z=Math.ceil(z*F)/F,o=Math.floor(o*F)/F;else break;L=F}return h},h}function E0(){var h=v0();return h.copy=function(){return x0(h,E0())},Yp.apply(h,arguments),jb(h)}function Gb(h,f){h=h.slice();var y=0,w=h.length-1,S=h[y],k=h[w],z;return k<S&&(z=y,y=w,w=z,z=S,S=k,k=z),h[y]=f.floor(S),h[w]=f.ceil(k),h}const Ap=new Date,Cp=new Date;function Nn(h,f,y,w){function S(k){return h(k=arguments.length===0?new Date:new Date(+k)),k}return S.floor=k=>(h(k=new Date(+k)),k),S.ceil=k=>(h(k=new Date(k-1)),f(k,1),h(k),k),S.round=k=>{const z=S(k),o=S.ceil(k);return k-z<o-k?z:o},S.offset=(k,z)=>(f(k=new Date(+k),z==null?1:Math.floor(z)),k),S.range=(k,z,o)=>{const L=[];if(k=S.ceil(k),o=o==null?1:Math.floor(o),!(k<z)||!(o>0))return L;let F;do L.push(F=new Date(+k)),f(k,o),h(k);while(F<k&&k<z);return L},S.filter=k=>Nn(z=>{if(z>=z)for(;h(z),!k(z);)z.setTime(z-1)},(z,o)=>{if(z>=z)if(o<0)for(;++o<=0;)for(;f(z,-1),!k(z););else for(;--o>=0;)for(;f(z,1),!k(z););}),y&&(S.count=(k,z)=>(Ap.setTime(+k),Cp.setTime(+z),h(Ap),h(Cp),Math.floor(y(Ap,Cp))),S.every=k=>(k=Math.floor(k),!isFinite(k)||!(k>0)?null:k>1?S.filter(w?z=>w(z)%k===0:z=>S.count(0,z)%k===0):S)),S}const Id=Nn(()=>{},(h,f)=>{h.setTime(+h+f)},(h,f)=>f-h);Id.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?Nn(f=>{f.setTime(Math.floor(f/h)*h)},(f,y)=>{f.setTime(+f+y*h)},(f,y)=>(y-f)/h):Id);Id.range;const us=1e3,to=us*60,hs=to*60,ds=hs*24,em=ds*7,sy=ds*30,Ip=ds*365,tc=Nn(h=>{h.setTime(h-h.getMilliseconds())},(h,f)=>{h.setTime(+h+f*us)},(h,f)=>(f-h)/us,h=>h.getUTCSeconds());tc.range;const tm=Nn(h=>{h.setTime(h-h.getMilliseconds()-h.getSeconds()*us)},(h,f)=>{h.setTime(+h+f*to)},(h,f)=>(f-h)/to,h=>h.getMinutes());tm.range;const qb=Nn(h=>{h.setUTCSeconds(0,0)},(h,f)=>{h.setTime(+h+f*to)},(h,f)=>(f-h)/to,h=>h.getUTCMinutes());qb.range;const im=Nn(h=>{h.setTime(h-h.getMilliseconds()-h.getSeconds()*us-h.getMinutes()*to)},(h,f)=>{h.setTime(+h+f*hs)},(h,f)=>(f-h)/hs,h=>h.getHours());im.range;const Zb=Nn(h=>{h.setUTCMinutes(0,0,0)},(h,f)=>{h.setTime(+h+f*hs)},(h,f)=>(f-h)/hs,h=>h.getUTCHours());Zb.range;const Wu=Nn(h=>h.setHours(0,0,0,0),(h,f)=>h.setDate(h.getDate()+f),(h,f)=>(f-h-(f.getTimezoneOffset()-h.getTimezoneOffset())*to)/ds,h=>h.getDate()-1);Wu.range;const nm=Nn(h=>{h.setUTCHours(0,0,0,0)},(h,f)=>{h.setUTCDate(h.getUTCDate()+f)},(h,f)=>(f-h)/ds,h=>h.getUTCDate()-1);nm.range;const Wb=Nn(h=>{h.setUTCHours(0,0,0,0)},(h,f)=>{h.setUTCDate(h.getUTCDate()+f)},(h,f)=>(f-h)/ds,h=>Math.floor(h/ds));Wb.range;function Ja(h){return Nn(f=>{f.setDate(f.getDate()-(f.getDay()+7-h)%7),f.setHours(0,0,0,0)},(f,y)=>{f.setDate(f.getDate()+y*7)},(f,y)=>(y-f-(y.getTimezoneOffset()-f.getTimezoneOffset())*to)/em)}const Od=Ja(0),kd=Ja(1),Xb=Ja(2),Hb=Ja(3),oc=Ja(4),Yb=Ja(5),Kb=Ja(6);Od.range;kd.range;Xb.range;Hb.range;oc.range;Yb.range;Kb.range;function $a(h){return Nn(f=>{f.setUTCDate(f.getUTCDate()-(f.getUTCDay()+7-h)%7),f.setUTCHours(0,0,0,0)},(f,y)=>{f.setUTCDate(f.getUTCDate()+y*7)},(f,y)=>(y-f)/em)}const M0=$a(0),zd=$a(1),Jb=$a(2),$b=$a(3),sc=$a(4),Qb=$a(5),ew=$a(6);M0.range;zd.range;Jb.range;$b.range;sc.range;Qb.range;ew.range;const Vu=Nn(h=>{h.setDate(1),h.setHours(0,0,0,0)},(h,f)=>{h.setMonth(h.getMonth()+f)},(h,f)=>f.getMonth()-h.getMonth()+(f.getFullYear()-h.getFullYear())*12,h=>h.getMonth());Vu.range;const tw=Nn(h=>{h.setUTCDate(1),h.setUTCHours(0,0,0,0)},(h,f)=>{h.setUTCMonth(h.getUTCMonth()+f)},(h,f)=>f.getUTCMonth()-h.getUTCMonth()+(f.getUTCFullYear()-h.getUTCFullYear())*12,h=>h.getUTCMonth());tw.range;const Go=Nn(h=>{h.setMonth(0,1),h.setHours(0,0,0,0)},(h,f)=>{h.setFullYear(h.getFullYear()+f)},(h,f)=>f.getFullYear()-h.getFullYear(),h=>h.getFullYear());Go.every=h=>!isFinite(h=Math.floor(h))||!(h>0)?null:Nn(f=>{f.setFullYear(Math.floor(f.getFullYear()/h)*h),f.setMonth(0,1),f.setHours(0,0,0,0)},(f,y)=>{f.setFullYear(f.getFullYear()+y*h)});Go.range;const Ha=Nn(h=>{h.setUTCMonth(0,1),h.setUTCHours(0,0,0,0)},(h,f)=>{h.setUTCFullYear(h.getUTCFullYear()+f)},(h,f)=>f.getUTCFullYear()-h.getUTCFullYear(),h=>h.getUTCFullYear());Ha.every=h=>!isFinite(h=Math.floor(h))||!(h>0)?null:Nn(f=>{f.setUTCFullYear(Math.floor(f.getUTCFullYear()/h)*h),f.setUTCMonth(0,1),f.setUTCHours(0,0,0,0)},(f,y)=>{f.setUTCFullYear(f.getUTCFullYear()+y*h)});Ha.range;function iw(h,f,y,w,S,k){const z=[[tc,1,us],[tc,5,5*us],[tc,15,15*us],[tc,30,30*us],[k,1,to],[k,5,5*to],[k,15,15*to],[k,30,30*to],[S,1,hs],[S,3,3*hs],[S,6,6*hs],[S,12,12*hs],[w,1,ds],[w,2,2*ds],[y,1,em],[f,1,sy],[f,3,3*sy],[h,1,Ip]];function o(F,Q,H){const ce=Q<F;ce&&([F,Q]=[Q,F]);const de=H&&typeof H.range=="function"?H:L(F,Q,H),ye=de?de.range(F,+Q+1):[];return ce?ye.reverse():ye}function L(F,Q,H){const ce=Math.abs(Q-F)/H,de=Hp(([,,Xe])=>Xe).right(z,ce);if(de===z.length)return h.every(Rp(F/Ip,Q/Ip,H));if(de===0)return Id.every(Math.max(Rp(F,Q,H),1));const[ye,Ee]=z[ce/z[de-1][2]<z[de][2]/ce?de-1:de];return ye.every(Ee)}return[o,L]}const[nw,rw]=iw(Go,Vu,Od,Wu,im,tm);function kp(h){if(0<=h.y&&h.y<100){var f=new Date(-1,h.m,h.d,h.H,h.M,h.S,h.L);return f.setFullYear(h.y),f}return new Date(h.y,h.m,h.d,h.H,h.M,h.S,h.L)}function zp(h){if(0<=h.y&&h.y<100){var f=new Date(Date.UTC(-1,h.m,h.d,h.H,h.M,h.S,h.L));return f.setUTCFullYear(h.y),f}return new Date(Date.UTC(h.y,h.m,h.d,h.H,h.M,h.S,h.L))}function Ru(h,f,y){return{y:h,m:f,d:y,H:0,M:0,S:0,L:0}}function ow(h){var f=h.dateTime,y=h.date,w=h.time,S=h.periods,k=h.days,z=h.shortDays,o=h.months,L=h.shortMonths,F=Bu(S),Q=Ou(S),H=Bu(k),ce=Ou(k),de=Bu(z),ye=Ou(z),Ee=Bu(o),Xe=Ou(o),ut=Bu(L),at=Ou(L),Ie={a:ri,A:je,b:dt,B:gt,c:null,d:dy,e:dy,f:Cw,g:Fw,G:Nw,H:Mw,I:Sw,j:Aw,L:S0,m:Iw,M:kw,p:Nt,q:Ai,Q:my,s:_y,S:zw,u:Pw,U:Dw,V:Lw,w:Rw,W:Bw,x:null,X:null,y:Ow,Y:Uw,Z:Vw,"%":py},ct={a:ti,A:Ji,b:vn,B:An,c:null,d:fy,e:fy,f:Zw,g:t2,G:n2,H:jw,I:Gw,j:qw,L:C0,m:Ww,M:Xw,p:Mn,q:$n,Q:my,s:_y,S:Hw,u:Yw,U:Kw,V:Jw,w:$w,W:Qw,x:null,X:null,y:e2,Y:i2,Z:r2,"%":py},ve={a:Ut,A:Pe,b:tt,B:St,c:Ot,d:uy,e:uy,f:bw,g:cy,G:ly,H:hy,I:hy,j:gw,L:vw,m:_w,M:yw,p:Be,q:mw,Q:Tw,s:Ew,S:xw,u:uw,U:hw,V:dw,w:cw,W:fw,x:vi,X:qt,y:cy,Y:ly,Z:pw,"%":ww};Ie.x=Oe(y,Ie),Ie.X=Oe(w,Ie),Ie.c=Oe(f,Ie),ct.x=Oe(y,ct),ct.X=Oe(w,ct),ct.c=Oe(f,ct);function Oe(xt,Ft){return function(vt){var lt=[],ci=-1,At=0,ei=xt.length,bi,tn,$i;for(vt instanceof Date||(vt=new Date(+vt));++ci<ei;)xt.charCodeAt(ci)===37&&(lt.push(xt.slice(At,ci)),(tn=ay[bi=xt.charAt(++ci)])!=null?bi=xt.charAt(++ci):tn=bi==="e"?" ":"0",($i=Ft[bi])&&(bi=$i(vt,tn)),lt.push(bi),At=ci+1);return lt.push(xt.slice(At,ci)),lt.join("")}}function Ze(xt,Ft){return function(vt){var lt=Ru(1900,void 0,1),ci=He(lt,xt,vt+="",0),At,ei;if(ci!=vt.length)return null;if("Q"in lt)return new Date(lt.Q);if("s"in lt)return new Date(lt.s*1e3+("L"in lt?lt.L:0));if(Ft&&!("Z"in lt)&&(lt.Z=0),"p"in lt&&(lt.H=lt.H%12+lt.p*12),lt.m===void 0&&(lt.m="q"in lt?lt.q:0),"V"in lt){if(lt.V<1||lt.V>53)return null;"w"in lt||(lt.w=1),"Z"in lt?(At=zp(Ru(lt.y,0,1)),ei=At.getUTCDay(),At=ei>4||ei===0?zd.ceil(At):zd(At),At=nm.offset(At,(lt.V-1)*7),lt.y=At.getUTCFullYear(),lt.m=At.getUTCMonth(),lt.d=At.getUTCDate()+(lt.w+6)%7):(At=kp(Ru(lt.y,0,1)),ei=At.getDay(),At=ei>4||ei===0?kd.ceil(At):kd(At),At=Wu.offset(At,(lt.V-1)*7),lt.y=At.getFullYear(),lt.m=At.getMonth(),lt.d=At.getDate()+(lt.w+6)%7)}else("W"in lt||"U"in lt)&&("w"in lt||(lt.w="u"in lt?lt.u%7:"W"in lt?1:0),ei="Z"in lt?zp(Ru(lt.y,0,1)).getUTCDay():kp(Ru(lt.y,0,1)).getDay(),lt.m=0,lt.d="W"in lt?(lt.w+6)%7+lt.W*7-(ei+5)%7:lt.w+lt.U*7-(ei+6)%7);return"Z"in lt?(lt.H+=lt.Z/100|0,lt.M+=lt.Z%100,zp(lt)):kp(lt)}}function He(xt,Ft,vt,lt){for(var ci=0,At=Ft.length,ei=vt.length,bi,tn;ci<At;){if(lt>=ei)return-1;if(bi=Ft.charCodeAt(ci++),bi===37){if(bi=Ft.charAt(ci++),tn=ve[bi in ay?Ft.charAt(ci++):bi],!tn||(lt=tn(xt,vt,lt))<0)return-1}else if(bi!=vt.charCodeAt(lt++))return-1}return lt}function Be(xt,Ft,vt){var lt=F.exec(Ft.slice(vt));return lt?(xt.p=Q.get(lt[0].toLowerCase()),vt+lt[0].length):-1}function Ut(xt,Ft,vt){var lt=de.exec(Ft.slice(vt));return lt?(xt.w=ye.get(lt[0].toLowerCase()),vt+lt[0].length):-1}function Pe(xt,Ft,vt){var lt=H.exec(Ft.slice(vt));return lt?(xt.w=ce.get(lt[0].toLowerCase()),vt+lt[0].length):-1}function tt(xt,Ft,vt){var lt=ut.exec(Ft.slice(vt));return lt?(xt.m=at.get(lt[0].toLowerCase()),vt+lt[0].length):-1}function St(xt,Ft,vt){var lt=Ee.exec(Ft.slice(vt));return lt?(xt.m=Xe.get(lt[0].toLowerCase()),vt+lt[0].length):-1}function Ot(xt,Ft,vt){return He(xt,f,Ft,vt)}function vi(xt,Ft,vt){return He(xt,y,Ft,vt)}function qt(xt,Ft,vt){return He(xt,w,Ft,vt)}function ri(xt){return z[xt.getDay()]}function je(xt){return k[xt.getDay()]}function dt(xt){return L[xt.getMonth()]}function gt(xt){return o[xt.getMonth()]}function Nt(xt){return S[+(xt.getHours()>=12)]}function Ai(xt){return 1+~~(xt.getMonth()/3)}function ti(xt){return z[xt.getUTCDay()]}function Ji(xt){return k[xt.getUTCDay()]}function vn(xt){return L[xt.getUTCMonth()]}function An(xt){return o[xt.getUTCMonth()]}function Mn(xt){return S[+(xt.getUTCHours()>=12)]}function $n(xt){return 1+~~(xt.getUTCMonth()/3)}return{format:function(xt){var Ft=Oe(xt+="",Ie);return Ft.toString=function(){return xt},Ft},parse:function(xt){var Ft=Ze(xt+="",!1);return Ft.toString=function(){return xt},Ft},utcFormat:function(xt){var Ft=Oe(xt+="",ct);return Ft.toString=function(){return xt},Ft},utcParse:function(xt){var Ft=Ze(xt+="",!0);return Ft.toString=function(){return xt},Ft}}}var ay={"-":"",_:" ",0:"0"},Wn=/^\s*\d+/,sw=/^%/,aw=/[\\^$*+?|[\]().{}]/g;function Oi(h,f,y){var w=h<0?"-":"",S=(w?-h:h)+"",k=S.length;return w+(k<y?new Array(y-k+1).join(f)+S:S)}function lw(h){return h.replace(aw,"\\$&")}function Bu(h){return new RegExp("^(?:"+h.map(lw).join("|")+")","i")}function Ou(h){return new Map(h.map((f,y)=>[f.toLowerCase(),y]))}function cw(h,f,y){var w=Wn.exec(f.slice(y,y+1));return w?(h.w=+w[0],y+w[0].length):-1}function uw(h,f,y){var w=Wn.exec(f.slice(y,y+1));return w?(h.u=+w[0],y+w[0].length):-1}function hw(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.U=+w[0],y+w[0].length):-1}function dw(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.V=+w[0],y+w[0].length):-1}function fw(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.W=+w[0],y+w[0].length):-1}function ly(h,f,y){var w=Wn.exec(f.slice(y,y+4));return w?(h.y=+w[0],y+w[0].length):-1}function cy(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.y=+w[0]+(+w[0]>68?1900:2e3),y+w[0].length):-1}function pw(h,f,y){var w=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(f.slice(y,y+6));return w?(h.Z=w[1]?0:-(w[2]+(w[3]||"00")),y+w[0].length):-1}function mw(h,f,y){var w=Wn.exec(f.slice(y,y+1));return w?(h.q=w[0]*3-3,y+w[0].length):-1}function _w(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.m=w[0]-1,y+w[0].length):-1}function uy(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.d=+w[0],y+w[0].length):-1}function gw(h,f,y){var w=Wn.exec(f.slice(y,y+3));return w?(h.m=0,h.d=+w[0],y+w[0].length):-1}function hy(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.H=+w[0],y+w[0].length):-1}function yw(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.M=+w[0],y+w[0].length):-1}function xw(h,f,y){var w=Wn.exec(f.slice(y,y+2));return w?(h.S=+w[0],y+w[0].length):-1}function vw(h,f,y){var w=Wn.exec(f.slice(y,y+3));return w?(h.L=+w[0],y+w[0].length):-1}function bw(h,f,y){var w=Wn.exec(f.slice(y,y+6));return w?(h.L=Math.floor(w[0]/1e3),y+w[0].length):-1}function ww(h,f,y){var w=sw.exec(f.slice(y,y+1));return w?y+w[0].length:-1}function Tw(h,f,y){var w=Wn.exec(f.slice(y));return w?(h.Q=+w[0],y+w[0].length):-1}function Ew(h,f,y){var w=Wn.exec(f.slice(y));return w?(h.s=+w[0],y+w[0].length):-1}function dy(h,f){return Oi(h.getDate(),f,2)}function Mw(h,f){return Oi(h.getHours(),f,2)}function Sw(h,f){return Oi(h.getHours()%12||12,f,2)}function Aw(h,f){return Oi(1+Wu.count(Go(h),h),f,3)}function S0(h,f){return Oi(h.getMilliseconds(),f,3)}function Cw(h,f){return S0(h,f)+"000"}function Iw(h,f){return Oi(h.getMonth()+1,f,2)}function kw(h,f){return Oi(h.getMinutes(),f,2)}function zw(h,f){return Oi(h.getSeconds(),f,2)}function Pw(h){var f=h.getDay();return f===0?7:f}function Dw(h,f){return Oi(Od.count(Go(h)-1,h),f,2)}function A0(h){var f=h.getDay();return f>=4||f===0?oc(h):oc.ceil(h)}function Lw(h,f){return h=A0(h),Oi(oc.count(Go(h),h)+(Go(h).getDay()===4),f,2)}function Rw(h){return h.getDay()}function Bw(h,f){return Oi(kd.count(Go(h)-1,h),f,2)}function Ow(h,f){return Oi(h.getFullYear()%100,f,2)}function Fw(h,f){return h=A0(h),Oi(h.getFullYear()%100,f,2)}function Uw(h,f){return Oi(h.getFullYear()%1e4,f,4)}function Nw(h,f){var y=h.getDay();return h=y>=4||y===0?oc(h):oc.ceil(h),Oi(h.getFullYear()%1e4,f,4)}function Vw(h){var f=h.getTimezoneOffset();return(f>0?"-":(f*=-1,"+"))+Oi(f/60|0,"0",2)+Oi(f%60,"0",2)}function fy(h,f){return Oi(h.getUTCDate(),f,2)}function jw(h,f){return Oi(h.getUTCHours(),f,2)}function Gw(h,f){return Oi(h.getUTCHours()%12||12,f,2)}function qw(h,f){return Oi(1+nm.count(Ha(h),h),f,3)}function C0(h,f){return Oi(h.getUTCMilliseconds(),f,3)}function Zw(h,f){return C0(h,f)+"000"}function Ww(h,f){return Oi(h.getUTCMonth()+1,f,2)}function Xw(h,f){return Oi(h.getUTCMinutes(),f,2)}function Hw(h,f){return Oi(h.getUTCSeconds(),f,2)}function Yw(h){var f=h.getUTCDay();return f===0?7:f}function Kw(h,f){return Oi(M0.count(Ha(h)-1,h),f,2)}function I0(h){var f=h.getUTCDay();return f>=4||f===0?sc(h):sc.ceil(h)}function Jw(h,f){return h=I0(h),Oi(sc.count(Ha(h),h)+(Ha(h).getUTCDay()===4),f,2)}function $w(h){return h.getUTCDay()}function Qw(h,f){return Oi(zd.count(Ha(h)-1,h),f,2)}function e2(h,f){return Oi(h.getUTCFullYear()%100,f,2)}function t2(h,f){return h=I0(h),Oi(h.getUTCFullYear()%100,f,2)}function i2(h,f){return Oi(h.getUTCFullYear()%1e4,f,4)}function n2(h,f){var y=h.getUTCDay();return h=y>=4||y===0?sc(h):sc.ceil(h),Oi(h.getUTCFullYear()%1e4,f,4)}function r2(){return"+0000"}function py(){return"%"}function my(h){return+h}function _y(h){return Math.floor(+h/1e3)}var Ql,rm,Vp;o2({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function o2(h){return Ql=ow(h),rm=Ql.format,Vp=Ql.parse,Ql.utcFormat,Ql.utcParse,Ql}function s2(h){return new Date(h)}function a2(h){return h instanceof Date?+h:+new Date(+h)}function k0(h,f,y,w,S,k,z,o,L,F){var Q=v0(),H=Q.invert,ce=Q.domain,de=F(".%L"),ye=F(":%S"),Ee=F("%I:%M"),Xe=F("%I %p"),ut=F("%a %d"),at=F("%b %d"),Ie=F("%B"),ct=F("%Y");function ve(Oe){return(L(Oe)<Oe?de:o(Oe)<Oe?ye:z(Oe)<Oe?Ee:k(Oe)<Oe?Xe:w(Oe)<Oe?S(Oe)<Oe?ut:at:y(Oe)<Oe?Ie:ct)(Oe)}return Q.invert=function(Oe){return new Date(H(Oe))},Q.domain=function(Oe){return arguments.length?ce(Array.from(Oe,a2)):ce().map(s2)},Q.ticks=function(Oe){var Ze=ce();return h(Ze[0],Ze[Ze.length-1],Oe??10)},Q.tickFormat=function(Oe,Ze){return Ze==null?ve:F(Ze)},Q.nice=function(Oe){var Ze=ce();return(!Oe||typeof Oe.range!="function")&&(Oe=f(Ze[0],Ze[Ze.length-1],Oe??10)),Oe?ce(Gb(Ze,Oe)):Q},Q.copy=function(){return x0(Q,k0(h,f,y,w,S,k,z,o,L,F))},Q}function l2(){return Yp.apply(k0(nw,rw,Go,Vu,Od,Wu,im,tm,tc,rm).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}rm("%b %Y");const jp=h=>h===void 0?"":(h.getMonth(),`${h.getFullYear()}`),Gp=(h,f)=>Number((h*(f-1)).toFixed(0)),ju=(h,f,y)=>y[Gp(h,f)],eo=(h,f,y)=>jp(ju(h,f,y)),Pp=h=>h.replace(/\w\S*/g,function(f){return f.charAt(0).toUpperCase()+f.substr(1).toLowerCase()}),c2=h=>{const f=h.split(`
`),y=f[0].split(",");return f.slice(1).map(w=>w.split(",").reduce((S,k,z)=>{const o={};return o[y[z]]=k,{...S,...o}},{}))},u2="#DCDCDC",om="#555555",Fd="#FF7440",qp="#E06638",z0="#EEE3D0";function gy(h,f,y){const w=h.slice();return w[21]=f[y],w}function yy(h,f,y){const w=h.slice();return w[24]=f[y],w}function xy(h,f,y){const w=h.slice();return w[24]=f[y],w}function vy(h,f,y){const w=h.slice();return w[29]=f[y],w[31]=y,w}function by(h){let f,y,w=h[29]+"",S;return{c(){f=Fn("rect"),y=Fn("text"),S=Zi(w),this.h()},l(k){f=Un(k,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),Mt(f).forEach(qe),y=Un(k,"text",{x:!0,dy:!0,fill:!0,"font-size":!0,class:!0});var z=Mt(y);S=Wi(z,w),z.forEach(qe),this.h()},h(){_e(f,"x",h[31]*My+Gu),_e(f,"y",0),_e(f,"width",Sy),_e(f,"height",Sy),_e(f,"fill",h[12](h[29])),_e(y,"x",h[31]*My+Gu+14),_e(y,"dy",10),_e(y,"fill",om),_e(y,"font-size",p2),_e(y,"class","svelte-145lpf4")},m(k,z){ni(k,f,z),ni(k,y,z),Ke(y,S)},p:Dn,d(k){k&&(qe(f),qe(y))}}}function wy(h){let f,y,w,S,k=h[24]+"",z,o;return{c(){f=Fn("g"),y=Fn("line"),S=Fn("text"),z=Zi(k),this.h()},l(L){f=Un(L,"g",{transform:!0});var F=Mt(f);y=Un(F,"line",{x1:!0,x2:!0,stroke:!0,"stroke-width":!0}),Mt(y).forEach(qe),S=Un(F,"text",{"text-anchor":!0,dy:!0,x:!0,fill:!0,class:!0});var Q=Mt(S);z=Wi(Q,k),Q.forEach(qe),F.forEach(qe),this.h()},h(){_e(y,"x1",Gu),_e(y,"x2",w=h[0]-Zp),_e(y,"stroke","#DCDCDC"),_e(y,"stroke-width",.5),_e(S,"text-anchor","end"),_e(S,"dy","0.3em"),_e(S,"x",Gu-4),_e(S,"fill","#DCDCDC"),_e(S,"class","svelte-145lpf4"),_e(f,"transform",o=`translate(0,${h[1](h[24])})`)},m(L,F){ni(L,f,F),Ke(f,y),Ke(f,S),Ke(S,z)},p(L,F){F[0]&1&&w!==(w=L[0]-Zp)&&_e(y,"x2",w),F[0]&2&&k!==(k=L[24]+"")&&On(z,k),F[0]&2&&o!==(o=`translate(0,${L[1](L[24])})`)&&_e(f,"transform",o)},d(L){L&&qe(f)}}}function Ty(h){let f,y,w=jp(h[24])+"",S,k,z,o,L,F;return{c(){f=Fn("g"),y=Fn("text"),S=Zi(w),z=Fn("line"),this.h()},l(Q){f=Un(Q,"g",{transform:!0});var H=Mt(f);y=Un(H,"text",{"text-anchor":!0,dy:!0,y:!0,fill:!0,class:!0});var ce=Mt(y);S=Wi(ce,w),ce.forEach(qe),z=Un(H,"line",{y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),Mt(z).forEach(qe),H.forEach(qe),this.h()},h(){_e(y,"text-anchor","middle"),_e(y,"dy","0.3em"),_e(y,"y",k=h[3]-ja+14),_e(y,"fill","#DCDCDC"),_e(y,"class","svelte-145lpf4"),_e(z,"y1",o=h[3]-ja),_e(z,"y2",L=h[3]-ja+4),_e(z,"stroke","#DCDCDC"),_e(z,"stroke-width",1),_e(f,"transform",F=`translate(${h[2](h[24])},0)`)},m(Q,H){ni(Q,f,H),Ke(f,y),Ke(y,S),Ke(f,z)},p(Q,H){H[0]&36&&w!==(w=jp(Q[24])+"")&&On(S,w),H[0]&8&&k!==(k=Q[3]-ja+14)&&_e(y,"y",k),H[0]&8&&o!==(o=Q[3]-ja)&&_e(z,"y1",o),H[0]&8&&L!==(L=Q[3]-ja+4)&&_e(z,"y2",L),H[0]&36&&F!==(F=`translate(${Q[2](Q[24])},0)`)&&_e(f,"transform",F)},d(Q){Q&&qe(f)}}}function h2(h){let f,y,w,S;return{c(){f=Fn("rect"),this.h()},l(k){f=Un(k,"rect",{x:!0,y:!0,height:!0,width:!0,fill:!0}),Mt(f).forEach(qe),this.h()},h(){_e(f,"x",y=h[2](h[4][0].date)-20),_e(f,"y",w=h[1](h[4][0].victims)),_e(f,"height",S=h[1](0)-h[1](h[4][0].victims)),_e(f,"width",40),_e(f,"fill",Fd)},m(k,z){ni(k,f,z)},p(k,z){z[0]&20&&y!==(y=k[2](k[4][0].date)-20)&&_e(f,"x",y),z[0]&18&&w!==(w=k[1](k[4][0].victims))&&_e(f,"y",w),z[0]&18&&S!==(S=k[1](0)-k[1](k[4][0].victims))&&_e(f,"height",S)},d(k){k&&qe(f)}}}function d2(h){let f,y,w,S=Sr(h[4]),k=[];for(let z=0;z<S.length;z+=1)k[z]=Ey(gy(h,S,z));return{c(){f=Fn("path");for(let z=0;z<k.length;z+=1)k[z].c();w=Ar(),this.h()},l(z){f=Un(z,"path",{stroke:!0,fill:!0,"stroke-width":!0,d:!0}),Mt(f).forEach(qe);for(let o=0;o<k.length;o+=1)k[o].l(z);w=Ar(),this.h()},h(){_e(f,"stroke",Fd),_e(f,"fill","none"),_e(f,"stroke-width","1.5"),_e(f,"d",y=h[7](h[4]))},m(z,o){ni(z,f,o);for(let L=0;L<k.length;L+=1)k[L]&&k[L].m(z,o);ni(z,w,o)},p(z,o){if(o[0]&144&&y!==(y=z[7](z[4]))&&_e(f,"d",y),o[0]&22){S=Sr(z[4]);let L;for(L=0;L<S.length;L+=1){const F=gy(z,S,L);k[L]?k[L].p(F,o):(k[L]=Ey(F),k[L].c(),k[L].m(w.parentNode,w))}for(;L<k.length;L+=1)k[L].d(1);k.length=S.length}},d(z){z&&(qe(f),qe(w)),qa(k,z)}}}function Ey(h){let f,y,w;return{c(){f=Fn("circle"),this.h()},l(S){f=Un(S,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Mt(f).forEach(qe),this.h()},h(){_e(f,"cx",y=h[2](h[21].date)),_e(f,"cy",w=h[1](h[21].victims)),_e(f,"r",m2),_e(f,"fill",Fd)},m(S,k){ni(S,f,k)},p(S,k){k[0]&20&&y!==(y=S[2](S[21].date))&&_e(f,"cx",y),k[0]&18&&w!==(w=S[1](S[21].victims))&&_e(f,"cy",w)},d(S){S&&qe(f)}}}function f2(h){let f,y,w,S,k,z,o,L,F;Ug(h[19]);let Q=Sr(h[11]),H=[];for(let Ie=0;Ie<Q.length;Ie+=1)H[Ie]=by(vy(h,Q,Ie));let ce=Sr(h[1].ticks(5)),de=[];for(let Ie=0;Ie<ce.length;Ie+=1)de[Ie]=wy(xy(h,ce,Ie));let ye=Sr(h[2].ticks(Math.min(h[5].length,4))),Ee=[];for(let Ie=0;Ie<ye.length;Ie+=1)Ee[Ie]=Ty(yy(h,ye,Ie));function Xe(Ie,ct){if(Ie[4].length>1)return d2;if(Ie[4].length==1)return h2}let ut=Xe(h),at=ut&&ut(h);return{c(){f=kt("div"),y=kt("div"),w=Fn("svg"),S=Fn("g");for(let Ie=0;Ie<H.length;Ie+=1)H[Ie].c();for(let Ie=0;Ie<de.length;Ie+=1)de[Ie].c();k=Ar();for(let Ie=0;Ie<Ee.length;Ie+=1)Ee[Ie].c();z=Ar(),at&&at.c(),this.h()},l(Ie){f=zt(Ie,"DIV",{class:!0});var ct=Mt(f);y=zt(ct,"DIV",{class:!0});var ve=Mt(y);w=Un(ve,"svg",{width:!0,height:!0});var Oe=Mt(w);S=Un(Oe,"g",{transform:!0});var Ze=Mt(S);for(let He=0;He<H.length;He+=1)H[He].l(Ze);Ze.forEach(qe);for(let He=0;He<de.length;He+=1)de[He].l(Oe);k=Ar();for(let He=0;He<Ee.length;He+=1)Ee[He].l(Oe);z=Ar(),at&&at.l(Oe),Oe.forEach(qe),ve.forEach(qe),ct.forEach(qe),this.h()},h(){_e(S,"transform",`translate(0,${P0/2})`),_e(w,"width",h[0]),_e(w,"height",h[3]),_e(y,"class","stacked-area-chart svelte-145lpf4"),Ug(()=>h[20].call(y)),_e(f,"class","container")},m(Ie,ct){ni(Ie,f,ct),Ke(f,y),Ke(y,w),Ke(w,S);for(let ve=0;ve<H.length;ve+=1)H[ve]&&H[ve].m(S,null);for(let ve=0;ve<de.length;ve+=1)de[ve]&&de[ve].m(w,null);Ke(w,k);for(let ve=0;ve<Ee.length;ve+=1)Ee[ve]&&Ee[ve].m(w,null);Ke(w,z),at&&at.m(w,null),o=bv(y,h[20].bind(y)),L||(F=Yi(window,"resize",h[19]),L=!0)},p(Ie,ct){if(ct[0]&6144){Q=Sr(Ie[11]);let ve;for(ve=0;ve<Q.length;ve+=1){const Oe=vy(Ie,Q,ve);H[ve]?H[ve].p(Oe,ct):(H[ve]=by(Oe),H[ve].c(),H[ve].m(S,null))}for(;ve<H.length;ve+=1)H[ve].d(1);H.length=Q.length}if(ct[0]&3){ce=Sr(Ie[1].ticks(5));let ve;for(ve=0;ve<ce.length;ve+=1){const Oe=xy(Ie,ce,ve);de[ve]?de[ve].p(Oe,ct):(de[ve]=wy(Oe),de[ve].c(),de[ve].m(w,k))}for(;ve<de.length;ve+=1)de[ve].d(1);de.length=ce.length}if(ct[0]&44){ye=Sr(Ie[2].ticks(Math.min(Ie[5].length,4)));let ve;for(ve=0;ve<ye.length;ve+=1){const Oe=yy(Ie,ye,ve);Ee[ve]?Ee[ve].p(Oe,ct):(Ee[ve]=Ty(Oe),Ee[ve].c(),Ee[ve].m(w,z))}for(;ve<Ee.length;ve+=1)Ee[ve].d(1);Ee.length=ye.length}ut===(ut=Xe(Ie))&&at?at.p(Ie,ct):(at&&at.d(1),at=ut&&ut(Ie),at&&(at.c(),at.m(w,null))),ct[0]&1&&_e(w,"width",Ie[0]),ct[0]&8&&_e(w,"height",Ie[3])},i:Dn,o:Dn,d(Ie){Ie&&qe(f),qa(H,Ie),qa(de,Ie),qa(Ee,Ie),at&&at.d(),o(),L=!1,F()}}}const P0=40,Zp=10,ja=20,Gu=30,My=170,Sy=10,p2=14,Ay=5,m2=3;function _2(h,f,y){let w,S,k,z,o,L,F,Q,H,ce,de,ye,Ee,{data:Xe}=f,{start:ut}=f,{end:at}=f;const Ie=["High school teen, 13 to 18"];let ct=300;const ve=m0().domain(Ie).range([Fd,z0]);function Oe(){y(9,S=window.innerWidth),y(10,w=window.outerWidth),y(8,z=window.innerHeight),y(6,k=window.outerHeight)}function Ze(){ct=this.clientWidth,y(0,ct)}return h.$$set=He=>{"data"in He&&y(13,Xe=He.data),"start"in He&&y(14,ut=He.start),"end"in He&&y(15,at=He.end)},h.$$.update=()=>{h.$$.dirty[0]&64&&y(3,o=.25*k),h.$$.dirty[0]&8192&&y(18,L=Xe.filter(He=>He.age_group==="High school teen, 13 to 18")),h.$$.dirty[0]&262144&&y(5,F=L.map(He=>He.date)),h.$$.dirty[0]&32&&y(17,Q=F.length),h.$$.dirty[0]&442368&&y(4,H=L.slice(Gp(ut,Q),Gp(at,Q)+1)),h.$$.dirty[0]&16&&console.log(H),h.$$.dirty[0]&180257&&y(2,ce=l2().domain([ju(ut,Q,F),ju(at,Q,F)]).range([Gu,ct-Zp])),h.$$.dirty[0]&16&&y(16,de=H.length>1?qv(H,He=>He.victims)-Ay:0),h.$$.dirty[0]&65560&&y(1,ye=E0().domain([de,Gv(H,He=>He.victims)+Ay]).rangeRound([o-ja,P0])),h.$$.dirty[0]&6&&y(7,Ee=Qv().x(He=>ce(He.date)).y(He=>ye(He.victims)))},y(10,w=0),y(9,S=0),y(6,k=0),y(8,z=0),[ct,ye,ce,o,H,F,k,Ee,z,S,w,Ie,ve,Xe,ut,at,de,Q,L,Oe,Ze]}class g2 extends ms{constructor(f){super(),_s(this,f,_2,f2,ps,{data:13,start:14,end:15},null,[-1,-1])}}var y2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x2(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var D0={exports:{}};(function(h,f){(function(y,w){h.exports=w()})(y2,function(){var y,w,S;function k(o,L){if(!y)y=L;else if(!w)w=L;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",Q={};y(Q),S=L(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(S.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}k(["exports"],function(o){var L=typeof self<"u"?self:{},F="2.15.0";let Q;const H={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Q==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Q={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{Q=t}}return Q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!H.API_URL)return null;try{const t=new URL(H.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ce={supported:!1,testSupport:function(t){!Ee&&ye&&(Xe?ut(t):de=t)}};let de,ye,Ee=!1,Xe=!1;function ut(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ye),t.isContextLost())return;ce.supported=!0}catch{}t.deleteTexture(e),Ee=!0}L.document&&(ye=L.document.createElement("img"),ye.onload=function(){de&&ut(de),de=null,Xe=!0},ye.onerror=function(){Ee=!0,de=null},ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const at="01";function Ie(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ct=ve;function ve(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}ve.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=a/c}var d=0,m=1;for(i=t,r=0;r<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));r++)t>a?d=i:m=i,i=.5*(m-d)+d;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Oe=Ie(ct),Ze=He;function He(t,e){this.x=t,this.y=e}He.prototype={clone:function(){return new He(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),a=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},He.convert=function(t){return t instanceof He?t:Array.isArray(t)?new He(t[0],t[1]):t};var Be=Ie(Ze);const Ut=Math.PI/180,Pe=180/Math.PI;function tt(t){return t*Ut}function St(t){return t*Pe}const Ot=[[0,0],[1,0],[1,1],[0,1]];function vi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function qt(t,e,i,r){const a=new Oe(t,e,i,r);return function(c){return a.solve(c)}}const ri=qt(.25,.1,.25,1);function je(t,e,i){return Math.min(i,Math.max(e,t))}function dt(t,e,i){return(i=je((i-t)/(e-t),0,1))*i*(3-2*i)}function gt(t,e,i){const r=i-e,a=((t-e)%r+r)%r+e;return a===e?i:a}function Nt(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const a=new Array(t.length);let c=null;t.forEach((d,m)=>{e(d,(g,x)=>{g&&(c=g),a[m]=x,--r==0&&i(c,a)})})}function Ai(t){const e=[];for(const i in t)e.push(t[i]);return e}function ti(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let Ji=1;function vn(){return Ji++}function An(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Mn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function $n(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function xt(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ft(t,e){return t.indexOf(e,t.length-e.length)!==-1}function vt(t,e,i){const r={};for(const a in t)r[a]=e.call(i||this,t[a],a,t);return r}function lt(t,e,i){const r={};for(const a in t)e.call(i||this,t[a],a,t)&&(r[a]=t[a]);return r}function ci(t){return Array.isArray(t)?t.map(ci):typeof t=="object"&&t?vt(t,ci):t}const At={};function ei(t){At[t]||(typeof console<"u"&&console.warn(t),At[t]=!0)}function bi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function tn(t){let e=0;for(let i,r,a=0,c=t.length,d=c-1;a<c;d=a++)i=t[a],r=t[d],e+=(r.x-i.x)*(i.y+r.y);return e}function $i(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ci(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,a,c)=>{const d=a||c;return e[r]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let lr=null;function fr(t){if(lr==null){const e=t.navigator?t.navigator.userAgent:null;lr=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return lr}function Dr(t){try{const e=L[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function gi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Cn="mapbox-tiles";let no=500,Ei=50,Et,Zt;function Qi(){try{return L.caches}catch{}}function dn(){Qi()&&!Et&&(Et=L.caches.open(Cn))}function nn(t){const e=t.indexOf("?");if(e<0)return t;const i=function(a){const c=a.indexOf("?");return c>0?a.slice(c+1).split("&"):[]}(t),r=i.filter(a=>{const c=a.split("=");return c[0]==="language"||c[0]==="worldview"});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let Xn=1/0;const bn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(bn);class cr extends Error{constructor(e,i,r){i===401&&be(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pr=$i()?()=>self.worker&&self.worker.referrer:()=>(L.location.protocol==="blob:"?L.parent:L).location.href,mr=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(pr())&&!/^\w+:/.test(i))){if(L.fetch&&L.Request&&L.AbortController&&L.Request.prototype.hasOwnProperty("signal"))return function(r,a){const c=new L.AbortController,d=new L.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:pr(),referrerPolicy:r.referrerPolicy,signal:c.signal});let m=!1,g=!1;const x=(T=d.url).indexOf("sku=")>0&&be(T);var T;r.type==="json"&&d.headers.set("Accept","application/json");const M=(P,D,O)=>{if(g)return;if(P&&P.message!=="SecurityError"&&ei(P.toString()),D&&O)return A(D);const j=Date.now();L.fetch(d).then(Y=>{if(Y.ok){const ne=x?Y.clone():null;return A(Y,ne,j)}return a(new cr(Y.statusText,Y.status,r.url))}).catch(Y=>{Y.name!=="AbortError"&&a(new Error(`${Y.message} ${r.url}`))})},A=(P,D,O)=>{(r.type==="arrayBuffer"?P.arrayBuffer():r.type==="json"?P.json():P.text()).then(j=>{g||(D&&O&&function(Y,ne,K){if(dn(),!Et)return;const ie={status:ne.status,statusText:ne.statusText,headers:new L.Headers};ne.headers.forEach((Ae,Te)=>ie.headers.set(Te,Ae));const oe=Ci(ne.headers.get("Cache-Control")||"");if(oe["no-store"])return;oe["max-age"]&&ie.headers.set("Expires",new Date(K+1e3*oe["max-age"]).toUTCString());const re=ie.headers.get("Expires");re&&(new Date(re).getTime()-K<42e4||function(Ae,Te){if(Zt===void 0)try{new Response(new ReadableStream),Zt=!0}catch{Zt=!1}Zt?Te(Ae.body):Ae.blob().then(Te)}(ne,Ae=>{const Te=new L.Response(Ae,ie);dn(),Et&&Et.then(Re=>Re.put(nn(Y.url),Te)).catch(Re=>ei(Re.message))}))}(d,D,O),m=!0,a(null,j,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(j=>{g||a(new Error(j.message))})};return x?function(P,D){if(dn(),!Et)return D(null);const O=nn(P.url);Et.then(j=>{j.match(O).then(Y=>{const ne=function(K){if(!K)return!1;const ie=new Date(K.headers.get("Expires")||0),oe=Ci(K.headers.get("Cache-Control")||"");return ie>Date.now()&&!oe["no-cache"]}(Y);j.delete(O),ne&&j.put(O,Y.clone()),D(null,Y,ne)}).catch(D)}).catch(D)}(d,M):M(null,null),{cancel:()=>{g=!0,m||c.abort()}}}(t,e);if($i()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,a){const c=new L.XMLHttpRequest;c.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const d in r.headers)c.setRequestHeader(d,r.headers[d]);return r.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=r.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let d=c.response;if(r.type==="json")try{d=JSON.parse(c.response)}catch(m){return a(m)}a(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new cr(c.statusText,c.status,r.url))},c.send(r.body),{cancel:()=>c.abort()}}(t,e)},Lr=function(t,e){return mr(ti(t,{type:"arrayBuffer"}),e)};function qr(t){const e=L.document.createElement("a");return e.href=t,e.protocol===L.document.location.protocol&&e.host===L.document.location.host}const te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let U,N;U=[],N=0;const ee=function(t,e){if(ce.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),N>=H.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return U.push(c),c}N++;let i=!1;const r=()=>{if(!i)for(i=!0,N--;U.length&&N<H.MAX_PARALLEL_IMAGE_REQUESTS;){const c=U.shift(),{requestParameters:d,callback:m,cancelled:g}=c;g||(c.cancel=ee(d,m).cancel)}},a=Lr(t,(c,d,m,g)=>{r(),c?e(c):d&&(L.createImageBitmap?function(x,T){const M=new L.Blob([new Uint8Array(x)],{type:"image/png"});L.createImageBitmap(M).then(A=>{T(null,A)}).catch(A=>{T(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(x,T)=>e(x,T,m,g)):function(x,T){const M=new L.Image,A=L.URL;M.onload=()=>{T(null,M),A.revokeObjectURL(M.src),M.onload=null,L.requestAnimationFrame(()=>{M.src=te})},M.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new L.Blob([new Uint8Array(x)],{type:"image/png"});M.src=x.byteLength?A.createObjectURL(P):te}(d,(x,T)=>e(x,T,m,g)))});return{cancel:()=>{a.cancel(),r()}}},se="NO_ACCESS_TOKEN";function fe(t){return t.indexOf("mapbox:")===0}function be(t){return H.API_URL_REGEX.test(t)}function xe(t){return H.API_CDN_URL_REGEX.test(t)}function pe(t){return H.API_STYLE_REGEX.test(t)&&!Ce(t)}function Ce(t){return H.API_SPRITE_REGEX.test(t)}const nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ht(t){const e=t.match(nt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function et(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Wt="mapbox.eventData";function Vt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(L.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class jt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Vt(H.ACCESS_TOKEN);let r="";return r=i&&i.u?L.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c)))):H.ACCESS_TOKEN||"",e?`${Wt}.${e}:${r}`:`${Wt}:${r}`}fetchEventData(){const e=Dr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const a=L.localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const c=L.localStorage.getItem(r);c&&(this.anonId=c)}catch{ei("Unable to read from LocalStorage")}}saveEventData(){const e=Dr("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{L.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&L.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ei("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,a){if(!H.EVENTS_URL)return;const c=ht(H.EVENTS_URL);c.params.push(`access_token=${a||H.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},m=i?ti(d,i):d,g={url:et(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(x,T){return mr(ti(x,{method:"POST"}),T)}(g,x=>{this.pendingRequest=null,r(x),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Kt=new class extends jt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){H.EVENTS_URL&&H.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>fe(i)||be(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Vt(H.ACCESS_TOKEN),i=e?e.u:H.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;$n(this.anonId)||(this.anonId=An(),r=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(a),m=(a-this.eventData.lastSuccess)/864e5;r=r||m>=1||m<-1||c.getDate()!==d.getDate()}else r=!0;r?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:at,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},oi=Kt.postTurnstileEvent.bind(Kt),Gi=new class extends jt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,H.EVENTS_URL&&(i||H.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(se)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),$n(this.anonId)||(this.anonId=An()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:at,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},rn=Gi.postMapLoadEvent.bind(Gi),Mi=new class extends jt{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){H.EVENTS_URL&&(t||H.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(a){const c=L.performance.getEntriesByType("resource"),d=L.performance.getEntriesByType("mark"),m=function(A){const P={};if(A){for(const D in A)if(D!=="other")for(const O of A[D]){const j=`${D}ResolveRangeMin`,Y=`${D}ResolveRangeMax`,ne=`${D}RequestCount`,K=`${D}RequestCachedCount`;P[j]=Math.min(P[j]||1/0,O.startTime),P[Y]=Math.max(P[Y]||-1/0,O.responseEnd);const ie=oe=>{P[oe]===void 0&&(P[oe]=0),++P[oe]};O.transferSize!==void 0&&O.transferSize===0&&ie(K),ie(ne)}}return P}(function(A,P){const D={};if(A)for(const O of A){const j=P(O);D[j]===void 0&&(D[j]=[]),D[j].push(O)}return D}(c,Js)),g=L.devicePixelRatio,x=L.navigator.connection||L.navigator.mozConnection||L.navigator.webkitConnection,T={counters:[],metadata:[],attributes:[]},M=(A,P,D)=>{D!=null&&A.push({name:P,value:D.toString()})};for(const A in m)M(T.counters,A,m[A]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(M(T.counters,"interactionRangeMin",a.interactionRange[0]),M(T.counters,"interactionRangeMax",a.interactionRange[1])),d)for(const A of Object.keys(Zr)){const P=Zr[A],D=d.find(O=>O.name===P);D&&M(T.counters,P,D.startTime)}return M(T.counters,"visibilityHidden",a.visibilityHidden),M(T.attributes,"style",function(A){if(A)for(const P of A){const D=P.name.split("?")[0];if(pe(D)){const O=D.split("/").slice(-2);if(O.length===2)return`mapbox://styles/${O[0]}/${O[1]}`}}}(c)),M(T.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),M(T.attributes,"fogEnabled",a.fogEnabled?"true":"false"),M(T.attributes,"projection",a.projection),M(T.attributes,"zoom",a.zoom),M(T.metadata,"devicePixelRatio",g),M(T.metadata,"connectionEffectiveType",x?x.effectiveType:void 0),M(T.metadata,"navigatorUserAgent",L.navigator.userAgent),M(T.metadata,"screenWidth",L.screen.width),M(T.metadata,"screenHeight",L.screen.height),M(T.metadata,"windowWidth",L.innerWidth),M(T.metadata,"windowHeight",L.innerHeight),M(T.metadata,"mapWidth",a.width/g),M(T.metadata,"mapHeight",a.height/g),M(T.metadata,"webglRenderer",a.renderer),M(T.metadata,"webglVendor",a.vendor),M(T.metadata,"sdkVersion",F),M(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(i);for(const a of r.metadata);for(const a of r.counters);for(const a of r.attributes);this.postEvent(e,r,()=>{},t)}},on=Mi.postPerformanceEvent.bind(Mi),ur=new class extends jt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!H.API_URL||!H.SESSION_PATH)return;const a=ht(H.API_URL+H.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${r||H.ACCESS_TOKEN||""}`);const c={url:et(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,m){return mr(ti(d,{method:"GET"}),m)}(c,d=>{this.pendingRequest=null,i(d),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,H.SESSION_PATH&&H.API_URL&&(i||H.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(se)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},wn=ur.getSessionAPI.bind(ur),Sn=new Set,Zr={create:"create",load:"load",fullLoad:"fullLoad"},Ks={mark(t){L.performance.mark(t)},measure(t,e,i){L.performance.measure(t,e,i)}};function Js(t){const e=t.name.split("?")[0];return xe(e)&&e.includes("mapbox-gl.js")?"javascript":xe(e)&&e.includes("mapbox-gl.css")?"css":function(i){return H.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ce(e)?"sprite":pe(e)?"style":function(i){return H.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const ui=L.performance;function $s(t){const e=t?t.url.toString():void 0;return ui.getEntriesByName(e)}let Zo,Qs,Wo,_r;const Hn={now:()=>Wo!==void 0?Wo:L.performance.now(),setNow(t){Wo=t},restoreNow(){Wo=void 0},frame(t){const e=L.requestAnimationFrame(t);return{cancel:()=>L.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;_r||(_r=L.document.createElement("canvas"));const a=_r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>_r.width||r>_r.height)&&(_r.width=i,_r.height=r),a.clearRect(-e,-e,i+2*e,r+2*e),a.drawImage(t,0,0,i,r),a.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Zo||(Zo=L.document.createElement("a")),Zo.href=t,Zo.href),get devicePixelRatio(){return L.devicePixelRatio},get prefersReducedMotion(){return!!L.matchMedia&&(Qs==null&&(Qs=L.matchMedia("(prefers-reduced-motion: reduce)")),Qs.matches)}};function ea(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function ta(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class ro{constructor(e,i={}){ti(this,i),this.type=e}}class hr extends ro{constructor(e,i={}){super("error",ti({error:e},i))}}class Xo{on(e,i){return this._listeners=this._listeners||{},ea(e,i,this._listeners),this}off(e,i){return ta(e,i,this._listeners),ta(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ea(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new ro(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const a=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const m of a)m.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const m of c)ta(r,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(ti(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof hr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Le=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Rr(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function sn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Tn(t){if(Array.isArray(t))return t.map(Tn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Tn(t[i]);return e}return sn(t)}class Qa extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var gr=Qa;class ia{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,a]of i)this.bindings[r]=a}concat(e){return new ia(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var el=ia;const Eo={kind:"null"},pt={kind:"number"},ai={kind:"string"},ii={kind:"boolean"},Yn={kind:"color"},ae={kind:"object"},rt={kind:"value"},hi={kind:"collator"},Kn={kind:"formatted"},Qn={kind:"resolvedImage"};function cn(t,e){return{kind:"array",itemType:t,N:e}}function Xi(t){if(t.kind==="array"){const e=Xi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Hu=[Eo,pt,ai,ii,Yn,Kn,ae,cn(rt),Qn];function oo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!oo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Hu)if(!oo(i,e))return null}}return`Expected ${Xi(t)} but found ${Xi(e)} instead.`}function na(t,e){return e.some(i=>i.kind===t.kind)}function ra(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var cc,Yu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function oa(t){return(t=Math.round(t))<0?0:t>255?255:t}function sa(t){return oa(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function tl(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ys(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{cc={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Yu)return Yu[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),a=i.indexOf(")");if(r!==-1&&a+1===i.length){var c=i.substr(0,r),d=i.substr(r+1,a-(r+1)).split(","),m=1;switch(c){case"rgba":if(d.length!==4)return null;m=tl(d.pop());case"rgb":return d.length!==3?null:[sa(d[0]),sa(d[1]),sa(d[2]),m];case"hsla":if(d.length!==4)return null;m=tl(d.pop());case"hsl":if(d.length!==3)return null;var g=(parseFloat(d[0])%360+360)%360/360,x=tl(d[1]),T=tl(d[2]),M=T<=.5?T*(x+1):T+x-T*x,A=2*T-M;return[oa(255*ys(A,M,g+1/3)),oa(255*ys(A,M,g)),oa(255*ys(A,M,g-1/3)),m];default:return null}}return null}}catch{}class er{constructor(e,i,r,a=1){this.r=e,this.g=i,this.b=r,this.a=a}static parse(e){if(!e)return;if(e instanceof er)return e;if(typeof e!="string")return;const i=cc(e);return i?new er(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${a})`}toArray(){const{r:e,g:i,b:r,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*r/a,a]}toArray01(){const{r:e,g:i,b:r,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,r/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a}=this;return[e,i,r,a]}}er.black=new er(0,0,0,1),er.white=new er(1,1,1,1),er.transparent=new er(0,0,0,0),er.red=new er(1,0,0,1),er.blue=new er(0,0,1,1);var un=er;class uc{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hc{constructor(e,i,r,a,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=a,this.textColor=c}}class tr{constructor(e){this.sections=e}static fromString(e){return new tr([new hc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof tr?e:tr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class yr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new yr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ku(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function aa(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof un||t instanceof uc||t instanceof tr||t instanceof yr)return!0;if(Array.isArray(t)){for(const e of t)if(!aa(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!aa(t[e]))return!1;return!0}return!1}function an(t){if(t===null)return Eo;if(typeof t=="string")return ai;if(typeof t=="boolean")return ii;if(typeof t=="number")return pt;if(t instanceof un)return Yn;if(t instanceof uc)return hi;if(t instanceof tr)return Kn;if(t instanceof yr)return Qn;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const a=an(r);if(i){if(i===a)continue;i=rt;break}i=a}return cn(i||rt,e)}return ae}function la(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof un||t instanceof tr||t instanceof yr?t.toString():JSON.stringify(t)}class dc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!aa(e[1]))return i.error("invalid value");const r=e[1];let a=an(r);const c=i.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new dc(a,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof un?["rgba"].concat(this.value.toArray()):this.value instanceof tr?this.value.serialize():this.value}}var Ho=dc,Ln=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const fc={string:ai,number:pt,boolean:ii,object:ae};class pc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,a=1;const c=e[0];if(c==="array"){let m,g;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in fc)||x==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);m=fc[x],a++}else m=rt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}r=cn(m,g)}else r=fc[c];const d=[];for(;a<e.length;a++){const m=i.parse(e[a],a,rt);if(!m)return null;d.push(m)}return new pc(r,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!oo(this.type,an(r)))return r;if(i===this.args.length-1)throw new Ln(`Expected value to be of type ${Xi(this.type)}, but found ${Xi(an(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(r=>r.serialize()))}}var so=pc;class Mo{constructor(e){this.type=Kn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const a=[];let c=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(c&&typeof m=="object"&&!Array.isArray(m)){c=!1;let g=null;if(m["font-scale"]&&(g=i.parse(m["font-scale"],1,pt),!g))return null;let x=null;if(m["text-font"]&&(x=i.parse(m["text-font"],1,cn(ai)),!x))return null;let T=null;if(m["text-color"]&&(T=i.parse(m["text-color"],1,Yn),!T))return null;const M=a[a.length-1];M.scale=g,M.font=x,M.textColor=T}else{const g=i.parse(e[d],1,rt);if(!g)return null;const x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new Mo(a)}evaluate(e){return new tr(this.sections.map(i=>{const r=i.content.evaluate(e);return an(r)===Qn?new hc("",r,null,null,null):new hc(la(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class il{constructor(e){this.type=Qn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const r=i.parse(e[1],1,ai);return r?new il(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=yr.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const qd={"to-boolean":ii,"to-color":Yn,"to-number":pt,"to-string":ai};class mc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");const a=qd[r],c=[];for(let d=1;d<e.length;d++){const m=i.parse(e[d],d,rt);if(!m)return null;c.push(m)}return new mc(a,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const a of this.args){if(i=a.evaluate(e),r=null,i instanceof un)return i;if(typeof i=="string"){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ku(i[0],i[1],i[2],i[3]),!r))return new un(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ln(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Ln(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?tr.fromString(la(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?yr.fromString(la(this.args[0].evaluate(e))):la(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new il(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var xs=mc;const Wr=["Unknown","Point","LineString","Polygon"];var _c=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=un.parse(t)),e}};class Yo{constructor(e,i,r,a){this.name=e,this.type=i,this._evaluate=r,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],a=Yo.definitions[r];if(!a)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,m=d.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let g=null;for(const[x,T]of m){g=new wc(i.registry,i.path,null,i.scope);const M=[];let A=!1;for(let P=1;P<e.length;P++){const D=e[P],O=Array.isArray(x)?x[P-1]:x.type,j=g.parse(D,1+M.length,O);if(!j){A=!0;break}M.push(j)}if(!A)if(Array.isArray(x)&&x.length!==M.length)g.error(`Expected ${x.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){const D=Array.isArray(x)?x[P]:x.type,O=M[P];g.concat(P+1).checkSubtype(D,O.type)}if(g.errors.length===0)return new Yo(r,c,T,M)}}if(m.length===1)i.errors.push(...g.errors);else{const x=(m.length?m:d).map(([M])=>{return A=M,Array.isArray(A)?`(${A.map(Xi).join(", ")})`:`(${Xi(A.type)}...)`;var A}).join(" | "),T=[];for(let M=1;M<e.length;M++){const A=i.parse(e[M],1+T.length);if(!A)return null;T.push(Xi(A.type))}i.error(`Expected arguments of type ${x}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){Yo.definitions=i;for(const r in i)e[r]=Yo}}var ao=Yo;class ca{constructor(e,i,r){this.type=hi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const a=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ii);if(!a)return null;const c=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ii);if(!c)return null;let d=null;return r.locale&&(d=i.parse(r.locale,1,ai),!d)?null:new ca(a,c,d)}evaluate(e){return new uc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const lo=8192;function nl(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function vs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ua(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*lo),Math.round(r*a*lo)]}function Ju(t,e,i){const r=t[0]-e[0],a=t[1]-e[1],c=t[0]-i[0],d=t[1]-i[1];return r*d-c*a==0&&r*c<=0&&a*d<=0}function rl(t,e){let i=!1;for(let d=0,m=e.length;d<m;d++){const g=e[d];for(let x=0,T=g.length;x<T-1;x++){if(Ju(t,g[x],g[x+1]))return!1;(a=g[x])[1]>(r=t)[1]!=(c=g[x+1])[1]>r[1]&&r[0]<(c[0]-a[0])*(r[1]-a[1])/(c[1]-a[1])+a[0]&&(i=!i)}}var r,a,c;return i}function gc(t,e){for(let i=0;i<e.length;i++)if(rl(t,e[i]))return!0;return!1}function yc(t,e,i,r){const a=r[0]-i[0],c=r[1]-i[1],d=(t[0]-i[0])*c-a*(t[1]-i[1]),m=(e[0]-i[0])*c-a*(e[1]-i[1]);return d>0&&m<0||d<0&&m>0}function bs(t,e,i){for(const x of i)for(let T=0;T<x.length-1;++T)if((m=[(d=x[T+1])[0]-(c=x[T])[0],d[1]-c[1]])[0]*(g=[(a=e)[0]-(r=t)[0],a[1]-r[1]])[1]-m[1]*g[0]!=0&&yc(r,a,c,d)&&yc(c,d,r,a))return!0;var r,a,c,d,m,g;return!1}function wi(t,e){for(let i=0;i<t.length;++i)if(!rl(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(bs(t[i],t[i+1],e))return!1;return!0}function Zd(t,e){for(let i=0;i<e.length;i++)if(wi(t,e[i]))return!0;return!1}function xc(t,e,i){const r=[];for(let a=0;a<t.length;a++){const c=[];for(let d=0;d<t[a].length;d++){const m=ua(t[a][d],i);nl(e,m),c.push(m)}r.push(c)}return r}function $u(t,e,i){const r=[];for(let a=0;a<t.length;a++){const c=xc(t[a],e,i);r.push(c)}return r}function vc(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const a=.5*r;let c=t[0]-i[0]>a?-r:i[0]-t[0]>a?r:0;c===0&&(c=t[0]-i[2]>a?-r:i[2]-t[0]>a?r:0),t[0]+=c}nl(e,t)}function Qu(t,e,i,r){const a=Math.pow(2,r.z)*lo,c=[r.x*lo,r.y*lo],d=[];if(!t)return d;for(const m of t)for(const g of m){const x=[g.x+c[0],g.y+c[1]];vc(x,e,i,a),d.push(x)}return d}function bc(t,e,i,r){const a=Math.pow(2,r.z)*lo,c=[r.x*lo,r.y*lo],d=[];if(!t)return d;for(const g of t){const x=[];for(const T of g){const M=[T.x+c[0],T.y+c[1]];nl(e,M),x.push(M)}d.push(x)}if(e[2]-e[0]<=a/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const g of d)for(const x of g)vc(x,e,i,a)}var m;return d}class ws{constructor(e,i){this.type=ii,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(aa(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let a=0;a<r.features.length;++a){const c=r.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ws(r,r.features[a].geometry)}else if(r.type==="Feature"){const a=r.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ws(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ws(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const m=xc(r.coordinates,c,d),g=Qu(i.geometry(),a,c,d);if(!vs(a,c))return!1;for(const x of g)if(!rl(x,m))return!1}if(r.type==="MultiPolygon"){const m=$u(r.coordinates,c,d),g=Qu(i.geometry(),a,c,d);if(!vs(a,c))return!1;for(const x of g)if(!gc(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const m=xc(r.coordinates,c,d),g=bc(i.geometry(),a,c,d);if(!vs(a,c))return!1;for(const x of g)if(!wi(x,m))return!1}if(r.type==="MultiPolygon"){const m=$u(r.coordinates,c,d),g=bc(i.geometry(),a,c,d);if(!vs(a,c))return!1;for(const x of g)if(!Zd(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ol=ws;function Ts(t){if(t instanceof ao&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ol)return!1;let e=!0;return t.eachChild(i=>{e&&!Ts(i)&&(e=!1)}),e}function co(t){if(t instanceof ao&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!co(i)&&(e=!1)}),e}function Ko(t,e){if(t instanceof ao&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!Ko(r,e)&&(i=!1)}),i}class sl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new sl(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var eh=sl;class ha{constructor(e,i=[],r,a=new el,c=[]){this.registry=e,this.path=i,this.key=i.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=c,this.expectedType=r}parse(e,i,r,a,c={}){return i?this.concat(i,r,a)._parse(e,c):this._parse(e,c)}_parse(e,i){function r(a,c,d){return d==="assert"?new so(c,[a]):d==="coerce"?new xs(c,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[a];if(c){let d=c.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,g=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(m,g))return null}else d=r(d,m,i.typeAnnotation||"coerce");else d=r(d,m,i.typeAnnotation||"assert")}if(!(d instanceof Ho)&&d.type.kind!=="resolvedImage"&&Tc(d)){const m=new _c;try{d=new Ho(d.type,d.evaluate(m))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const a=typeof e=="number"?this.path.concat(e):this.path,c=r?this.scope.concat(r):this.scope;return new ha(this.registry,a,i||null,c,this.errors)}error(e,...i){const r=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new gr(r,e))}checkSubtype(e,i){const r=oo(e,i);return r&&this.error(r),r}}var wc=ha;function Tc(t){if(t instanceof eh)return Tc(t.boundExpression);if(t instanceof ao&&t.name==="error"||t instanceof ca||t instanceof ol)return!1;const e=t instanceof xs||t instanceof so;let i=!0;return t.eachChild(r=>{i=e?i&&Tc(r):i&&r instanceof Ho}),!!i&&Ts(t)&&Ko(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function al(t,e){const i=t.length-1;let r,a,c=0,d=i,m=0;for(;c<=d;)if(m=Math.floor((c+d)/2),r=t[m],a=t[m+1],r<=e){if(m===i||e<a)return m;c=m+1}else{if(!(r>e))throw new Ln("Input is not a number.");d=m-1}return 0}class ll{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,c]of r)this.labels.push(a),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,pt);if(!r)return null;const a=[];let c=null;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],g=e[d+1],x=d,T=d+1;if(typeof m!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=m)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const M=i.parse(g,T,c);if(!M)return null;c=c||M.type,a.push([m,M])}return new ll(c,r,a)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const c=i.length;return a>=i[c-1]?r[c-1].evaluate(e):r[al(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Ec=ll;function di(t,e,i){return t*(1-i)+e*i}var da=Object.freeze({__proto__:null,array:function(t,e,i){return t.map((r,a)=>di(r,e[a],i))},color:function(t,e,i){return new un(di(t.r,e.r,i),di(t.g,e.g,i),di(t.b,e.b,i),di(t.a,e.a,i))},number:di});const th=.95047,Mc=1.08883,ih=4/29,Jo=6/29,Sc=3*Jo*Jo,Wd=Jo*Jo*Jo,Xd=Math.PI/180,Hd=180/Math.PI;function Ac(t){return t>Wd?Math.pow(t,1/3):t/Sc+ih}function Cc(t){return t>Jo?t*t*t:Sc*(t-ih)}function Ic(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function cl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function nh(t){const e=cl(t.r),i=cl(t.g),r=cl(t.b),a=Ac((.4124564*e+.3575761*i+.1804375*r)/th),c=Ac((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-Ac((.0193339*e+.119192*i+.9503041*r)/Mc)),alpha:t.a}}function rh(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Cc(e),i=th*Cc(i),r=Mc*Cc(r),new un(Ic(3.2404542*i-1.5371385*e-.4985314*r),Ic(-.969266*i+1.8760108*e+.041556*r),Ic(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Yd(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const fa={forward:nh,reverse:rh,interpolate:function(t,e,i){return{l:di(t.l,e.l,i),a:di(t.a,e.a,i),b:di(t.b,e.b,i),alpha:di(t.alpha,e.alpha,i)}}},Es={forward:function(t){const{l:e,a:i,b:r}=nh(t),a=Math.atan2(r,i)*Hd;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Xd,i=t.c;return rh({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Yd(t.h,e.h,i),c:di(t.c,e.c,i),l:di(t.l,e.l,i),alpha:di(t.alpha,e.alpha,i)}}};var kc=Object.freeze({__proto__:null,hcl:Es,lab:fa});class pa{constructor(e,i,r,a,c){this.type=e,this.operator=i,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,i,r,a){let c=0;if(e.name==="exponential")c=zc(i,e.base,r,a);else if(e.name==="linear")c=zc(i,1,r,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;c=new Oe(d[0],d[1],d[2],d[3]).solve(zc(i,1,r,a))}return c}static parse(e,i){let[r,a,c,...d]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const x=a[1];if(typeof x!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const x=a.slice(1);if(x.length!==4||x.some(T=>typeof T!="number"||T<0||T>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,pt),!c)return null;const m=[];let g=null;r==="interpolate-hcl"||r==="interpolate-lab"?g=Yn:i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let x=0;x<d.length;x+=2){const T=d[x],M=d[x+1],A=x+3,P=x+4;if(typeof T!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=T)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=i.parse(M,P,g);if(!D)return null;g=g||D.type,m.push([T,D])}return g.kind==="number"||g.kind==="color"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new pa(g,r,a,c,m):i.error(`Type ${Xi(g)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const c=i.length;if(a>=i[c-1])return r[c-1].evaluate(e);const d=al(i,a),m=pa.interpolationFactor(this.interpolation,a,i[d],i[d+1]),g=r[d].evaluate(e),x=r[d+1].evaluate(e);return this.operator==="interpolate"?da[this.type.kind.toLowerCase()](g,x,m):this.operator==="interpolate-hcl"?Es.reverse(Es.interpolate(Es.forward(g),Es.forward(x),m)):fa.reverse(fa.interpolate(fa.forward(g),fa.forward(x),m))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function zc(t,e,i,r){const a=r-i,c=t-i;return a===0?0:e===1?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}var Xr=pa;class ul{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const a=i.expectedType;a&&a.kind!=="value"&&(r=a);const c=[];for(const m of e.slice(1)){const g=i.parse(m,1+c.length,r,void 0,{typeAnnotation:"omit"});if(!g)return null;r=r||g.type,c.push(g)}const d=a&&c.some(m=>oo(a,m.type));return new ul(d?rt:r,c)}evaluate(e){let i,r=null,a=0;for(const c of this.args){if(a++,r=c.evaluate(e),r&&r instanceof yr&&!r.available&&(i||(i=r),r=null,a===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Pc=ul;class hl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const m=i.parse(e[c+1],c+1);if(!m)return null;r.push([d,m])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return a?new hl(r,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var oh=hl;class Dc{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,pt),a=i.parse(e[2],2,cn(i.expectedType||rt));return r&&a?new Dc(a.type.itemType,r,a):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new Ln(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new Ln(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new Ln(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Kd=Dc;class Lc{constructor(e,i){this.type=ii,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,rt),a=i.parse(e[2],2,rt);return r&&a?na(r.type,[ii,ai,pt,Eo,rt])?new Lc(r,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!ra(i,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(an(i))} instead.`);if(!ra(r,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${Xi(an(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var dl=Lc;class ma{constructor(e,i,r){this.type=pt,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,rt),a=i.parse(e[2],2,rt);if(!r||!a)return null;if(!na(r.type,[ii,ai,pt,Eo,rt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(r.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,pt);return c?new ma(r,a,c):null}return new ma(r,a)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ra(i,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(an(i))} instead.`);if(!ra(r,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${Xi(an(r))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return r.indexOf(i,a)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var sh=ma;class Rc{constructor(e,i,r,a,c,d){this.inputType=e,this.type=i,this.input=r,this.cases=a,this.outputs=c,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c={},d=[];for(let x=2;x<e.length-1;x+=2){let T=e[x];const M=e[x+1];Array.isArray(T)||(T=[T]);const A=i.concat(x);if(T.length===0)return A.error("Expected at least one branch label.");for(const D of T){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(r){if(A.checkSubtype(r,an(D)))return null}else r=an(D);if(c[String(D)]!==void 0)return A.error("Branch labels must be unique.");c[String(D)]=d.length}const P=i.parse(M,x,a);if(!P)return null;a=a||P.type,d.push(P)}const m=i.parse(e[1],1,rt);if(!m)return null;const g=i.parse(e[e.length-1],e.length-1,a);return g?m.type.kind!=="value"&&i.concat(1).checkSubtype(r,m.type)?null:new Rc(r,a,m,c,d,g):null}evaluate(e){const i=this.input.evaluate(e);return(an(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],a={};for(const d of i){const m=a[this.cases[d]];m===void 0?(a[this.cases[d]]=r.length,r.push([this.cases[d],[d]])):r[m][1].push(d)}const c=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,m]of r)e.push(m.length===1?c(m[0]):m.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var Jd=Rc;class Bc{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const m=i.parse(e[d],d,ii);if(!m)return null;const g=i.parse(e[d+1],d+1,r);if(!g)return null;a.push([m,g]),r=r||g.type}const c=i.parse(e[e.length-1],e.length-1,r);return c?new Bc(r,a,c):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ah=Bc;class _a{constructor(e,i,r,a){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,rt),a=i.parse(e[2],2,pt);if(!r||!a)return null;if(!na(r.type,[cn(rt),ai,rt]))return i.error(`Expected first argument to be of type array or string, but found ${Xi(r.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,pt);return c?new _a(r.type,r,a,c):null}return new _a(r.type,r,a)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ra(i,["string","array"]))throw new Ln(`Expected first argument to be of type array or string, but found ${Xi(an(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(r,a)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lh=_a;function fl(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ch(t,e,i,r){return r.compare(e,i)===0}function Ms(t,e,i){const r=t!=="=="&&t!=="!=";return class L0{constructor(c,d,m){this.type=ii,this.lhs=c,this.rhs=d,this.collator=m,this.hasUntypedArgument=c.type.kind==="value"||d.type.kind==="value"}static parse(c,d){if(c.length!==3&&c.length!==4)return d.error("Expected two or three arguments.");const m=c[0];let g=d.parse(c[1],1,rt);if(!g)return null;if(!fl(m,g.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Xi(g.type)}'.`);let x=d.parse(c[2],2,rt);if(!x)return null;if(!fl(m,x.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Xi(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${Xi(g.type)}' and '${Xi(x.type)}'.`);r&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new so(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new so(g.type,[x])));let T=null;if(c.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(T=d.parse(c[3],3,hi),!T)return null}return new L0(g,x,T)}evaluate(c){const d=this.lhs.evaluate(c),m=this.rhs.evaluate(c);if(r&&this.hasUntypedArgument){const g=an(d),x=an(m);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Ln(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const g=an(d),x=an(m);if(g.kind!=="string"||x.kind!=="string")return e(c,d,m)}return this.collator?i(c,d,m,this.collator.evaluate(c)):e(c,d,m)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const $d=Ms("==",function(t,e,i){return e===i},ch),Qd=Ms("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!ch(0,e,i,r)}),ef=Ms("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),tf=Ms(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),nf=Ms("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),uh=Ms(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class pl{constructor(e,i,r,a,c,d){this.type=ai,this.number=e,this.locale=i,this.currency=r,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,pt);if(!r)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=i.parse(a.locale,1,ai),!c))return null;let d=null;if(a.currency&&(d=i.parse(a.currency,1,ai),!d))return null;let m=null;if(a.unit&&(m=i.parse(a.unit,1,ai),!m))return null;let g=null;if(a["min-fraction-digits"]&&(g=i.parse(a["min-fraction-digits"],1,pt),!g))return null;let x=null;return a["max-fraction-digits"]&&(x=i.parse(a["max-fraction-digits"],1,pt),!x)?null:new pl(r,c,d,m,g,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ss{constructor(e){this.type=pt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Xi(r.type)} instead.`):new Ss(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ln(`Expected value to be of type string or array, but found ${Xi(an(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const hh={"==":$d,"!=":Qd,">":tf,"<":ef,">=":uh,"<=":nf,array:so,at:Kd,boolean:so,case:ah,coalesce:Pc,collator:ca,format:Mo,image:il,in:dl,"index-of":sh,interpolate:Xr,"interpolate-hcl":Xr,"interpolate-lab":Xr,length:Ss,let:oh,literal:Ho,match:Jd,number:so,"number-format":pl,object:so,slice:lh,step:Ec,string:so,"to-boolean":xs,"to-color":xs,"to-number":xs,"to-string":xs,var:eh,within:ol};function dh(t,[e,i,r,a]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const c=a?a.evaluate(t):1,d=Ku(e,i,r,c);if(d)throw new Ln(d);return new un(e/255*c,i/255*c,r/255*c,c)}function uo(t,e){return t in e}function ml(t,e){const i=e[t];return i===void 0?null:i}function xr(t){return{type:t}}ao.register(hh,{error:[{kind:"error"},[ai],(t,[e])=>{throw new Ln(e.evaluate(t))}],typeof:[ai,[rt],(t,[e])=>Xi(an(e.evaluate(t)))],"to-rgba":[cn(pt,4),[Yn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Yn,[pt,pt,pt],dh],rgba:[Yn,[pt,pt,pt,pt],dh],has:{type:ii,overloads:[[[ai],(t,[e])=>uo(e.evaluate(t),t.properties())],[[ai,ae],(t,[e,i])=>uo(e.evaluate(t),i.evaluate(t))]]},get:{type:rt,overloads:[[[ai],(t,[e])=>ml(e.evaluate(t),t.properties())],[[ai,ae],(t,[e,i])=>ml(e.evaluate(t),i.evaluate(t))]]},"feature-state":[rt,[ai],(t,[e])=>ml(e.evaluate(t),t.featureState||{})],properties:[ae,[],t=>t.properties()],"geometry-type":[ai,[],t=>t.geometryType()],id:[rt,[],t=>t.id()],zoom:[pt,[],t=>t.globals.zoom],pitch:[pt,[],t=>t.globals.pitch||0],"distance-from-center":[pt,[],t=>t.distanceFromCenter()],"heatmap-density":[pt,[],t=>t.globals.heatmapDensity||0],"line-progress":[pt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[pt,[],t=>t.globals.skyRadialProgress||0],accumulated:[rt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[pt,xr(pt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[pt,xr(pt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:pt,overloads:[[[pt,pt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[pt],(t,[e])=>-e.evaluate(t)]]},"/":[pt,[pt,pt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[pt,[pt,pt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[pt,[pt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))],log2:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[pt,[pt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[pt,[pt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[pt,[pt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[pt,[pt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[pt,[pt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[pt,[pt],(t,[e])=>Math.atan(e.evaluate(t))],min:[pt,xr(pt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[pt,xr(pt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[pt,[pt],(t,[e])=>Math.abs(e.evaluate(t))],round:[pt,[pt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[pt,[pt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[pt,[pt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ii,[ai,rt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ii,[rt],(t,[e])=>t.id()===e.value],"filter-type-==":[ii,[ai],(t,[e])=>t.geometryType()===e.value],"filter-<":[ii,[ai,rt],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[ii,[rt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[ii,[ai,rt],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[ii,[rt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[ii,[ai,rt],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[ii,[rt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[ii,[ai,rt],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[ii,[rt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[ii,[rt],(t,[e])=>e.value in t.properties()],"filter-has-id":[ii,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[ii,[cn(ai)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ii,[cn(rt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ii,[ai,cn(rt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ii,[ai,cn(rt)],(t,[e,i])=>function(r,a,c,d){for(;c<=d;){const m=c+d>>1;if(a[m]===r)return!0;a[m]>r?d=m-1:c=m+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[xr(ii),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[xr(ii),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ii,[ii],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ii,[ai],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ai,[ai],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ai,[ai],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ai,xr(rt),(t,e)=>e.map(i=>la(i.evaluate(t))).join("")],"resolved-locale":[ai,[hi],(t,[e])=>e.evaluate(t).resolvedLocale()]});var ga=hh;function fh(t){return{result:"success",value:t}}function $o(t){return{result:"error",value:t}}function As(t){return t["property-type"]==="data-driven"}function _l(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function gl(t){return!!t.expression&&t.expression.interpolated}function mi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function ya(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ph(t){return t}function yl(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",a=r||!(r||t.property!==void 0),c=t.type||(gl(e)?"exponential":"interval");if(i&&((t=Rr({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],un.parse(x[1])])),t.default=un.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!kc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,m,g;if(c==="exponential")d=ho;else if(c==="interval")d=xl;else if(c==="categorical"){d=mh,m=Object.create(null);for(const x of t.stops)m[x[0]]=x[1];g=typeof t.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);d=_h}if(r){const x={},T=[];for(let P=0;P<t.stops.length;P++){const D=t.stops[P],O=D[0].zoom;x[O]===void 0&&(x[O]={zoom:O,type:t.type,property:t.property,default:t.default,stops:[]},T.push(O)),x[O].stops.push([D[0].value,D[1]])}const M=[];for(const P of T)M.push([x[P].zoom,yl(x[P],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Xr.interpolationFactor.bind(void 0,A),zoomStops:M.map(P=>P[0]),evaluate:({zoom:P},D)=>ho({stops:M,base:t.base},e,P).evaluate(P,D)}}if(a){const x=c==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Xr.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>d(t,e,T,m,g)}}return{kind:"source",evaluate(x,T){const M=T&&T.properties?T.properties[t.property]:void 0;return M===void 0?Cs(t.default,e.default):d(t,e,M,m,g)}}}function Cs(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function mh(t,e,i,r,a){return Cs(typeof i===a?r[i]:void 0,t.default,e.default)}function xl(t,e,i){if(mi(i)!=="number")return Cs(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const a=al(t.stops.map(c=>c[0]),i);return t.stops[a][1]}function ho(t,e,i){const r=t.base!==void 0?t.base:1;if(mi(i)!=="number")return Cs(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const c=al(t.stops.map(T=>T[0]),i),d=function(T,M,A,P){const D=P-A,O=T-A;return D===0?0:M===1?O/D:(Math.pow(M,O)-1)/(Math.pow(M,D)-1)}(i,r,t.stops[c][0],t.stops[c+1][0]),m=t.stops[c][1],g=t.stops[c+1][1];let x=da[e.type]||ph;if(t.colorSpace&&t.colorSpace!=="rgb"){const T=kc[t.colorSpace];x=(M,A)=>T.reverse(T.interpolate(T.forward(M),T.forward(A),d))}return typeof m.evaluate=="function"?{evaluate(...T){const M=m.evaluate.apply(void 0,T),A=g.evaluate.apply(void 0,T);if(M!==void 0&&A!==void 0)return x(M,A,d)}}:x(m,g,d)}function _h(t,e,i){return e.type==="color"?i=un.parse(i):e.type==="formatted"?i=tr.fromString(i.toString()):e.type==="resolvedImage"?i=yr.fromString(i.toString()):mi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Cs(i,t.default,e.default)}class vl{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new _c,this._defaultValue=i?function(r){return r.type==="color"&&(ya(r.default)||Array.isArray(r.default))?new un(0,0,0,0):r.type==="color"?un.parse(r.default)||null:r.default===void 0?null:r.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,a,c,d,m,g){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,a,c,d,m,g){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Ln(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Is(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in ga}function ks(t,e){const i=new wc(ga,[],e?function(a){const c={color:Yn,string:ai,number:pt,enum:ai,boolean:ii,formatted:Kn,resolvedImage:Qn};return a.type==="array"?cn(c[a.value]||rt,a.length):c[a.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?fh(new vl(r,e)):$o(i.errors)}class Oc{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!co(i.expression)}evaluateWithoutErrorHandling(e,i,r,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,c,d)}evaluate(e,i,r,a,c,d){return this._styleExpression.evaluate(e,i,r,a,c,d)}}class xa{constructor(e,i,r,a){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!co(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,r,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,c,d)}evaluate(e,i,r,a,c,d){return this._styleExpression.evaluate(e,i,r,a,c,d)}interpolationFactor(e,i,r){return this.interpolationType?Xr.interpolationFactor(this.interpolationType,e,i,r):0}}function va(t,e){if((t=ks(t,e)).result==="error")return t;const i=t.value.expression,r=Ts(i);if(!r&&!As(e))return $o([new gr("","data expressions not supported")]);const a=Ko(i,["zoom","pitch","distance-from-center"]);if(!a&&!_l(e))return $o([new gr("","zoom expressions not supported")]);const c=wl(i);return c||a?c instanceof gr?$o([c]):c instanceof Xr&&!gl(e)?$o([new gr("",'"interpolate" expressions cannot be used with this property')]):fh(c?new xa(r?"camera":"composite",t.value,c.labels,c instanceof Xr?c.interpolation:void 0):new Oc(r?"constant":"source",t.value)):$o([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class bl{constructor(e,i){this._parameters=e,this._specification=i,Rr(this,yl(this._parameters,this._specification))}static deserialize(e){return new bl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function wl(t){let e=null;if(t instanceof oh)e=wl(t.result);else if(t instanceof Pc){for(const i of t.args)if(e=wl(i),e)break}else(t instanceof Ec||t instanceof Xr)&&t.input instanceof ao&&t.input.name==="zoom"&&(e=t);return e instanceof gr||t.eachChild(i=>{const r=wl(i);r instanceof gr?e=r:!e&&r?e=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class yt{constructor(e,i,r,a){this.message=(e?`${e}: `:"")+r,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function Br(t){const e=t.key,i=t.value,r=t.valueSpec||{},a=t.objectElementValidators||{},c=t.style,d=t.styleSpec;let m=[];const g=mi(i);if(g!=="object")return[new yt(e,i,`object expected, ${g} found`)];for(const x in i){const T=x.split(".")[0];let M;a[T]?M=a[T]:r[T]?M=Vn:a["*"]?M=a["*"]:r["*"]&&(M=Vn),M?m=m.concat(M({key:(e&&`${e}.`)+x,value:i[x],valueSpec:r[T]||r["*"],style:c,styleSpec:d,object:i,objectKey:x},i)):m.push(new yt(e,i[x],`unknown property "${x}"`))}for(const x in r)a[x]||r[x].required&&r[x].default===void 0&&i[x]===void 0&&m.push(new yt(e,i,`missing required property "${x}"`));return m}function gh(t){const e=t.value,i=t.valueSpec,r=t.style,a=t.styleSpec,c=t.key,d=t.arrayElementValidator||Vn;if(mi(e)!=="array")return[new yt(c,e,`array expected, ${mi(e)} found`)];if(i.length&&e.length!==i.length)return[new yt(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new yt(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let m={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};a.$version<7&&(m.function=i.function),mi(i.value)==="object"&&(m=i.value);let g=[];for(let x=0;x<e.length;x++)g=g.concat(d({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:r,styleSpec:a,key:`${c}[${x}]`}));return g}function ba(t){const e=t.key,i=t.value,r=t.valueSpec;let a=mi(i);if(a==="number"&&i!=i&&(a="NaN"),a!=="number")return[new yt(e,i,`number expected, ${a} found`)];if("minimum"in r){let c=r.minimum;if(mi(r.minimum)==="array"&&(c=r.minimum[t.arrayIndex]),i<c)return[new yt(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in r){let c=r.maximum;if(mi(r.maximum)==="array"&&(c=r.maximum[t.arrayIndex]),i>c)return[new yt(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function wa(t){const e=t.valueSpec,i=sn(t.value.type);let r,a,c,d={};const m=i!=="categorical"&&t.value.property===void 0,g=!m,x=mi(t.value.stops)==="array"&&mi(t.value.stops[0])==="array"&&mi(t.value.stops[0][0])==="object",T=Br({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(P){if(i==="identity")return[new yt(P.key,P.value,'identity function may not have a "stops" property')];let D=[];const O=P.value;return D=D.concat(gh({key:P.key,value:O,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:M})),mi(O)==="array"&&O.length===0&&D.push(new yt(P.key,O,"array must have at least one stop")),D},default:function(P){return Vn({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return i==="identity"&&m&&T.push(new yt(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||T.push(new yt(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!gl(t.valueSpec)&&T.push(new yt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(g&&!As(t.valueSpec)?T.push(new yt(t.key,t.value,"property functions not supported")):m&&!_l(t.valueSpec)&&T.push(new yt(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!x||t.value.property!==void 0||T.push(new yt(t.key,t.value,'"property" property is required')),T;function M(P){let D=[];const O=P.value,j=P.key;if(mi(O)!=="array")return[new yt(j,O,`array expected, ${mi(O)} found`)];if(O.length!==2)return[new yt(j,O,`array length 2 expected, length ${O.length} found`)];if(x){if(mi(O[0])!=="object")return[new yt(j,O,`object expected, ${mi(O[0])} found`)];if(O[0].zoom===void 0)return[new yt(j,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new yt(j,O,"object stop key must have value")];const Y=sn(O[0].zoom);if(typeof Y!="number")return[new yt(j,O[0].zoom,"stop zoom values must be numbers")];if(c&&c>Y)return[new yt(j,O[0].zoom,"stop zoom values must appear in ascending order")];Y!==c&&(c=Y,a=void 0,d={}),D=D.concat(Br({key:`${j}[0]`,value:O[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:ba,value:A}}))}else D=D.concat(A({key:`${j}[0]`,value:O[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},O));return Is(Tn(O[1]))?D.concat([new yt(`${j}[1]`,O[1],"expressions are not allowed in function stops.")]):D.concat(Vn({key:`${j}[1]`,value:O[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function A(P,D){const O=mi(P.value),j=sn(P.value),Y=P.value!==null?P.value:D;if(r){if(O!==r)return[new yt(P.key,Y,`${O} stop domain type must match previous stop domain type ${r}`)]}else r=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof j!="number"&&typeof j!="string"&&typeof j!="boolean")return[new yt(P.key,Y,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&i!=="categorical"){let ne=`number expected, ${O} found`;return As(e)&&i===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(P.key,Y,ne)]}return i!=="categorical"||O!=="number"||typeof j=="number"&&isFinite(j)&&Math.floor(j)===j?i!=="categorical"&&O==="number"&&typeof j=="number"&&typeof a=="number"&&a!==void 0&&j<a?[new yt(P.key,Y,"stop domain values must appear in ascending order")]:(a=j,i==="categorical"&&j in d?[new yt(P.key,Y,"stop domain values must be unique")]:(d[j]=!0,[])):[new yt(P.key,Y,`integer expected, found ${String(j)}`)]}}function In(t){const e=(t.expressionContext==="property"?va:ks)(Tn(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new yt(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new yt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!co(i))return[new yt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Ta(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Ko(i,["zoom","feature-state"]))return[new yt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Ts(i))return[new yt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ta(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)i.delete(a);if(i.size===0)return[];const r=[];return t instanceof ao&&i.has(t.name)?[new yt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{r.push(...Ta(a,e))}),r)}function Tl(t){const e=t.key,i=t.value,r=t.valueSpec,a=[];return Array.isArray(r.values)?r.values.indexOf(sn(i))===-1&&a.push(new yt(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(sn(i))===-1&&a.push(new yt(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),a}function Fc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Fc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function El(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fc(t)||(t=Ps(t));const i=t;let r=!0;try{r=function(x){if(!zs(x))return x;let T=Tn(x);return Ml(T),T=yh(T),T}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const a=Le[`filter_${e}`],c=ks(r,a);let d=null;if(c.result==="error")throw new Error(c.value.map(x=>`${x.key}: ${x.message}`).join(", "));d=(x,T,M)=>c.value.evaluate(x,T,{},M);let m=null,g=null;if(r!==i){const x=ks(i,a);if(x.result==="error")throw new Error(x.value.map(T=>`${T.key}: ${T.message}`).join(", "));m=(T,M,A,P,D)=>x.value.evaluate(T,M,{},A,void 0,void 0,P,D),g=!Ts(x.value.expression)}return{filter:d,dynamicFilter:m||void 0,needGeometry:xh(r),needFeature:!!g}}function yh(t){if(!Array.isArray(t))return t;const e=function(i){if(Uc.has(i[0])){for(let r=1;r<i.length;r++)if(zs(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>yh(i))}function Ml(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||zs(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||zs(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||zs(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)Ml(t[r])}function zs(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(zs(t[i]))return!0;return!1}const Uc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rf(t,e){return t<e?-1:t>e?1:0}function xh(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(xh(t[e]))return!0;return!1}function Ps(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Nc(t[1],t[2],"=="):e==="!="?Sl(Nc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Nc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Ps))):e==="all"?["all"].concat(t.slice(1).map(Ps)):e==="none"?["all"].concat(t.slice(1).map(Ps).map(Sl)):e==="in"?Vc(t[1],t.slice(2)):e==="!in"?Sl(Vc(t[1],t.slice(2))):e==="has"?jc(t[1]):e==="!has"?Sl(jc(t[1])):e!=="within"||t;var i}function Nc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Vc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(rf)]]:["filter-in-small",t,["literal",e]]}}function jc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Sl(t){return["!",t]}function Ea(t){return Fc(Tn(t.value))?In(Rr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Ma(t)}function Ma(t){const e=t.value,i=t.key;if(mi(e)!=="array")return[new yt(i,e,`array expected, ${mi(e)} found`)];const r=t.styleSpec;let a,c=[];if(e.length<1)return[new yt(i,e,"filter array must have at least 1 element")];switch(c=c.concat(Tl({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),sn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&sn(e[1])==="$type"&&c.push(new yt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&c.push(new yt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=mi(e[1]),a!=="string"&&c.push(new yt(`${i}[1]`,e[1],`string expected, ${a} found`)));for(let d=2;d<e.length;d++)a=mi(e[d]),sn(e[1])==="$type"?c=c.concat(Tl({key:`${i}[${d}]`,value:e[d],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&c.push(new yt(`${i}[${d}]`,e[d],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)c=c.concat(Ma({key:`${i}[${d}]`,value:e[d],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=mi(e[1]),e.length!==2?c.push(new yt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&c.push(new yt(`${i}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=mi(e[1]),e.length!==2?c.push(new yt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&c.push(new yt(`${i}[1]`,e[1],`object expected, ${a} found`))}return c}function Gc(t,e){const i=t.key,r=t.style,a=t.styleSpec,c=t.value,d=t.objectKey,m=a[`${e}_${t.layerType}`];if(!m)return[];const g=d.match(/^(.*)-transition$/);if(e==="paint"&&g&&m[g[1]]&&m[g[1]].transition)return Vn({key:i,value:c,valueSpec:a.transition,style:r,styleSpec:a});const x=t.valueSpec||m[d];if(!x)return[new yt(i,c,`unknown property "${d}"`)];let T;if(mi(c)==="string"&&As(x)&&!x.tokens&&(T=/^{([^}]+)}$/.exec(c))){const A=`\`{ "type": "identity", "property": ${T?JSON.stringify(T[1]):'"_"'} }\``;return[new yt(i,c,`"${d}" does not support interpolation syntax
Use an identity property function instead: ${A}.`)]}const M=[];return t.layerType==="symbol"&&(d==="text-field"&&r&&!r.glyphs&&M.push(new yt(i,c,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&ya(Tn(c))&&sn(c.type)==="identity"&&M.push(new yt(i,c,'"text-font" does not support identity functions'))),M.concat(Vn({key:t.key,value:c,valueSpec:x,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:d}))}function vh(t){return Gc(t,"paint")}function qc(t){return Gc(t,"layout")}function bh(t){let e=[];const i=t.value,r=t.key,a=t.style,c=t.styleSpec;i.type||i.ref||e.push(new yt(r,i,'either "type" or "ref" is required'));let d=sn(i.type);const m=sn(i.ref);if(i.id){const g=sn(i.id);for(let x=0;x<t.arrayIndex;x++){const T=a.layers[x];sn(T.id)===g&&e.push(new yt(r,i.id,`duplicate layer id "${i.id}", previously used at line ${T.id.__line__}`))}}if("ref"in i){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in i&&e.push(new yt(r,i[x],`"${x}" is prohibited for ref layers`))}),a.layers.forEach(x=>{sn(x.id)===m&&(g=x)}),g?g.ref?e.push(new yt(r,i.ref,"ref cannot reference another ref layer")):d=sn(g.type):typeof m=="string"&&e.push(new yt(r,i.ref,`ref layer "${m}" not found`))}else if(d!=="background"&&d!=="sky")if(i.source){const g=a.sources&&a.sources[i.source],x=g&&sn(g.type);g?x==="vector"&&d==="raster"?e.push(new yt(r,i.source,`layer "${i.id}" requires a raster source`)):x==="raster"&&d!=="raster"?e.push(new yt(r,i.source,`layer "${i.id}" requires a vector source`)):x!=="vector"||i["source-layer"]?x==="raster-dem"&&d!=="hillshade"?e.push(new yt(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||x==="geojson"&&g.lineMetrics||e.push(new yt(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new yt(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new yt(r,i.source,`source "${i.source}" not found`))}else e.push(new yt(r,i,'missing required property "source"'));return e=e.concat(Br({key:r,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vn({key:`${r}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:g=>Ea(Rr({layerType:d},g)),layout:g=>Br({layer:i,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>qc(Rr({layerType:d},x))}}),paint:g=>Br({layer:i,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":x=>vh(Rr({layerType:d},x))}})}})),e}function So(t){const e=t.value,i=t.key,r=mi(e);return r!=="string"?[new yt(i,e,`string expected, ${r} found`)]:[]}const wh={promoteId:function({key:t,value:e}){if(mi(e)==="string")return So({key:t,value:e});{const i=[];for(const r in e)i.push(...So({key:`${t}.${r}`,value:e[r]}));return i}}};function Th(t){const e=t.value,i=t.key,r=t.styleSpec,a=t.style;if(!e.type)return[new yt(i,e,'"type" is required')];const c=sn(e.type);let d;switch(c){case"vector":case"raster":case"raster-dem":return d=Br({key:i,value:e,valueSpec:r[`source_${c.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:wh}),d;case"geojson":if(d=Br({key:i,value:e,valueSpec:r.source_geojson,style:a,styleSpec:r,objectElementValidators:wh}),e.cluster)for(const m in e.clusterProperties){const[g,x]=e.clusterProperties[m],T=typeof g=="string"?[g,["accumulated"],["get",m]]:g;d.push(...In({key:`${i}.${m}.map`,value:x,expressionContext:"cluster-map"})),d.push(...In({key:`${i}.${m}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return d;case"video":return Br({key:i,value:e,valueSpec:r.source_video,style:a,styleSpec:r});case"image":return Br({key:i,value:e,valueSpec:r.source_image,style:a,styleSpec:r});case"canvas":return[new yt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tl({key:`${i}.type`,value:e.type,valueSpec:{values:of(r)},style:a,styleSpec:r})}}function of(t){return t.source.reduce((e,i)=>{const r=t[i];return r.type.type==="enum"&&(e=e.concat(Object.keys(r.type.values))),e},[])}function Eh(t){const e=t.value,i=t.styleSpec,r=i.light,a=t.style;let c=[];const d=mi(e);if(e===void 0)return c;if(d!=="object")return c=c.concat([new yt("light",e,`object expected, ${d} found`)]),c;for(const m in e){const g=m.match(/^(.*)-transition$/);c=c.concat(g&&r[g[1]]&&r[g[1]].transition?Vn({key:m,value:e[m],valueSpec:i.transition,style:a,styleSpec:i}):r[m]?Vn({key:m,value:e[m],valueSpec:r[m],style:a,styleSpec:i}):[new yt(m,e[m],`unknown property "${m}"`)])}return c}function Zc(t){const e=t.value,i=t.key,r=t.style,a=t.styleSpec,c=a.terrain;let d=[];const m=mi(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new yt("terrain",e,`object expected, ${m} found`)]),d;for(const g in e){const x=g.match(/^(.*)-transition$/);d=d.concat(x&&c[x[1]]&&c[x[1]].transition?Vn({key:g,value:e[g],valueSpec:a.transition,style:r,styleSpec:a}):c[g]?Vn({key:g,value:e[g],valueSpec:c[g],style:r,styleSpec:a}):[new yt(g,e[g],`unknown property "${g}"`)])}if(e.source){const g=r.sources&&r.sources[e.source],x=g&&sn(g.type);g?x!=="raster-dem"&&d.push(new yt(i,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):d.push(new yt(i,e.source,`source "${e.source}" not found`))}else d.push(new yt(i,e,'terrain is missing required property "source"'));return d}function Mh(t){const e=t.value,i=t.style,r=t.styleSpec,a=r.fog;let c=[];const d=mi(e);if(e===void 0)return c;if(d!=="object")return c=c.concat([new yt("fog",e,`object expected, ${d} found`)]),c;for(const m in e){const g=m.match(/^(.*)-transition$/);c=c.concat(g&&a[g[1]]&&a[g[1]].transition?Vn({key:m,value:e[m],valueSpec:r.transition,style:i,styleSpec:r}):a[m]?Vn({key:m,value:e[m],valueSpec:a[m],style:i,styleSpec:r}):[new yt(m,e[m],`unknown property "${m}"`)])}return c}const Sh={"*":()=>[],array:gh,boolean:function(t){const e=t.value,i=t.key,r=mi(e);return r!=="boolean"?[new yt(i,e,`boolean expected, ${r} found`)]:[]},number:ba,color:function(t){const e=t.key,i=t.value,r=mi(i);return r!=="string"?[new yt(e,i,`color expected, ${r} found`)]:cc(i)===null?[new yt(e,i,`color expected, "${i}" found`)]:[]},enum:Tl,filter:Ea,function:wa,layer:bh,object:Br,source:Th,light:Eh,terrain:Zc,fog:Mh,string:So,formatted:function(t){return So(t).length===0?[]:In(t)},resolvedImage:function(t){return So(t).length===0?[]:In(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,a=t.style;let c=[];const d=mi(e);if(d==="object")for(const m in e)c=c.concat(Vn({key:m,value:e[m],valueSpec:r[m],style:a,styleSpec:i}));else d!=="string"&&(c=c.concat([new yt("projection",e,`object or string expected, ${d} found`)]));return c}};function Vn(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&ya(sn(e))?wa(t):i.expression&&Is(Tn(e))?In(t):i.type&&Sh[i.type]?Sh[i.type](t):Br(Rr({},t,{valueSpec:i.type?r[i.type]:i}))}function sf(t){const e=t.value,i=t.key,r=So(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new yt(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new yt(i,e,'"glyphs" url must include a "{range}" token'))),r}function Ah(t,e=Le){return vr(Vn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:sf,"*":()=>[]}}))}const af=t=>vr(vh(t)),lf=t=>vr(qc(t));function vr(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Ch(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new hr(new Error(r.message))),i=!0;return i}var cf=Hr,Or=3;function Hr(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var c=0;c<this.d*this.d;c++){var d=a[Or+c],m=a[Or+c+1];r.push(d===m?null:a.subarray(d,m))}var g=a[Or+r.length+1];this.keys=a.subarray(a[Or+r.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var x=0;x<this.d*this.d;x++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var T=i/e*t;this.min=-T,this.max=t+T}Hr.prototype.insert=function(t,e,i,r,a){this._forEachCell(e,i,r,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(a)},Hr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Hr.prototype._insertCell=function(t,e,i,r,a,c){this.cells[a].push(c)},Hr.prototype.query=function(t,e,i,r,a){var c=this.min,d=this.max;if(t<=c&&e<=c&&d<=i&&d<=r&&!a)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,i,r,this._queryCell,m,{},a),m},Hr.prototype._queryCell=function(t,e,i,r,a,c,d,m){var g=this.cells[a];if(g!==null)for(var x=this.keys,T=this.bboxes,M=0;M<g.length;M++){var A=g[M];if(d[A]===void 0){var P=4*A;(m?m(T[P+0],T[P+1],T[P+2],T[P+3]):t<=T[P+2]&&e<=T[P+3]&&i>=T[P+0]&&r>=T[P+1])?(d[A]=!0,c.push(x[A])):d[A]=!1}}},Hr.prototype._forEachCell=function(t,e,i,r,a,c,d,m){for(var g=this._convertToCellCoord(t),x=this._convertToCellCoord(e),T=this._convertToCellCoord(i),M=this._convertToCellCoord(r),A=g;A<=T;A++)for(var P=x;P<=M;P++){var D=this.d*P+A;if((!m||m(this._convertFromCellCoord(A),this._convertFromCellCoord(P),this._convertFromCellCoord(A+1),this._convertFromCellCoord(P+1)))&&a.call(this,t,e,i,r,D,c,d,m))return}},Hr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Hr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Hr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Or+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=e,d=0;d<t.length;d++){var m=t[d];a[Or+d]=c,a.set(m,c),c+=m.length}return a[Or+t.length]=c,a.set(this.keys,c),a[Or+t.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};var Qo=Ie(cf);const Al={};function bt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Al[e]={klass:t,omit:i.omit||[]}}bt(Object,"Object"),Qo.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Qo.deserialize=function(t){return new Qo(t.buffer)},Object.defineProperty(Qo,"name",{value:"Grid"}),bt(Qo,"Grid"),bt(un,"Color"),bt(Error,"Error"),bt(cr,"AJAXError"),bt(yr,"ResolvedImage"),bt(bl,"StylePropertyFunction"),bt(vl,"StyleExpression",{omit:["_evaluator"]}),bt(xa,"ZoomDependentExpression"),bt(Oc,"ZoomConstantExpression"),bt(ao,"CompoundExpression",{omit:["_evaluate"]});for(const t in ga)Al[ga[t]._classRegistryKey]||bt(ga[t],`Expression${t}`);function Wc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Xc(t){return L.ImageBitmap&&t instanceof L.ImageBitmap}function Ds(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Wc(t)||Xc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof L.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Ds(r,e));return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(Al[r].omit.indexOf(c)>=0||(a[c]=Ds(t[c],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(a.$name=r),a}throw new Error("can't serialize object of type "+typeof t)}function es(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Wc(t)||Xc(t)||ArrayBuffer.isView(t)||t instanceof L.ImageData)return t;if(Array.isArray(t))return t.map(es);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=Al[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(r[a]=es(t[a]));return r}throw new Error("can't deserialize object of type "+typeof t)}const _t={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Hc(t){for(const e of t)if(Yc(e.charCodeAt(0)))return!0;return!1}function uf(t){for(const e of t)if(!Ih(e.charCodeAt(0)))return!1;return!0}function Ih(t){return!(_t.Arabic(t)||_t["Arabic Supplement"](t)||_t["Arabic Extended-A"](t)||_t["Arabic Presentation Forms-A"](t)||_t["Arabic Presentation Forms-B"](t))}function Yc(t){return!(t!==746&&t!==747&&(t<4352||!(_t["Bopomofo Extended"](t)||_t.Bopomofo(t)||_t["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||_t["CJK Compatibility Ideographs"](t)||_t["CJK Compatibility"](t)||_t["CJK Radicals Supplement"](t)||_t["CJK Strokes"](t)||!(!_t["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||_t["CJK Unified Ideographs Extension A"](t)||_t["CJK Unified Ideographs"](t)||_t["Enclosed CJK Letters and Months"](t)||_t["Hangul Compatibility Jamo"](t)||_t["Hangul Jamo Extended-A"](t)||_t["Hangul Jamo Extended-B"](t)||_t["Hangul Jamo"](t)||_t["Hangul Syllables"](t)||_t.Hiragana(t)||_t["Ideographic Description Characters"](t)||_t.Kanbun(t)||_t["Kangxi Radicals"](t)||_t["Katakana Phonetic Extensions"](t)||_t.Katakana(t)&&t!==12540||!(!_t["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!_t["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||_t["Unified Canadian Aboriginal Syllabics"](t)||_t["Unified Canadian Aboriginal Syllabics Extended"](t)||_t["Vertical Forms"](t)||_t["Yijing Hexagram Symbols"](t)||_t["Yi Syllables"](t)||_t["Yi Radicals"](t))))}function kh(t){return!(Yc(t)||function(e){return!!(_t["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||_t["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||_t["Letterlike Symbols"](e)||_t["Number Forms"](e)||_t["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||_t["Control Pictures"](e)&&e!==9251||_t["Optical Character Recognition"](e)||_t["Enclosed Alphanumerics"](e)||_t["Geometric Shapes"](e)||_t["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||_t["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_t["CJK Symbols and Punctuation"](e)||_t.Katakana(e)||_t["Private Use Area"](e)||_t["CJK Compatibility Forms"](e)||_t["Small Form Variants"](e)||_t["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function zh(t){return t>=1424&&t<=2303||_t["Arabic Presentation Forms-A"](t)||_t["Arabic Presentation Forms-B"](t)}function hf(t,e){return!(!e&&zh(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||_t.Khmer(t))}function df(t){for(const e of t)if(zh(e.charCodeAt(0)))return!0;return!1}const Kc="deferred",Jc="loading",$c="loaded";let Ls=null,l="unavailable",n=null;const s=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(l="error"),Ls&&Ls(t)};function u(){p.fire(new ro("pluginStateChange",{pluginStatus:l,pluginURL:n}))}const p=new Xo,_=function(){return l},v=function(){if(l!==Kc||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");l=Jc,u(),n&&Lr({url:n},t=>{t?s(t):(l=$c,u())})},b={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>l===$c||b.applyArabicShaping!=null,isLoading:()=>l===Jc,setState(t){l=t.pluginStatus,n=t.pluginURL},isParsed:()=>b.applyArabicShaping!=null&&b.processBidirectionalText!=null&&b.processStyledBidirectionalText!=null,getPluginURL:()=>n};class E{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const a of i)if(!hf(a.charCodeAt(0),r))return!1;return!0}(e,b.isLoaded())}}class I{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,a){if(ya(r))return new bl(r,a);if(Is(r)){const c=va(r,a);if(c.result==="error")throw new Error(c.value.map(d=>`${d.key}: ${d.message}`).join(", "));return c.value}{let c=r;return typeof r=="string"&&a.type==="color"&&(c=un.parse(r)),{kind:"constant",evaluate:()=>c}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class C{constructor(e){this.property=e,this.value=new I(e,void 0)}transitioned(e,i){return new V(this.property,this.value,i,ti({},e.transition,this.transition),e.now)}untransitioned(){return new V(this.property,this.value,null,{},0)}}class R{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ci(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new C(this._values[e].property)),this._values[e].value=new I(this._values[e].property,i===null?void 0:ci(i))}getTransition(e){return ci(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new C(this._values[e].property)),this._values[e].transition=ci(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const r=new q(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].transitioned(e,i._values[a]);return r}untransitioned(){const e=new q(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class V{constructor(e,i,r,a,c){const d=a.delay||0,m=a.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+d,this.end=this.begin+m,e.specification.transition&&(a.delay||a.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const a=e.now||0,c=this.value.possiblyEvaluate(e,i,r),d=this.prior;if(d){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return d.possiblyEvaluate(e,i,r);{const m=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,r),c,vi(m))}}return c}}class q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const a=new X(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,r);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ci(this._values[e].value)}setValue(e,i){this._values[e]=new I(this._values[e].property,i===null?void 0:ci(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const a=new X(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,r);return a}}class Z{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,a){return this.property.evaluate(this.value,this.parameters,e,i,r,a)}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class B{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const a=da[this.specification.type];return a?a(e,i,r):e}}class G{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,a){return new Z(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,a)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Z(this,{kind:"constant",value:void 0},e.parameters);const a=da[this.specification.type];return a?new Z(this,{kind:"constant",value:a(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,a,c,d){return e.kind==="constant"?e.value:e.evaluate(i,r,a,c,d)}}class J{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,a){return!!e.expression.evaluate(i,null,{},r,a)}interpolate(){return!1}}class ${constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new E(0,{});for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new I(a,void 0),d=this.defaultTransitionablePropertyValues[r]=new C(a);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate(i)}}}function le(t,e){return 256*(t=je(Math.floor(t),0,255))+je(Math.floor(e),0,255)}bt(G,"DataDrivenProperty"),bt(B,"DataConstantProperty"),bt(J,"ColorRampProperty");const he={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ue{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ge{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function me(t,e=1){let i=0,r=0;return{members:t.map(a=>{const c=he[a.type].BYTES_PER_ELEMENT,d=i=Se(i,Math.max(e,c)),m=a.components||1;return r=Math.max(r,c),i+=c*m,{name:a.name,type:a.type,components:m,offset:d}}),size:Se(i,Math.max(r,e)),alignment:e}}function Se(t,e){return Math.ceil(t/e)*e}class Je extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=r,e}}Je.prototype.bytesPerElement=4,bt(Je,"StructArrayLayout2i4");class we extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=a,e}}we.prototype.bytesPerElement=6,bt(we,"StructArrayLayout3i6");class Ue extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=r,this.int16[d+2]=a,this.int16[d+3]=c,e}}Ue.prototype.bytesPerElement=8,bt(Ue,"StructArrayLayout4i8");class ke extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,a,c,d,m)}emplace(e,i,r,a,c,d,m,g){const x=6*e,T=12*e,M=3*e;return this.int16[x+0]=i,this.int16[x+1]=r,this.uint8[T+4]=a,this.uint8[T+5]=c,this.uint8[T+6]=d,this.uint8[T+7]=m,this.float32[M+2]=g,e}}ke.prototype.bytesPerElement=12,bt(ke,"StructArrayLayout2i4ub1f12");class Ye extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=r,this.float32[d+2]=a,this.float32[d+3]=c,e}}Ye.prototype.bytesPerElement=16,bt(Ye,"StructArrayLayout4f16");class Me extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,c)}emplace(e,i,r,a,c,d){const m=6*e,g=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=r,this.uint16[m+2]=a,this.uint16[m+3]=c,this.float32[g+2]=d,e}}Me.prototype.bytesPerElement=12,bt(Me,"StructArrayLayout4ui1f12");class Fe extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=r,this.uint16[d+2]=a,this.uint16[d+3]=c,e}}Fe.prototype.bytesPerElement=8,bt(Fe,"StructArrayLayout4ui8");class Qe extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,r,a,c,d)}emplace(e,i,r,a,c,d,m){const g=6*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=a,this.int16[g+3]=c,this.int16[g+4]=d,this.int16[g+5]=m,e}}Qe.prototype.bytesPerElement=12,bt(Qe,"StructArrayLayout6i12");class Ge extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m,g,x,T,M,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,r,a,c,d,m,g,x,T,M,A)}emplace(e,i,r,a,c,d,m,g,x,T,M,A,P){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=r,this.int16[D+2]=a,this.int16[D+3]=c,this.uint16[D+4]=d,this.uint16[D+5]=m,this.uint16[D+6]=g,this.uint16[D+7]=x,this.int16[D+8]=T,this.int16[D+9]=M,this.int16[D+10]=A,this.int16[D+11]=P,e}}Ge.prototype.bytesPerElement=24,bt(Ge,"StructArrayLayout4i4ui4i24");class it extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,r,a,c,d)}emplace(e,i,r,a,c,d,m){const g=10*e,x=5*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=a,this.float32[x+2]=c,this.float32[x+3]=d,this.float32[x+4]=m,e}}it.prototype.bytesPerElement=20,bt(it,"StructArrayLayout3i3f20");class It extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}It.prototype.bytesPerElement=4,bt(It,"StructArrayLayout1ul4");class Gt extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m,g,x,T,M,A,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,r,a,c,d,m,g,x,T,M,A,P)}emplace(e,i,r,a,c,d,m,g,x,T,M,A,P,D){const O=20*e,j=10*e;return this.int16[O+0]=i,this.int16[O+1]=r,this.int16[O+2]=a,this.int16[O+3]=c,this.int16[O+4]=d,this.float32[j+3]=m,this.float32[j+4]=g,this.float32[j+5]=x,this.float32[j+6]=T,this.int16[O+14]=M,this.uint32[j+8]=A,this.uint16[O+18]=P,this.uint16[O+19]=D,e}}Gt.prototype.bytesPerElement=40,bt(Gt,"StructArrayLayout5i4f1i1ul2ui40");class wt extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,a,c,d,m)}emplace(e,i,r,a,c,d,m,g){const x=8*e;return this.int16[x+0]=i,this.int16[x+1]=r,this.int16[x+2]=a,this.int16[x+4]=c,this.int16[x+5]=d,this.int16[x+6]=m,this.int16[x+7]=g,e}}wt.prototype.bytesPerElement=16,bt(wt,"StructArrayLayout3i2i2i16");class Lt extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,c)}emplace(e,i,r,a,c,d){const m=4*e,g=8*e;return this.float32[m+0]=i,this.float32[m+1]=r,this.float32[m+2]=a,this.int16[g+6]=c,this.int16[g+7]=d,e}}Lt.prototype.bytesPerElement=16,bt(Lt,"StructArrayLayout2f1f2i16");class li extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const d=12*e,m=3*e;return this.uint8[d+0]=i,this.uint8[d+1]=r,this.float32[m+1]=a,this.float32[m+2]=c,e}}li.prototype.bytesPerElement=12,bt(li,"StructArrayLayout2ub2f12");class si extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=a,e}}si.prototype.bytesPerElement=12,bt(si,"StructArrayLayout3f12");class Ct extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=a,e}}Ct.prototype.bytesPerElement=6,bt(Ct,"StructArrayLayout3ui6");class Ti extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe){const re=this.length;return this.resize(re+1),this.emplace(re,e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe)}emplace(e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe,re){const Ae=30*e,Te=15*e,Re=60*e;return this.int16[Ae+0]=i,this.int16[Ae+1]=r,this.int16[Ae+2]=a,this.float32[Te+2]=c,this.float32[Te+3]=d,this.uint16[Ae+8]=m,this.uint16[Ae+9]=g,this.uint32[Te+5]=x,this.uint32[Te+6]=T,this.uint32[Te+7]=M,this.uint16[Ae+16]=A,this.uint16[Ae+17]=P,this.uint16[Ae+18]=D,this.float32[Te+10]=O,this.float32[Te+11]=j,this.uint8[Re+48]=Y,this.uint8[Re+49]=ne,this.uint8[Re+50]=K,this.uint32[Te+13]=ie,this.int16[Ae+28]=oe,this.uint8[Re+58]=re,e}}Ti.prototype.bytesPerElement=60,bt(Ti,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ii extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe,re,Ae,Te,Re,$e,ze,Ne,Ve,We){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe,re,Ae,Te,Re,$e,ze,Ne,Ve,We)}emplace(e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j,Y,ne,K,ie,oe,re,Ae,Te,Re,$e,ze,Ne,Ve,We,ot){const De=38*e,ft=19*e;return this.int16[De+0]=i,this.int16[De+1]=r,this.int16[De+2]=a,this.float32[ft+2]=c,this.float32[ft+3]=d,this.int16[De+8]=m,this.int16[De+9]=g,this.int16[De+10]=x,this.int16[De+11]=T,this.int16[De+12]=M,this.int16[De+13]=A,this.uint16[De+14]=P,this.uint16[De+15]=D,this.uint16[De+16]=O,this.uint16[De+17]=j,this.uint16[De+18]=Y,this.uint16[De+19]=ne,this.uint16[De+20]=K,this.uint16[De+21]=ie,this.uint16[De+22]=oe,this.uint16[De+23]=re,this.uint16[De+24]=Ae,this.uint16[De+25]=Te,this.uint16[De+26]=Re,this.uint16[De+27]=$e,this.uint16[De+28]=ze,this.uint32[ft+15]=Ne,this.float32[ft+16]=Ve,this.float32[ft+17]=We,this.float32[ft+18]=ot,e}}Ii.prototype.bytesPerElement=76,bt(Ii,"StructArrayLayout3i2f6i15ui1ul3f76");class ki extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ki.prototype.bytesPerElement=4,bt(ki,"StructArrayLayout1f4");class zi extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,c)}emplace(e,i,r,a,c,d){const m=5*e;return this.float32[m+0]=i,this.float32[m+1]=r,this.float32[m+2]=a,this.float32[m+3]=c,this.float32[m+4]=d,e}}zi.prototype.bytesPerElement=20,bt(zi,"StructArrayLayout5f20");class jn extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=r,this.uint16[d+3]=a,this.uint16[d+4]=c,e}}jn.prototype.bytesPerElement=12,bt(jn,"StructArrayLayout1ul3ui12");class kn extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,e}}kn.prototype.bytesPerElement=4,bt(kn,"StructArrayLayout2ui4");class br extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}br.prototype.bytesPerElement=2,bt(br,"StructArrayLayout1ui2");class Yr extends ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=r,e}}Yr.prototype.bytesPerElement=8,bt(Yr,"StructArrayLayout2f8");class Hi extends ue{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hi.prototype.size=40;class Pi extends Gt{get(e){return new Hi(this,e)}}bt(Pi,"CollisionBoxArray");class yi extends ue{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}yi.prototype.size=60;class fn extends Ti{get(e){return new yi(this,e)}}bt(fn,"PlacedSymbolArray");class Jn extends ue{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Jn.prototype.size=76;class qi extends Ii{get(e){return new Jn(this,e)}}bt(qi,"SymbolInstanceArray");class ir extends ki{getoffsetX(e){return this.float32[1*e+0]}}bt(ir,"GlyphOffsetArray");class Cl extends Je{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}bt(Cl,"SymbolLineVertexArray");class ts extends ue{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ts.prototype.size=12;class Sa extends jn{get(e){return new ts(this,e)}}bt(Sa,"FeatureIndexArray");class fo extends kn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}bt(fo,"FillExtrusionCentroidArray");const Ao=me([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),is=me([{name:"a_dash",components:4,type:"Uint16"}]);var Il={exports:{}},Aa={exports:{}};Aa.exports=function(t,e){var i,r,a,c,d,m,g,x;for(r=t.length-(i=3&t.length),a=e,d=3432918353,m=461845907,x=0;x<r;)g=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24,++x,a=27492+(65535&(c=5*(65535&(a=(a^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(g=0,i){case 3:g^=(255&t.charCodeAt(x+2))<<16;case 2:g^=(255&t.charCodeAt(x+1))<<8;case 1:a^=g=(65535&(g=(g=(65535&(g^=255&t.charCodeAt(x)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var Qc=Aa.exports,cm={exports:{}};cm.exports=function(t,e){for(var i,r=t.length,a=e^r,c=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++c;switch(r){case 3:a^=(255&t.charCodeAt(c+2))<<16;case 2:a^=(255&t.charCodeAt(c+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(c)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var um=Qc,X0=cm.exports;Il.exports=um,Il.exports.murmur3=um,Il.exports.murmur2=X0;var ff=Ie(Il.exports);class Ph{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,a){this.ids.push(hm(e)),this.positions.push(i,r,a)}getPositions(e){const i=hm(e);let r=0,a=this.ids.length-1;for(;r<a;){const d=r+a>>1;this.ids[d]>=i?a=d:r=d+1}const c=[];for(;this.ids[r]===i;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c}static serialize(e,i){const r=new Float64Array(e.ids),a=new Uint32Array(e.positions);return pf(r,a,0,r.length-1),i&&i.push(r.buffer,a.buffer),{ids:r,positions:a}}static deserialize(e){const i=new Ph;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function hm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ff(String(t))}function pf(t,e,i,r){for(;i<r;){const a=t[i+r>>1];let c=i-1,d=r+1;for(;;){do c++;while(t[c]<a);do d--;while(t[d]>a);if(c>=d)break;Dh(t,c,d),Dh(e,3*c,3*d),Dh(e,3*c+1,3*d+1),Dh(e,3*c+2,3*d+2)}d-i<r-d?(pf(t,e,i,d),i=d+1):(pf(t,e,d+1,r),r=d)}}function Dh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}bt(Ph,"FeaturePositionMap");class ns{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Lh extends ns{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class dm extends ns{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class fm extends ns{constructor(e){super(e),this.current=un.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const H0=new Float32Array(16),Y0=new Float32Array(9),K0=new Float32Array(4);function mf(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}class eu{constructor(e,i,r){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=r}setUniform(e,i,r,a,c){i.set(e,c,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new fm(e):new Lh(e)}}class kl{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,a,c){const d=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,c,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new dm(e):new Lh(e)}}class rs{constructor(e,i,r,a){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,a,c,d){const m=this.paintVertexArray.length,g=this.expression.evaluate(new E(0),i,{},c,a,d);this.paintVertexArray.resize(e),this._setPaintValue(m,e,g)}updatePaintArray(e,i,r,a,c){const d=this.expression.evaluate({zoom:0},r,a,void 0,c);this._setPaintValue(e,i,d)}_setPaintValue(e,i,r){if(this.type==="color"){const a=mf(r);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class po{constructor(e,i,r,a,c,d){this.expression=e,this.uniformNames=i.map(m=>`u_${m}_t`),this.type=r,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,r,a,c,d){const m=this.expression.evaluate(new E(this.zoom),i,{},c,a,d),g=this.expression.evaluate(new E(this.zoom+1),i,{},c,a,d),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,m,g)}updatePaintArray(e,i,r,a,c){const d=this.expression.evaluate({zoom:this.zoom},r,a,void 0,c),m=this.expression.evaluate({zoom:this.zoom+1},r,a,void 0,c);this._setPaintValue(e,i,d,m)}_setPaintValue(e,i,r,a){if(this.type==="color"){const c=mf(r),d=mf(a);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,c[0],c[1],d[0],d[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,a,c){const d=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,m=je(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(e,c,m)}getBinding(e,i){return new Lh(e)}}class Rs{constructor(e,i,r,a,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(r==="array"?is:Ao).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new a}populatePaintArray(e,i,r){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,a,c,d){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],d)}_setPaintValues(e,i,r,a){if(!a||!r)return;const c=a[r];if(!c)return;const{tl:d,br:m,pixelRatio:g}=c;for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,d[0],d[1],m[0],m[1],g)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bs{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const a=[];for(const c in e.paint._values){if(!r(c))continue;const d=e.paint.get(c);if(!(d instanceof Z&&As(d.property.specification)))continue;const m=$0(c,e.type),g=d.value,x=d.property.specification.type,T=!!d.property.useIntegerZoom,M=c==="line-dasharray"||c.endsWith("pattern"),A=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(g.kind!=="constant"||A)if(g.kind==="source"||A||M){const P=pm(c,x,"source");this.binders[c]=M?new Rs(g,m,x,P,e.id):new rs(g,m,x,P),a.push(`/a_${c}`)}else{const P=pm(c,x,"composite");this.binders[c]=new po(g,m,x,T,i,P),a.push(`/z_${c}`)}else this.binders[c]=M?new kl(g.value,m):new eu(g.value,m,x),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof rs||i instanceof po?i.maxValue:0}populatePaintArrays(e,i,r,a,c,d){for(const m in this.binders){const g=this.binders[m];(g instanceof rs||g instanceof po||g instanceof Rs)&&g.populatePaintArray(e,i,r,a,c,d)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof kl&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,a,c,d){let m=!1;for(const g in e){const x=i.getPositions(g);for(const T of x){const M=r.feature(T.index);for(const A in this.binders){const P=this.binders[A];if((P instanceof rs||P instanceof po||P instanceof Rs)&&P.expression.isStateDependent===!0){const D=a.paint.get(A);P.expression=D.value,P.updatePaintArray(T.start,T.end,M,e[g],c,d),m=!0}}}}return m}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof eu||r instanceof kl)&&e.push(...r.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof rs||r instanceof po||r instanceof Rs)for(let a=0;a<r.paintVertexAttributes.length;a++)e.push(r.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof eu||r instanceof kl||r instanceof po)for(const a of r.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof eu||a instanceof kl||a instanceof po)for(const c of a.uniformNames)i.push({name:c,property:r,binding:a.getBinding(e,c)})}return i}setUniforms(e,i,r,a,c){for(const{name:d,property:m,binding:g}of r)this.binders[m].setUniform(e,g,c,a.get(m),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof rs||i instanceof po||i instanceof Rs)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof rs||r instanceof po||r instanceof Rs)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof rs||i instanceof po||i instanceof Rs)&&i.destroy()}}}class Ca{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Bs(a,i,r);this.needsUpload=!1,this._featureMap=new Ph,this._bufferOffset=0}populatePaintArrays(e,i,r,a,c,d,m){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,i,a,c,d,m);i.id!==void 0&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,a,c){for(const d of r)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,i,d,a,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const J0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $0(t,e){return J0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Q0={"line-pattern":{source:Me,composite:Me},"fill-pattern":{source:Me,composite:Me},"fill-extrusion-pattern":{source:Me,composite:Me},"line-dasharray":{source:Fe,composite:Fe}},ex={color:{source:Yr,composite:Ye},number:{source:ki,composite:Yr}};function pm(t,e,i){const r=Q0[t];return r&&r[i]||ex[e][i]}bt(eu,"ConstantBinder"),bt(kl,"PatternConstantBinder"),bt(rs,"SourceExpressionBinder"),bt(Rs,"PatternCompositeBinder"),bt(po,"CompositeExpressionBinder"),bt(Bs,"ProgramConfiguration",{omit:["_buffers"]}),bt(Ca,"ProgramConfigurationSet");const mm="-transition";class mo extends Xo{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new W(i.layout)),i.paint)){this._transitionablePaint=new R(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new X(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){i!=null&&this._validate(lf,`layers.${this.id}.layout.${e}`,e,i,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Ft(e,mm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(i!=null&&this._validate(af,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(Ft(e,mm))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const a=this._transitionablePaint._values[e],c=a.value.isDataDriven(),d=a.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value,g=m.isDataDriven(),x=Ft(e,"pattern")||e==="line-dasharray";return g||c||x||this._handleOverridablePaintPropertyUpdate(e,d,m)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),lt(e,(i,r)=>!(i===void 0||r==="layout"&&!Object.keys(i).length||r==="paint"&&!Object.keys(i).length))}_validate(e,i,r,a,c={}){return(!c||c.validate!==!1)&&Ch(this,e.call(Ah,{key:i,layerType:this.type,objectKey:r,value:a,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Z&&As(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=El(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tx=me([{name:"a_pos",components:2,type:"Int16"}],4),ix=me([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class pn{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,a){let c=this.segments[this.segments.length-1];return e>pn.MAX_VERTEX_ARRAY_LENGTH&&ei(`Max vertices per segment is ${pn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>pn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,a){return new pn([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])}}pn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt(pn,"SegmentVector");var Dt=8192;class Os{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}setSouthWest(e){return this._sw=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}extend(e){const i=this._sw,r=this._ne;let a,c;if(e instanceof Di)a=e,c=e;else{if(!(e instanceof Os))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Os.convert(e)):this.extend(Di.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Di.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return i||r?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),r.lng=Math.max(c.lng,r.lng),r.lat=Math.max(c.lat,r.lat)):(this._sw=new Di(a.lng,a.lat),this._ne=new Di(c.lng,c.lat)),this}getCenter(){return new Di((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Di(this.getWest(),this.getNorth())}getSouthEast(){return new Di(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=Di.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&a}static convert(e){return!e||e instanceof Os?e:new Os(e)}}var Rh=1e-6,wr=typeof Float32Array<"u"?Float32Array:Array;function _m(){var t=new wr(9);return wr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function gm(t,e,i){var r=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],x=e[6],T=e[7],M=e[8],A=i[0],P=i[1],D=i[2],O=i[3],j=i[4],Y=i[5],ne=i[6],K=i[7],ie=i[8];return t[0]=A*r+P*d+D*x,t[1]=A*a+P*m+D*T,t[2]=A*c+P*g+D*M,t[3]=O*r+j*d+Y*x,t[4]=O*a+j*m+Y*T,t[5]=O*c+j*g+Y*M,t[6]=ne*r+K*d+ie*x,t[7]=ne*a+K*m+ie*T,t[8]=ne*c+K*g+ie*M,t}function _o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _f(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],x=e[7],T=e[8],M=e[9],A=e[10],P=e[11],D=e[12],O=e[13],j=e[14],Y=e[15],ne=i*m-r*d,K=i*g-a*d,ie=i*x-c*d,oe=r*g-a*m,re=r*x-c*m,Ae=a*x-c*g,Te=T*O-M*D,Re=T*j-A*D,$e=T*Y-P*D,ze=M*j-A*O,Ne=M*Y-P*O,Ve=A*Y-P*j,We=ne*Ve-K*Ne+ie*ze+oe*$e-re*Re+Ae*Te;return We?(t[0]=(m*Ve-g*Ne+x*ze)*(We=1/We),t[1]=(a*Ne-r*Ve-c*ze)*We,t[2]=(O*Ae-j*re+Y*oe)*We,t[3]=(A*re-M*Ae-P*oe)*We,t[4]=(g*$e-d*Ve-x*Re)*We,t[5]=(i*Ve-a*$e+c*Re)*We,t[6]=(j*ie-D*Ae-Y*K)*We,t[7]=(T*Ae-A*ie+P*K)*We,t[8]=(d*Ne-m*$e+x*Te)*We,t[9]=(r*$e-i*Ne-c*Te)*We,t[10]=(D*re-O*ie+Y*ne)*We,t[11]=(M*ie-T*re-P*ne)*We,t[12]=(m*Re-d*ze-g*Te)*We,t[13]=(i*ze-r*Re+a*Te)*We,t[14]=(O*K-D*oe-j*ne)*We,t[15]=(T*oe-M*K+A*ne)*We,t):null}function Ia(t,e,i){var r=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],x=e[6],T=e[7],M=e[8],A=e[9],P=e[10],D=e[11],O=e[12],j=e[13],Y=e[14],ne=e[15],K=i[0],ie=i[1],oe=i[2],re=i[3];return t[0]=K*r+ie*m+oe*M+re*O,t[1]=K*a+ie*g+oe*A+re*j,t[2]=K*c+ie*x+oe*P+re*Y,t[3]=K*d+ie*T+oe*D+re*ne,t[4]=(K=i[4])*r+(ie=i[5])*m+(oe=i[6])*M+(re=i[7])*O,t[5]=K*a+ie*g+oe*A+re*j,t[6]=K*c+ie*x+oe*P+re*Y,t[7]=K*d+ie*T+oe*D+re*ne,t[8]=(K=i[8])*r+(ie=i[9])*m+(oe=i[10])*M+(re=i[11])*O,t[9]=K*a+ie*g+oe*A+re*j,t[10]=K*c+ie*x+oe*P+re*Y,t[11]=K*d+ie*T+oe*D+re*ne,t[12]=(K=i[12])*r+(ie=i[13])*m+(oe=i[14])*M+(re=i[15])*O,t[13]=K*a+ie*g+oe*A+re*j,t[14]=K*c+ie*x+oe*P+re*Y,t[15]=K*d+ie*T+oe*D+re*ne,t}function tu(t,e,i){var r,a,c,d,m,g,x,T,M,A,P,D,O=i[0],j=i[1],Y=i[2];return e===t?(t[12]=e[0]*O+e[4]*j+e[8]*Y+e[12],t[13]=e[1]*O+e[5]*j+e[9]*Y+e[13],t[14]=e[2]*O+e[6]*j+e[10]*Y+e[14],t[15]=e[3]*O+e[7]*j+e[11]*Y+e[15]):(a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],x=e[6],T=e[7],M=e[8],A=e[9],P=e[10],D=e[11],t[0]=r=e[0],t[1]=a,t[2]=c,t[3]=d,t[4]=m,t[5]=g,t[6]=x,t[7]=T,t[8]=M,t[9]=A,t[10]=P,t[11]=D,t[12]=r*O+m*j+M*Y+e[12],t[13]=a*O+g*j+A*Y+e[13],t[14]=c*O+x*j+P*Y+e[14],t[15]=d*O+T*j+D*Y+e[15]),t}function ka(t,e,i){var r=i[0],a=i[1],c=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gf(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[4],d=e[5],m=e[6],g=e[7],x=e[8],T=e[9],M=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*a+x*r,t[5]=d*a+T*r,t[6]=m*a+M*r,t[7]=g*a+A*r,t[8]=x*a-c*r,t[9]=T*a-d*r,t[10]=M*a-m*r,t[11]=A*a-g*r,t}function Bh(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[0],d=e[1],m=e[2],g=e[3],x=e[8],T=e[9],M=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a-x*r,t[1]=d*a-T*r,t[2]=m*a-M*r,t[3]=g*a-A*r,t[8]=c*r+x*a,t[9]=d*r+T*a,t[10]=m*r+M*a,t[11]=g*r+A*a,t}function ym(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xm(t,e,i){var r,a,c,d=i[0],m=i[1],g=i[2],x=Math.hypot(d,m,g);return x<Rh?null:(d*=x=1/x,m*=x,g*=x,r=Math.sin(e),a=Math.cos(e),t[0]=d*d*(c=1-a)+a,t[1]=m*d*c+g*r,t[2]=g*d*c-m*r,t[3]=0,t[4]=d*m*c-g*r,t[5]=m*m*c+a,t[6]=g*m*c+d*r,t[7]=0,t[8]=d*g*c+m*r,t[9]=m*g*c-d*r,t[10]=g*g*c+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var nx=Ia;function yf(){var t=new wr(3);return wr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function vm(t){var e=new wr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function iu(t){return Math.hypot(t[0],t[1],t[2])}function zl(t,e,i){var r=new wr(3);return r[0]=t,r[1]=e,r[2]=i,r}function os(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function xf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function bm(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function nu(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function ru(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Fr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ou(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function nr(t,e){var i=e[0],r=e[1],a=e[2],c=i*i+r*r+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function Kr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vf(t,e,i){var r=e[0],a=e[1],c=e[2],d=i[0],m=i[1],g=i[2];return t[0]=a*g-c*m,t[1]=c*d-r*g,t[2]=r*m-a*d,t}function hn(t,e,i){var r=e[0],a=e[1],c=e[2],d=i[3]*r+i[7]*a+i[11]*c+i[15];return t[0]=(i[0]*r+i[4]*a+i[8]*c+i[12])/(d=d||1),t[1]=(i[1]*r+i[5]*a+i[9]*c+i[13])/d,t[2]=(i[2]*r+i[6]*a+i[10]*c+i[14])/d,t}function wm(t,e,i){var r=i[0],a=i[1],c=i[2],d=e[0],m=e[1],g=e[2],x=a*g-c*m,T=c*d-r*g,M=r*m-a*d,A=a*M-c*T,P=c*x-r*M,D=r*T-a*x,O=2*i[3];return T*=O,M*=O,P*=2,D*=2,t[0]=d+(x*=O)+(A*=2),t[1]=m+T+P,t[2]=g+M+D,t}var su,go=xf,rx=bm,ox=iu;function Tm(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Em(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],d=i*i+r*r+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=i*d,t[1]=r*d,t[2]=a*d,t[3]=c*d,t}function za(t,e,i){var r=e[0],a=e[1],c=e[2],d=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*c+i[12]*d,t[1]=i[1]*r+i[5]*a+i[9]*c+i[13]*d,t[2]=i[2]*r+i[6]*a+i[10]*c+i[14]*d,t[3]=i[3]*r+i[7]*a+i[11]*c+i[15]*d,t}function Mm(){var t=new wr(4);return wr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Sm(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Am(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=r*g+d*m,t[1]=a*g+c*m,t[2]=c*g-a*m,t[3]=d*g-r*m,t}function Cm(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=r*g-c*m,t[1]=a*g+d*m,t[2]=c*g+r*m,t[3]=d*g-a*m,t}yf(),su=new wr(4),wr!=Float32Array&&(su[0]=0,su[1]=0,su[2]=0,su[3]=0);var sx=Em;yf(),zl(1,0,0),zl(0,1,0),Mm(),Mm(),_m();const ax=me([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Im}=ax,km=me([{name:"a_pos_3",components:3,type:"Int16"}]);var au=me([{name:"a_pos",type:"Int16",components:2}]);class bf{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const a=Kr(i,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,r){if(function(P,D){var O=P[0],j=P[1],Y=P[2],ne=D[0],K=D[1],ie=D[2];return Math.abs(O-ne)<=Rh*Math.max(1,Math.abs(O),Math.abs(ne))&&Math.abs(j-K)<=Rh*Math.max(1,Math.abs(j),Math.abs(K))&&Math.abs(Y-ie)<=Rh*Math.max(1,Math.abs(Y),Math.abs(ie))}(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[a,c,d]=this.dir,m=this.pos[0]-e[0],g=this.pos[1]-e[1],x=this.pos[2]-e[2],T=a*a+c*c+d*d,M=2*(m*a+g*c+x*d),A=M*M-4*T*(m*m+g*g+x*x-i*i);if(A<0){const P=Math.max(-M/2,0),D=m+a*P,O=g+c*P,j=x+d*P,Y=Math.hypot(D,O,j);return r[0]=D*i/Y,r[1]=O*i/Y,r[2]=j*i/Y,!1}{const P=(-M-Math.sqrt(A))/(2*T);if(P<0){const D=Math.hypot(m,g,x);return r[0]=m*i/D,r[1]=g*i/D,r[2]=x*i/D,!1}return r[0]=m+a*P,r[1]=g+c*P,r[2]=x+d*P,!0}}}class wf{constructor(e,i,r,a,c){this.TL=e,this.TR=i,this.BR=r,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,i,r){const a=[-1,1,1],c=[1,1,1],d=[1,-1,1],m=[-1,-1,1],g=hn(a,a,e),x=hn(c,c,e),T=hn(d,d,e),M=hn(m,m,e);return new wf(g,x,T,M,i/r)}}class Tf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,a){const c=Math.pow(2,r),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const x=za([],g,e),T=1/x[3]/i*c;return function(M,A,P){return M[0]=A[0]*P[0],M[1]=A[1]*P[1],M[2]=A[2]*P[2],M[3]=A[3]*P[3],M}(x,x,[T,T,a?1/x[3]:T,T])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const x=nr([],vf([],go([],d[g[0]],d[g[1]]),go([],d[g[2]],d[g[1]]))),T=-Kr(x,d[g[1]]);return x.concat(T)});return new Tf(d,m)}}class rr{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const a of e)nu(i,i,a),ru(r,r,a);return new rr(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let a=0;a<r.length;++a)hn(r[a],r[a],i);return rr.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=Fr([],os([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=vm(this.min),a=vm(this.max);for(let c=0;c<i.length;c++)r[c]=i[c]?this.min[c]:this.center[c],a[c]=i[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new rr(r,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let a=0;a<e.planes.length;a++){const c=e.planes[a];let d=0;for(let m=0;m<i.length;m++)d+=Kr(c,i[m])+c[3]>=0;if(d===0)return 0;d!==i.length&&(r=!1)}if(r)return 2;for(let a=0;a<3;a++){let c=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){const g=e.points[m][a]-this.min[a];c=Math.min(c,g),d=Math.max(d,g)}if(d<0||c>this.max[a]-this.min[a])return 0}return 1}}const Ef=5,zm=6,Co=Dt/Math.PI/2,lx=16383,Pa=64,lu=[Pa,32,16],Jr=-Co,$r=Co,cx=[new rr([Jr,Jr,Jr],[$r,$r,$r]),new rr([Jr,Jr,Jr],[0,0,$r]),new rr([0,Jr,Jr],[$r,0,$r]),new rr([Jr,0,Jr],[0,$r,$r]),new rr([0,0,Jr],[$r,$r,$r])];function Oh(t){return t*Co/hu}function Pm(t,e,i,r=!0){const a=Fr([],t._camera.position,t.worldSize),c=[e,i,1,1];za(c,c,t.pixelMatrixInverse),Tm(c,c,1/c[3]);const d=nr([],go([],c,a)),m=t.globeMatrix,g=[m[12],m[13],m[14]],x=go([],g,a),T=iu(x),M=nr([],x),A=t.worldSize/(2*Math.PI),P=Kr(M,d),D=Math.asin(A/T);if(D<Math.acos(P)){if(!r)return null;const $e=[],ze=[];Fr($e,d,T/P),nr(ze,go(ze,$e,x)),nr(d,os(d,x,Fr(d,ze,Math.tan(D)*T)))}const O=[];new bf(a,d).closestPointOnSphere(g,A,O);const j=nr([],gi(m,0)),Y=nr([],gi(m,1)),ne=nr([],gi(m,2)),K=Kr(j,O),ie=Kr(Y,O),oe=Kr(ne,O),re=St(Math.asin(-ie/A));let Ae=St(Math.atan2(K,oe));Ae=t.center.lng+function($e,ze){const Ne=(ze-$e+180)%360-180;return Ne<-180?Ne+360:Ne}(t.center.lng,Ae);const Te=ko(Ae),Re=je(zo(re),0,1);return new Rl(Te,Re)}class ux{constructor(e,i,r){this.a=go([],e,r),this.b=go([],i,r),this.center=r;const a=nr([],this.a),c=nr([],this.b);this.angle=Math.acos(Kr(a,c))}}function Mf(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,a,c,d){const m=Math.sin(c);return r*(Math.sin((1-d)*c)/m)+a*(Math.sin(d*c)/m)}(t.a[e],t.b[e],t.angle,je(i,0,1))+t.center[e]}function Io(t){if(t.z<=1)return cx[t.z+2*t.y+t.x];const e=Sf(Fh(t));return rr.fromPoints(e)}function Da(t,e,i){return Fr(t,t,1-i),ou(t,t,e,i)}function Dm(t,e){const i=Ll(e.zoom);if(i===0)return Io(t);const r=Fh(t),a=Sf(r),c=ko(r.getWest())*e.worldSize,d=ko(r.getEast())*e.worldSize,m=zo(r.getNorth())*e.worldSize,g=zo(r.getSouth())*e.worldSize,x=[c,m,0],T=[d,m,0],M=[c,g,0],A=[d,g,0],P=_f([],e.globeMatrix);return hn(x,x,P),hn(T,T,P),hn(M,M,P),hn(A,A,P),a[0]=Da(a[0],M,i),a[1]=Da(a[1],A,i),a[2]=Da(a[2],T,i),a[3]=Da(a[3],x,i),rr.fromPoints(a)}function Lm(t,e,i){for(const r of t)hn(r,r,e),Fr(r,r,i)}function hx(t,e,i){const r=e/t.worldSize,a=t.globeMatrix;if(i.z<=1){const Te=Io(i).getCorners();return Lm(Te,a,r),rr.fromPoints(Te)}const c=Fh(i),d=Sf(c);Lm(d,a,r);const m=Number.MAX_VALUE,g=[-m,-m,-m],x=[m,m,m];if(c.contains(t.center)){for(const $e of d)nu(x,x,$e),ru(g,g,$e);g[2]=0;const Te=t.point,Re=[Te.x*r,Te.y*r,0];return nu(x,x,Re),ru(g,g,Re),new rr(x,g)}const T=[a[12]*r,a[13]*r,a[14]*r],M=c.getCenter(),A=je(t.center.lat,-qn,qn),P=je(M.lat,-qn,qn),D=ko(t.center.lng),O=zo(A);let j=D-ko(M.lng);const Y=O-zo(P);j>.5?j-=1:j<-.5&&(j+=1);let ne=0;Math.abs(j)>Math.abs(Y)?ne=j>=0?1:3:(ne=Y>=0?0:2,ou(T,T,[a[4]*r,a[5]*r,a[6]*r],-Math.sin(tt(Y>=0?c.getSouth():c.getNorth()))*Co));const K=d[ne],ie=d[(ne+1)%4],oe=new ux(K,ie,T),re=[Mf(oe,0)||K[0],Mf(oe,1)||K[1],Mf(oe,2)||K[2]],Ae=Ll(t.zoom);if(Ae>0){const Te=function({x:$e,y:ze,z:Ne},Ve,We,ot,De){const ft=1/(1<<Ne);let Tt=$e*ft,mt=Tt+ft,Xt=ze*ft,st=Xt+ft,Pt=0;const Ht=(Tt+mt)/2-ot;return Ht>.5?Pt=-1:Ht<-.5&&(Pt=1),Tt=((Tt+Pt)*Ve-(ot*=Ve))*We+ot,mt=((mt+Pt)*Ve-ot)*We+ot,Xt=(Xt*Ve-(De*=Ve))*We+De,st=(st*Ve-De)*We+De,[[Tt,st,0],[mt,st,0],[mt,Xt,0],[Tt,Xt,0]]}(i,e,t._pixelsPerMercatorPixel,D,O);for(let $e=0;$e<d.length;$e++)Da(d[$e],Te[$e],Ae);const Re=os([],Te[ne],Te[(ne+1)%4]);Fr(Re,Re,.5),Da(re,Re,Ae)}for(const Te of d)nu(x,x,Te),ru(g,g,Te);return x[2]=Math.min(K[2],ie[2]),nu(x,x,re),ru(g,g,re),new rr(x,g)}function Fh({x:t,y:e,z:i}){const r=1/(1<<i),a=new Di(Ur(t*r),Gn((e+1)*r)),c=new Di(Ur((t+1)*r),Gn(e*r));return new Os(a,c)}function Sf(t){const e=tt(t.getNorth()),i=tt(t.getSouth()),r=Math.cos(e),a=Math.cos(i),c=Math.sin(e),d=Math.sin(i),m=t.getWest(),g=t.getEast();return[Pl(a,d,m),Pl(a,d,g),Pl(r,c,g),Pl(r,c,m)]}function Pl(t,e,i,r=Co){return i=tt(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Dl(t,e,i){return Pl(Math.cos(tt(t)),Math.sin(tt(t)),e,i)}function cu(t,e,i,r){const a=1<<i.z,c=(t/Dt+i.x)/a;return Dl(Gn((e/Dt+i.y)/a),Ur(c),r)}function Uh({min:t,max:e}){return lx/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Rm=new Float64Array(16);function uu(t){const e=Uh(t),i=ym(Rm,[e,e,e]);return tu(i,i,((r=[])[0]=-(a=t.min)[0],r[1]=-a[1],r[2]=-a[2],r));var r,a}function Af(t){const e=(r=t.min,(i=Rm)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const a=1/Uh(t);return ka(e,e,[a,a,a])}function Bm(t,e,i,r,a){const c=function(g){const x=Dt/(2*Math.PI);return g/(2*Math.PI)/x}(i),d=[t,e,-i/(2*Math.PI)],m=_o(new Float64Array(16));return tu(m,m,d),ka(m,m,[c,c,c]),gf(m,m,tt(-a)),Bh(m,m,tt(-r)),m}function Ll(t){return dt(Ef,zm,t)}function Om(t,e){const i=Dl(e.lat,e.lng),r=function(D){const O=Dl(D._center.lat,D._center.lng);let j=vf([],zl(0,1,0),O);const Y=xm([],-D.angle,O);j=hn(j,j,Y),xm(Y,-D._pitch,j);const ne=nr([],O);return Fr(ne,ne,Oh(D.cameraToCenterDistance/D.pixelsPerMeter)),hn(ne,ne,Y),os([],O,ne)}(t);return d=(a=xf([],r,i))[0],m=a[1],g=a[2],x=(c=i)[0],T=c[1],M=c[2],P=(A=Math.sqrt(d*d+m*m+g*g)*Math.sqrt(x*x+T*T+M*M))&&Kr(a,c)/A,Math.acos(Math.min(Math.max(P,-1),1));var a,c,d,m,g,x,T,M,A,P}function Cf(t,e){return Om(t,e)>Math.PI/2*1.01}const Fm=tt(85),dx=Math.cos(Fm),fx=Math.sin(Fm),hu=63710088e-1,Um=2*Math.PI*hu;class Fs{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fs(gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,a=e.lat*i,c=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return hu*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Os(new Fs(this.lng-r,this.lat-i),new Fs(this.lng+r,this.lat+i))}toEcef(e){const i=Oh(e);return Dl(this.lat,this.lng,Co+i)}static convert(e){if(e instanceof Fs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Di=Fs;function If(t){return Um*Math.cos(t*Math.PI/180)}function ko(t){return(180+t)/360}function zo(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function yo(t,e){return t/If(e)}function Ur(t){return 360*t-180}function Gn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Nm(t,e){return t*If(Gn(e))}const qn=85.051129;function Vm(t){return 1/Math.cos(t*Math.PI/180)}class Rl{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=Di.convert(e);return new Rl(ko(r.lng),zo(r.lat),yo(i,r.lat))}toLngLat(){return new Di(Ur(this.x),Gn(this.y))}toAltitude(){return Nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Um*Vm(Gn(this.y))}}function kf(t,e,i,r,a,c,d,m,g){const x=(e+r)/2,T=(i+a)/2,M=new Be(x,T);m(M),function(A,P,D,O,j,Y){const ne=D-j,K=O-Y;return Math.abs((O-P)*ne-(D-A)*K)/Math.hypot(ne,K)}(M.x,M.y,c.x,c.y,d.x,d.y)>=g?(kf(t,e,i,x,T,c,M,m,g),kf(t,x,T,r,a,M,d,m,g)):t.push(d)}function jm(t,e,i){let r=t[0],a=r.x,c=r.y;e(r);const d=[r];for(let m=1;m<t.length;m++){const g=t[m],{x,y:T}=g;e(g),kf(d,a,c,x,T,r,g,e,i),a=x,c=T,r=g}return d}function zf(t,e,i,r){if(r(e,i)){const a=e.add(i)._mult(.5);zf(t,e,a,r),zf(t,a,i,r)}else t.push(i)}function px(t,e){let i=t[0];const r=[i];for(let a=1;a<t.length;a++){const c=t[a];zf(r,i,c,e),i=c}return r}const Pf=Math.pow(2,14)-1,Gm=-Pf-1;function mx(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=je(i,Gm,Pf),t.y=je(r,Gm,Pf),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ss(t,e,i){const r=t.loadGeometry(),a=t.extent,c=Dt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:m,x:g,y:x,projection:T}=i,M=A=>{const P=Ur((e.x+A.x/a)/d),D=Gn((e.y+A.y/a)/d),O=T.project(P,D);A.x=(O.x*m-g)*a,A.y=(O.y*m-x)*a};for(let A=0;A<r.length;A++)if(t.type!==1)r[A]=jm(r[A],M,1);else{const P=[];for(const D of r[A])D.x<0||D.x>=a||D.y<0||D.y>=a||(M(D),P.push(D));r[A]=P}}for(const d of r)for(const m of d)mx(m,c);return r}function La(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ss(t):[]}}function Nh(t,e,i,r,a){t.emplaceBack(2*e+(r+1)/2,2*i+(a+1)/2)}function Vh(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Df{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Je,this.indexArray=new Ct,this.segments=new pn,this.programConfigurations=new Ca(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){const c=this.layers[0],d=[];let m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(const{feature:x,id:T,index:M,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,D=La(x,P);if(!this.layers[0]._featureFilter.filter(new E(this.zoom),D,r))continue;const O=m?m.evaluate(D,{},r):void 0,j={id:T,properties:x.properties,type:x.type,sourceLayerIndex:A,index:M,geometry:P?D.geometry:ss(x,r,a),patterns:{},sortKey:O};d.push(j)}m&&d.sort((x,T)=>x.sortKey-T.sortKey);let g=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Qe,g=a.projection);for(const x of d){const{geometry:T,index:M,sourceLayerIndex:A}=x,P=e[M].feature;this.addFeature(x,T,M,i.availableImages,r,g),i.featureIndex.insert(P,T,M,A,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ix.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,a,c,d){for(const m of i)for(const g of m){const x=g.x,T=g.y;if(x<0||x>=Dt||T<0||T>=Dt)continue;if(d){const P=d.projectTilePoint(x,T,c),D=d.upVector(c,x,T),O=this.globeExtVertexArray;Vh(O,P,D),Vh(O,P,D),Vh(O,P,D),Vh(O,P,D)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=M.vertexLength;Nh(this.layoutVertexArray,x,T,-1,-1),Nh(this.layoutVertexArray,x,T,1,-1),Nh(this.layoutVertexArray,x,T,1,1),Nh(this.layoutVertexArray,x,T,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},a,c)}}function qm(t,e){for(let i=0;i<t.length;i++)if(Ra(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ra(t,e[i]))return!0;return!!Lf(t,e)}function _x(t,e,i){return!!Ra(t,e)||!!Rf(e,t,i)}function Zm(t,e){if(t.length===1)return Xm(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let a=0;a<r.length;a++)if(Ra(t,r[a]))return!0}for(let i=0;i<t.length;i++)if(Xm(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Lf(t,e[i]))return!0;return!1}function gx(t,e,i){if(t.length>1){if(Lf(t,e))return!0;for(let r=0;r<e.length;r++)if(Rf(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Rf(t[r],e,i))return!0;return!1}function Lf(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],a=t[i+1];for(let c=0;c<e.length-1;c++)if(yx(r,a,e[c],e[c+1]))return!0}return!1}function yx(t,e,i,r){return bi(t,i,r)!==bi(e,i,r)&&bi(t,e,i)!==bi(t,e,r)}function Rf(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let a=1;a<e.length;a++)if(Wm(t,e[a-1],e[a])<r)return!0;return!1}function Wm(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Xm(t,e){let i,r,a,c=!1;for(let d=0;d<t.length;d++){i=t[d];for(let m=0,g=i.length-1;m<i.length;g=m++)r=i[m],a=i[g],r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(c=!c)}return c}function Ra(t,e){let i=!1;for(let r=0,a=t.length-1;r<t.length;a=r++){const c=t[r],d=t[a];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(i=!i)}return i}function Hm(t,e,i,r,a){for(const d of t)if(e<=d.x&&i<=d.y&&r>=d.x&&a>=d.y)return!0;const c=[new Be(e,i),new Be(e,a),new Be(r,a),new Be(r,i)];if(t.length>2){for(const d of c)if(Ra(t,d))return!0}for(let d=0;d<t.length-1;d++)if(xx(t[d],t[d+1],c))return!0;return!1}function xx(t,e,i){const r=i[0],a=i[2];if(t.x<r.x&&e.x<r.x||t.x>a.x&&e.x>a.x||t.y<r.y&&e.y<r.y||t.y>a.y&&e.y>a.y)return!1;const c=bi(t,e,i[0]);return c!==bi(t,e,i[1])||c!==bi(t,e,i[2])||c!==bi(t,e,i[3])}function Bl(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function jh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ym(t,e,i,r,a){if(!e[0]&&!e[1])return t;const c=Be.convert(e)._mult(a);i==="viewport"&&c._rotate(-r);const d=[];for(let m=0;m<t.length;m++)d.push(t[m].sub(c));return d}function Km(t,e,i,r){const a=Be.convert(t)._mult(r);return e==="viewport"&&a._rotate(-i),a}bt(Df,"CircleBucket",{omit:["layers"]});const vx=new $({"circle-sort-key":new G(Le.layout_circle["circle-sort-key"])});var bx={paint:new $({"circle-radius":new G(Le.paint_circle["circle-radius"]),"circle-color":new G(Le.paint_circle["circle-color"]),"circle-blur":new G(Le.paint_circle["circle-blur"]),"circle-opacity":new G(Le.paint_circle["circle-opacity"]),"circle-translate":new B(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new B(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new B(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new B(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new G(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new G(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new G(Le.paint_circle["circle-stroke-opacity"])}),layout:vx};function Jm(t,e,i,r,a,c,d,m,g){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(g*=t.pixelToTileUnitsFactor);const x=t.tileID.canonical,T=i.projection.upVectorScale(x,i.center.lat,i.worldSize).metersToTile;for(const M of e)for(const A of M){const P=A.add(m),D=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(P.x,P.y,!0):0,O=i.projection.projectTilePoint(P.x,P.y,x);if(D>0){const K=i.projection.upVector(x,P.x,P.y);O.x+=K[0]*T*D,O.y+=K[1]*T*D,O.z+=K[2]*T*D}const j=c?P:wx(O.x,O.y,O.z,r),Y=c?t.tilespaceRays.map(K=>Ex(K,D)):t.queryGeometry.screenGeometry,ne=za([],[O.x,O.y,O.z,1],r);if(!d&&c?g*=ne[3]/i.cameraToCenterDistance:d&&!c&&(g*=i.cameraToCenterDistance/ne[3]),c){const K=Gn((A.y/Dt+x.y)/(1<<x.z));g/=i.projection.pixelsPerMeter(K,1)/yo(1,K)}if(_x(Y,j,g))return!0}return!1}function wx(t,e,i,r){const a=za([],[t,e,i,1],r);return new Be(a[0]/a[3],a[1]/a[3])}const $m=zl(0,0,0),Tx=zl(0,0,1);function Ex(t,e){const i=yf();return $m[2]=e,t.intersectsPlane($m,Tx,i),new Be(i[0],i[1])}class Qm extends Df{}function e_(t,{width:e,height:i},r,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=a,t}function t_(t,e,i){const{width:r,height:a}=e;r===t.width&&a===t.height||(Bf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,a)},i),t.width=r,t.height=a,t.data=e.data)}function Bf(t,e,i,r,a,c){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const d=t.data,m=e.data;for(let g=0;g<a.height;g++){const x=((i.y+g)*t.width+i.x)*c,T=((r.y+g)*e.width+r.x)*c;for(let M=0;M<a.width*c;M++)m[T+M]=d[x+M]}return e}bt(Qm,"HeatmapBucket",{omit:["layers"]});class as{constructor(e,i){e_(this,e,1,i)}resize(e){t_(this,new as(e),1)}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,c){Bf(e,i,r,a,c,1)}}class Tr{constructor(e,i){e_(this,e,4,i)}resize(e){t_(this,new Tr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Tr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,c){Bf(e,i,r,a,c,4)}}bt(as,"AlphaImage"),bt(Tr,"RGBAImage");var Mx={paint:new $({"heatmap-radius":new G(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new G(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new B(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new J(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new B(Le.paint_heatmap["heatmap-opacity"])})};function Of(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,a=t.image||new Tr({width:i,height:r}),c=(d,m,g)=>{e[t.evaluationKey]=g;const x=t.expression.evaluate(e);a.data[d+m+0]=Math.floor(255*x.r/x.a),a.data[d+m+1]=Math.floor(255*x.g/x.a),a.data[d+m+2]=Math.floor(255*x.b/x.a),a.data[d+m+3]=Math.floor(255*x.a)};if(t.clips)for(let d=0,m=0;d<r;++d,m+=4*i)for(let g=0,x=0;g<i;g++,x+=4){const T=g/(i-1),{start:M,end:A}=t.clips[d];c(m,x,M*(1-T)+A*T)}else for(let d=0,m=0;d<i;d++,m+=4)c(0,m,d/(i-1));return a}var Sx={paint:new $({"hillshade-illumination-direction":new B(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new B(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new B(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new B(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new B(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new B(Le.paint_hillshade["hillshade-accent-color"])})};const Ax=me([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cx}=Ax;var Ff={exports:{}};function Gh(t,e,i){i=i||2;var r,a,c,d,m,g,x,T=e&&e.length,M=T?e[0]*i:t.length,A=i_(t,0,M,i,!0),P=[];if(!A||A.next===A.prev)return P;if(T&&(A=function(O,j,Y,ne){var K,ie,oe,re=[];for(K=0,ie=j.length;K<ie;K++)(oe=i_(O,j[K]*ne,K<ie-1?j[K+1]*ne:O.length,ne,!1))===oe.next&&(oe.steiner=!0),re.push(Bx(oe));for(re.sort(Dx),K=0;K<re.length;K++)Y=Lx(re[K],Y);return Y}(t,e,A,i)),t.length>80*i){r=c=t[0],a=d=t[1];for(var D=i;D<M;D+=i)(m=t[D])<r&&(r=m),(g=t[D+1])<a&&(a=g),m>c&&(c=m),g>d&&(d=g);x=(x=Math.max(c-r,d-a))!==0?32767/x:0}return du(A,P,i,r,a,x,0),P}function i_(t,e,i,r,a){var c,d;if(a===Vf(t,e,i,r)>0)for(c=e;c<i;c+=r)d=o_(c,t[c],t[c+1],d);else for(c=i-r;c>=e;c-=r)d=o_(c,t[c],t[c+1],d);return d&&qh(d,d.next)&&(pu(d),d=d.next),d}function Ba(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!qh(r,r.next)&&mn(r.prev,r,r.next)!==0)r=r.next;else{if(pu(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function du(t,e,i,r,a,c,d){if(t){!d&&c&&function(T,M,A,P){var D=T;do D.z===0&&(D.z=Uf(D.x,D.y,M,A,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,function(O){var j,Y,ne,K,ie,oe,re,Ae,Te=1;do{for(Y=O,O=null,ie=null,oe=0;Y;){for(oe++,ne=Y,re=0,j=0;j<Te&&(re++,ne=ne.nextZ);j++);for(Ae=Te;re>0||Ae>0&&ne;)re!==0&&(Ae===0||!ne||Y.z<=ne.z)?(K=Y,Y=Y.nextZ,re--):(K=ne,ne=ne.nextZ,Ae--),ie?ie.nextZ=K:O=K,K.prevZ=ie,ie=K;Y=ne}ie.nextZ=null,Te*=2}while(oe>1)}(D)}(t,r,a,c);for(var m,g,x=t;t.prev!==t.next;)if(m=t.prev,g=t.next,c?kx(t,r,a,c):Ix(t))e.push(m.i/i|0),e.push(t.i/i|0),e.push(g.i/i|0),pu(t),t=g.next,x=g.next;else if((t=g)===x){d?d===1?du(t=zx(Ba(t),e,i),e,i,r,a,c,2):d===2&&Px(t,e,i,r,a,c):du(Ba(t),e,i,r,a,c,1);break}}}function Ix(t){var e=t.prev,i=t,r=t.next;if(mn(e,i,r)>=0)return!1;for(var a=e.x,c=i.x,d=r.x,m=e.y,g=i.y,x=r.y,T=a<c?a<d?a:d:c<d?c:d,M=m<g?m<x?m:x:g<x?g:x,A=a>c?a>d?a:d:c>d?c:d,P=m>g?m>x?m:x:g>x?g:x,D=r.next;D!==e;){if(D.x>=T&&D.x<=A&&D.y>=M&&D.y<=P&&Ol(a,m,c,g,d,x,D.x,D.y)&&mn(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function kx(t,e,i,r){var a=t.prev,c=t,d=t.next;if(mn(a,c,d)>=0)return!1;for(var m=a.x,g=c.x,x=d.x,T=a.y,M=c.y,A=d.y,P=m<g?m<x?m:x:g<x?g:x,D=T<M?T<A?T:A:M<A?M:A,O=m>g?m>x?m:x:g>x?g:x,j=T>M?T>A?T:A:M>A?M:A,Y=Uf(P,D,e,i,r),ne=Uf(O,j,e,i,r),K=t.prevZ,ie=t.nextZ;K&&K.z>=Y&&ie&&ie.z<=ne;){if(K.x>=P&&K.x<=O&&K.y>=D&&K.y<=j&&K!==a&&K!==d&&Ol(m,T,g,M,x,A,K.x,K.y)&&mn(K.prev,K,K.next)>=0||(K=K.prevZ,ie.x>=P&&ie.x<=O&&ie.y>=D&&ie.y<=j&&ie!==a&&ie!==d&&Ol(m,T,g,M,x,A,ie.x,ie.y)&&mn(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;K&&K.z>=Y;){if(K.x>=P&&K.x<=O&&K.y>=D&&K.y<=j&&K!==a&&K!==d&&Ol(m,T,g,M,x,A,K.x,K.y)&&mn(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ie&&ie.z<=ne;){if(ie.x>=P&&ie.x<=O&&ie.y>=D&&ie.y<=j&&ie!==a&&ie!==d&&Ol(m,T,g,M,x,A,ie.x,ie.y)&&mn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function zx(t,e,i){var r=t;do{var a=r.prev,c=r.next.next;!qh(a,c)&&n_(a,r,r.next,c)&&fu(a,c)&&fu(c,a)&&(e.push(a.i/i|0),e.push(r.i/i|0),e.push(c.i/i|0),pu(r),pu(r.next),r=t=c),r=r.next}while(r!==t);return Ba(r)}function Px(t,e,i,r,a,c){var d=t;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&Ox(d,m)){var g=r_(d,m);return d=Ba(d,d.next),g=Ba(g,g.next),du(d,e,i,r,a,c,0),void du(g,e,i,r,a,c,0)}m=m.next}d=d.next}while(d!==t)}function Dx(t,e){return t.x-e.x}function Lx(t,e){var i=function(a,c){var d,m=c,g=a.x,x=a.y,T=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var M=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(M<=g&&M>T&&(T=M,d=m.x<m.next.x?m:m.next,M===g))return d}m=m.next}while(m!==c);if(!d)return null;var A,P=d,D=d.x,O=d.y,j=1/0;m=d;do g>=m.x&&m.x>=D&&g!==m.x&&Ol(x<O?g:T,x,D,O,x<O?T:g,x,m.x,m.y)&&(A=Math.abs(x-m.y)/(g-m.x),fu(m,a)&&(A<j||A===j&&(m.x>d.x||m.x===d.x&&Rx(d,m)))&&(d=m,j=A)),m=m.next;while(m!==P);return d}(t,e);if(!i)return e;var r=r_(i,t);return Ba(r,r.next),Ba(i,i.next)}function Rx(t,e){return mn(t.prev,t,e.prev)<0&&mn(e.next,t,t.next)<0}function Uf(t,e,i,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bx(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Ol(t,e,i,r,a,c,d,m){return(a-d)*(e-m)>=(t-d)*(c-m)&&(t-d)*(r-m)>=(i-d)*(e-m)&&(i-d)*(c-m)>=(a-d)*(r-m)}function Ox(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==r.i&&a.next.i!==r.i&&n_(a,a.next,i,r))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(fu(t,e)&&fu(e,t)&&function(i,r){var a=i,c=!1,d=(i.x+r.x)/2,m=(i.y+r.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==i);return c}(t,e)&&(mn(t.prev,t,e.prev)||mn(t,e.prev,e))||qh(t,e)&&mn(t.prev,t,t.next)>0&&mn(e.prev,e,e.next)>0)}function mn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function qh(t,e){return t.x===e.x&&t.y===e.y}function n_(t,e,i,r){var a=Wh(mn(t,e,i)),c=Wh(mn(t,e,r)),d=Wh(mn(i,r,t)),m=Wh(mn(i,r,e));return a!==c&&d!==m||!(a!==0||!Zh(t,i,e))||!(c!==0||!Zh(t,r,e))||!(d!==0||!Zh(i,t,r))||!(m!==0||!Zh(i,e,r))}function Zh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Wh(t){return t>0?1:t<0?-1:0}function fu(t,e){return mn(t.prev,t,t.next)<0?mn(t,e,t.next)>=0&&mn(t,t.prev,e)>=0:mn(t,e,t.prev)<0||mn(t,t.next,e)<0}function r_(t,e){var i=new Nf(t.i,t.x,t.y),r=new Nf(e.i,e.x,e.y),a=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,r.next=i,i.prev=r,c.next=r,r.prev=c,r}function o_(t,e,i,r){var a=new Nf(t,e,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function pu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Nf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vf(t,e,i,r){for(var a=0,c=e,d=i-r;c<i;c+=r)a+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return a}Ff.exports=Gh,Ff.exports.default=Gh,Gh.deviation=function(t,e,i,r){var a=e&&e.length,c=Math.abs(Vf(t,0,a?e[0]*i:t.length,i));if(a)for(var d=0,m=e.length;d<m;d++)c-=Math.abs(Vf(t,e[d]*i,d<m-1?e[d+1]*i:t.length,i));var g=0;for(d=0;d<r.length;d+=3){var x=r[d]*i,T=r[d+1]*i,M=r[d+2]*i;g+=Math.abs((t[x]-t[M])*(t[T+1]-t[x+1])-(t[x]-t[T])*(t[M+1]-t[x+1]))}return c===0&&g===0?0:Math.abs((g-c)/c)},Gh.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,a=0;a<t.length;a++){for(var c=0;c<t[a].length;c++)for(var d=0;d<e;d++)i.vertices.push(t[a][c][d]);a>0&&i.holes.push(r+=t[a-1].length)}return i};var jf=Ie(Ff.exports);function Fx(t,e,i,r,a){s_(t,e,i||0,r||t.length-1,a||Ux)}function s_(t,e,i,r,a){for(;r>i;){if(r-i>600){var c=r-i+1,d=e-i+1,m=Math.log(c),g=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*g*(c-g)/c)*(d-c/2<0?-1:1);s_(t,e,Math.max(i,Math.floor(e-d*g/c+x)),Math.min(r,Math.floor(e+(c-d)*g/c+x)),a)}var T=t[e],M=i,A=r;for(mu(t,i,e),a(t[r],T)>0&&mu(t,i,r);M<A;){for(mu(t,M,A),M++,A--;a(t[M],T)<0;)M++;for(;a(t[A],T)>0;)A--}a(t[i],T)===0?mu(t,i,A):mu(t,++A,r),A<=e&&(i=A+1),e<=A&&(r=A-1)}}function mu(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Ux(t,e){return t<e?-1:t>e?1:0}function Gf(t,e){const i=t.length;if(i<=1)return[t];const r=[];let a,c;for(let d=0;d<i;d++){const m=tn(t[d]);m!==0&&(t[d].area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(a&&r.push(a),a=[t[d]]):a.push(t[d]))}if(a&&r.push(a),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(Fx(r[d],e,1,r[d].length-1,Nx),r[d]=r[d].slice(0,e));return r}function Nx(t,e){return e.area-t.area}function qf(t,e,i){const r=i.patternDependencies;let a=!1;for(const c of e){const d=c.paint.get(`${t}-pattern`);d.isConstant()||(a=!0);const m=d.constantOr(null);m&&(a=!0,r[m]=!0)}return a}function Zf(t,e,i,r,a){const c=a.patternDependencies;for(const d of e){const m=d.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:r},i,{},a.availableImages);g=g&&g.name?g.name:g,c[g]=!0,i.patterns[d.id]=g}}return i}class Xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Je,this.indexArray=new Ct,this.indexArray2=new kn,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new pn,this.segments2=new pn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,a){this.hasPattern=qf("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:m,id:g,index:x,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,A=La(m,M);if(!this.layers[0]._featureFilter.filter(new E(this.zoom),A,r))continue;const P=c?c.evaluate(A,{},r,i.availableImages):void 0,D={id:g,properties:m.properties,type:m.type,sourceLayerIndex:T,index:x,geometry:M?A.geometry:ss(m,r,a),patterns:{},sortKey:P};d.push(D)}c&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:x,sourceLayerIndex:T}=m;if(this.hasPattern){const M=Zf("fill",this.layers,m,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(m,g,x,r,{},i.availableImages);i.featureIndex.insert(e[x].feature,g,x,T,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,a,c,d=[]){for(const m of Gf(i,500)){let g=0;for(const D of m)g+=D.length;const x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),T=x.vertexLength,M=[],A=[];for(const D of m){if(D.length===0)continue;D!==m[0]&&A.push(M.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),j=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(j+D.length-1,j),M.push(D[0].x),M.push(D[0].y);for(let Y=1;Y<D.length;Y++)this.layoutVertexArray.emplaceBack(D[Y].x,D[Y].y),this.indexArray2.emplaceBack(j+Y-1,j+Y),M.push(D[Y].x),M.push(D[Y].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const P=jf(M,A);for(let D=0;D<P.length;D+=3)this.indexArray.emplaceBack(T+P[D],T+P[D+1],T+P[D+2]);x.vertexLength+=g,x.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,d,a)}}bt(Xh,"FillBucket",{omit:["layers","patternFeatures"]});const Vx=new $({"fill-sort-key":new G(Le.layout_fill["fill-sort-key"])});var jx={paint:new $({"fill-antialias":new B(Le.paint_fill["fill-antialias"]),"fill-opacity":new G(Le.paint_fill["fill-opacity"]),"fill-color":new G(Le.paint_fill["fill-color"]),"fill-outline-color":new G(Le.paint_fill["fill-outline-color"]),"fill-translate":new B(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new B(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new G(Le.paint_fill["fill-pattern"])}),layout:Vx};const Gx=me([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qx=me([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Zx=me([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Wx}=Gx;var Hh={},Xx=Ze,a_=Fl;function Fl(t,e,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=a,t.readFields(Hx,this,e)}function Hx(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,a){for(var c=r.readVarint()+r.pos;r.pos<c;){var d=a._keys[r.readVarint()],m=a._values[r.readVarint()];a.properties[d]=m}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function Yx(t){for(var e,i,r=0,a=0,c=t.length,d=c-1;a<c;d=a++)r+=((i=t[d]).x-(e=t[a]).x)*(e.y+i.y);return r}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,a=0,c=0,d=0,m=[];t.pos<i;){if(a<=0){var g=t.readVarint();r=7&g,a=g>>3}if(a--,r===1||r===2)c+=t.readSVarint(),d+=t.readSVarint(),r===1&&(e&&m.push(e),e=[]),e.push(new Xx(c,d));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Fl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,a=0,c=0,d=1/0,m=-1/0,g=1/0,x=-1/0;t.pos<e;){if(r<=0){var T=t.readVarint();i=7&T,r=T>>3}if(r--,i===1||i===2)(a+=t.readSVarint())<d&&(d=a),a>m&&(m=a),(c+=t.readSVarint())<g&&(g=c),c>x&&(x=c);else if(i!==7)throw new Error("unknown command "+i)}return[d,g,m,x]},Fl.prototype.toGeoJSON=function(t,e,i){var r,a,c=this.extent*Math.pow(2,i),d=this.extent*t,m=this.extent*e,g=this.loadGeometry(),x=Fl.types[this.type];function T(P){for(var D=0;D<P.length;D++){var O=P[D];P[D]=[360*(O.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+m)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(r=0;r<g.length;r++)M[r]=g[r][0];T(g=M);break;case 2:for(r=0;r<g.length;r++)T(g[r]);break;case 3:for(g=function(P){var D=P.length;if(D<=1)return[P];for(var O,j,Y=[],ne=0;ne<D;ne++){var K=Yx(P[ne]);K!==0&&(j===void 0&&(j=K<0),j===K<0?(O&&Y.push(O),O=[P[ne]]):O.push(P[ne]))}return O&&Y.push(O),Y}(g),r=0;r<g.length;r++)for(a=0;a<g[r].length;a++)T(g[r][a])}g.length===1?g=g[0]:x="Multi"+x;var A={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Kx=a_,l_=c_;function c_(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Jx,this,e),this.length=this._features.length}function Jx(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var a=null,c=r.readVarint()+r.pos;r.pos<c;){var d=r.readVarint()>>3;a=d===1?r.readString():d===2?r.readFloat():d===3?r.readDouble():d===4?r.readVarint64():d===5?r.readVarint():d===6?r.readSVarint():d===7?r.readBoolean():null}return a}(i))}c_.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Kx(this._pbf,e,this.extent,this._keys,this._values)};var $x=l_;function Qx(t,e,i){if(t===3){var r=new $x(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Wf=Hh.VectorTile=function(t,e){this.layers=t.readFields(Qx,{},e)},Yh=Hh.VectorTileFeature=a_;function Kh(t,e,i,r){const a=[],c=r===0?(d,m,g,x,T,M)=>{d.push(new Be(M,g+(M-m)/(x-m)*(T-g)))}:(d,m,g,x,T,M)=>{d.push(new Be(m+(M-g)/(T-g)*(x-m),M))};for(const d of t){const m=[];for(const g of d){if(g.length<=2)continue;const x=[];for(let A=0;A<g.length-1;A++){const P=g[A].x,D=g[A].y,O=g[A+1].x,j=g[A+1].y,Y=r===0?P:D,ne=r===0?O:j;Y<e?ne>e&&c(x,P,D,O,j,e):Y>i?ne<i&&c(x,P,D,O,j,i):x.push(g[A]),ne<e&&Y>=e&&c(x,P,D,O,j,e),ne>i&&Y<=i&&c(x,P,D,O,j,i)}let T=g[g.length-1];const M=r===0?T.x:T.y;M>=e&&M<=i&&x.push(T),x.length&&(T=x[x.length-1],x[0].x===T.x&&x[0].y===T.y||x.push(x[0]),m.push(x))}m.length&&a.push(m)}return a}Hh.VectorTileLayer=l_;const e1=Yh.types,t1=Math.pow(2,13);function _u(t,e,i,r,a,c,d,m){t.emplaceBack((e<<1)+d,(i<<1)+c,(Math.floor(r*t1)<<1)+a,Math.round(m))}function gu(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class u_{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(e.x,e.y),this.max=new Be(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,a=this.max;e.x<r.x?r.x=e.x:e.x>a.x&&(a.x=e.x),e.y<r.y?r.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===Dt)&&e.x===i.x)!=((e.y===0||e.y===Dt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,di(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Dt!=e.x>Dt&&this.addBorderIntersection(1,di(i.y,e.y,(Dt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,di(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Dt!=e.y>Dt&&this.addBorderIntersection(3,di(i.x,e.x,(Dt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return e!==0?this.acc.div(e)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class yu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ue,this.centroidVertexArray=new fo,this.indexArray=new Ct,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new pn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,a){this.features=[],this.hasPattern=qf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const d=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*d/(d*d+1)/Dt/(1<<c.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:m,sourceLayerIndex:g}of e){const x=this.layers[0]._featureFilter.needGeometry,T=La(c,x);if(!this.layers[0]._featureFilter.filter(new E(this.zoom),T,r))continue;const M={id:d,sourceLayerIndex:g,index:m,geometry:x?T.geometry:ss(c,r,a),properties:c.properties,type:c.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(Zf("fill-extrusion",this.layers,M,this.zoom,i)):this.addFeature(M,M.geometry,m,r,{},i.availableImages,a),i.featureIndex.insert(c,M.geometry,m,g,this.index,A)}this.sortBorders()}addFeatures(e,i,r,a,c){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,i,r,a,c)}this.sortBorders()}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Zx.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,qx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,a,c,d,m){const g=[new Be(0,0),new Be(Dt,Dt)],x=m.projection,T=x.name==="globe",M=this.enableTerrain&&!T?new u_:null,A=e1[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qe);const P=Gf(i,500);for(let Y=P.length-1;Y>=0;Y--){const ne=P[Y];(ne.length===0||(D=ne[0]).every(K=>K.x<=0)||D.every(K=>K.x>=Dt)||D.every(K=>K.y<=0)||D.every(K=>K.y>=Dt))&&P.splice(Y,1)}var D;let O;if(T)O=g_(P,g,a);else{O=[];for(const Y of P)O.push({polygon:Y,bounds:g})}const j=A?this.edgeRadius:0;for(const{polygon:Y,bounds:ne}of O){let K=0,ie=0;for(const re of Y)A&&!re[0].equals(re[re.length-1])&&re.push(re[0]),ie+=A?re.length-1:re.length;const oe=this.segments.prepareSegment((A?5:4)*ie,this.layoutVertexArray,this.indexArray);if(A){const re=[],Ae=[];K=oe.vertexLength;for(const Re of Y){let $e,ze;Re.length&&Re!==Y[0]&&Ae.push(re.length/2),$e=Re[1].sub(Re[0])._perp()._unit();for(let Ne=1;Ne<Re.length;Ne++){const Ve=Re[Ne],We=Re[Ne===Re.length-1?1:Ne+1];let{x:ot,y:De}=Ve;if(j){ze=We.sub(Ve)._perp()._unit();const ft=$e.add(ze)._unit(),Tt=j*Math.min(4,1/($e.x*ft.x+$e.y*ft.y));ot+=Tt*ft.x,De+=Tt*ft.y,$e=ze}_u(this.layoutVertexArray,ot,De,0,0,1,1,0),oe.vertexLength++,re.push(Ve.x,Ve.y),T&&gu(this.layoutVertexExtArray,x.projectTilePoint(ot,De,a),x.upVector(a,ot,De))}}const Te=jf(re,Ae);for(let Re=0;Re<Te.length;Re+=3)this.indexArray.emplaceBack(K+Te[Re],K+Te[Re+2],K+Te[Re+1]),oe.primitiveLength++}for(const re of Y){M&&re.length&&M.startRing(re[0]);let Ae,Te,Re,$e=re.length>4&&p_(re[re.length-2],re[0],re[1]),ze=j?i1(re[re.length-2],re[0],re[1],j):0;Te=re[1].sub(re[0])._perp()._unit();let Ne=!0;for(let Ve=1,We=0;Ve<re.length;Ve++){let ot=re[Ve-1],De=re[Ve];const ft=re[Ve===re.length-1?1:Ve+1];if(M&&A&&M.currentPolyCount.top++,f_(De,ot,ne)){j&&(Te=ft.sub(De)._perp()._unit(),Ne=!Ne);continue}M&&M.append(De,ot);const Tt=De.sub(ot)._perp(),mt=Tt.x/(Math.abs(Tt.x)+Math.abs(Tt.y)),Xt=Tt.y>0?1:0,st=ot.dist(De);if(We+st>32768&&(We=0),j){Re=ft.sub(De)._perp()._unit();let Yt=d_(ot,De,ft,h_(Te,Re),j);isNaN(Yt)&&(Yt=0);const Rt=De.sub(ot)._unit();ot=ot.add(Rt.mult(ze))._round(),De=De.add(Rt.mult(-Yt))._round(),ze=Yt,Te=Re}const Pt=oe.vertexLength,Ht=re.length>4&&p_(ot,De,ft);let _i=m_(We,$e,Ne);if(_u(this.layoutVertexArray,ot.x,ot.y,mt,Xt,0,0,_i),_u(this.layoutVertexArray,ot.x,ot.y,mt,Xt,0,1,_i),We+=st,_i=m_(We,Ht,!Ne),$e=Ht,_u(this.layoutVertexArray,De.x,De.y,mt,Xt,0,0,_i),_u(this.layoutVertexArray,De.x,De.y,mt,Xt,0,1,_i),oe.vertexLength+=4,this.indexArray.emplaceBack(Pt+0,Pt+1,Pt+2),this.indexArray.emplaceBack(Pt+1,Pt+3,Pt+2),oe.primitiveLength+=2,j){const Yt=K+(Ve===1?re.length-2:Ve-2),Rt=Ve===1?K:Yt+1;if(this.indexArray.emplaceBack(Pt+1,Yt,Pt+3),this.indexArray.emplaceBack(Yt,Rt,Pt+3),oe.primitiveLength+=2,Ae===void 0&&(Ae=Pt),!f_(ft,re[Ve],ne)){const ji=Ve===re.length-1?Ae:oe.vertexLength;this.indexArray.emplaceBack(Pt+2,Pt+3,ji),this.indexArray.emplaceBack(Pt+3,ji+1,ji),this.indexArray.emplaceBack(Pt+3,Rt,ji+1),oe.primitiveLength+=3}Ne=!Ne}if(T){const Yt=this.layoutVertexExtArray,Rt=x.projectTilePoint(ot.x,ot.y,a),ji=x.projectTilePoint(De.x,De.y,a),Jt=x.upVector(a,ot.x,ot.y),$t=x.upVector(a,De.x,De.y);gu(Yt,Rt,Jt),gu(Yt,Rt,Jt),gu(Yt,ji,$t),gu(Yt,ji,$t)}}A&&(K+=re.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const Y=M.borders,ne=this.featuresOnBorder.push(M)-1;for(let K=0;K<4;K++)Y[K][0]!==Number.MAX_VALUE&&this.borders[K].push(ne)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,d,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let a,c;if(e)if(e.y!==0){const m=i.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else a=Math.ceil(7*(e.x+450)),c=0;else a=0,c=+r;let d=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const m of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let g=0;g<m.top;g++)this.centroidVertexArray.emplace(d++,a,c);for(let g=0;g<2*m.edges;g++)this.centroidVertexArray.emplace(d++,0,c),this.centroidVertexArray.emplace(d++,a,c)}}}function h_(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function i1(t,e,i,r){const a=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return d_(t,e,i,h_(a,c),r)}function d_(t,e,i,r,a){const c=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,a*c/r)}function f_(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function p_(t,e,i){if(t.x<0||t.x>=Dt||e.x<0||e.x>=Dt||i.x<0||i.x>=Dt)return!1;const r=i.sub(e),a=r.perp(),c=t.sub(e);return(r.x*c.x+r.y*c.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function m_(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function __(){const t=Math.PI/32,e=Math.tan(t),i=hu;return i*Math.sqrt(1+2*e*e)-i}function g_(t,e,i){const r=1<<i.z,a=Ur(i.x/r),c=Ur((i.x+1)/r),d=Gn(i.y/r),m=Gn((i.y+1)/r);return function(g,x,T,M,A=0,P){const D=[];if(!g.length||!T||!M)return D;const O=(re,Ae)=>{for(const Te of re)D.push({polygon:Te,bounds:Ae})},j=Math.ceil(Math.log2(T)),Y=Math.ceil(Math.log2(M)),ne=j-Y,K=[];for(let re=0;re<Math.abs(ne);re++)K.push(ne>0?0:1);for(let re=0;re<Math.min(j,Y);re++)K.push(0),K.push(1);let ie=g;if(ie=Kh(ie,x[0].y-A,x[1].y+A,1),ie=Kh(ie,x[0].x-A,x[1].x+A,0),!ie.length)return D;const oe=[];for(K.length?oe.push({polygons:ie,bounds:x,depth:0}):O(ie,x);oe.length;){const re=oe.pop(),Ae=re.depth,Te=K[Ae],Re=re.bounds[0],$e=re.bounds[1],ze=Te===0?Re.x:Re.y,Ne=Te===0?$e.x:$e.y,Ve=P?P(Te,ze,Ne):.5*(ze+Ne),We=Kh(re.polygons,ze-A,Ve+A,Te),ot=Kh(re.polygons,Ve-A,Ne+A,Te);if(We.length){const De=[Re,new Be(Te===0?Ve:$e.x,Te===1?Ve:$e.y)];K.length>Ae+1?oe.push({polygons:We,bounds:De,depth:Ae+1}):O(We,De)}if(ot.length){const De=[new Be(Te===0?Ve:Re.x,Te===1?Ve:Re.y),$e];K.length>Ae+1?oe.push({polygons:ot,bounds:De,depth:Ae+1}):O(ot,De)}}return D}(t,e,Math.ceil((c-a)/11.25),Math.ceil((d-m)/11.25),1,(g,x,T)=>{if(g===0)return .5*(x+T);{const M=Gn((i.y+x/Dt)/r);return(zo(.5*(Gn((i.y+T/Dt)/r)+M))*r-i.y)*Dt}})}bt(yu,"FillExtrusionBucket",{omit:["layers","features"]}),bt(u_,"PartMetadata");const n1=new $({"fill-extrusion-edge-radius":new B(Le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var r1={paint:new $({"fill-extrusion-opacity":new B(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new G(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new B(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new B(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new G(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new G(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new G(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new B(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new B(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new B(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new B(Le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:n1};function y_(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Jh{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=xu(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=function(c,d,m){var g=y_(256*c,256*(d=Math.pow(2,m)-d-1),m),x=y_(256*(c+1),256*(d+1),m);return g[0]+","+g[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),a=function(c,d,m){let g,x="";for(let T=c;T>0;T--)g=1<<T-1,x+=(d&g?1:0)+(m&g?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class x_{constructor(e,i){this.wrap=e,this.canonical=i,this.key=xu(e,i.z,i.z,i.x,i.y)}}class or{constructor(e,i,r,a,c){this.overscaledZ=e,this.wrap=i,this.canonical=new Jh(r,+a,+c),this.key=i===0&&e===r?this.canonical.key:xu(i,e,r,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new or(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new or(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return xu(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return xu(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new or(i,this.wrap,i,r,a),new or(i,this.wrap,i,r+1,a),new or(i,this.wrap,i,r,a+1),new or(i,this.wrap,i,r+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new or(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new x_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xu(t,e,i,r,a){const c=1<<Math.min(i,22);let d=c*(a%c)+r%c;return t&&i<22&&(d+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}bt(Jh,"CanonicalTileID"),bt(or,"OverscaledTileID",{omit:["projMatrix"]});class Ul extends Be{constructor(e,i,r){super(e,i),this.z=r}}function vu(t,e){return t.x*e.x+t.y*e.y}function v_(t,e){if(t.length===1){let i=0;const r=e[i++];let a;for(;!a||r.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const c=e[i],d=t[0],m=a.sub(r),g=c.sub(r),x=d.sub(r),T=vu(m,m),M=vu(m,g),A=vu(g,g),P=vu(x,m),D=vu(x,g),O=T*A-M*M,j=(A*P-M*D)/O,Y=(T*D-M*P)/O,ne=r.z*(1-j-Y)+a.z*j+c.z*Y;if(isFinite(ne))return ne}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function b_(t,e,i,r,a,c,d,m){const g=d*a.getElevationAt(t,e,!0,!0),x=c[0]!==0,T=x?c[1]===0?d*(c[0]/7-450):d*function(M,A,P){const D=Math.floor(A[0]/8),O=Math.floor(A[1]/8),j=10*(A[0]-8*D),Y=10*(A[1]-8*O),ne=M.getElevationAt(D,O,!0,!0),K=M.getMeterToDEM(P),ie=Math.floor(.5*(j*K-1)),oe=Math.floor(.5*(Y*K-1)),re=M.tileCoordToPixel(D,O),Ae=2*ie+1,Te=2*oe+1,Re=function(ot,De,ft,Tt,mt){return[ot.getElevationAtPixel(De,ft,!0),ot.getElevationAtPixel(De+mt,ft,!0),ot.getElevationAtPixel(De,ft+mt,!0),ot.getElevationAtPixel(De+Tt,ft+mt,!0)]}(M,re.x-ie,re.y-oe,Ae,Te),$e=Math.abs(Re[0]-Re[1]),ze=Math.abs(Re[2]-Re[3]),Ne=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),Ve=Math.min(.25,.5*K*($e+ze)/Ae),We=Math.min(.25,.5*K*Ne/Te);return ne+Math.max(Ve*j,We*Y)}(a,c,m):g;return{base:g+(i===0)?-1:i,top:x?Math.max(T+r,g+i+2):g+r}}const o1=me([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:s1}=o1,a1=me([{name:"a_packed",components:4,type:"Float32"}]),{members:l1}=a1,c1=Yh.types,u1=Math.cos(Math.PI/180*37.5);class $h{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new Ye,this.indexArray=new Ct,this.programConfigurations=new Ca(e.layers,e.zoom),this.segments=new pn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){this.hasPattern=qf("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:T,id:M,index:A,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=La(T,D);if(!this.layers[0]._featureFilter.filter(new E(this.zoom),O,r))continue;const j=c?c.evaluate(O,{},r):void 0,Y={id:M,properties:T.properties,type:T.type,sourceLayerIndex:P,index:A,geometry:D?O.geometry:ss(T,r,a),patterns:{},sortKey:j};d.push(Y)}c&&d.sort((T,M)=>T.sortKey-M.sortKey);const{lineAtlas:m,featureIndex:g}=i,x=this.addConstantDashes(m);for(const T of d){const{geometry:M,index:A,sourceLayerIndex:P}=T;if(x&&this.addFeatureDashes(T,m),this.hasPattern){const D=Zf("line",this.layers,T,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(T,M,A,r,m.positions,i.availableImages);g.insert(e[A].feature,M,A,P,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const a=r.paint.get("line-dasharray").value,c=r.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")i=!0;else{const d=c.value,m=a.value;if(!m)continue;e.addDash(m,d)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind==="constant"&&d.kind==="constant")continue;let m,g;if(c.kind==="constant"){if(m=c.value,!m)continue}else m=c.evaluate({zoom:r},e);g=d.kind==="constant"?d.value:d.evaluate({zoom:r},e),i.addDash(m,g),e.patterns[a.id]=i.getKey(m,g)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,l1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,a,c,d){const m=this.layers[0].layout,g=m.get("line-join").evaluate(e,{}),x=m.get("line-cap").evaluate(e,{}),T=m.get("line-miter-limit"),M=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of i)this.addLine(A,e,g,x,T,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,d,a)}addLine(e,i,r,a,c,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=c1[i.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(m?3:2))return;r==="bevel"&&(c=1.05);const T=this.overscaling<=16?15*Dt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let A,P,D,O,j;this.e1=this.e2=-1,m&&(A=e[g-2],j=e[x].sub(A)._unit()._perp());for(let Y=x;Y<g;Y++){if(D=Y===g-1?m?e[x+1]:void 0:e[Y+1],D&&e[Y].equals(D))continue;j&&(O=j),A&&(P=A),A=e[Y],j=D?D.sub(A)._unit()._perp():O,O=O||j;let ne=O.add(j);ne.x===0&&ne.y===0||ne._unit();const K=O.x*j.x+O.y*j.y,ie=ne.x*j.x+ne.y*j.y,oe=ie!==0?1/ie:1/0,re=2*Math.sqrt(2-2*ie),Ae=ie<u1&&P&&D,Te=O.x*j.y-O.y*j.x>0;if(Ae&&Y>x){const ze=A.dist(P);if(ze>2*T){const Ne=A.sub(A.sub(P)._mult(T/ze)._round());this.updateDistance(P,Ne),this.addCurrentVertex(Ne,O,0,0,M),P=Ne}}const Re=P&&D;let $e=Re?r:m?"butt":a;if(Re&&$e==="round"&&(oe<d?$e="miter":oe<=2&&($e="fakeround")),$e==="miter"&&oe>c&&($e="bevel"),$e==="bevel"&&(oe>2&&($e="flipbevel"),oe<c&&($e="miter")),P&&this.updateDistance(P,A),$e==="miter")ne._mult(oe),this.addCurrentVertex(A,ne,0,0,M);else if($e==="flipbevel"){if(oe>100)ne=j.mult(-1);else{const ze=oe*O.add(j).mag()/O.sub(j).mag();ne._perp()._mult(ze*(Te?-1:1))}this.addCurrentVertex(A,ne,0,0,M),this.addCurrentVertex(A,ne.mult(-1),0,0,M)}else if($e==="bevel"||$e==="fakeround"){const ze=-Math.sqrt(oe*oe-1),Ne=Te?ze:0,Ve=Te?0:ze;if(P&&this.addCurrentVertex(A,O,Ne,Ve,M),$e==="fakeround"){const We=Math.round(180*re/Math.PI/20);for(let ot=1;ot<We;ot++){let De=ot/We;if(De!==.5){const Tt=De-.5;De+=De*Tt*(De-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*Tt*Tt+(.848013+K*(.215638*K-1.06021)))}const ft=j.sub(O)._mult(De)._add(O)._unit()._mult(Te?-1:1);this.addHalfVertex(A,ft.x,ft.y,!1,Te,0,M)}}D&&this.addCurrentVertex(A,j,-Ne,-Ve,M)}else if($e==="butt")this.addCurrentVertex(A,ne,0,0,M);else if($e==="square"){const ze=P?1:-1;P||this.addCurrentVertex(A,ne,ze,ze,M),this.addCurrentVertex(A,ne,0,0,M),P&&this.addCurrentVertex(A,ne,ze,ze,M)}else $e==="round"&&(P&&(this.addCurrentVertex(A,O,0,0,M),this.addCurrentVertex(A,O,1,1,M,!0)),D&&(this.addCurrentVertex(A,j,-1,-1,M,!0),this.addCurrentVertex(A,j,0,0,M)));if(Ae&&Y<g-1){const ze=A.dist(D);if(ze>2*T){const Ne=A.add(D.sub(A)._mult(T/ze)._round());this.updateDistance(A,Ne),this.addCurrentVertex(Ne,j,0,0,M),A=Ne}}}}addCurrentVertex(e,i,r,a,c,d=!1){const m=i.y*a-i.x,g=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,d,!1,r,c),this.addHalfVertex(e,m,g,d,!0,-a,c)}addHalfVertex({x:e,y:i},r,a,c,d,m,g){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(d?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),g.primitiveLength++),d?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}bt($h,"LineBucket",{omit:["layers","patternFeatures"]});const h1=new $({"line-cap":new G(Le.layout_line["line-cap"]),"line-join":new G(Le.layout_line["line-join"]),"line-miter-limit":new B(Le.layout_line["line-miter-limit"]),"line-round-limit":new B(Le.layout_line["line-round-limit"]),"line-sort-key":new G(Le.layout_line["line-sort-key"])});var w_={paint:new $({"line-opacity":new G(Le.paint_line["line-opacity"]),"line-color":new G(Le.paint_line["line-color"]),"line-translate":new B(Le.paint_line["line-translate"]),"line-translate-anchor":new B(Le.paint_line["line-translate-anchor"]),"line-width":new G(Le.paint_line["line-width"]),"line-gap-width":new G(Le.paint_line["line-gap-width"]),"line-offset":new G(Le.paint_line["line-offset"]),"line-blur":new G(Le.paint_line["line-blur"]),"line-dasharray":new G(Le.paint_line["line-dasharray"]),"line-pattern":new G(Le.paint_line["line-pattern"]),"line-gradient":new J(Le.paint_line["line-gradient"]),"line-trim-offset":new B(Le.paint_line["line-trim-offset"])}),layout:h1};const T_=new class extends G{possiblyEvaluate(t,e){return e=new E(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=ti({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(w_.paint.properties["line-width"].specification);function E_(t,e){return e>0?e+2*t:t}T_.useIntegerZoom=!0;const d1=me([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),f1=me([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),p1=me([{name:"a_projected_pos",components:4,type:"Float32"}],4);me([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const m1=me([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_1=me([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);me([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const M_=me([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),g1=me([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);me([{name:"triangle",components:3,type:"Uint16"}]),me([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),me([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),me([{type:"Float32",name:"offsetX"}]),me([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Rn=24;const xo=128;function Xf(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new E(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:a}=i;let c=0;for(;c<r.length&&r[c]<=t;)c++;c=Math.max(0,c-1);let d=c;for(;d<r.length&&r[d]<t+1;)d++;d=Math.min(r.length-1,d);const m=r[c],g=r[d];return i.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:m,maxZoom:g,minSize:i.evaluate(new E(m)),maxSize:i.evaluate(new E(g)),interpolationType:a}}}function Qh(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:a}){return t.kind==="source"?r/xo:t.kind==="composite"?di(r/xo,a/xo,i):e}function Nl(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:c,maxZoom:d}=t,m=a?je(Xr.interpolationFactor(a,e,c,d),0,1):0;t.kind==="camera"?r=di(t.minSize,t.maxSize,m):i=m}return{uSizeT:i,uSize:r}}var y1=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xo,evaluateSizeForFeature:Qh,evaluateSizeForZoom:Nl,getSizeData:Xf});function x1(t,e,i){return t.sections.forEach(r=>{r.text=function(a,c,d){const m=c.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?a=a.toLocaleUpperCase():m==="lowercase"&&(a=a.toLocaleLowerCase()),b.applyArabicShaping&&(a=b.applyArabicShaping(a)),a}(r.text,e,i)}),t}const bu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function v1(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function b1(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var S_=Fi,A_=function(t,e,i,r,a){var c,d,m=8*a-r-1,g=(1<<m)-1,x=g>>1,T=-7,M=i?a-1:0,A=i?-1:1,P=t[e+M];for(M+=A,c=P&(1<<-T)-1,P>>=-T,T+=m;T>0;c=256*c+t[e+M],M+=A,T-=8);for(d=c&(1<<-T)-1,c>>=-T,T+=r;T>0;d=256*d+t[e+M],M+=A,T-=8);if(c===0)c=1-x;else{if(c===g)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,r),c-=x}return(P?-1:1)*d*Math.pow(2,c-r)},C_=function(t,e,i,r,a,c){var d,m,g,x=8*c-a-1,T=(1<<x)-1,M=T>>1,A=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=r?0:c-1,D=r?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=T):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),(e+=d+M>=1?A/g:A*Math.pow(2,1-M))*g>=2&&(d++,g/=2),d+M>=T?(m=0,d=T):d+M>=1?(m=(e*g-1)*Math.pow(2,a),d+=M):(m=e*Math.pow(2,M-1)*Math.pow(2,a),d=0));a>=8;t[i+P]=255&m,P+=D,m/=256,a-=8);for(d=d<<a|m,x+=a;x>0;t[i+P]=255&d,P+=D,d/=256,x-=8);t[i+P-D]|=128*O};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Fi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Fi.Varint=0,Fi.Fixed64=1,Fi.Bytes=2,Fi.Fixed32=5;var Hf=4294967296,I_=1/Hf,k_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ls(t){return t.type===Fi.Bytes?t.readVarint()+t.pos:t.pos+1}function Vl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function z_(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var a=i.pos-1;a>=t;a--)i.buf[a+r]=i.buf[a]}function w1(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function T1(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function E1(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function M1(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function S1(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function A1(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function C1(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function I1(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function k1(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ed(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function jl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function P_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Fi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),a=r>>3,c=this.pos;this.type=7&r,t(a,e,this),this.pos===c&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ed(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=P_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ed(this.buf,this.pos)+ed(this.buf,this.pos+4)*Hf;return this.pos+=8,t},readSFixed64:function(){var t=ed(this.buf,this.pos)+P_(this.buf,this.pos+4)*Hf;return this.pos+=8,t},readFloat:function(){var t=A_(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=A_(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(a,c,d){var m,g,x=d.buf;if(m=(112&(g=x[d.pos++]))>>4,g<128||(m|=(127&(g=x[d.pos++]))<<3,g<128)||(m|=(127&(g=x[d.pos++]))<<10,g<128)||(m|=(127&(g=x[d.pos++]))<<17,g<128)||(m|=(127&(g=x[d.pos++]))<<24,g<128)||(m|=(1&(g=x[d.pos++]))<<31,g<128))return Vl(a,m,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&k_?function(i,r,a){return k_.decode(i.subarray(r,a))}(this.buf,e,t):function(i,r,a){for(var c="",d=r;d<a;){var m,g,x,T=i[d],M=null,A=T>239?4:T>223?3:T>191?2:1;if(d+A>a)break;A===1?T<128&&(M=T):A===2?(192&(m=i[d+1]))==128&&(M=(31&T)<<6|63&m)<=127&&(M=null):A===3?(g=i[d+2],(192&(m=i[d+1]))==128&&(192&g)==128&&((M=(15&T)<<12|(63&m)<<6|63&g)<=2047||M>=55296&&M<=57343)&&(M=null)):A===4&&(g=i[d+2],x=i[d+3],(192&(m=i[d+1]))==128&&(192&g)==128&&(192&x)==128&&((M=(15&T)<<18|(63&m)<<12|(63&g)<<6|63&x)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,A=1):M>65535&&(M-=65536,c+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),c+=String.fromCharCode(M),d+=A}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Fi.Bytes)return t.push(this.readVarint(e));var i=ls(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Fi.Bytes)return t.push(this.readSVarint());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Fi.Bytes)return t.push(this.readBoolean());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Fi.Bytes)return t.push(this.readFloat());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Fi.Bytes)return t.push(this.readDouble());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Fi.Bytes)return t.push(this.readFixed32());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Fi.Bytes)return t.push(this.readSFixed32());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Fi.Bytes)return t.push(this.readFixed64());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Fi.Bytes)return t.push(this.readSFixed64());var e=ls(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Fi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Fi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Fi.Fixed32)this.pos+=4;else{if(e!==Fi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),jl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),jl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),jl(this.buf,-1&t,this.pos),jl(this.buf,Math.floor(t*I_),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),jl(this.buf,-1&t,this.pos),jl(this.buf,Math.floor(t*I_),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,a;if(e>=0?(r=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(c,d,m){m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,m.buf[m.pos]=127&(c>>>=7)}(r,0,i),function(c,d){var m=(7&c)<<4;d.buf[d.pos++]|=m|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,a,c){for(var d,m,g=0;g<a.length;g++){if((d=a.charCodeAt(g))>55295&&d<57344){if(!m){d>56319||g+1===a.length?(r[c++]=239,r[c++]=191,r[c++]=189):m=d;continue}if(d<56320){r[c++]=239,r[c++]=191,r[c++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(r[c++]=239,r[c++]=191,r[c++]=189,m=null);d<128?r[c++]=d:(d<2048?r[c++]=d>>6|192:(d<65536?r[c++]=d>>12|224:(r[c++]=d>>18|240,r[c++]=d>>12&63|128),r[c++]=d>>6&63|128),r[c++]=63&d|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&z_(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),C_(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),C_(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&z_(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Fi.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,w1,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,T1,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,S1,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,E1,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,M1,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,A1,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,C1,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,I1,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,k1,e)},writeBytesField:function(t,e){this.writeTag(t,Fi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Fi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Fi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Fi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Fi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Fi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Fi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Fi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Fi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Fi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var td=Ie(S_);const Yf=3;function z1(t,e,i){e.glyphs=[],t===1&&i.readMessage(P1,e)}function P1(t,e,i){if(t===3){const{id:r,bitmap:a,width:c,height:d,left:m,top:g,advance:x}=i.readMessage(D1,{});e.glyphs.push({id:r,bitmap:new as({width:c+2*Yf,height:d+2*Yf},a),metrics:{width:c,height:d,left:m,top:g,advance:x}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function D1(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const D_=Yf;function Kf(t){let e=0,i=0;for(const d of t)e+=d.w*d.h,i=Math.max(i,d.w);t.sort((d,m)=>m.h-d.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,c=0;for(const d of t)for(let m=r.length-1;m>=0;m--){const g=r[m];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,c=Math.max(c,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===g.w&&d.h===g.h){const x=r.pop();m<r.length&&(r[m]=x)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(r.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}const dr=1;class Jf{constructor(e,{pixelRatio:i,version:r,stretchX:a,stretchY:c,content:d}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=c,this.content=d,this.version=r}get tl(){return[this.paddedRect.x+dr,this.paddedRect.y+dr]}get br(){return[this.paddedRect.x+this.paddedRect.w-dr,this.paddedRect.y+this.paddedRect.h-dr]}get displaySize(){return[(this.paddedRect.w-2*dr)/this.pixelRatio,(this.paddedRect.h-2*dr)/this.pixelRatio]}}class L_{constructor(e,i){const r={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,r,c),this.addImages(i,a,c);const{w:d,h:m}=Kf(c),g=new Tr({width:d||1,height:m||1});for(const x in e){const T=e[x],M=r[x].paddedRect;Tr.copy(T.data,g,{x:0,y:0},{x:M.x+dr,y:M.y+dr},T.data)}for(const x in i){const T=i[x],M=a[x].paddedRect,A=M.x+dr,P=M.y+dr,D=T.data.width,O=T.data.height;Tr.copy(T.data,g,{x:0,y:0},{x:A,y:P},T.data),Tr.copy(T.data,g,{x:0,y:O-1},{x:A,y:P-1},{width:D,height:1}),Tr.copy(T.data,g,{x:0,y:0},{x:A,y:P+O},{width:D,height:1}),Tr.copy(T.data,g,{x:D-1,y:0},{x:A-1,y:P},{width:1,height:O}),Tr.copy(T.data,g,{x:0,y:0},{x:A+D,y:P},{width:1,height:O})}this.image=g,this.iconPositions=r,this.patternPositions=a}addImages(e,i,r){for(const a in e){const c=e[a],d={x:0,y:0,w:c.data.width+2*dr,h:c.data.height+2*dr};r.push(d),i[a]=new Jf(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,c]=e.tl;r.update(i.data,void 0,{x:a,y:c})}}bt(Jf,"ImagePosition"),bt(L_,"ImageAtlas");const Nr={horizontal:1,vertical:2,horizontalOnly:3},R_=-17;class wu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new wu;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new wu;return i.imageName=e,i}}class Gl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new Gl;for(let a=0;a<e.sections.length;a++){const c=e.sections[a];c.image?r.addImageSection(c):r.addTextSection(c,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let a="";for(let c=0;c<i.length;c++){const d=i.charCodeAt(c+1)||null,m=i.charCodeAt(c-1)||null;a+=!r&&(d&&kh(d)&&!bu[i[c+1]]||m&&kh(m)&&!bu[i[c-1]])||!bu[i[c]]?i[c]:bu[i[c]]}return a}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&id[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&id[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new Gl;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(wu.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void ei("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(wu.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $f(t,e,i,r,a,c,d,m,g,x,T,M,A,P,D){const O=Gl.fromFeature(t,a);M===Nr.vertical&&O.verticalizePunctuation(A);let j=[];const Y=function(re,Ae,Te,Re,$e,ze){if(!re)return[];const Ne=[],Ve=function(ft,Tt,mt,Xt,st,Pt){let Ht=0;for(let _i=0;_i<ft.length();_i++){const Yt=ft.getSection(_i);Ht+=B_(ft.getCharCode(_i),Yt,Xt,st,Tt,Pt)}return Ht/Math.max(1,Math.ceil(Ht/mt))}(re,Ae,Te,Re,$e,ze),We=re.text.indexOf("​")>=0;let ot=0;for(let ft=0;ft<re.length();ft++){const Tt=re.getSection(ft),mt=re.getCharCode(ft);if(id[mt]||(ot+=B_(mt,Tt,Re,$e,Ae,ze)),ft<re.length()-1){const Xt=!((De=mt)<11904||!(_t["Bopomofo Extended"](De)||_t.Bopomofo(De)||_t["CJK Compatibility Forms"](De)||_t["CJK Compatibility Ideographs"](De)||_t["CJK Compatibility"](De)||_t["CJK Radicals Supplement"](De)||_t["CJK Strokes"](De)||_t["CJK Symbols and Punctuation"](De)||_t["CJK Unified Ideographs Extension A"](De)||_t["CJK Unified Ideographs"](De)||_t["Enclosed CJK Letters and Months"](De)||_t["Halfwidth and Fullwidth Forms"](De)||_t.Hiragana(De)||_t["Ideographic Description Characters"](De)||_t["Kangxi Radicals"](De)||_t["Katakana Phonetic Extensions"](De)||_t.Katakana(De)||_t["Vertical Forms"](De)||_t["Yi Radicals"](De)||_t["Yi Syllables"](De)));(L1[mt]||Xt||Tt.imageName)&&Ne.push(F_(ft+1,ot,Ve,Ne,R1(mt,re.getCharCode(ft+1),Xt&&We),!1))}}var De;return U_(F_(re.length(),ot,Ve,Ne,0,!0))}(O,x,c,e,r,P),{processBidirectionalText:ne,processStyledBidirectionalText:K}=b;if(ne&&O.sections.length===1){const re=ne(O.toString(),Y);for(const Ae of re){const Te=new Gl;Te.text=Ae,Te.sections=O.sections;for(let Re=0;Re<Ae.length;Re++)Te.sectionIndex.push(0);j.push(Te)}}else if(K){const re=K(O.text,O.sectionIndex,Y);for(const Ae of re){const Te=new Gl;Te.text=Ae[0],Te.sectionIndex=Ae[1],Te.sections=O.sections,j.push(Te)}}else j=function(re,Ae){const Te=[],Re=re.text;let $e=0;for(const ze of Ae)Te.push(re.substring($e,ze)),$e=ze;return $e<Re.length&&Te.push(re.substring($e,Re.length)),Te}(O,Y);const ie=[],oe={positionedLines:ie,text:O.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(re,Ae,Te,Re,$e,ze,Ne,Ve,We,ot,De,ft){let Tt=0,mt=0,Xt=0;const st=Ve==="right"?1:Ve==="left"?0:.5;let Pt=!1;for(const Jt of $e){const $t=Jt.getSections();for(const Li of $t){if(Li.imageName)continue;const Ui=Ae[Li.fontStack];if(Ui&&(Pt=Ui.ascender!==void 0&&Ui.descender!==void 0,!Pt))break}if(!Pt)break}let Ht=0;for(const Jt of $e){Jt.trim();const $t=Jt.getMaxScale(),Li=($t-1)*Rn,Ui={positionedGlyphs:[],lineOffset:0};re.positionedLines[Ht]=Ui;const Ni=Ui.positionedGlyphs;let Ri=0;if(!Jt.length()){mt+=ze,++Ht;continue}let Ki=0,ln=0;for(let Bi=0;Bi<Jt.length();Bi++){const En=Jt.getSection(Bi),gn=Jt.getSectionIndex(Bi),en=Jt.getCharCode(Bi);let xi=En.scale,yn=null,Vi=null,sr=null,xn=Rn,Bn=0;const zn=!(We===Nr.horizontal||!De&&!Yc(en)||De&&(id[en]||(_i=en,_t.Arabic(_i)||_t["Arabic Supplement"](_i)||_t["Arabic Extended-A"](_i)||_t["Arabic Presentation Forms-A"](_i)||_t["Arabic Presentation Forms-B"](_i))));if(En.imageName){const ar=Re[En.imageName];if(!ar)continue;sr=En.imageName,re.iconsInText=re.iconsInText||!0,Vi=ar.paddedRect;const Pn=ar.displaySize;xi=xi*Rn/ft,yn={width:Pn[0],height:Pn[1],left:dr,top:-D_,advance:zn?Pn[1]:Pn[0],localGlyph:!1},Bn=Pt?-yn.height*xi:R_+$t*Rn-Pn[1]*xi,xn=yn.advance;const wo=(zn?Pn[0]:Pn[1])*xi-Rn*$t;wo>0&&wo>Ri&&(Ri=wo)}else{const ar=Te[En.fontStack];if(!ar)continue;ar[en]&&(Vi=ar[en]);const Pn=Ae[En.fontStack];if(!Pn)continue;const wo=Pn.glyphs[en];if(!wo)continue;if(yn=wo.metrics,xn=en!==8203?Rn:0,Pt){const Kl=Pn.ascender!==void 0?Math.abs(Pn.ascender):0,Pu=Pn.descender!==void 0?Math.abs(Pn.descender):0,Du=(Kl+Pu)*xi;Ki<Du&&(Ki=Du,ln=(Kl-Pu)/2*xi),Bn=-Kl*xi}else Bn=R_+($t-xi)*Rn}zn?(re.verticalizable=!0,Ni.push({glyph:en,imageName:sr,x:Tt,y:mt+Bn,vertical:zn,scale:xi,localGlyph:yn.localGlyph,fontStack:En.fontStack,sectionIndex:gn,metrics:yn,rect:Vi}),Tt+=xn*xi+ot):(Ni.push({glyph:en,imageName:sr,x:Tt,y:mt+Bn,vertical:zn,scale:xi,localGlyph:yn.localGlyph,fontStack:En.fontStack,sectionIndex:gn,metrics:yn,rect:Vi}),Tt+=yn.advance*xi+ot)}Ni.length!==0&&(Xt=Math.max(Tt-ot,Xt),Pt?N_(Ni,st,Ri,ln,ze*$t/2):N_(Ni,st,Ri,0,ze/2)),Tt=0;const _n=ze*$t+Ri;Ui.lineOffset=Math.max(Ri,Li),mt+=_n,++Ht}var _i;const Yt=mt,{horizontalAlign:Rt,verticalAlign:ji}=Qf(Ne);(function(Jt,$t,Li,Ui,Ni,Ri){const Ki=($t-Li)*Ni,ln=-Ri*Ui;for(const _n of Jt)for(const Bi of _n.positionedGlyphs)Bi.x+=Ki,Bi.y+=ln})(re.positionedLines,st,Rt,ji,Xt,Yt),re.top+=-ji*Yt,re.bottom=re.top+Yt,re.left+=-Rt*Xt,re.right=re.left+Xt,re.hasBaseline=Pt}(oe,e,i,r,j,d,m,g,M,x,A,D),!function(re){for(const Ae of re)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ie)&&oe}const id={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},L1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function B_(t,e,i,r,a,c){if(e.imageName){const d=r[e.imageName];return d?d.displaySize[0]*e.scale*Rn/c+a:0}{const d=i[e.fontStack],m=d&&d.glyphs[t];return m?m.metrics.advance*e.scale+a:0}}function O_(t,e,i,r){const a=Math.pow(t-e,2);return r?t<e?a/2:2*a:a+Math.abs(i)*i}function R1(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function F_(t,e,i,r,a,c){let d=null,m=O_(e,i,a,c);for(const g of r){const x=O_(e-g.x,i,a,c)+g.badness;x<=m&&(d=g,m=x)}return{index:t,x:e,priorBreak:d,badness:m}}function U_(t){return t?U_(t.priorBreak).concat(t.index):[]}function Qf(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function N_(t,e,i,r,a){if(!(e||i||r||a))return;const c=t.length-1,d=t[c],m=(d.x+d.metrics.advance*d.scale)*e;for(let g=0;g<=c;g++)t[g].x-=m,t[g].y+=i+r+a}function B1(t,e,i){const{horizontalAlign:r,verticalAlign:a}=Qf(i),c=e[0]-t.displaySize[0]*r,d=e[1]-t.displaySize[1]*a;return{image:t,top:d,bottom:d+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function V_(t,e,i,r,a,c){const d=t.image;let m;if(d.content){const j=d.content,Y=d.pixelRatio||1;m=[j[0]/Y,j[1]/Y,d.displaySize[0]-j[2]/Y,d.displaySize[1]-j[3]/Y]}const g=e.left*c,x=e.right*c;let T,M,A,P;i==="width"||i==="both"?(P=a[0]+g-r[3],M=a[0]+x+r[1]):(P=a[0]+(g+x-d.displaySize[0])/2,M=P+d.displaySize[0]);const D=e.top*c,O=e.bottom*c;return i==="height"||i==="both"?(T=a[1]+D-r[0],A=a[1]+O+r[2]):(T=a[1]+(D+O-d.displaySize[1])/2,A=T+d.displaySize[1]),{image:d,top:T,right:M,bottom:A,left:P,collisionPadding:m}}class cs extends Be{constructor(e,i,r,a,c){super(e,i),this.angle=a,this.z=r,c!==void 0&&(this.segment=c)}clone(){return new cs(this.x,this.y,this.z,this.angle,this.segment)}}function j_(t,e,i,r,a){if(e.segment===void 0)return!0;let c=e,d=e.segment+1,m=0;for(;m>-i/2;){if(d--,d<0)return!1;m-=t[d].dist(c),c=t[d]}m+=t[d].dist(t[d+1]),d++;const g=[];let x=0;for(;m<i/2;){const T=t[d],M=t[d+1];if(!M)return!1;let A=t[d-1].angleTo(T)-T.angleTo(M);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:A}),x+=A;m-g[0].distance>r;)x-=g.shift().angleDelta;if(x>a)return!1;d++,m+=T.dist(M)}return!0}function G_(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function q_(t,e,i){return t?.6*e*i:0}function Z_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function O1(t,e,i,r,a,c){const d=q_(i,a,c),m=Z_(i,r)*c;let g=0;const x=G_(t)/2;for(let T=0;T<t.length-1;T++){const M=t[T],A=t[T+1],P=M.dist(A);if(g+P>x){const D=(x-g)/P,O=di(M.x,A.x,D),j=di(M.y,A.y,D),Y=new cs(O,j,0,A.angleTo(M),T);return!d||j_(t,Y,m,d,e)?Y:void 0}g+=P}}function F1(t,e,i,r,a,c,d,m,g){const x=q_(r,c,d),T=Z_(r,a),M=T*d,A=t[0].x===0||t[0].x===g||t[0].y===0||t[0].y===g;return e-M<e/4&&(e=M+e/4),W_(t,A?e/2*m%e:(T/2+2*c)*d*m%e,e,x,i,M,A,!1,g)}function W_(t,e,i,r,a,c,d,m,g){const x=c/2,T=G_(t);let M=0,A=e-i,P=[];for(let D=0;D<t.length-1;D++){const O=t[D],j=t[D+1],Y=O.dist(j),ne=j.angleTo(O);for(;A+i<M+Y;){A+=i;const K=(A-M)/Y,ie=di(O.x,j.x,K),oe=di(O.y,j.y,K);if(ie>=0&&ie<g&&oe>=0&&oe<g&&A-x>=0&&A+x<=T){const re=new cs(ie,oe,0,ne,D);re._round(),r&&!j_(t,re,c,r,a)||P.push(re)}}M+=Y}return m||P.length||d||(P=W_(t,M/2,i,r,a,c,d,!0,g)),P}function X_(t,e,i,r,a){const c=[];for(let d=0;d<t.length;d++){const m=t[d];let g;for(let x=0;x<m.length-1;x++){let T=m[x],M=m[x+1];T.x<e&&M.x<e||(T.x<e?T=new Be(e,T.y+(e-T.x)/(M.x-T.x)*(M.y-T.y))._round():M.x<e&&(M=new Be(e,T.y+(e-T.x)/(M.x-T.x)*(M.y-T.y))._round()),T.y<i&&M.y<i||(T.y<i?T=new Be(T.x+(i-T.y)/(M.y-T.y)*(M.x-T.x),i)._round():M.y<i&&(M=new Be(T.x+(i-T.y)/(M.y-T.y)*(M.x-T.x),i)._round()),T.x>=r&&M.x>=r||(T.x>=r?T=new Be(r,T.y+(r-T.x)/(M.x-T.x)*(M.y-T.y))._round():M.x>=r&&(M=new Be(r,T.y+(r-T.x)/(M.x-T.x)*(M.y-T.y))._round()),T.y>=a&&M.y>=a||(T.y>=a?T=new Be(T.x+(a-T.y)/(M.y-T.y)*(M.x-T.x),a)._round():M.y>=a&&(M=new Be(T.x+(a-T.y)/(M.y-T.y)*(M.x-T.x),a)._round()),g&&T.equals(g[g.length-1])||(g=[T],c.push(g)),g.push(M)))))}}return c}bt(cs,"Anchor");const Tu=1e20;function H_(t,e,i,r,a,c,d,m,g){for(let x=e;x<e+r;x++)Y_(t,i*c+x,c,a,d,m,g);for(let x=i;x<i+a;x++)Y_(t,x*c+e,1,r,d,m,g)}function Y_(t,e,i,r,a,c,d){c[0]=0,d[0]=-Tu,d[1]=Tu,a[0]=t[e];for(let m=1,g=0,x=0;m<r;m++){a[m]=t[e+m*i];const T=m*m;do{const M=c[g];x=(a[m]-a[M]+T-M*M)/(m-M)/2}while(x<=d[g]&&--g>-1);g++,c[g]=m,d[g]=x,d[g+1]=Tu}for(let m=0,g=0;m<r;m++){for(;d[g+1]<m;)g++;const x=c[g],T=m-x;t[e+m*i]=a[x]+T*T}}const vo=2,ep={none:0,ideographs:1,all:2};class ql{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const a in e)for(const c of e[a])r.push({stack:a,id:c});Nt(r,({stack:a,id:c},d)=>{let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=m.glyphs[c];if(g!==void 0)return void d(null,{stack:a,id:c,glyph:g});if(g=this._tinySDF(m,a,c),g)return m.glyphs[c]=g,void d(null,{stack:a,id:c,glyph:g});const x=Math.floor(c/256);if(256*x>65535)return void d(new Error("glyphs > 65535 not supported"));if(m.ranges[x])return void d(null,{stack:a,id:c,glyph:g});let T=m.requests[x];T||(T=m.requests[x]=[],ql.loadGlyphRange(a,x,this.url,this.requestManager,(M,A)=>{if(A){m.ascender=A.ascender,m.descender=A.descender;for(const P in A.glyphs)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=A.glyphs[+P]);m.ranges[x]=!0}for(const P of T)P(M,A);delete m.requests[x]})),T.push((M,A)=>{M?d(M):A&&d(null,{stack:a,id:c,glyph:A.glyphs[c]||null})})},(a,c)=>{if(a)i(a);else if(c){const d={};for(const{stack:m,id:g,glyph:x}of c)d[m]===void 0&&(d[m]={}),d[m].glyphs===void 0&&(d[m].glyphs={}),d[m].glyphs[g]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},d[m].ascender=this.entries[m].ascender,d[m].descender=this.entries[m].descender;i(null,d)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ep.none&&(this.localGlyphMode===ep.all?!!this.localFontFamily:!!this.localFontFamily&&(_t["CJK Unified Ideographs"](e)||_t["Hangul Syllables"](e)||_t.Hiragana(e)||_t.Katakana(e)||_t["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,r){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(r))return;let c=e.tinySDF;if(!c){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),c=e.tinySDF=new ql.TinySDF({fontFamily:a,fontWeight:O,fontSize:24*vo,buffer:3*vo,radius:8*vo}),c.fontWeight=O}if(this.localGlyphs[c.fontWeight][r])return this.localGlyphs[c.fontWeight][r];const d=String.fromCharCode(r),{data:m,width:g,height:x,glyphWidth:T,glyphHeight:M,glyphLeft:A,glyphTop:P,glyphAdvance:D}=c.draw(d);return this.localGlyphs[c.fontWeight][r]={id:r,bitmap:new as({width:g,height:x},m),metrics:{width:T/vo,height:M/vo,left:A/vo,top:P/vo-27,advance:D/vo,localGlyph:!0}}}}ql.loadGlyphRange=function(t,e,i,r,a){const c=256*e,d=c+255,m=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${d}`),bn.Glyphs);Lr(m,(g,x)=>{if(g)a(g);else if(x){const T={},M=function(A){return new td(A).readFields(z1,{})}(x);for(const A of M.glyphs)T[A.id]=A;a(null,{glyphs:T,ascender:M.ascender,descender:M.descender})}})},ql.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const m=this.size=t+4*e,g=this._createCanvas(m),x=this.ctx=g.getContext("2d",{willReadFrequently:!0});x.font=`${d} ${c} ${t}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(t),d=Math.ceil(i),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),g=Math.min(this.size-this.buffer,d+Math.ceil(r)),x=m+2*this.buffer,T=g+2*this.buffer,M=Math.max(x*T,0),A=new Uint8ClampedArray(M),P={data:A,width:x,height:T,glyphWidth:m,glyphHeight:g,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(m===0||g===0)return P;const{ctx:D,buffer:O,gridInner:j,gridOuter:Y}=this;D.clearRect(O,O,m,g),D.fillText(t,O,O+d);const ne=D.getImageData(O,O,m,g);Y.fill(Tu,0,M),j.fill(0,0,M);for(let K=0;K<g;K++)for(let ie=0;ie<m;ie++){const oe=ne.data[4*(K*m+ie)+3]/255;if(oe===0)continue;const re=(K+O)*x+ie+O;if(oe===1)Y[re]=0,j[re]=Tu;else{const Ae=.5-oe;Y[re]=Ae>0?Ae*Ae:0,j[re]=Ae<0?Ae*Ae:0}}H_(Y,0,0,x,T,x,this.f,this.v,this.z),H_(j,O,O,m,g,x,this.f,this.v,this.z);for(let K=0;K<M;K++){const ie=Math.sqrt(Y[K])-Math.sqrt(j[K]);A[K]=Math.round(255-255*(ie/this.radius+this.cutoff))}return P}};const Zl=dr;function K_(t,e,i,r){const a=[],c=t.image,d=c.pixelRatio,m=c.paddedRect.w-2*Zl,g=c.paddedRect.h-2*Zl,x=t.right-t.left,T=t.bottom-t.top,M=c.stretchX||[[0,m]],A=c.stretchY||[[0,g]],P=(ze,Ne)=>ze+Ne[1]-Ne[0],D=M.reduce(P,0),O=A.reduce(P,0),j=m-D,Y=g-O;let ne=0,K=D,ie=0,oe=O,re=0,Ae=j,Te=0,Re=Y;if(c.content&&r){const ze=c.content;ne=nd(M,0,ze[0]),ie=nd(A,0,ze[1]),K=nd(M,ze[0],ze[2]),oe=nd(A,ze[1],ze[3]),re=ze[0]-ne,Te=ze[1]-ie,Ae=ze[2]-ze[0]-K,Re=ze[3]-ze[1]-oe}const $e=(ze,Ne,Ve,We)=>{const ot=rd(ze.stretch-ne,K,x,t.left),De=od(ze.fixed-re,Ae,ze.stretch,D),ft=rd(Ne.stretch-ie,oe,T,t.top),Tt=od(Ne.fixed-Te,Re,Ne.stretch,O),mt=rd(Ve.stretch-ne,K,x,t.left),Xt=od(Ve.fixed-re,Ae,Ve.stretch,D),st=rd(We.stretch-ie,oe,T,t.top),Pt=od(We.fixed-Te,Re,We.stretch,O),Ht=new Be(ot,ft),_i=new Be(mt,ft),Yt=new Be(mt,st),Rt=new Be(ot,st),ji=new Be(De/d,Tt/d),Jt=new Be(Xt/d,Pt/d),$t=e*Math.PI/180;if($t){const Ni=Math.sin($t),Ri=Math.cos($t),Ki=[Ri,-Ni,Ni,Ri];Ht._matMult(Ki),_i._matMult(Ki),Rt._matMult(Ki),Yt._matMult(Ki)}const Li=ze.stretch+ze.fixed,Ui=Ne.stretch+Ne.fixed;return{tl:Ht,tr:_i,bl:Rt,br:Yt,tex:{x:c.paddedRect.x+Zl+Li,y:c.paddedRect.y+Zl+Ui,w:Ve.stretch+Ve.fixed-Li,h:We.stretch+We.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:Jt,minFontScaleX:Ae/d/x,minFontScaleY:Re/d/T,isSDF:i}};if(r&&(c.stretchX||c.stretchY)){const ze=J_(M,j,D),Ne=J_(A,Y,O);for(let Ve=0;Ve<ze.length-1;Ve++){const We=ze[Ve],ot=ze[Ve+1];for(let De=0;De<Ne.length-1;De++)a.push($e(We,Ne[De],ot,Ne[De+1]))}}else a.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return a}function nd(t,e,i){let r=0;for(const a of t)r+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return r}function J_(t,e,i){const r=[{fixed:-Zl,stretch:0}];for(const[a,c]of t){const d=r[r.length-1];r.push({fixed:a-d.stretch,stretch:d.stretch}),r.push({fixed:a-d.stretch,stretch:d.stretch+(c-a)})}return r.push({fixed:e+Zl,stretch:i}),r}function rd(t,e,i,r){return t/e*i+r}function od(t,e,i,r){return t-e*i/r}function U1(t,e,i,r){const a=e+t.positionedLines[r].lineOffset;return r===0?i+a/2:i+(a+(e+t.positionedLines[r-1].lineOffset))/2}class N1{constructor(e=[],i=V1){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,a=i[e];for(;e>0;){const c=e-1>>1,d=i[c];if(r(a,d)>=0)break;i[e]=d,e=c}i[e]=a}_down(e){const{data:i,compare:r}=this,a=this.length>>1,c=i[e];for(;e<a;){let d=1+(e<<1),m=i[d];const g=d+1;if(g<this.length&&r(i[g],m)<0&&(d=g,m=i[g]),r(m,c)>=0)break;i[e]=m,e=d}i[e]=c}}function V1(t,e){return t<e?-1:t>e?1:0}function j1(t,e=1,i=!1){let r=1/0,a=1/0,c=-1/0,d=-1/0;const m=t[0];for(let P=0;P<m.length;P++){const D=m[P];(!P||D.x<r)&&(r=D.x),(!P||D.y<a)&&(a=D.y),(!P||D.x>c)&&(c=D.x),(!P||D.y>d)&&(d=D.y)}const g=Math.min(c-r,d-a);let x=g/2;const T=new N1([],G1);if(g===0)return new Be(r,a);for(let P=r;P<c;P+=g)for(let D=a;D<d;D+=g)T.push(new Wl(P+x,D+x,x,t));let M=function(P){let D=0,O=0,j=0;const Y=P[0];for(let ne=0,K=Y.length,ie=K-1;ne<K;ie=ne++){const oe=Y[ne],re=Y[ie],Ae=oe.x*re.y-re.x*oe.y;O+=(oe.x+re.x)*Ae,j+=(oe.y+re.y)*Ae,D+=3*Ae}return new Wl(O/D,j/D,0,P)}(t),A=T.length;for(;T.length;){const P=T.pop();(P.d>M.d||!M.d)&&(M=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,A)),P.max-M.d<=e||(x=P.h/2,T.push(new Wl(P.p.x-x,P.p.y-x,x,t)),T.push(new Wl(P.p.x+x,P.p.y-x,x,t)),T.push(new Wl(P.p.x-x,P.p.y+x,x,t)),T.push(new Wl(P.p.x+x,P.p.y+x,x,t)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${M.d}`)),M.p}function G1(t,e){return e.max-t.max}class Wl{constructor(e,i,r,a){this.p=new Be(e,i),this.h=r,this.d=function(c,d){let m=!1,g=1/0;for(let x=0;x<d.length;x++){const T=d[x];for(let M=0,A=T.length,P=A-1;M<A;P=M++){const D=T[M],O=T[P];D.y>c.y!=O.y>c.y&&c.x<(O.x-D.x)*(c.y-D.y)/(O.y-D.y)+D.x&&(m=!m),g=Math.min(g,Wm(c,D,O))}}return(m?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Xl=7,tp=Number.POSITIVE_INFINITY,q1=Math.sqrt(2);function $_(t,[e,i]){let r=0,a=0;if(i===tp){e<0&&(e=0);const c=e/q1;switch(t){case"top-right":case"top-left":a=c-Xl;break;case"bottom-right":case"bottom-left":a=-c+Xl;break;case"bottom":a=-e+Xl;break;case"top":a=e-Xl}switch(t){case"top-right":case"bottom-right":r=-c;break;case"top-left":case"bottom-left":r=c;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-Xl;break;case"bottom-right":case"bottom-left":case"bottom":a=-i+Xl}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,a]}function Z1(t,e,i,r,a,c,d,m,g,x){t.createArrays(),t.tilePixelRatio=Dt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const T=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,A={};if(t.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=t.textSizeData;A.compositeTextSizes=[M["text-size"].possiblyEvaluate(new E(O),m),M["text-size"].possiblyEvaluate(new E(j),m)]}if(t.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=t.iconSizeData;A.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new E(O),m),M["icon-size"].possiblyEvaluate(new E(j),m)]}A.layoutTextSize=M["text-size"].possiblyEvaluate(new E(g+1),m),A.layoutIconSize=M["icon-size"].possiblyEvaluate(new E(g+1),m),A.textMaxSize=M["text-size"].possiblyEvaluate(new E(18),m);const P=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",D=T.get("text-size");for(const O of t.features){const j=T.get("text-font").evaluate(O,{},m).join(","),Y=D.evaluate(O,{},m),ne=A.layoutTextSize.evaluate(O,{},m),K=(A.layoutIconSize.evaluate(O,{},m),{horizontal:{},vertical:void 0}),ie=O.text;let oe,re=[0,0];if(ie){const Re=ie.toString(),$e=T.get("text-letter-spacing").evaluate(O,{},m)*Rn,ze=T.get("text-line-height").evaluate(O,{},m)*Rn,Ne=uf(Re)?$e:0,Ve=T.get("text-anchor").evaluate(O,{},m),We=T.get("text-variable-anchor");if(!We){const mt=T.get("text-radial-offset").evaluate(O,{},m);re=mt?$_(Ve,[mt*Rn,tp]):T.get("text-offset").evaluate(O,{},m).map(Xt=>Xt*Rn)}let ot=P?"center":T.get("text-justify").evaluate(O,{},m);const De=T.get("symbol-placement")==="point",ft=De?T.get("text-max-width").evaluate(O,{},m)*Rn:1/0,Tt=mt=>{t.allowVerticalPlacement&&Hc(Re)&&(K.vertical=$f(ie,e,i,a,j,ft,ze,Ve,mt,Ne,re,Nr.vertical,!0,ne,Y))};if(!P&&We){const mt=ot==="auto"?We.map(st=>ip(st)):[ot];let Xt=!1;for(let st=0;st<mt.length;st++){const Pt=mt[st];if(!K.horizontal[Pt])if(Xt)K.horizontal[Pt]=K.horizontal[0];else{const Ht=$f(ie,e,i,a,j,ft,ze,"center",Pt,Ne,re,Nr.horizontal,!1,ne,Y);Ht&&(K.horizontal[Pt]=Ht,Xt=Ht.positionedLines.length===1)}}Tt("left")}else{if(ot==="auto"&&(ot=ip(Ve)),De||T.get("text-writing-mode").indexOf("horizontal")>=0||!Hc(Re)){const mt=$f(ie,e,i,a,j,ft,ze,Ve,ot,Ne,re,Nr.horizontal,!1,ne,Y);mt&&(K.horizontal[ot]=mt)}Tt(De?"left":ot)}}let Ae=!1;if(O.icon&&O.icon.name){const Re=r[O.icon.name];Re&&(oe=B1(a[O.icon.name],T.get("icon-offset").evaluate(O,{},m),T.get("icon-anchor").evaluate(O,{},m)),Ae=Re.sdf,t.sdfIcons===void 0?t.sdfIcons=Re.sdf:t.sdfIcons!==Re.sdf&&ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Te=eg(K.horizontal)||K.vertical;t.iconsInText||(t.iconsInText=!!Te&&Te.iconsInText),(Te||oe)&&W1(t,O,K,oe,r,A,ne,0,re,Ae,d,m,x)}c&&t.generateCollisionDebugBuffers(g,t.collisionBoxArray)}function ip(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function W1(t,e,i,r,a,c,d,m,g,x,T,M,A){let P=c.textMaxSize.evaluate(e,{},M);P===void 0&&(P=d);const D=t.layers[0].layout,O=D.get("icon-offset").evaluate(e,{},M),j=eg(i.horizontal)||i.vertical,Y=A.name==="globe",ne=Rn,K=d/ne,ie=t.tilePixelRatio*P/ne,oe=(Ve=t.overscaling,t.zoom>18&&Ve>2&&(Ve>>=1),Math.max(Dt/(512*Ve),1)*D.get("symbol-spacing")),re=D.get("text-padding")*t.tilePixelRatio,Ae=D.get("icon-padding")*t.tilePixelRatio,Te=tt(D.get("text-max-angle")),Re=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",$e=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ze=D.get("symbol-placement"),Ne=oe/2;var Ve;const We=D.get("icon-text-fit");let ot;r&&We!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(ot=V_(r,i.vertical,We,D.get("icon-text-fit-padding"),O,K)),j&&(r=V_(r,j,We,D.get("icon-text-fit-padding"),O,K)));const De=(ft,Tt,mt)=>{if(Tt.x<0||Tt.x>=Dt||Tt.y<0||Tt.y>=Dt)return;let Xt=null;if(Y){const{x:st,y:Pt,z:Ht}=A.projectTilePoint(Tt.x,Tt.y,mt);Xt={anchor:new cs(st,Pt,Ht,0,void 0),up:A.upVector(mt,Tt.x,Tt.y)}}(function(st,Pt,Ht,_i,Yt,Rt,ji,Jt,$t,Li,Ui,Ni,Ri,Ki,ln,_n,Bi,En,gn,en,xi,yn,Vi,sr,xn){const Bn=st.addToLineVertexArray(Pt,_i);let zn,ar,Pn,wo,Kl,Pu,Du,Dg=0,Lg=0,Rg=0,Bg=0,gp=-1,yp=-1;const Ro={};let Og=ff("");const Ua=Ht?Ht.anchor:Pt;let xp=0,vp=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[xp,vp]=$t.layout.get("text-offset").evaluate(xi,{},xn).map(Er=>Er*Rn):(xp=$t.layout.get("text-radial-offset").evaluate(xi,{},xn)*Rn,vp=tp),st.allowVerticalPlacement&&Yt.vertical){const Er=Yt.vertical;if(ln)Pu=np(Er),Jt&&(Du=np(Jt));else{const Mr=$t.layout.get("text-rotate").evaluate(xi,{},xn)+90;Pn=sd(Li,Ua,Pt,Ui,Ni,Ri,Er,Ki,Mr,_n),Jt&&(wo=sd(Li,Ua,Pt,Ui,Ni,Ri,Jt,En,Mr))}}if(Rt){const Er=$t.layout.get("icon-rotate").evaluate(xi,{},xn),Mr=$t.layout.get("icon-text-fit")!=="none",Lu=K_(Rt,Er,Vi,Mr),wp=Jt?K_(Jt,Er,Vi,Mr):void 0;ar=sd(Li,Ua,Pt,Ui,Ni,Ri,Rt,En,Er),Dg=4*Lu.length;const Fg=st.iconSizeData;let Na=null;Fg.kind==="source"?(Na=[xo*$t.layout.get("icon-size").evaluate(xi,{},xn)],Na[0]>Us&&ei(`${st.layerIds[0]}: Value for "icon-size" is >= ${Eu}. Reduce your "icon-size".`)):Fg.kind==="composite"&&(Na=[xo*yn.compositeIconSizes[0].evaluate(xi,{},xn),xo*yn.compositeIconSizes[1].evaluate(xi,{},xn)],(Na[0]>Us||Na[1]>Us)&&ei(`${st.layerIds[0]}: Value for "icon-size" is >= ${Eu}. Reduce your "icon-size".`)),st.addSymbols(st.icon,Lu,Na,en,gn,xi,!1,Ht,Pt,Bn.lineStartIndex,Bn.lineLength,-1,sr,xn),gp=st.icon.placedSymbolArray.length-1,wp&&(Lg=4*wp.length,st.addSymbols(st.icon,wp,Na,en,gn,xi,Nr.vertical,Ht,Pt,Bn.lineStartIndex,Bn.lineLength,-1,sr,xn),yp=st.icon.placedSymbolArray.length-1)}for(const Er in Yt.horizontal){const Mr=Yt.horizontal[Er];zn||(Og=ff(Mr.text),ln?Kl=np(Mr):zn=sd(Li,Ua,Pt,Ui,Ni,Ri,Mr,Ki,$t.layout.get("text-rotate").evaluate(xi,{},xn),_n));const Lu=Mr.positionedLines.length===1;if(Rg+=Q_(st,Ht,Pt,Mr,ji,$t,ln,xi,_n,Bn,Yt.vertical?Nr.horizontal:Nr.horizontalOnly,Lu?Object.keys(Yt.horizontal):[Er],Ro,gp,yn,sr,xn),Lu)break}Yt.vertical&&(Bg+=Q_(st,Ht,Pt,Yt.vertical,ji,$t,ln,xi,_n,Bn,Nr.vertical,["vertical"],Ro,yp,yn,sr,xn));let Zs=-1;const bp=(Er,Mr)=>Er?Math.max(Er,Mr):Mr;Zs=bp(Kl,Zs),Zs=bp(Pu,Zs),Zs=bp(Du,Zs);const vv=Zs>-1?1:0;st.glyphOffsetArray.length>=Vs.MAX_GLYPHS&&ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&st.addToSortKeyRanges(st.symbolInstances.length,xi.sortKey),st.symbolInstances.emplaceBack(Ua.x,Ua.y,Ua.z,Pt.x,Pt.y,Ro.right>=0?Ro.right:-1,Ro.center>=0?Ro.center:-1,Ro.left>=0?Ro.left:-1,Ro.vertical>=0?Ro.vertical:-1,gp,yp,Og,zn!==void 0?zn:st.collisionBoxArray.length,zn!==void 0?zn+1:st.collisionBoxArray.length,Pn!==void 0?Pn:st.collisionBoxArray.length,Pn!==void 0?Pn+1:st.collisionBoxArray.length,ar!==void 0?ar:st.collisionBoxArray.length,ar!==void 0?ar+1:st.collisionBoxArray.length,wo||st.collisionBoxArray.length,wo?wo+1:st.collisionBoxArray.length,Ui,Rg,Bg,Dg,Lg,vv,0,xp,vp,Zs)})(t,Tt,Xt,ft,i,r,a,ot,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,re,Re,g,0,Ae,$e,O,e,c,x,T,M)};if(ze==="line")for(const ft of X_(e.geometry,0,0,Dt,Dt)){const Tt=F1(ft,oe,Te,i.vertical||j,r,ne,ie,t.overscaling,Dt);for(const mt of Tt)j&&X1(t,j.text,Ne,mt)||De(ft,mt,M)}else if(ze==="line-center"){for(const ft of e.geometry)if(ft.length>1){const Tt=O1(ft,Te,i.vertical||j,r,ne,ie);Tt&&De(ft,Tt,M)}}else if(e.type==="Polygon")for(const ft of Gf(e.geometry,0)){const Tt=j1(ft,16);De(ft[0],new cs(Tt.x,Tt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const ft of e.geometry)De(ft,new cs(ft[0].x,ft[0].y,0,0,void 0),M);else if(e.type==="Point")for(const ft of e.geometry)for(const Tt of ft)De([Tt],new cs(Tt.x,Tt.y,0,0,void 0),M)}const Eu=255,Us=Eu*xo;function Q_(t,e,i,r,a,c,d,m,g,x,T,M,A,P,D,O,j){const Y=function(ie,oe,re,Ae,Te,Re,$e,ze){const Ne=[];if(oe.positionedLines.length===0)return Ne;const Ve=Ae.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,We=function(mt){const Xt=mt[0],st=mt[1],Pt=Xt*st;return Pt>0?[Xt,-st]:Pt<0?[-Xt,st]:Xt===0?[st,Xt]:[st,-Xt]}(re);let ot=Math.abs(oe.top-oe.bottom);for(const mt of oe.positionedLines)ot-=mt.lineOffset;const De=oe.positionedLines.length,ft=ot/De;let Tt=oe.top-re[1];for(let mt=0;mt<De;++mt){const Xt=oe.positionedLines[mt];Tt=U1(oe,ft,Tt,mt);for(const st of Xt.positionedGlyphs){if(!st.rect)continue;const Pt=st.rect||{};let Ht=D_+1,_i=!0,Yt=1,Rt=0;if(st.imageName){const Vi=$e[st.imageName];if(!Vi)continue;if(Vi.sdf){ei("SDF images are not supported in formatted text and will be ignored.");continue}_i=!1,Yt=Vi.pixelRatio,Ht=dr/Yt}const ji=(Te||ze)&&st.vertical,Jt=st.metrics.advance*st.scale/2,$t=st.metrics,Li=st.rect;if(Li===null)continue;ze&&oe.verticalizable&&(Rt=st.imageName?Jt-st.metrics.width*st.scale/2:0);const Ui=Te?[st.x+Jt,st.y]:[0,0];let Ni=[0,0],Ri=[0,0],Ki=!1;Te||(ji?(Ri=[st.x+Jt+We[0],st.y+We[1]-Rt],Ki=!0):Ni=[st.x+Jt+re[0],st.y+re[1]-Rt]);const ln=Li.w*st.scale/(Yt*(st.localGlyph?vo:1)),_n=Li.h*st.scale/(Yt*(st.localGlyph?vo:1));let Bi,En,gn,en;if(ji){const Vi=st.y-Tt,sr=new Be(-Jt,Jt-Vi),xn=-Math.PI/2,Bn=new Be(...Ri);Bi=new Be(-Jt+Ni[0],Ni[1]),Bi._rotateAround(xn,sr)._add(Bn),Bi.x+=-Vi+Jt,Bi.y-=($t.left-Ht)*st.scale;const zn=st.imageName?$t.advance*st.scale:Rn*st.scale,ar=String.fromCharCode(st.glyph);v1(ar)?Bi.x+=(1-Ht)*st.scale:b1(ar)?Bi.x+=zn-$t.height*st.scale+(-Ht-1)*st.scale:Bi.x+=st.imageName||$t.width+2*Ht===Li.w&&$t.height+2*Ht===Li.h?(zn-_n)/2:(zn-($t.height+2*Ht)*st.scale)/2,En=new Be(Bi.x,Bi.y-ln),gn=new Be(Bi.x+_n,Bi.y),en=new Be(Bi.x+_n,Bi.y-ln)}else{const Vi=($t.left-Ht)*st.scale-Jt+Ni[0],sr=(-$t.top-Ht)*st.scale+Ni[1],xn=Vi+ln,Bn=sr+_n;Bi=new Be(Vi,sr),En=new Be(xn,sr),gn=new Be(Vi,Bn),en=new Be(xn,Bn)}if(Ve){let Vi;Vi=Te?new Be(0,0):Ki?new Be(We[0],We[1]):new Be(re[0],re[1]),Bi._rotateAround(Ve,Vi),En._rotateAround(Ve,Vi),gn._rotateAround(Ve,Vi),en._rotateAround(Ve,Vi)}const xi=new Be(0,0),yn=new Be(0,0);Ne.push({tl:Bi,tr:En,bl:gn,br:en,tex:Pt,writingMode:oe.writingMode,glyphOffset:Ui,sectionIndex:st.sectionIndex,isSDF:_i,pixelOffsetTL:xi,pixelOffsetBR:yn,minFontScaleX:0,minFontScaleY:0})}}return Ne}(0,r,g,c,d,m,a,t.allowVerticalPlacement),ne=t.textSizeData;let K=null;ne.kind==="source"?(K=[xo*c.layout.get("text-size").evaluate(m,{},j)],K[0]>Us&&ei(`${t.layerIds[0]}: Value for "text-size" is >= ${Eu}. Reduce your "text-size".`)):ne.kind==="composite"&&(K=[xo*D.compositeTextSizes[0].evaluate(m,{},j),xo*D.compositeTextSizes[1].evaluate(m,{},j)],(K[0]>Us||K[1]>Us)&&ei(`${t.layerIds[0]}: Value for "text-size" is >= ${Eu}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,K,g,d,m,T,e,i,x.lineStartIndex,x.lineLength,P,O,j);for(const ie of M)A[ie]=t.text.placedSymbolArray.length-1;return 4*Y.length}function eg(t){for(const e in t)return t[e];return null}function sd(t,e,i,r,a,c,d,m,g,x){let T=d.top,M=d.bottom,A=d.left,P=d.right;const D=d.collisionPadding;if(D&&(A-=D[0],T-=D[1],P+=D[2],M+=D[3]),g){const O=new Be(A,T),j=new Be(P,T),Y=new Be(A,M),ne=new Be(P,M),K=tt(g);let ie=new Be(0,0);x&&(ie=new Be(x[0],x[1])),O._rotateAround(K,ie),j._rotateAround(K,ie),Y._rotateAround(K,ie),ne._rotateAround(K,ie),A=Math.min(O.x,j.x,Y.x,ne.x),P=Math.max(O.x,j.x,Y.x,ne.x),T=Math.min(O.y,j.y,Y.y,ne.y),M=Math.max(O.y,j.y,Y.y,ne.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,A,T,P,M,m,r,a,c),t.length-1}function np(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function X1(t,e,i,r){const a=t.compareText;if(e in a){const c=a[e];for(let d=c.length-1;d>=0;d--)if(r.dist(c[d])<i)return!0}else a[e]=[];return a[e].push(r),!1}function tg(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),c=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),d=Math.sin(t._pitch)*c+a;return Math.min(1.01*d,a*(1/t._horizonShift))}function Oa(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,a=(t.x+1)*i,c=t.y*i,d=(t.y+1)*i,m=Ur(r),g=Ur(a),x=Gn(c),T=Gn(d),M=e.project(m,x),A=e.project(g,x),P=e.project(g,T),D=e.project(m,T);let O=Math.min(M.x,A.x,P.x,D.x),j=Math.min(M.y,A.y,P.y,D.y),Y=Math.max(M.x,A.x,P.x,D.x),ne=Math.max(M.y,A.y,P.y,D.y);const K=i/16;function ie(re,Ae,Te,Re,$e,ze){const Ne=(Te+$e)/2,Ve=(Re+ze)/2,We=e.project(Ur(Ne),Gn(Ve)),ot=Math.max(0,O-We.x,j-We.y,We.x-Y,We.y-ne);O=Math.min(O,We.x),Y=Math.max(Y,We.x),j=Math.min(j,We.y),ne=Math.max(ne,We.y),ot>K&&(ie(re,We,Te,Re,Ne,Ve),ie(We,Ae,Ne,Ve,$e,ze))}ie(M,A,r,c,a,c),ie(A,P,a,c,a,d),ie(P,D,a,d,r,d),ie(D,M,r,d,r,c),O-=K,j-=K,Y+=K,ne+=K;const oe=1/Math.max(Y-O,ne-j);return{scale:oe,x:O*oe,y:j*oe,x2:Y*oe,y2:ne*oe,projection:e}}const H1=_o(new Float32Array(16));class Ns{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Di(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return yo(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return tg(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,a){const c=e.horizonLineFromTop(!1),d=new Be(i,Math.max(c,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,i,r){const a=new Be(i,r);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return H1}createTileMatrix(e,i,r){let a,c,d;const m=r.canonical,g=_o(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Oa(m,this);a=1,c=x.x+r.wrap*x.scale,d=x.y,ka(g,g,[a/x.scale,a/x.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(m.z),c=(m.x+Math.pow(2,m.z)*r.wrap)*a,d=m.y*a;return tu(g,g,[c,d,0]),ka(g,g,[a/Dt,a/Dt,1]),g}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class Y1 extends Ns{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(tt(i));this.n=(a+Math.sin(tt(r)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:a,r0:c}=this,d=tt(e-this.center[0]),m=tt(i),g=Math.sqrt(a-2*r*Math.sin(m))/r;return{x:g*Math.sin(d*r),y:g*Math.cos(d*r)-c,z:0}}unproject(e,i){const{n:r,c:a,r0:c}=this,d=c+i;let m=Math.atan2(e,Math.abs(d))*Math.sign(d);d*r<0&&(m-=Math.PI*Math.sign(e)*Math.sign(d));const g=tt(this.center[0])*r;m=gt(m,-Math.PI-g,Math.PI-g);const x=je(St(m/r)+this.center[0],-180,180),T=Math.asin(je((a-(e*e+d*d)*r*r)/(2*r),-1,1)),M=je(St(T),-qn,qn);return new Di(x,M)}}const Mu=1.340264,Su=-.081106,Au=893e-6,Cu=.003796,ad=Math.sqrt(3)/2;class K1 extends Ns{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(ad*Math.sin(i)),a=r*r,c=a*a*a;return{x:.5*(e*Math.cos(r)/(ad*(Mu+3*Su*a+c*(7*Au+9*Cu*a)))/Math.PI+.5),y:1-.5*(r*(Mu+Su*a+c*(Au+Cu*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=r*r,c=a*a*a;for(let T,M,A,P=0;P<12&&(M=r*(Mu+Su*a+c*(Au+Cu*a))-i,A=Mu+3*Su*a+c*(7*Au+9*Cu*a),T=M/A,r=je(r-T,-Math.PI/3,Math.PI/3),a=r*r,c=a*a*a,!(Math.abs(T)<1e-12));++P);const d=ad*e*(Mu+3*Su*a+c*(7*Au+9*Cu*a))/Math.cos(r),m=Math.asin(Math.sin(r)/ad),g=je(180*d/Math.PI,-180,180),x=je(180*m/Math.PI,-qn,qn);return new Di(g,x)}}class J1 extends Ns{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),a=je(360*(.5-i),-qn,qn);return new Di(r,a)}}const Hl=Math.PI/2;function ld(t){return Math.tan((Hl+t)/2)}class $1 extends Ns{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let a=tt(i),c=tt(r);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const d=Math.cos(a),m=ld(a);this.n=a===c?Math.sin(a):Math.log(d/Math.cos(c))/Math.log(ld(c)/m),this.f=d*Math.pow(ld(a),this.n)/this.n}project(e,i){i=tt(i),this.southernCenter&&(i=-i),e=tt(e-this.center[0]);const r=1e-6,{n:a,f:c}=this;c>0?i<-Hl+r&&(i=-Hl+r):i>Hl-r&&(i=Hl-r);const d=c/Math.pow(ld(i),a);let m=d*Math.sin(a*e),g=c-d*Math.cos(a*e);return m=.5*(m/Math.PI+.5),g=.5*(g/Math.PI+.5),{x:m,y:this.southernCenter?g:1-g,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:a}=this,c=a-i,d=Math.sign(c),m=Math.sign(r)*Math.sqrt(e*e+c*c);let g=Math.atan2(e,Math.abs(c))*d;c*r<0&&(g-=Math.PI*Math.sign(e)*d);const x=je(St(g/r)+this.center[0],-180,180),T=je(St(2*Math.atan(Math.pow(a/m,1/r))-Hl),-qn,qn);return new Di(x,this.southernCenter?-T:T)}}class ig extends Ns{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ko(e),y:zo(i),z:0}}unproject(e,i){const r=Ur(e),a=Gn(i);return new Di(r,a)}}const ng=tt(qn);class Q1 extends Ns{project(e,i){const r=(i=tt(i))*i,a=r*r;return{x:.5*((e=tt(e))*(.8707-.131979*r+a*(a*(.003971*r-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+a*(.028874*r-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=25,c=0,d=r*r;do{d=r*r;const x=d*d;c=(r*(1.007226+d*(.015085+x*(.028874*d-.044475-.005916*x)))-i)/(1.007226+d*(.045255+x*(.259866*d-.311325-.005916*11*x))),r=je(r-c,-ng,ng)}while(Math.abs(c)>1e-6&&--a>0);d=r*r;const m=je(St(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),g=St(r);return new Di(m,g)}}const rg=tt(qn);class ev extends Ns{project(e,i){i=tt(i),e=tt(e);const r=Math.cos(i),a=2/Math.PI,c=Math.acos(r*Math.cos(e/2)),d=Math.sin(c)/c,m=.5*(e*a+2*r*Math.sin(e/2)/d)||0,g=.5*(i+Math.sin(i)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,c=25;const d=1e-6;let m=0,g=0;do{const x=Math.cos(a),T=Math.sin(a),M=2*T*x,A=T*T,P=x*x,D=Math.cos(r/2),O=Math.sin(r/2),j=2*D*O,Y=O*O,ne=1-P*D*D,K=ne?1/ne:0,ie=ne?Math.acos(x*D)*Math.sqrt(1/ne):0,oe=.5*(2*ie*x*O+2*r/Math.PI)-e,re=.5*(ie*T+a)-i,Ae=.5*K*(P*Y+ie*x*D*A)+1/Math.PI,Te=K*(j*M/4-ie*T*O),Re=.125*K*(M*O-ie*T*P*j),$e=.5*K*(A*D+ie*Y*x)+.5,ze=Te*Re-$e*Ae;m=(re*Te-oe*$e)/ze,g=(oe*Re-re*Ae)/ze,r=je(r-m,-Math.PI,Math.PI),a=je(a-g,-rg,rg)}while((Math.abs(m)>d||Math.abs(g)>d)&&--c>0);return new Di(St(r),St(a))}}class og extends Ns{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:a}=this;return{x:tt(e)*a*r+.5,y:-Math.sin(tt(i))/a*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:a}=this,c=-(i-.5)/r,d=je(St((e-.5)/r)/a,-180,180),m=Math.asin(je(c*a,-1,1)),g=je(St(m),-qn,qn);return new Di(d,g)}}class tv extends ig{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const a=cu(e,i,r);return hn(a,a,uu(Io(r))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const r=Dl(i.lat,i.lng),a=nr([],r),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ou(r,r,a,yo(1,0)*Dt*c);const d=_o(new Float64Array(16));return Ia(d,e.pixelMatrix,e.globeMatrix),hn(r,r,d),new Be(r[0],r[1])}pixelsPerMeter(e,i){return yo(1,0)*i}pixelSpaceConversion(e,i,r){const a=yo(1,e)*i,c=di(yo(1,45)*i,a,r);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,r){const a=Af(Io(r.canonical));return Ia(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:r}=e,a=uu(Io(i));return Bh(a,a,tt(r.lng)),gf(a,a,tt(r.lat)),ka(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,r,a){return Pm(e,i,r,!0)||new Rl(0,0)}pointCoordinate3D(e,i,r){const a=this.pointCoordinate(e,i,r,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Pm(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,c){const d=a.cameraToCenterDistance,m=a._centerAltitude*c,g=a._camera,x=a._camera.forward(),T=os([],Fr([],x,-d),[0,0,m]),M=a.worldSize/(2*Math.PI),A=[0,0,-M],P=a.width/a.height,D=Math.tan(a.fovAboveCenter),O=Fr([],g.up(),D),j=Fr([],g.right(),D*P),Y=nr([],os([],os([],x,O),j)),ne=[];let K;if(new bf(T,Y).closestPointOnSphere(A,M,ne)){const ie=os([],ne,A),oe=go([],ie,T);K=Math.cos(a.fovAboveCenter)*iu(oe)}else{const ie=go([],T,A),oe=go([],A,T);nr(oe,oe);const re=iu(ie)-M;K=Math.sqrt(re*(re+2*M));const Ae=Math.acos(K/(M+re))-Math.acos(Kr(x,oe));K*=Math.cos(Ae)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ll(e.zoom);if(r>0){const a=tg(e,yo(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return di(i,a+c*(1-Math.cos(d)),Math.pow(r,10))}return i}upVector(e,i,r){return cu(i,r,e,1)}upVectorScale(e){return{metersToTile:Oh(Uh(Io(e)))}}}function sg(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new ig(t);case"equirectangular":return new J1(t);case"naturalEarth":return new Q1(t);case"equalEarth":return new K1(t);case"winkelTripel":return new ev(t);case"albers":return i?new og(t):new Y1(t);case"lambertConformalConic":return i?new og(t):new $1(t);case"globe":return new tv(t)}throw new Error(`Invalid projection name: ${t.name}`)}const iv=Yh.types,nv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cd(t,e,i,r,a,c,d,m,g,x,T,M,A){const P=m?Math.min(Us,Math.round(m[0])):0,D=m?Math.min(Us,Math.round(m[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*a),c,d,(P<<1)+(g?1:0),D,16*x,16*T,256*M,256*A)}function ud(t,e,i,r,a,c,d){t.emplaceBack(e,i,r,a,c,d)}function hd(t,e,i,r,a){t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a)}function rv(t){for(const e of t.sections)if(df(e.text))return!0;return!1}class rp{constructor(e){this.layoutVertexArray=new Ge,this.indexArray=new Ct,this.programConfigurations=e,this.segments=new pn,this.dynamicLayoutVertexArray=new Ye,this.opacityVertexArray=new It,this.placedSymbolArray=new fn,this.globeExtVertexArray=new it}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,p1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nv,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,f1.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}bt(rp,"SymbolBuffers");class op{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new pn,this.collisionVertexArray=new li,this.collisionVertexArrayExt=new si}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,m1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bt(op,"CollisionBuffers");class Vs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_o([]),this.placementViewportMatrix=_o([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xf(this.zoom,i["text-size"]),this.iconSizeData=Xf(this.zoom,i["icon-size"]);const r=this.layers[0].layout,a=r.get("symbol-sort-key"),c=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(d=>Nr[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new rp(new Ca(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rp(new Ca(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ir,this.lineVertexArray=new Cl,this.symbolInstances=new qi}calculateGlyphDependencies(e,i,r,a,c){for(let d=0;d<e.length;d++)if(i[e.charCodeAt(d)]=!0,a&&c){const m=bu[e.charAt(d)];m&&(i[m.charCodeAt(0)]=!0)}}populate(e,i,r,a){const c=this.layers[0],d=c.layout,m=this.projection.name==="globe",g=d.get("text-font"),x=d.get("text-field"),T=d.get("icon-image"),M=(x.value.kind!=="constant"||x.value.value instanceof tr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),A=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,P=d.get("symbol-sort-key");if(this.features=[],!M&&!A)return;const D=i.iconDependencies,O=i.glyphDependencies,j=i.availableImages,Y=new E(this.zoom);for(const{feature:ne,id:K,index:ie,sourceLayerIndex:oe}of e){const re=c._featureFilter.needGeometry,Ae=La(ne,re);if(!c._featureFilter.filter(Y,Ae,r))continue;if(re||(Ae.geometry=ss(ne,r,a)),m&&ne.type!==1&&r.z<=5){const ze=Ae.geometry,Ne=.98078528056,Ve=(We,ot)=>Kr(cu(We.x,We.y,r,1),cu(ot.x,ot.y,r,1))<Ne;for(let We=0;We<ze.length;We++)ze[We]=px(ze[We],Ve)}let Te,Re;if(M){const ze=c.getValueAndResolveTokens("text-field",Ae,r,j),Ne=tr.factory(ze);rv(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||_()==="unavailable"||this.hasRTLText&&b.isParsed())&&(Te=x1(Ne,c,Ae))}if(A){const ze=c.getValueAndResolveTokens("icon-image",Ae,r,j);Re=ze instanceof yr?ze:yr.fromString(ze)}if(!Te&&!Re)continue;const $e=this.sortFeaturesByKey?P.evaluate(Ae,{},r):void 0;if(this.features.push({id:K,text:Te,icon:Re,index:ie,sourceLayerIndex:oe,geometry:Ae.geometry,properties:ne.properties,type:iv[ne.type],sortKey:$e}),Re&&(D[Re.name]=!0),Te){const ze=g.evaluate(Ae,{},r).join(","),Ne=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(const Ve of Te.sections)if(Ve.image)D[Ve.image.name]=!0;else{const We=Hc(Te.toString()),ot=Ve.fontStack||ze,De=O[ot]=O[ot]||{};this.calculateGlyphDependencies(Ve.text,De,Ne,this.allowVerticalPlacement,We)}}}d.get("symbol-placement")==="line"&&(this.features=function(ne){const K={},ie={},oe=[];let re=0;function Ae(ze){oe.push(ne[ze]),re++}function Te(ze,Ne,Ve){const We=ie[ze];return delete ie[ze],ie[Ne]=We,oe[We].geometry[0].pop(),oe[We].geometry[0]=oe[We].geometry[0].concat(Ve[0]),We}function Re(ze,Ne,Ve){const We=K[Ne];return delete K[Ne],K[ze]=We,oe[We].geometry[0].shift(),oe[We].geometry[0]=Ve[0].concat(oe[We].geometry[0]),We}function $e(ze,Ne,Ve){const We=Ve?Ne[0][Ne[0].length-1]:Ne[0][0];return`${ze}:${We.x}:${We.y}`}for(let ze=0;ze<ne.length;ze++){const Ne=ne[ze],Ve=Ne.geometry,We=Ne.text?Ne.text.toString():null;if(!We){Ae(ze);continue}const ot=$e(We,Ve),De=$e(We,Ve,!0);if(ot in ie&&De in K&&ie[ot]!==K[De]){const ft=Re(ot,De,Ve),Tt=Te(ot,De,oe[ft].geometry);delete K[ot],delete ie[De],ie[$e(We,oe[Tt].geometry,!0)]=Tt,oe[ft].geometry=null}else ot in ie?Te(ot,De,Ve):De in K?Re(ot,De,Ve):(Ae(ze),K[ot]=re-1,ie[De]=re-1)}return oe.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,K)=>ne.sortKey-K.sortKey)}update(e,i,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:c}of i)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,a,c,d,m,g,x,T,M,A,P,D){const O=e.indexArray,j=e.layoutVertexArray,Y=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*i.length,j,O,this.canOverlap?d.sortKey:void 0),K=this.glyphOffsetArray.length,ie=ne.vertexLength,oe=this.allowVerticalPlacement&&m===Nr.vertical?Math.PI/2:0,re=d.text&&d.text.sections;for(let Te=0;Te<i.length;Te++){const{tl:Re,tr:$e,bl:ze,br:Ne,tex:Ve,pixelOffsetTL:We,pixelOffsetBR:ot,minFontScaleX:De,minFontScaleY:ft,glyphOffset:Tt,isSDF:mt,sectionIndex:Xt}=i[Te],st=ne.vertexLength,Pt=Tt[1];if(cd(j,x.x,x.y,Re.x,Pt+Re.y,Ve.x,Ve.y,r,mt,We.x,We.y,De,ft),cd(j,x.x,x.y,$e.x,Pt+$e.y,Ve.x+Ve.w,Ve.y,r,mt,ot.x,We.y,De,ft),cd(j,x.x,x.y,ze.x,Pt+ze.y,Ve.x,Ve.y+Ve.h,r,mt,We.x,ot.y,De,ft),cd(j,x.x,x.y,Ne.x,Pt+Ne.y,Ve.x+Ve.w,Ve.y+Ve.h,r,mt,ot.x,ot.y,De,ft),g){const{x:Ht,y:_i,z:Yt}=g.anchor,[Rt,ji,Jt]=g.up;ud(Y,Ht,_i,Yt,Rt,ji,Jt),ud(Y,Ht,_i,Yt,Rt,ji,Jt),ud(Y,Ht,_i,Yt,Rt,ji,Jt),ud(Y,Ht,_i,Yt,Rt,ji,Jt),hd(e.dynamicLayoutVertexArray,Ht,_i,Yt,oe)}else hd(e.dynamicLayoutVertexArray,x.x,x.y,x.z,oe);O.emplaceBack(st,st+1,st+2),O.emplaceBack(st+1,st+2,st+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Te!==i.length-1&&Xt===i[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,d,d.index,{},P,D,re&&re[Xt])}const Ae=g?g.anchor:x;e.placedSymbolArray.emplaceBack(Ae.x,Ae.y,Ae.z,x.x,x.y,K,this.glyphOffsetArray.length-K,ie,T,M,x.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],m,0,!1,0,A,0)}_commitLayoutVertex(e,i,r,a,c,d,m){e.emplaceBack(i,r,a,c,d,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,i,r,a,c,d,m){const g=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),x=g.vertexLength,T=m.tileAnchorX,M=m.tileAnchorY;for(let P=0;P<4;P++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,a,c,d,T,M,new Be(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,c,d,T,M,new Be(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,c,d,T,M,new Be(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,a,c,d,T,M,new Be(e.x1,e.y2)),g.vertexLength+=4;const A=r.indexArray;A.emplaceBack(x,x+1),A.emplaceBack(x+1,x+2),A.emplaceBack(x+2,x+3),A.emplaceBack(x+3,x),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,a,c,d){for(let m=a;m<c;m++){const g=r.get(m),x=this.getSymbolInstanceTextSize(e,d,i,m);this._addCollisionDebugVertices(g,x,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,r,a,c,d){for(let m=a;m<c;m++){const g=r.get(m),x=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(g,x,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new op(wt,M_.members,kn),this.iconCollisionBox=new op(wt,M_.members,kn);const r=Nl(this.iconSizeData,e),a=Nl(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,i,r,a){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),d=Qh(this.textSizeData,e,c)/Rn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,r){const a=this.icon.placedSymbolArray.get(r),c=Qh(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,a,c,d){for(let m=a;m<c;m++){const g=r.get(m),x=this.getSymbolInstanceTextSize(e,d,i,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,g.padding)}}_updateIconDebugCollisionBoxes(e,i,r,a,c,d){for(let m=a;m<c;m++){const g=r.get(m),x=this.getSymbolInstanceIconSize(e,i,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,g.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Nl(this.iconSizeData,e),a=Nl(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(r,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,a,c,d,m,g,x){const T={};if(i<r){const{x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie,featureIndex:oe}=e.get(i);T.textBox={x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie},T.textFeatureIndex=oe}if(a<c){const{x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie,featureIndex:oe}=e.get(a);T.verticalTextBox={x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie},T.verticalTextFeatureIndex=oe}if(d<m){const{x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie,featureIndex:oe}=e.get(d);T.iconBox={x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie},T.iconFeatureIndex=oe}if(g<x){const{x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie,featureIndex:oe}=e.get(g);T.verticalIconBox={x1:M,y1:A,x2:P,y2:D,padding:O,projectedAnchorX:j,projectedAnchorY:Y,projectedAnchorZ:ne,tileAnchorX:K,tileAnchorY:ie},T.verticalIconFeatureIndex=oe}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),a=r.vertexStartIndex+4*r.numGlyphs;for(let c=r.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),a=[],c=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const g=this.symbolInstances.get(m);a.push(0|Math.round(i*g.tileAnchorX+r*g.tileAnchorY)),c.push(g.featureIndex)}return d.sort((m,g)=>a[m]-a[g]||c[g]-c[m]),d}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:g,verticalPlacedIconSymbolIndex:x}=r;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bt(Vs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vs.MAX_GLYPHS=65535,Vs.addDynamicAttributes=hd;const ov=new $({"symbol-placement":new B(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new B(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new B(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new G(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new B(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new B(Le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new B(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new B(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new B(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new G(Le.layout_symbol["icon-size"]),"icon-text-fit":new B(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new B(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new G(Le.layout_symbol["icon-image"]),"icon-rotate":new G(Le.layout_symbol["icon-rotate"]),"icon-padding":new B(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new B(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new G(Le.layout_symbol["icon-offset"]),"icon-anchor":new G(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new B(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new B(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new B(Le.layout_symbol["text-rotation-alignment"]),"text-field":new G(Le.layout_symbol["text-field"]),"text-font":new G(Le.layout_symbol["text-font"]),"text-size":new G(Le.layout_symbol["text-size"]),"text-max-width":new G(Le.layout_symbol["text-max-width"]),"text-line-height":new G(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new G(Le.layout_symbol["text-letter-spacing"]),"text-justify":new G(Le.layout_symbol["text-justify"]),"text-radial-offset":new G(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new B(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new G(Le.layout_symbol["text-anchor"]),"text-max-angle":new B(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new B(Le.layout_symbol["text-writing-mode"]),"text-rotate":new G(Le.layout_symbol["text-rotate"]),"text-padding":new B(Le.layout_symbol["text-padding"]),"text-keep-upright":new B(Le.layout_symbol["text-keep-upright"]),"text-transform":new G(Le.layout_symbol["text-transform"]),"text-offset":new G(Le.layout_symbol["text-offset"]),"text-allow-overlap":new B(Le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new B(Le.layout_symbol["text-ignore-placement"]),"text-optional":new B(Le.layout_symbol["text-optional"])});var sp={paint:new $({"icon-opacity":new G(Le.paint_symbol["icon-opacity"]),"icon-color":new G(Le.paint_symbol["icon-color"]),"icon-halo-color":new G(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new G(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new G(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new B(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new B(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new G(Le.paint_symbol["text-opacity"]),"text-color":new G(Le.paint_symbol["text-color"],{runtimeType:Yn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new G(Le.paint_symbol["text-halo-color"]),"text-halo-width":new G(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new G(Le.paint_symbol["text-halo-blur"]),"text-translate":new B(Le.paint_symbol["text-translate"]),"text-translate-anchor":new B(Le.paint_symbol["text-translate-anchor"])}),layout:ov};class ag{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Eo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt(ag,"FormatSectionOverride",{omit:["defaultValue"]});class dd extends mo{constructor(e){super(e,sp)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const a=[];for(const c of r)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,a){const c=this.layout.get(e).evaluate(i,{},r,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Is(d.value)||!c?c:function(m,g){return g.replace(/{([^{}]+)}/g,(x,T)=>T in m?String(m[T]):"")}(i.properties,c)}createBucket(e){return new Vs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of sp.paint.overridableProperties){if(!dd.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new ag(i),a=new vl(r,i.property.specification);let c=null;c=i.value.kind==="constant"||i.value.kind==="source"?new Oc("source",a):new xa("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Z(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&dd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),a=sp.paint.properties[i];let c=!1;const d=m=>{for(const g of m)if(a.overrides&&a.overrides.hasOverride(g))return void(c=!0)};if(r.value.kind==="constant"&&r.value.value instanceof tr)d(r.value.value.sections);else if(r.value.kind==="source"){const m=x=>{c||(x instanceof Ho&&an(x.value)===Kn?d(x.value.sections):x instanceof Mo?d(x.sections):x.eachChild(m))},g=r.value;g._styleExpression&&m(g._styleExpression.expression)}return c}getProgramConfiguration(e){return new Bs(this,e)}}var sv={paint:new $({"background-color":new B(Le.paint_background["background-color"]),"background-pattern":new B(Le.paint_background["background-pattern"]),"background-opacity":new B(Le.paint_background["background-opacity"])})},av={paint:new $({"raster-opacity":new B(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new B(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new B(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new B(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new B(Le.paint_raster["raster-saturation"]),"raster-contrast":new B(Le.paint_raster["raster-contrast"]),"raster-resampling":new B(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new B(Le.paint_raster["raster-fade-duration"])})};class lv extends mo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var cv={paint:new $({"sky-type":new B(Le.paint_sky["sky-type"]),"sky-atmosphere-sun":new B(Le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new B(Le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new B(Le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new B(Le.paint_sky["sky-gradient-radius"]),"sky-gradient":new J(Le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new B(Le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new B(Le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new B(Le.paint_sky["sky-opacity"])})};function ap(t,e,i){const r=[0,0,1],a=Sm([]);return Cm(a,a,i?-tt(t)+Math.PI:tt(t)),Am(a,a,-tt(e)),wm(r,r,a),nr(r,r)}const uv={circle:class extends mo{constructor(t){super(t,bx)}createBucket(t){return new Df(t)}queryRadius(t){const e=t;return Bl("circle-radius",this,e)+Bl("circle-stroke-width",this,e)+jh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,a,c,d,m){const g=Km(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Jm(t,r,c,d,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",g,x)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Bs(this,t)}},heatmap:class extends mo{createBucket(t){return new Qm(t)}constructor(t){super(t,Mx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Of({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Bl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,a,c,d,m){const g=this.paint.get("heatmap-radius").evaluate(e,i);return Jm(t,r,c,d,m,!0,!0,new Be(0,0),g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Bs(this,t)}},hillshade:class extends mo{constructor(t){super(t,Sx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends mo{constructor(t){super(t,jx)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Bs(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Xh(t)}queryRadius(){return jh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,a,c){return!t.queryGeometry.isAboveHorizon&&Zm(Ym(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends mo{constructor(t){super(t,r1)}createBucket(t){return new yu(t)}queryRadius(){return jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Bs(this,t)}queryIntersectsFeature(t,e,i,r,a,c,d,m,g){const x=Km(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,i),M=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],P=m&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,O=t.tile.getBucket(this);if(P&&O instanceof yu){const ie=O.centroidVertexArray,oe=g+1;oe<ie.length&&(A[0]=ie.geta_centroid_pos0(oe),A[1]=ie.geta_centroid_pos1(oe))}if(A[0]===0&&A[1]===1)return!1;c.projection.name==="globe"&&(r=g_([r],[new Be(0,0),new Be(Dt,Dt)],t.tileID.canonical).map(ie=>ie.polygon).flat());const j=P?m:null,[Y,ne]=function(ie,oe,re,Ae,Te,Re,$e,ze,Ne,Ve,We){return ie.projection.name==="globe"?function(ot,De,ft,Tt,mt,Xt,st,Pt,Ht,_i,Yt){const Rt=[],ji=[],Jt=ot.projection.upVectorScale(Yt,ot.center.lat,ot.worldSize).metersToTile,$t=[0,0,0,1],Li=[0,0,0,1],Ui=(Ri,Ki,ln,_n)=>{Ri[0]=Ki,Ri[1]=ln,Ri[2]=_n,Ri[3]=1},Ni=__();ft>0&&(ft+=Ni),Tt+=Ni;for(const Ri of De){const Ki=[],ln=[];for(const _n of Ri){const Bi=_n.x+mt.x,En=_n.y+mt.y,gn=ot.projection.projectTilePoint(Bi,En,Yt),en=ot.projection.upVector(Yt,_n.x,_n.y);let xi=ft,yn=Tt;if(st){const Vi=b_(Bi,En,ft,Tt,st,Pt,Ht,_i);xi+=Vi.base,yn+=Vi.top}ft!==0?Ui($t,gn.x+en[0]*Jt*xi,gn.y+en[1]*Jt*xi,gn.z+en[2]*Jt*xi):Ui($t,gn.x,gn.y,gn.z),Ui(Li,gn.x+en[0]*Jt*yn,gn.y+en[1]*Jt*yn,gn.z+en[2]*Jt*yn),hn($t,$t,Xt),hn(Li,Li,Xt),Ki.push(new Ul($t[0],$t[1],$t[2])),ln.push(new Ul(Li[0],Li[1],Li[2]))}Rt.push(Ki),ji.push(ln)}return[Rt,ji]}(ie,oe,re,Ae,Te,Re,$e,ze,Ne,Ve,We):$e?function(ot,De,ft,Tt,mt,Xt,st,Pt,Ht){const _i=[],Yt=[],Rt=[0,0,0,1];for(const ji of ot){const Jt=[],$t=[];for(const Li of ji){const Ui=Li.x+Tt.x,Ni=Li.y+Tt.y,Ri=b_(Ui,Ni,De,ft,Xt,st,Pt,Ht);Rt[0]=Ui,Rt[1]=Ni,Rt[2]=Ri.base,Rt[3]=1,za(Rt,Rt,mt),Rt[3]=Math.max(Rt[3],1e-5);const Ki=new Ul(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Rt[0]=Ui,Rt[1]=Ni,Rt[2]=Ri.top,Rt[3]=1,za(Rt,Rt,mt),Rt[3]=Math.max(Rt[3],1e-5);const ln=new Ul(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Jt.push(Ki),$t.push(ln)}_i.push(Jt),Yt.push($t)}return[_i,Yt]}(oe,re,Ae,Te,Re,$e,ze,Ne,Ve):function(ot,De,ft,Tt,mt){const Xt=[],st=[],Pt=mt[8]*De,Ht=mt[9]*De,_i=mt[10]*De,Yt=mt[11]*De,Rt=mt[8]*ft,ji=mt[9]*ft,Jt=mt[10]*ft,$t=mt[11]*ft;for(const Li of ot){const Ui=[],Ni=[];for(const Ri of Li){const Ki=Ri.x+Tt.x,ln=Ri.y+Tt.y,_n=mt[0]*Ki+mt[4]*ln+mt[12],Bi=mt[1]*Ki+mt[5]*ln+mt[13],En=mt[2]*Ki+mt[6]*ln+mt[14],gn=mt[3]*Ki+mt[7]*ln+mt[15],en=_n+Pt,xi=Bi+Ht,yn=En+_i,Vi=Math.max(gn+Yt,1e-5),sr=_n+Rt,xn=Bi+ji,Bn=En+Jt,zn=Math.max(gn+$t,1e-5);Ui.push(new Ul(en/Vi,xi/Vi,yn/Vi)),Ni.push(new Ul(sr/zn,xn/zn,Bn/zn))}Xt.push(Ui),st.push(Ni)}return[Xt,st]}(oe,re,Ae,Te,Re)}(c,r,M,T,x,d,j,A,D,c.center.lat,t.tileID.canonical),K=t.queryGeometry;return function(ie,oe,re){let Ae=1/0;Zm(re,oe)&&(Ae=v_(re,oe[0]));for(let Te=0;Te<oe.length;Te++){const Re=oe[Te],$e=ie[Te];for(let ze=0;ze<Re.length-1;ze++){const Ne=Re[ze],Ve=[Ne,Re[ze+1],$e[ze+1],$e[ze],Ne];qm(re,Ve)&&(Ae=Math.min(Ae,v_(re,Ve)))}}return Ae!==1/0&&Ae}(Y,ne,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends mo{constructor(t){super(t,w_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ec,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=T_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $h(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Bs(this,t)}queryRadius(t){const e=t,i=E_(Bl("line-width",this,e),Bl("line-gap-width",this,e)),r=Bl("line-offset",this,e);return i/2+Math.abs(r)+jh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,a,c){if(t.queryGeometry.isAboveHorizon)return!1;const d=Ym(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*E_(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),g=this.paint.get("line-offset").evaluate(e,i);return g&&(r=function(x,T){const M=[],A=new Be(0,0);for(let P=0;P<x.length;P++){const D=x[P],O=[];for(let j=0;j<D.length;j++){const Y=D[j],ne=D[j+1],K=j===0?A:Y.sub(D[j-1])._unit()._perp(),ie=j===D.length-1?A:ne.sub(Y)._unit()._perp(),oe=K._add(ie)._unit();oe._mult(1/(oe.x*ie.x+oe.y*ie.y)),O.push(oe._mult(T)._add(Y))}M.push(O)}return M}(r,g*t.pixelToTileUnitsFactor)),function(x,T,M){for(let A=0;A<T.length;A++){const P=T[A];if(x.length>=3){for(let D=0;D<P.length;D++)if(Ra(x,P[D]))return!0}if(gx(x,P,M))return!0}return!1}(d,r,m)}isTileClipped(){return!0}},symbol:dd,background:class extends mo{constructor(t){super(t,sv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends mo{constructor(t){super(t,av)}getProgramIds(){return["raster"]}},sky:class extends mo{constructor(t){super(t,cv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Of({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),a=!r,c=t.style.light,d=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?ap(d.azimuthal,90-d.polar,e):ap(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return ap(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Iu{constructor(e,i,r,a){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,r){const{width:a,height:c}=e,{context:d}=this,{gl:m}=d,{HTMLImageElement:g,HTMLCanvasElement:x,HTMLVideoElement:T,ImageData:M,ImageBitmap:A}=L;if(m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===a&&this.size[1]===c){const{x:P,y:D}=r||{x:0,y:0};e instanceof g||e instanceof x||e instanceof T||e instanceof M||A&&e instanceof A?m.texSubImage2D(m.TEXTURE_2D,0,P,D,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,P,D,a,c,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[a,c],e instanceof g||e instanceof x||e instanceof T||e instanceof M||A&&e instanceof A?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,a,c,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hv{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class dv{constructor(){this.tasks={},this.taskQueue=[],xt(["process"],this),this.invoker=new hv(this.process),this.nextId=0}add(e,i){const r=this.nextId++,a=function({type:c,isSymbolTile:d,zoom:m}){return m=m||0,c==="message"?0:c!=="maybePrepare"||d?c!=="parseTile"||d?c==="parseTile"&&d?300-m:c==="maybePrepare"&&d?400-m:500:200-m:100-m}(i);if(a===0){$i();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:a,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){$i();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<i&&(i=c.priority,e=a)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class lg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const fv=["tile","layer","source","sourceLayer","state"];class cg{constructor(e,i,r,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=a,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of fv)this[i]!==void 0&&(e[i]=this[i]);return e}}const Qr=32,Po=33,js=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,a=0,c=0,d=0,m=0;for(1&e?a=c=d=Qr:i=r=m=Qr;(e>>=1)>1;){const x=i+a>>1,T=r+c>>1;1&e?(a=i,c=r,i=d,r=m):(i=a,r=c,a=d,c=m),d=x,m=T}const g=4*t;js[g+0]=i,js[g+1]=r,js[g+2]=a,js[g+3]=c}const Do=new Uint16Array(2178),Gs=new Uint8Array(1089),fd=new Uint16Array(1089);function ug(t){return t===0?-.03125:t===32?.03125:0}var hg=me([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const dg={type:2,extent:Dt,loadGeometry:()=>[[new Be(0,0),new Be(Dt+1,0),new Be(Dt+1,Dt+1),new Be(0,Dt+1),new Be(0,0)]]};class lp{constructor(e,i,r,a,c){this.tileID=e,this.uid=vn(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Hn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Oa(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,c){const d={};if(!c)return d;for(const m of a){const g=m.layerIds.map(x=>c.getLayer(x)).filter(Boolean);if(g.length!==0){m.layers=g,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>g.filter(T=>T.id===x)[0]));for(const x of g)d[x.id]=m}}return d}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const c=this.buckets[a];if(c instanceof Vs){if(this.hasSymbolBuckets=!0,!r)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const c=this.buckets[a];if(c instanceof Vs&&c.hasRTLText){this.hasRTLText=!0,b.isLoading()||b.isLoaded()||_()!=="deferred"||v();break}}this.queryPadding=0;for(const a in this.buckets){const c=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(a).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Pi}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const a=this.buckets[r];a.uploadPending()&&a.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Iu(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Iu(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Iu(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,a,c,d,m,g){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:m,transform:d,params:c,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const a=r.loadVTLayers(),c=i?i.sourceLayer:"",d=a._geojsonTileLayer||a[c];if(!d)return;const m=El(i&&i.filter),{z:g,x,y:T}=this.tileID.canonical,M={z:g,x,y:T};for(let A=0;A<d.length;A++){const P=d.feature(A);if(m.needGeometry){const j=La(P,!0);if(!m.filter(new E(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!m.filter(new E(this.tileID.overscaledZ),P))continue;const D=r.getId(P,c),O=new cg(P,g,x,T,D);O.tile=M,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Ci(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let a=!1;if(this.expirationTime>r)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{const c=this.expirationTime-i;c?this.expirationTime=r+Math.max(c,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const d=this.buckets[c],m=d.layers[0].sourceLayer||"_geojsonTileLayer",g=r[m],x=e[m];if(!g||!x||Object.keys(x).length===0)continue;if(d.update(x,g,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),d instanceof $h||d instanceof Xh){const M=i.style._getSourceCache(d.layers[0].source);i._terrain&&i._terrain.enabled&&M&&d.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(M.id,this.tileID)}const T=i&&i.style&&i.style.getLayer(c);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hn.now()+e}setTexture(e,i){const r=i.context,a=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Iu(r,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(e,i){const r={};for(const a of i)r[a]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const a=this.dependencies[r];if(a){for(const c of i)if(a[c])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=ss(dg,this.tileID.canonical,this.tileTransform)[0],a=new Je,c=new br;for(let d=0;d<r.length;d++){const{x:m,y:g}=r[d];a.emplaceBack(m,g),c.emplaceBack(d)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(a,au.members),this._tileDebugSegments=pn.simpleSegment(0,0,a.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=ss(dg,this.tileID.canonical,this.tileTransform)[0];let a,c;if(this.isRaster){const d=function(m,g){const x=Oa(m,g),T=Math.pow(2,m.z);for(let j=0;j<Po;j++)for(let Y=0;Y<Po;Y++){const ne=Ur((m.x+(Y+ug(Y))/Qr)/T),K=Gn((m.y+(j+ug(j))/Qr)/T),ie=g.project(ne,K),oe=j*Po+Y;Do[2*oe+0]=Math.round((ie.x*x.scale-x.x)*Dt),Do[2*oe+1]=Math.round((ie.y*x.scale-x.y)*Dt)}Gs.fill(0),fd.fill(0);for(let j=2045;j>=0;j--){const Y=4*j,ne=js[Y+0],K=js[Y+1],ie=js[Y+2],oe=js[Y+3],re=ne+ie>>1,Ae=K+oe>>1,Te=re+Ae-K,Re=Ae+ne-re,$e=K*Po+ne,ze=oe*Po+ie,Ne=Ae*Po+re,Ve=Math.hypot((Do[2*$e+0]+Do[2*ze+0])/2-Do[2*Ne+0],(Do[2*$e+1]+Do[2*ze+1])/2-Do[2*Ne+1])>=16;Gs[Ne]=Gs[Ne]||(Ve?1:0),j<1022&&(Gs[Ne]=Gs[Ne]||Gs[(K+Re>>1)*Po+(ne+Te>>1)]||Gs[(oe+Re>>1)*Po+(ie+Te>>1)])}const M=new Ue,A=new Ct;let P=0;function D(j,Y){const ne=Y*Po+j;return fd[ne]===0&&(M.emplaceBack(Do[2*ne+0],Do[2*ne+1],j*Dt/Qr,Y*Dt/Qr),fd[ne]=++P),fd[ne]-1}function O(j,Y,ne,K,ie,oe){const re=j+ne>>1,Ae=Y+K>>1;if(Math.abs(j-ie)+Math.abs(Y-oe)>1&&Gs[Ae*Po+re])O(ie,oe,j,Y,re,Ae),O(ne,K,ie,oe,re,Ae);else{const Te=D(j,Y),Re=D(ne,K),$e=D(ie,oe);A.emplaceBack(Te,Re,$e)}}return O(0,0,Qr,Qr,Qr,0),O(Qr,Qr,0,0,0,Qr),{vertices:M,indices:A}}(this.tileID.canonical,i);a=d.vertices,c=d.indices}else{a=new Ue,c=new Ct;for(const{x:m,y:g}of r)a.emplaceBack(m,g,0,0);const d=jf(a.int16,void 0,4);for(let m=0;m<d.length;m+=3)c.emplaceBack(d[m],d[m+1],d[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,hg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=pn.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const a=this.tileID.canonical,c=uu(Dm(a,i)),d=Ll(i.zoom);let m;d>0&&(m=_f(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,i,c,m,d),this._makeGlobeTileDebugTextBuffer(e,a,i,c,m,d)}_globePoint(e,i,r,a,c,d,m){let g=cu(e,i,r);if(d){const x=1<<r.z,T=ko(a.center.lng),M=zo(a.center.lat),A=(r.x+.5)/x-T;let P=0;A>.5?P=-1:A<-.5&&(P=1);let D=(e/Dt+r.x)/x+P,O=(i/Dt+r.y)/x;D=(D-T)*a._pixelsPerMercatorPixel+T,O=(O-M)*a._pixelsPerMercatorPixel+M;const j=[D*a.worldSize,O*a.worldSize,0];hn(j,j,d),g=Da(g,j,m)}return hn(g,g,c)}_makeGlobeTileDebugBorderBuffer(e,i,r,a,c,d){const m=new Je,g=new br,x=new we,T=(A,P,D,O,j)=>{const Y=(D-A)/(j-1),ne=(O-P)/(j-1),K=m.length;for(let ie=0;ie<j;ie++){const oe=A+ie*Y,re=P+ie*ne;m.emplaceBack(oe,re);const Ae=this._globePoint(oe,re,i,r,a,c,d);x.emplaceBack(Ae[0],Ae[1],Ae[2]),g.emplaceBack(K+ie)}},M=Dt;T(0,0,M,0,16),T(M,0,M,M,16),T(M,M,0,M,16),T(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(m,au.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(x,km.members),this._tileDebugSegments=pn.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugTextBuffer(e,i,r,a,c,d){const m=Dt/4,g=new Je,x=new Ct,T=new we,M=25;x.reserve(32),g.reserve(M),T.reserve(M);const A=(P,D)=>M*P+D;for(let P=0;P<M;P++){const D=P*m;for(let O=0;O<M;O++){const j=O*m;g.emplaceBack(j,D);const Y=this._globePoint(j,D,i,r,a,c,d);T.emplaceBack(Y[0],Y[1],Y[2])}}for(let P=0;P<4;P++)for(let D=0;D<4;D++){const O=A(P,D),j=A(P,D+1),Y=A(P+1,D),ne=A(P+1,D+1);x.emplaceBack(O,j,Y),x.emplaceBack(Y,j,ne)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(g,au.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,km.members),this._tileDebugTextSegments=pn.simpleSegment(0,0,M,32)}}class pv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const a=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},ti(this.stateChanges[e][a],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const c in this.state[e])c!==a&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const c in this.state[e][a])r[c]||(this.deletedStates[e][a][c]=null)}else for(const c in r)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][c]===null&&delete this.deletedStates[e][a][c]}removeFeatureState(e,i,r){if(this.deletedStates[e]===null)return;const a=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&i!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][r]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(r in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][r]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),a=ti({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(c===null)return{};for(const d in c)delete a[d]}return a}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const c={};for(const d in this.stateChanges[a])this.state[a][d]||(this.state[a][d]={}),ti(this.state[a][d],this.stateChanges[a][d]),c[d]=this.state[a][d];r[a]=c}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const c={};if(this.deletedStates[a]===null)for(const d in this.state[a])c[d]={},this.state[a][d]={};else for(const d in this.deletedStates[a]){if(this.deletedStates[a][d]===null)this.state[a][d]={};else if(this.state[a][d])for(const m of Object.keys(this.deletedStates[a][d]))delete this.state[a][d][m];c[d]=this.state[a][d]}r[a]=r[a]||{},ti(r[a],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const a in e)e[a].setFeatureState(r,i)}}class fg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function pg(t,e,i,r){let a=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(r[d])<1e-15){if(i[d]<t[d]||i[d]>e[d])return null}else{const m=1/r[d];let g=(t[d]-i[d])*m,x=(e[d]-i[d])*m;if(g>x){const T=g;g=x,x=T}if(g>a&&(a=g),x<c&&(c=x),a>c)return null}return a}function mg(t,e,i,r,a,c,d,m,g,x,T){const M=r-t,A=a-e,P=c-i,D=d-t,O=m-e,j=g-i,Y=T[1]*j-T[2]*O,ne=T[2]*D-T[0]*j,K=T[0]*O-T[1]*D,ie=M*Y+A*ne+P*K;if(Math.abs(ie)<1e-15)return null;const oe=1/ie,re=x[0]-t,Ae=x[1]-e,Te=x[2]-i,Re=(re*Y+Ae*ne+Te*K)*oe;if(Re<0||Re>1)return null;const $e=Ae*P-Te*A,ze=Te*M-re*P,Ne=re*A-Ae*M,Ve=(T[0]*$e+T[1]*ze+T[2]*Ne)*oe;return Ve<0||Re+Ve>1?null:(D*$e+O*ze+j*Ne)*oe}function _g(t,e,i){return(t-e)/(i-e)}function gg(t,e,i,r,a,c,d,m,g){const x=1<<i,T=c-r,M=d-a,A=(t+1)/x*T+r,P=(e+0)/x*M+a,D=(e+1)/x*M+a;m[0]=(t+0)/x*T+r,m[1]=P,g[0]=A,g[1]=D}class yg{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const d=Math.ceil(Math.log2(c.dim/8)),m=[];let g=Math.ceil(Math.pow(2,d));const x=1/g,T=(P,D,O,j,Y)=>{const ne=j?1:0,K=(P+1)*O-ne,ie=D*O,oe=(D+1)*O-ne;Y[0]=P*O,Y[1]=ie,Y[2]=K,Y[3]=oe};let M=new fg(g);const A=[];for(let P=0;P<g*g;P++){T(P%g,Math.floor(P/g),x,!1,A);const D=qs(A[0],A[1],c),O=qs(A[2],A[1],c),j=qs(A[2],A[3],c),Y=qs(A[0],A[3],c);M.minimums.push(Math.min(D,O,j,Y)),M.maximums.push(Math.max(D,O,j,Y)),M.leaves.push(1)}for(m.push(M),g/=2;g>=1;g/=2){const P=m[m.length-1];M=new fg(g);for(let D=0;D<g*g;D++){T(D%g,Math.floor(D/g),2,!0,A);const O=P.getElevation(A[0],A[1]),j=P.getElevation(A[2],A[1]),Y=P.getElevation(A[2],A[3]),ne=P.getElevation(A[0],A[3]),K=P.isLeaf(A[0],A[1]),ie=P.isLeaf(A[2],A[1]),oe=P.isLeaf(A[2],A[3]),re=P.isLeaf(A[0],A[3]),Ae=Math.min(O.min,j.min,Y.min,ne.min),Te=Math.max(O.max,j.max,Y.max,ne.max),Re=K&&ie&&oe&&re;M.maximums.push(Te),M.minimums.push(Ae),M.leaves.push(Te-Ae<=5&&Re?1:0)}m.push(M)}return m}(this.dem),r=i.length-1,a=i[r];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,a,c,d,m=1){return pg([e,i,-100],[r,a,this.maximums[0]*m],c,d)}raycast(e,i,r,a,c,d,m=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,i,r,a,c,d,m);if(g==null)return null;const x=[],T=[],M=[],A=[],P=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:D,t:O,nodex:j,nodey:Y,depth:ne}=P.pop();if(this.leaves[D]){gg(j,Y,ne,e,i,r,a,M,A);const ie=1<<ne,oe=(j+0)/ie,re=(j+1)/ie,Ae=(Y+0)/ie,Te=(Y+1)/ie,Re=qs(oe,Ae,this.dem)*m,$e=qs(re,Ae,this.dem)*m,ze=qs(re,Te,this.dem)*m,Ne=qs(oe,Te,this.dem)*m,Ve=mg(M[0],M[1],Re,A[0],M[1],$e,A[0],A[1],ze,c,d),We=mg(A[0],A[1],ze,M[0],A[1],Ne,M[0],M[1],Re,c,d),ot=Math.min(Ve!==null?Ve:Number.MAX_VALUE,We!==null?We:Number.MAX_VALUE);if(ot!==Number.MAX_VALUE)return ot;{const De=ou([],c,d,O);if(xg(Re,$e,Ne,ze,_g(De[0],M[0],A[0]),_g(De[1],M[1],A[1]))>=De[2])return O}continue}let K=0;for(let ie=0;ie<this._siblingOffset.length;ie++){gg((j<<1)+this._siblingOffset[ie][0],(Y<<1)+this._siblingOffset[ie][1],ne+1,e,i,r,a,M,A),M[2]=-100,A[2]=this.maximums[this.childOffsets[D]+ie]*m;const oe=pg(M,A,c,d);if(oe!=null){const re=oe;x[ie]=re;let Ae=!1;for(let Te=0;Te<K&&!Ae;Te++)re>=x[T[Te]]&&(T.splice(Te,0,ie),Ae=!0);Ae||(T[K]=ie),K++}}for(let ie=0;ie<K;ie++){const oe=T[ie];P.push({idx:this.childOffsets[D]+oe,t:x[oe],nodex:(j<<1)+this._siblingOffset[oe][0],nodey:(Y<<1)+this._siblingOffset[oe][1],depth:ne+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,a,c){if(e[a].isLeaf(i,r)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=a-1,m=e[d];let g=0,x=0;for(let T=0;T<this._siblingOffset.length;T++){const M=2*i+this._siblingOffset[T][0],A=2*r+this._siblingOffset[T][1],P=m.getElevation(M,A),D=m.isLeaf(M,A),O=this._addNode(P.min,P.max,D);D&&(g|=1<<T),x||(x=O)}for(let T=0;T<this._siblingOffset.length;T++)g&1<<T||this._construct(e,2*i+this._siblingOffset[T][0],2*r+this._siblingOffset[T][1],d,x+T)}}function xg(t,e,i,r,a,c){return di(di(t,i,c),di(e,r,c),a)}function qs(t,e,i){const r=i.dim,a=je(t*r-.5,0,r-1),c=je(e*r-.5,0,r-1),d=Math.floor(a),m=Math.floor(c),g=Math.min(d+1,r-1),x=Math.min(m+1,r-1);return xg(i.get(d,m),i.get(g,m),i.get(d,x),i.get(g,x),a-d,c-m)}const vg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mv(t,e,i){return(256*t*256+256*e+i)/10-1e4}function _v(t,e,i){return 256*t+e+i/256-32768}class pd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,a=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return ei(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=a,!a){for(let g=0;g<d;g++)m[this._idx(-1,g)]=m[this._idx(0,g)],m[this._idx(d,g)]=m[this._idx(d-1,g)],m[this._idx(g,-1)]=m[this._idx(g,0)],m[this._idx(g,d)]=m[this._idx(g,d-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(d,-1)]=m[this._idx(d-1,0)],m[this._idx(-1,d)]=m[this._idx(0,d-1)],m[this._idx(d,d)]=m[this._idx(d-1,d-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yg(this)}get(e,i,r=!1){r&&(e=je(e,-1,this.dim),i=je(i,-1,this.dim));const a=4*this._idx(e,i);return(this.encoding==="terrarium"?_v:mv)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return vg[e]}get unpackVector(){return vg[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],a=pd.getUnpackVector(i);let c=Math.floor((e+a[3])/a[2]);return r[2]=c%256,c=Math.floor(c/256),r[1]=c%256,c=Math.floor(c/256),r[0]=c,r}getPixels(){return new Tr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,c=i*this.dim+this.dim,d=r*this.dim,m=r*this.dim+this.dim;switch(i){case-1:a=c-1;break;case 1:c=a+1}switch(r){case-1:d=m-1;break;case 1:m=d+1}const g=-i*this.dim,x=-r*this.dim;for(let T=d;T<m;T++)for(let M=a;M<c;M++){const A=4*this._idx(M,T),P=4*this._idx(M+g,T+x);this.pixels[A+0]=e.pixels[P+0],this.pixels[A+1]=e.pixels[P+1],this.pixels[A+2]=e.pixels[P+2],this.pixels[A+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bt(pd,"DEMData"),bt(yg,"DemMinMaxQuadTree",{omit:["dem"]});class gv{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const c={value:i,timeout:void 0};if(r!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},r)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,a=i===void 0?0:this.data[r].indexOf(i),c=this.data[r][a];return this.data[r].splice(a,1),c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const a of this.data[r])e(a.value)||i.push(a);for(const r of i)this.remove(r.value.tileID,r)}}class Yl{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}Yl.ReadOnly=!1,Yl.ReadWrite=!0,Yl.disabled=new Yl(519,Yl.ReadOnly,[0,1]);const cp=7680;class up{constructor(e,i,r,a,c,d){this.test=e,this.ref=i,this.mask=r,this.fail=a,this.depthFail=c,this.pass=d}}up.disabled=new up({func:519,mask:0},0,0,cp,cp,cp);class Lo{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}Lo.Replace=[1,0],Lo.disabled=new Lo(Lo.Replace,un.transparent,[!1,!1,!1,!1]),Lo.unblended=new Lo(Lo.Replace,un.transparent,[!0,!0,!0,!0]),Lo.alphaBlended=new Lo([1,771],un.transparent,[!0,!0,!0,!0]);const hp=1029,dp=2305;class bo{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}bo.disabled=new bo(!1,hp,dp),bo.backCCW=new bo(!0,hp,dp),bo.backCW=new bo(!0,hp,2304),bo.frontCW=new bo(!0,1028,2304),bo.frontCCW=new bo(!0,1028,dp);class Fa extends Xo{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new gv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new pv,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Ai(this._tiles).map(e=>e.tileID).sort(bg).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,a)=>{const c=r.tileID,d=a.tileID,m=new Be(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),g=new Be(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-d.overscaledZ||g.y-m.y||g.x-m.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(bg).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new hr(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hn.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ro("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let a=0;a<i.length;a++){const c=i[a];if(e.neighboringTiles&&e.neighboringTiles[c]){const d=this.getTileByID(c);r(e,d),r(d,e)}}function r(a,c){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let d=c.tileID.canonical.x-a.tileID.canonical.x;const m=c.tileID.canonical.y-a.tileID.canonical.y,g=Math.pow(2,a.tileID.canonical.z),x=c.tileID.key;d===0&&m===0||Math.abs(m)>1||(Math.abs(d)>1&&(Math.abs(d+g)===1?d+=g:Math.abs(d-g)===1&&(d-=g)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,d,m),a.neighboringTiles&&a.neighboringTiles[x]&&(a.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,a){for(const c in this._tiles){let d=this._tiles[c];if(a[c]||!d.hasData()||d.tileID.overscaledZ<=i||d.tileID.overscaledZ>r)continue;let m=d.tileID;for(;d&&d.tileID.overscaledZ>i+1;){const x=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[x.key],d&&d.hasData()&&(m=x)}let g=m;for(;g.overscaledZ>i;)if(g=g.scaledTo(g.overscaledZ-1),e[g.key]){a[m.key]=m;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const a=e.scaledTo(r),c=this._getLoadedTile(a);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,a=Math.ceil(e.height/i)+1,c=Math.floor(r*a*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,c):c,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),r[c.tileID.key]=c}this._tiles=r;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let a;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new or(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(a=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(m=>this._source.hasTile(m)))):a=[];const c=this._updateRetainedTiles(a);if(wg(this._source.type)&&a.length!==0){const m={},g={},x=Object.keys(c);for(const M of x){const A=c[M],P=this._tiles[M];if(!P||P.fadeEndTime&&P.fadeEndTime<=Hn.now())continue;const D=this.findLoadedParent(A,Math.max(A.overscaledZ-Fa.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),m[D.tileID.key]=D.tileID),g[M]=A}const T=a[a.length-1].overscaledZ;for(const M in this._tiles){const A=this._tiles[M];if(c[M]||!A.hasData())continue;let P=A.tileID;for(;P.overscaledZ>T;){P=P.scaledTo(P.overscaledZ-1);const D=this._tiles[P.key];if(D&&D.hasData()&&g[P.key]){c[M]=A.tileID;break}}}for(const M in m)c[M]||(this._coveredTiles[M]=!0,c[M]=m[M])}for(const m in c)this._tiles[m].clearFadeHold();const d=function(m,g){const x=[];for(const T in m)T in g||x.push(T);return x}(this._tiles,c);for(const m of d){const g=this._tiles[m];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const r={},a=e.reduce((x,T)=>Math.min(x,T.overscaledZ),1/0),c=e[0].overscaledZ,d=Math.max(c-Fa.maxOverzooming,this._source.minzoom),m=Math.max(c+Fa.maxUnderzooming,this._source.minzoom),g={};for(const x of e){const T=this._addTile(x);i[x.key]=x,T.hasData()||a<this._source.maxzoom&&(g[x.key]=x)}this._retainLoadedChildren(g,a,m,i);for(const x of e){let T=this._tiles[x.key];if(T.hasData())continue;if(x.canonical.z>=this._source.maxzoom){const A=x.children(this._source.maxzoom)[0],P=this.getTile(A);if(P&&P.hasData()){i[A.key]=A;continue}}else{const A=x.children(this._source.maxzoom);if(i[A[0].key]&&i[A[1].key]&&i[A[2].key]&&i[A[3].key])continue}let M=T.wasRequested();for(let A=x.overscaledZ-1;A>=d;--A){const P=x.scaledTo(A);if(r[P.key]||(r[P.key]=!0,T=this.getTile(P),!T&&M&&(T=this._addTile(P)),T&&(i[P.key]=P,M=T.wasRequested(),T.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){r=this._loadedParentTiles[a.key];break}i.push(a.key);const c=a.scaledTo(a.overscaledZ-1);if(r=this._getLoadedTile(c),r)break;a=c}for(const c of i)this._loadedParentTiles[c]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const a=this.map?this.map.painter:null;i=new lp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new ro("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const a=[],c=this.transform;if(!c)return a;const d=c.projection.name==="globe",m=ko(c.center.lng);for(const g in this._tiles){const x=this._tiles[g];if(r&&x.clearQueryDebugViz(),x.holdingForFade())continue;let T;if(d){const M=x.tileID.canonical;if(M.z===0){const A=[Math.abs(je(m,...ku(M,-1))-m),Math.abs(je(m,...ku(M,1))-m)];T=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(je(m,...ku(M,-1))-m),Math.abs(je(m,...ku(M,0))-m),Math.abs(je(m,...ku(M,1))-m)];T=[A.indexOf(Math.min(...A))-1]}}else T=[0];for(const M of T){const A=e.containsTile(x,c,i,M);A&&a.push(A)}}return a}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(wg(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Hn.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const a=this._tiles[e];a&&a.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const m=()=>{this._sourceLoaded&&(this._source.off("data",m),this._preloadTiles(e,i))};return void this._source.on("data",m)}const r=new Map,a=Array.isArray(e)?e:[e],c=this.map.painter.terrain,d=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const m of a){const g=m.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const x of g)r.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}Nt(Array.from(r.values()),(m,g)=>{const x=new lp(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,T=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),g(T,x)})},i)}}function bg(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wg(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function ku(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Fa.maxOverzooming=10,Fa.maxUnderzooming=3;class md{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const a=r||e.findDEMTileFor(i);if(!a||!a.dem)return;const c=a.dem,d=a.tileID,m=1<<i.canonical.z-d.canonical.z;return new md(a,a.tileSize/Dt/m,[(i.canonical.x/m-d.canonical.x)*c.dim,(i.canonical.y/m-d.canonical.y)*c.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(r);return new Be(a,c)}getElevationAt(e,i,r,a){const c=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],m=Math.floor(c),g=Math.floor(d),x=this._dem;return a=!!a,r?di(di(x.get(m,g,a),x.get(m,g+1,a),d-g),di(x.get(m+1,g,a),x.get(m+1,g+1,a),d-g),c-m):x.get(m,g,a)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yo(1,e)*this._dem.stride}}class Tg{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Qo(Dt,16,0),this.featureIndexArray=new Sa,this.promoteId=i}insert(e,i,r,a,c,d=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,c,d);const g=this.grid;for(let x=0;x<i.length;x++){const T=i[x],M=[1/0,1/0,-1/0,-1/0];for(let A=0;A<T.length;A++){const P=T[A];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}M[0]<Dt&&M[1]<Dt&&M[2]>=0&&M[3]>=0&&g.insert(m,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wf(new td(this.rawTileData)).layers,this.sourceLayerCoder=new lg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,a){this.loadVTLayers();const c=e.params||{},d=El(c.filter),m=e.tileResult,g=e.transform,x=m.bufferedTilespaceBounds,T=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(D,O,j,Y)=>Hm(m.bufferedTilespaceGeometry,D,O,j,Y));T.sort(yv);let M=null;g.elevation&&T.length>0&&(M=md.create(g.elevation,this.tileID));const A={};let P;for(let D=0;D<T.length;D++){const O=T[D];if(O===P)continue;P=O;const j=this.featureIndexArray.get(O);let Y=null;this.loadMatchingFeature(A,j,d,c.layers,c.availableImages,i,r,a,(ne,K,ie,oe=0)=>(Y||(Y=ss(ne,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(m,ne,ie,Y,this.z,e.transform,e.pixelPosMatrix,M,oe)))}return A}loadMatchingFeature(e,i,r,a,c,d,m,g,x){const{featureIndex:T,bucketIndex:M,sourceLayerIndex:A,layoutVertexArrayOffset:P}=i,D=this.bucketLayerIDs[M];if(a&&!function(ne,K){for(let ie=0;ie<ne.length;ie++)if(K.indexOf(ne[ie])>=0)return!0;return!1}(a,D))return;const O=this.sourceLayerCoder.decode(A),j=this.vtLayers[O].feature(T);if(r.needGeometry){const ne=La(j,!0);if(!r.filter(new E(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!r.filter(new E(this.tileID.overscaledZ),j))return;const Y=this.getId(j,O);for(let ne=0;ne<D.length;ne++){const K=D[ne];if(a&&a.indexOf(K)<0)continue;const ie=d[K];if(!ie)continue;let oe={};Y!==void 0&&g&&(oe=g.getState(ie.sourceLayer||"_geojsonTileLayer",Y));const re=ti({},m[K]);re.paint=Eg(re.paint,ie.paint,j,oe,c),re.layout=Eg(re.layout,ie.layout,j,oe,c);const Ae=!x||x(j,ie,oe,P);if(!Ae)continue;const Te=new cg(j,this.z,this.x,this.y,Y);Te.layer=re;let Re=e[K];Re===void 0&&(Re=e[K]=[]),Re.push({featureIndex:T,feature:Te,intersectionZ:Ae})}}lookupSymbolFeatures(e,i,r,a,c,d,m,g){const x={};this.loadVTLayers();const T=El(c);for(const M of e)this.loadMatchingFeature(x,{bucketIndex:r,sourceLayerIndex:a,featureIndex:M,layoutVertexArrayOffset:0},T,d,m,g,i);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(r),c=this.vtFeatures[a];if(c[i])return c[i];const d=this.vtLayers[a].feature(i);return c[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(r=e.properties[a]),typeof r=="boolean"&&(r=Number(r))}return r}}function Eg(t,e,i,r,a){return vt(t,(c,d)=>{const m=e instanceof X?e.get(d):null;return m&&m.evaluate?m.evaluate(i,r,a):m})}function yv(t,e){return e-t}bt(Tg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Mg{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new as({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=Mn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const a=[];let c=e.length%2==1?-e[e.length-1]*r:0,d=e[0]*r,m=!0;a.push({left:c,right:d,isDash:m,zeroLength:e[0]===0});let g=e[0];for(let x=1;x<e.length;x++){m=!m;const T=e[x];c=g*r,g+=T,d=g*r,a.push({left:c,right:d,isDash:m,zeroLength:T===0})}return a}addRoundDash(e,i,r){const a=i/2;for(let c=-r;c<=r;c++){const d=this.width*(this.nextRow+r+c);let m=0,g=e[m];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++m]);const T=Math.abs(x-g.left),M=Math.abs(x-g.right),A=Math.min(T,M);let P;const D=c/r*(a+1);if(g.isDash){const O=a-Math.abs(D);P=Math.sqrt(A*A+O*O)}else P=a-Math.sqrt(A*A+D*D);this.image.data[d+x]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,i){for(let g=e.length-1;g>=0;--g){const x=e[g],T=e[g+1];x.zeroLength?e.splice(g,1):T&&T.isDash===x.isDash&&(T.left=x.left,e.splice(g,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const c=this.width*this.nextRow;let d=0,m=e[d];for(let g=0;g<this.width;g++){g/m.right>1&&(m=e[++d]);const x=Math.abs(g-m.left),T=Math.abs(g-m.right),M=Math.min(x,T);this.image.data[c+g]=Math.max(0,Math.min(255,(m.isDash?M:-M)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const a=i==="round",c=a?7:0,d=2*c+1;if(this.nextRow+d>this.height)return ei("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let T=0;T<e.length;T++)e[T]<0&&(ei("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),m+=e[T];if(m!==0){const T=this.width/m,M=this.getDashRanges(e,this.width,T);a?this.addRoundDash(M,T,c):this.addRegularDash(M,i==="square"?.5*T:0)}const g=this.nextRow+c;this.nextRow+=d;const x={tl:[g,c],br:[m,0]};return this.positions[r]=x,x}}bt(Mg,"LineAtlas");const Sg=1*vo;class Ag{constructor(e){const i={},r=[];for(const m in e){const g=e[m],x=i[m]={};for(const T in g.glyphs){const M=g.glyphs[+T];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const A=M.metrics.localGlyph?Sg:1,P={x:0,y:0,w:M.bitmap.width+2*A,h:M.bitmap.height+2*A};r.push(P),x[T]=P}}const{w:a,h:c}=Kf(r),d=new as({width:a||1,height:c||1});for(const m in e){const g=e[m];for(const x in g.glyphs){const T=g.glyphs[+x];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const M=i[m][x],A=T.metrics.localGlyph?Sg:1;as.copy(T.bitmap,d,{x:0,y:0},{x:M.x+A,y:M.y+A},T.bitmap)}}this.image=d,this.positions=i}}bt(Ag,"GlyphAtlas");class xv{constructor(e){this.tileID=new or(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Oa(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,a,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Pi;const d=new lg(Object.keys(e.layers).sort()),m=new Tg(this.tileID,this.promoteId);m.bucketLayerIDs=[];const g={},x=new Mg(256,256),T={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:r},M=i.familiesBySource[this.source];for(const oe in M){const re=e.layers[oe];if(!re)continue;let Ae=!1,Te=!1;for(const ze of M[oe])ze[0].type==="symbol"?Ae=!0:Te=!0;if(this.isSymbolTile===!0&&!Ae||this.isSymbolTile===!1&&!Te)continue;re.version===1&&ei(`Vector tile source "${this.source}" layer "${oe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Re=d.encode(oe),$e=[];for(let ze=0;ze<re.length;ze++){const Ne=re.feature(ze),Ve=m.getId(Ne,oe);$e.push({feature:Ne,id:Ve,index:ze,sourceLayerIndex:Re})}for(const ze of M[oe]){const Ne=ze[0];this.isSymbolTile!==void 0&&Ne.type==="symbol"!==this.isSymbolTile||Ne.minzoom&&this.zoom<Math.floor(Ne.minzoom)||Ne.maxzoom&&this.zoom>=Ne.maxzoom||Ne.visibility!=="none"&&(fp(ze,this.zoom,r),(g[Ne.id]=Ne.createBucket({index:m.bucketLayerIDs.length,layers:ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Re,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate($e,T,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(ze.map(Ve=>Ve.id)))}}let A,P,D,O;x.trim();const j={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=()=>{if(A)return c(A);if(P&&D&&O){const oe=new Ag(P),re=new L_(D,O);for(const Ae in g){const Te=g[Ae];Te instanceof Vs?(fp(Te.layers,this.zoom,r),Z1(Te,P,oe.positions,D,re.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof $h||Te instanceof Xh||Te instanceof yu)&&(fp(Te.layers,this.zoom,r),Te.addFeatures(T,this.tileID.canonical,re.patternPositions,r,this.tileTransform))}this.status="done",c(null,{buckets:Ai(g).filter(Ae=>!Ae.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oe.image,lineAtlas:x,imageAtlas:re,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?oe.positions:null})}},ne=vt(T.glyphDependencies,oe=>Object.keys(oe).map(Number));Object.keys(ne).length?a.send("getGlyphs",{uid:this.uid,stacks:ne},(oe,re)=>{A||(A=oe,P=re,Y())},void 0,!1,j):P={};const K=Object.keys(T.iconDependencies);K.length?a.send("getImages",{icons:K,source:this.source,tileID:this.tileID,type:"icons"},(oe,re)=>{A||(A=oe,D=re,Y())},void 0,!1,j):D={};const ie=Object.keys(T.patternDependencies);ie.length?a.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(oe,re)=>{A||(A=oe,O=re,Y())},void 0,!1,j):O={},Y()}}function fp(t,e,i){const r=new E(e);for(const a of t)a.recalculate(r,i)}class Cg{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,a){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[d,m]=c.result;return this.scheduler?this.scheduler.add(()=>{a(d,m)},i):a(d,m),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=r((d,m)=>{c.result=[d,m];for(const g of c.callbacks)this.scheduler?this.scheduler.add(()=>{g(d,m)},i):g(d,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==a),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Ig(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const c=Lr(t.request,(d,m,g,x)=>{d?a(d):m&&a(null,{vectorTile:i?void 0:new Wf(new td(m)),rawData:m,cacheControl:g,expires:x})});return()=>{c.cancel(),a()}},e)}const kg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=r>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const c=kg[15&r];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new pp(m,d,c,e)}constructor(e,i=64,r=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=kg.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-m%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${r}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+g,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+g),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+g,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:m}=this,g=[0,c.length-1,0],x=[];for(;g.length;){const T=g.pop()||0,M=g.pop()||0,A=g.pop()||0;if(M-A<=m){for(let j=A;j<=M;j++){const Y=d[2*j],ne=d[2*j+1];Y>=e&&Y<=r&&ne>=i&&ne<=a&&x.push(c[j])}continue}const P=A+M>>1,D=d[2*P],O=d[2*P+1];D>=e&&D<=r&&O>=i&&O<=a&&x.push(c[P]),(T===0?e<=D:i<=O)&&(g.push(A),g.push(P-1),g.push(1-T)),(T===0?r>=D:a>=O)&&(g.push(P+1),g.push(M),g.push(1-T))}return x}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:d}=this,m=[0,a.length-1,0],g=[],x=r*r;for(;m.length;){const T=m.pop()||0,M=m.pop()||0,A=m.pop()||0;if(M-A<=d){for(let j=A;j<=M;j++)Pg(c[2*j],c[2*j+1],e,i)<=x&&g.push(a[j]);continue}const P=A+M>>1,D=c[2*P],O=c[2*P+1];Pg(D,O,e,i)<=x&&g.push(a[P]),(T===0?e-r<=D:i-r<=O)&&(m.push(A),m.push(P-1),m.push(1-T)),(T===0?e+r>=D:i+r>=O)&&(m.push(P+1),m.push(M),m.push(1-T))}return g}}function mp(t,e,i,r,a,c){if(a-r<=i)return;const d=r+a>>1;zg(t,e,d,r,a,c),mp(t,e,i,r,d-1,1-c),mp(t,e,i,d+1,a,1-c)}function zg(t,e,i,r,a,c){for(;a>r;){if(a-r>600){const x=a-r+1,T=i-r+1,M=Math.log(x),A=.5*Math.exp(2*M/3),P=.5*Math.sqrt(M*A*(x-A)/x)*(T-x/2<0?-1:1);zg(t,e,i,Math.max(r,Math.floor(i-T*A/x+P)),Math.min(a,Math.floor(i+(x-T)*A/x+P)),c)}const d=e[2*i+c];let m=r,g=a;for(zu(t,e,r,i),e[2*a+c]>d&&zu(t,e,r,a);m<g;){for(zu(t,e,m,g),m++,g--;e[2*m+c]<d;)m++;for(;e[2*g+c]>d;)g--}e[2*r+c]===d?zu(t,e,r,g):(g++,zu(t,e,g,a)),g<=i&&(r=g+1),i<=g&&(a=g-1)}}function zu(t,e,i,r){_p(t,i,r),_p(e,2*i,2*r),_p(e,2*i+1,2*r+1)}function _p(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function Pg(t,e,i,r){const a=t-i,c=e-r;return a*a+c*c}o.ARRAY_TYPE=wr,o.AUTH_ERR_MSG=se,o.Aabb=rr,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},xt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$i()?t:L,this.scheduler=new dv}send(t,e,i,r,a=!1,c){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[d]=i);const m=fr(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:t,hasCallback:!!i,targetMapId:r,mustQueue:a,sourceMapId:this.mapId,data:Ds(e,m)},m),{cancel:()=>{i&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||$i()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(es(e.error)):i(null,es(e.data)))}else{const i=fr(this.globalScope)?void 0:[],r=e.hasCallback?(c,d)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?Ds(c):null,data:Ds(d,i)},i)}:c=>{},a=es(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,r);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],a.source)[c[1]](a,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Jh,o.Color=un,o.ColorMode=Lo,o.CullFaceMode=bo,o.DEMData=pd,o.DataConstantProperty=B,o.DedupedRequest=Cg,o.DepthMode=Yl,o.EXTENT=Dt,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,a=Math.floor(t.x),c=Math.floor((t.x-a)*r),d=Math.floor(t.y*r),m=this.findDEMTileFor(new or(i,a,i,c,d));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const a=r.getSource().maxzoom,c=1<<a,d=Math.floor(t.x),m=t.x-d,g=new or(a,d,a,Math.floor(m*c),Math.floor(t.y*c)),x=this.findDEMTileFor(g);if(!x||!x.dem)return e;const T=x.dem,M=1<<x.tileID.canonical.z,A=(m*M-x.tileID.canonical.x)*T.dim,P=(t.y*M-x.tileID.canonical.y)*T.dim,D=Math.floor(A),O=Math.floor(P);return(i?this.exaggeration():1)*di(di(T.get(D,O),T.get(D,O+1),P-O),di(T.get(D+1,O),T.get(D+1,O+1),P-O),A-D)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Rl(t.wrap+(t.canonical.x+e/Dt)/r,(t.canonical.y+i/Dt)/r))}getAtTileOffsetFunc(t,e,i,r){return a=>{const c=this.getAtTileOffset(t,a.x,a.y),d=r.upVector(t.canonical,a.x,a.y);return Fr(d,d,c*r.upVectorScale(t.canonical,e,i).metersToTile),d}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const a=md.create(this,t,r);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,a=1<<t.canonical.z-r.canonical.z;let c=t.canonical.x/a-r.canonical.x,d=t.canonical.y/a-r.canonical.y,m=0;for(let g=0;g<t.canonical.z-r.canonical.z&&!i.leaves[m];g++){c*=2,d*=2;const x=2*Math.floor(d)+Math.floor(c);m=i.childOffsets[m]+x,c%=1,d%=1}return{min:this.exaggeration()*i.minimums[m],max:this.exaggeration()*i.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=hr,o.EvaluationParameters=E,o.Event=ro,o.Evented=Xo,o.FillExtrusionBucket=yu,o.Frustum=Tf,o.FrustumCorners=wf,o.GLOBE_RADIUS=Co,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=zm,o.GLOBE_ZOOM_THRESHOLD_MIN=Ef,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Je,r=new Ct,a=[],c=t+1+2,d=e[0]+1,m=e[0]+1+(1+e.length),g=(x,T,M)=>{let A=x===c-1?x-2:x===0?x:x-1;return A+=M?24575:0,[A,T]};for(let x=0;x<c;++x)i.emplaceBack(...g(x,0,!0));for(let x=0;x<d;++x)for(let T=0;T<c;++T)i.emplaceBack(...g(T,x,(T===0||T===c-1)&&!0));for(let x=0;x<e.length;++x){const T=e[x];for(let M=0;M<c;++M)i.emplaceBack(...g(M,T,!0))}for(let x=0;x<e.length;++x){const T=r.length,M=e[x]+1+2,A=new Ct;for(let O=0;O<M-1;O++){const j=O===M-2,Y=j?c*(m-e.length+x-O):c;for(let ne=0;ne<c-1;ne++){const K=O*c+ne;O===0||j||ne===0||ne===c-2?(A.emplaceBack(K+1,K,K+Y),A.emplaceBack(K+Y,K+Y+1,K+1)):(r.emplaceBack(K+1,K,K+Y),r.emplaceBack(K+Y,K+Y+1,K+1))}}const P=pn.simpleSegment(0,T,i.length,r.length-T);for(let O=0;O<A.uint16.length;O+=3)r.emplaceBack(A.uint16[O],A.uint16[O+1],A.uint16[O+2]);const D=pn.simpleSegment(0,T,i.length,r.length-T);a.push({withoutSkirts:P,withSkirts:D})}return{vertices:i,indices:r,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(Pa,lu);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,au.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Ct;for(let a=0;a<=Pa;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new zi,r=new zi;this._poleSegments=[];for(let a=0,c=0;a<Ef;a++){const d=360/(1<<a);i.emplaceBack(0,-Co,0,.5,0),r.emplaceBack(0,-Co,0,.5,1);for(let m=0;m<=Pa;m++){const g=m/Pa,x=di(0,d,g),[T,M,A]=Pl(dx,fx,x,Co);i.emplaceBack(T,M,A,g,0),r.emplaceBack(T,M,A,g,1)}this._poleSegments.push(pn.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Im,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Im,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new kn,r=Pa,a=r+1+2,c=1;this._wireframeSegments=[];for(let d=0,m=0;d<lu.length;d++){const g=lu[d];for(let T=c;T<g+c;T++)for(let M=c;M<r+c;M++){const A=T*a+M;i.emplaceBack(A,A+1),i.emplaceBack(A,A+a),i.emplaceBack(A,A+a+1)}const x=g*r*3;this._wireframeSegments.push(pn.simpleSegment(0,m,(g+1)*a,x)),m+=x}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=ql,o.ImagePosition=Jf,o.KDBush=pp,o.LivePerformanceUtils=Ks,o.LngLat=Di,o.LngLatBounds=Os,o.LocalGlyphMode=ep,o.MAX_MERCATOR_LATITUDE=qn,o.MercatorCoordinate=Rl,o.ONE_EM=Rn,o.OverscaledTileID=or,o.PerformanceMarkers=Zr,o.Point=Be,o.Properties=$,o.RGBAImage=Tr,o.Ray=bf,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!fe(t))return t;const i=ht(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!fe(t))return t;const i=ht(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!fe(t))return t;const a=ht(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),r&&a.params.push(`worldview=${r}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const a=ht(t);return fe(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||r)):(a.path+=`${e}${i}`,et(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!fe(t))return t;const r=ht(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&r.authority!=="raster"&&i===512?"@2x":""}${ce.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${H.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${H.TILE_URL_VERSION}${r.path}`);const a=this._customAccessToken||function(c){for(const d of c){const m=d.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(r.params)||H.ACCESS_TOKEN;return H.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,a)}canonicalizeTileURL(t,e){const i=ht(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${H.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${H.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(r+=`?${a.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&fe(e),r=[];for(const a of t.tiles||[])be(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=ht(H.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(r.path!=="/"&&(t.path=`${r.path}${t.path}`),!H.REQUIRE_ACCESS_TOKEN)return et(t);if(e=e||H.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),et(t)}},o.ResourceType=bn,o.SegmentVector=pn,o.SourceCache=Fa,o.StencilMode=up,o.StructArrayLayout1ui2=br,o.StructArrayLayout2f1f2i16=Lt,o.StructArrayLayout2i4=Je,o.StructArrayLayout2ui4=kn,o.StructArrayLayout3f12=si,o.StructArrayLayout3ui6=Ct,o.StructArrayLayout4i8=Ue,o.StructArrayLayout5f20=zi,o.Texture=Iu,o.Tile=lp,o.Transitionable=R,o.Uniform1f=Lh,o.Uniform1i=class extends ns{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends ns{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends ns{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=dm,o.UniformColor=fm,o.UniformMatrix2f=class extends ns{constructor(t){super(t),this.current=K0}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends ns{constructor(t){super(t),this.current=Y0}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends ns{constructor(t){super(t),this.current=H0}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=x_,o.ValidationError=yt,o.VectorTileFeature=Yh,o.VectorTileWorkerSource=class extends Xo{constructor(t,e,i,r,a){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=a||Ig,this.loading={},this.loaded={},this.deduped=new Cg(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,a=r&&r.collectResourceTiming,c=this.loading[i]=new xv(t);c.abort=this.loadVectorData(t,(d,m)=>{const g=!this.loading[i];if(delete this.loading[i],g||d||!m)return c.status="done",g||(this.loaded[i]=c),e(d);const x=m.rawData,T={};m.expires&&(T.expires=m.expires),m.cacheControl&&(T.cacheControl=m.cacheControl),c.vectorTile=m.vectorTile||new Wf(new td(x));const M=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,P)=>{if(A||!P)return e(A);const D={};if(a){const O=$s(r);O.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,ti({rawTileData:x.slice(0)},P,T,D))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,r=t.uid,a=this;if(i&&i[r]){const c=i[r];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=Oa(t.tileID.canonical,t.projection);const d=(m,g)=>{const x=c.reloadCallback;x&&(delete c.reloadCallback,c.parse(c.vectorTile,a.layerIndex,this.availableImages,a.actor,x)),e(m,g)};c.status==="parsing"?c.reloadCallback=d:c.status==="done"&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},o.WritingMode=Nr,o.ZoomDependentExpression=xa,o.add=os,o.addDynamicAttributes=hd,o.adjoint=function(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],x=e[7],T=e[8];return t[0]=d*T-m*x,t[1]=a*x-r*T,t[2]=r*m-a*d,t[3]=m*g-c*T,t[4]=i*T-a*g,t[5]=a*c-i*m,t[6]=c*x-d*g,t[7]=r*g-i*x,t[8]=i*d-r*c,t},o.asyncAll=Nt,o.bezier=qt,o.bindAll=xt,o.boundsAttributes=hg,o.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const a=gt(r-1,-1,t.length-1),c=gt(r+1,-1,t.length-1),d=t[r],m=t[c],g=t[a].sub(d).unit(),x=m.sub(d).unit(),T=x.angleWithSep(g.x,g.y),M=g.add(x).unit().mult(-1*e/Math.sin(T/2));i.push(d.add(M))}return i},o.cacheEntryPossiblyAdded=function(t){Xn++,Xn>Ei&&(t.getActor().send("enforceCacheSizeLimit",no),Xn=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,a=Bm(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Ia(a,a,Af(Io(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:a}=t._center;return Bm(e,i,t.worldSize,r,a)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/yo(1,t.center.lat),r=_o(new Float64Array(16));return tu(r,r,[t.point.x,t.point.y,0]),ka(r,r,[i,i,e]),Float32Array.from(r)},o.circumferenceAtLatitude=If,o.clamp=je,o.clearTileCache=function(t){if(!Qi())return;const e=L.caches.delete(Cn);t&&e.catch(t).then(()=>t())},o.clipLine=X_,o.clone=function(t){var e=new wr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=ci,o.collisionCircleLayout=g1,o.config=H,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new wr(16);return wr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=_m,o.createExpression=ks,o.createLayout=me,o.createStyleLayer=function(t){return t.type==="custom"?new lv(t):new uv[t.type](t)},o.cross=vf,o.degToRad=tt,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=Kr,o.earthRadius=hu,o.ease=ri,o.easeCubicInOut=vi,o.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),a=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/r);return new Di(St(a),St(c))},o.emitValidationErrors=Ch,o.endsWith=Ft,o.enforceCacheSizeLimit=function(t){dn(),Et&&Et.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},o.evaluateSizeForFeature=Qh,o.evaluateSizeForZoom=Nl,o.evaluateVariableOffset=$_,o.evented=p,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=Hn,o.exported$1=ce,o.extend=ti,o.extend$1=Rr,o.fillExtrusionHeightLift=__,o.filterObject=lt,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],d=i+i,m=r+r,g=a+a,x=i*d,T=r*d,M=r*m,A=a*d,P=a*m,D=a*g,O=c*d,j=c*m,Y=c*g;return t[0]=1-M-D,t[1]=T+Y,t[2]=A-j,t[3]=0,t[4]=T-Y,t[5]=1-x-D,t[6]=P+O,t[7]=0,t[8]=A+j,t[9]=P-O,t[10]=1-x-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=ym,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ot[e]},o.getAABBPointSquareDist=function(t,e,i){let r=0;for(let a=0;a<2;++a){const c=i?i[a]:0;t[a]>c&&(r+=(t[a]-c)*(t[a]-c)),e[a]<c&&(r+=(c-e[a])*(c-e[a]))}return r},o.getAnchorAlignment=Qf,o.getAnchorJustification=ip,o.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,a=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),a=Math.max(a,c.y);return{min:new Be(e,i),max:new Be(r,a)}},o.getColumn=gi,o.getDefaultExportFromCjs=Ie,o.getGridMatrix=function(t,e,i,r){const a=e.getNorth(),c=e.getSouth(),d=e.getWest(),m=e.getEast(),g=1<<t.z,x=m-d,T=a-c,M=x/Pa,A=-T/lu[i],P=[0,M,0,A,0,0,a,d,0];if(t.z>0){const D=180/r;gm(P,P,[D/x+1,0,0,0,D/T+1,0,-.5*D/M,.5*D/A,1])}return P[2]=g,P[5]=t.x,P[8]=t.y,P},o.getImage=ee,o.getJSON=function(t,e){return mr(ti(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=qn-5;t=je(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(tt(t))),3);return Math.round(i*(lu.length-1))},o.getMapSessionAPI=wn,o.getPerformanceMeasurement=$s,o.getProjection=sg,o.getRTLTextPluginStatus=_,o.getReferrer=pr,o.getTilePoint=function(t,{x:e,y:i},r=0){return new Be(((e-r)*t.scale-t.x)*Dt,(i*t.scale-t.y)*Dt)},o.getTileVec3=function(t,e,i=0){return zl(((e.x-i)*t.scale-t.x)*Dt,(e.y*t.scale-t.y)*Dt,Nm(e.z,e.y))},o.getVideo=function(t,e){const i=L.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const a=L.document.createElement("source");qr(t[r])||(i.crossOrigin="Anonymous"),a.src=t[r],i.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=_o(new Float64Array(16));return Ia(i,t.pixelMatrix,t.globeMatrix),hn(e,e,i),new Be(e[0],e[1])},o.globeDenormalizeECEF=Af,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return hn(i,i,uu(Io(e.canonical))),hn(i,i,t),i},o.globeMetersToEcef=Oh,o.globeNormalizeECEF=uu,o.globePixelsToTileUnits=function(t,e){return Dt/(512*Math.pow(2,t))*Uh(Io(e))},o.globePoleMatrixForTile=function(t,e,i){const r=_o(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return Bh(r,i.globeMatrix,a),Float32Array.from(r)},o.globeTileBounds=Io,o.globeTiltAtLngLat=Om,o.globeToMercatorTransition=Ll,o.globeUseCustomAntiAliasing=function(t,e,i){const r=Ll(i.zoom),a=t.style.map._antialias,c=!!e.extStandardDerivatives,d=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!a&&!d&&c},o.identity=_o,o.identity$1=Sm,o.invert=_f,o.isFullscreen=function(){return!!L.document.fullscreenElement||!!L.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Cf,o.isMapAuthenticated=function(t){return Sn.has(t)},o.isMapboxURL=fe,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!fr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Gn,o.latLngToECEF=Dl,o.len=ox,o.length=iu,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=Ur,o.loadVectorTile=Ig,o.makeRequest=mr,o.mapValue=function(t,e,i,r,a){return je((t-e)/(i-e)*(a-r)+r,r,a)},o.mercatorScale=Vm,o.mercatorXfromLng=ko,o.mercatorYfromLat=zo,o.mercatorZfromAltitude=yo,o.mul=nx,o.mul$1=rx,o.multiply=Ia,o.multiply$1=gm,o.multiply$2=bm,o.nextPowerOfTwo=Mn,o.normalize=nr,o.normalize$1=sx,o.normalize$2=Em,o.number=di,o.ortho=function(t,e,i,r,a,c,d){var m=1/(e-i),g=1/(r-a),x=1/(c-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+i)*m,t[13]=(a+r)*g,t[14]=(d+c)*x,t[15]=1,t},o.pbf=S_,o.perspective=function(t,e,i,r,a){var c,d=1/Math.tan(e/2);return t[0]=d/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+r)*(c=1/(r-a)),t[14]=2*a*r*c):(t[10]=-1,t[14]=-2*r),t},o.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const a=e[r];a in t&&(i[a]=t[a])}return i},o.plugin=b,o.pointGeometry=Ze,o.polesInViewport=function(t){const e=_o(new Float64Array(16));Ia(e,t.pixelMatrix,t.globeMatrix);const i=[0,Jr,0],r=[0,$r,0];return hn(i,i,e),hn(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Cf(t,new Di(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Cf(t,new Di(t.center.lat,-90))]},o.polygonContainsPoint=Ra,o.polygonIntersectsBox=Hm,o.polygonIntersectsPolygon=qm,o.polygonizeBounds=function(t,e,i=0,r=!0){const a=new Be(i,i),c=t.sub(a),d=e.add(a),m=[c,new Be(d.x,c.y),d,new Be(c.x,d.y)];return r&&m.push(c.clone()),m},o.posAttributes=au,o.postMapLoadEvent=rn,o.postPerformanceEvent=on,o.postTurnstileEvent=oi,o.potpack=Kf,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=St,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:l,pluginURL:n}),p.on("pluginStateChange",t),t},o.removeAuthState=function(t){Sn.delete(t)},o.renderColorRamp=Of,o.resample=jm,o.rotateX=gf,o.rotateX$1=Am,o.rotateY=Bh,o.rotateY$1=Cm,o.rotateZ=function(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[0],d=e[1],m=e[2],g=e[3],x=e[4],T=e[5],M=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a+x*r,t[1]=d*a+T*r,t[2]=m*a+M*r,t[3]=g*a+A*r,t[4]=x*a-c*r,t[5]=T*a-d*r,t[6]=M*a-m*r,t[7]=A*a-g*r,t},o.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=r*g+a*m,t[1]=a*g-r*m,t[2]=c*g+d*m,t[3]=d*g-c*m,t},o.scale=ka,o.scale$1=Tm,o.scale$2=Fr,o.scaleAndAdd=ou,o.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},o.setCacheLimits=function(t,e){no=t,Ei=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if(l===Kc||l===Jc||l===$c)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Hn.resolveURL(t),l=Kc,Ls=e,u(),i||v()},o.smoothstep=dt,o.spec=Le,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},o.storeAuthState=function(t,e){e?Sn.add(t):Sn.delete(t)},o.sub=go,o.subtract=xf,o.symbolSize=y1,o.tileAABB=function(t,e,i,r,a,c,d,m,g){if(g.name==="globe")return hx(t,e,new Jh(i,r,a));const x=Oa({z:i,x:r,y:a},g);return new rr([(c+x.x/x.scale)*e,e*(x.y/x.scale),d],[(c+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},o.tileCornersToBounds=Fh,o.tileTransform=Oa,o.transformMat3=function(t,e,i){var r=e[0],a=e[1],c=e[2];return t[0]=r*i[0]+a*i[3]+c*i[6],t[1]=r*i[1]+a*i[4]+c*i[7],t[2]=r*i[2]+a*i[5]+c*i[8],t},o.transformMat4=hn,o.transformMat4$1=za,o.transformQuat=wm,o.transitionTileAABBinECEF=Dm,o.translate=tu,o.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=s,o.uniqueId=vn,o.updateGlobeVertexNormal=function(t,e,i,r,a){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=r,t.float32[c+2]=a},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>vr(Ea(t)),o.validateFog=t=>vr(Mh(t)),o.validateLayer=t=>vr(bh(t)),o.validateLight=t=>vr(Eh(t)),o.validateSource=t=>vr(Th(t)),o.validateStyle=Ah,o.validateTerrain=t=>vr(Zc(t)),o.values=Ai,o.vectorTile=Hh,o.version=F,o.warnOnce=ei,o.window=L,o.wrap=gt}),k(["./shared"],function(o){function L(te){if(typeof te=="number"||typeof te=="boolean"||typeof te=="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){let N="[";for(const ee of te)N+=`${L(ee)},`;return`${N}]`}let U="{";for(const N of Object.keys(te).sort())U+=`${N}:${L(te[N])},`;return`${U}}`}function F(te){let U="";for(const N of o.refProperties)U+=`/${L(te[N])}`;return U}class Q{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,N){for(const se of U)this._layerConfigs[se.id]=se,(this._layers[se.id]=o.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of N)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ee=function(se,fe){const be={};for(let pe=0;pe<se.length;pe++){const Ce=fe&&fe[se[pe].id]||F(se[pe]);fe&&(fe[se[pe].id]=Ce);let nt=be[Ce];nt||(nt=be[Ce]=[]),nt.push(se[pe])}const xe=[];for(const pe in be)xe.push(be[pe]);return xe}(o.values(this._layerConfigs),this.keyCache);for(const se of ee){const fe=se.map(ht=>this._layers[ht.id]),be=fe[0];if(be.visibility==="none")continue;const xe=be.source||"";let pe=this.familiesBySource[xe];pe||(pe=this.familiesBySource[xe]={});const Ce=be.sourceLayer||"_geojsonTileLayer";let nt=pe[Ce];nt||(nt=pe[Ce]=[]),nt.push(fe)}}}class H{loadTile(U,N){const{uid:ee,encoding:se,rawImageData:fe,padding:be,buildQuadTree:xe}=U,pe=o.window.ImageBitmap&&fe instanceof o.window.ImageBitmap?this.getImageData(fe,be):fe;N(null,new o.DEMData(ee,pe,se,be<1,xe))}getImageData(U,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const ee=this.offscreenCanvasContext.getImageData(-N,-N,U.width+2*N,U.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}function ce(te,U){if(te.length!==0){de(te[0],U);for(var N=1;N<te.length;N++)de(te[N],!U)}}function de(te,U){for(var N=0,ee=0,se=0,fe=te.length,be=fe-1;se<fe;be=se++){var xe=(te[se][0]-te[be][0])*(te[be][1]+te[se][1]),pe=N+xe;ee+=Math.abs(N)>=Math.abs(xe)?N-pe+xe:xe-pe+N,N=pe}N+ee>=0!=!!U&&te.reverse()}var ye=o.getDefaultExportFromCjs(function te(U,N){var ee,se=U&&U.type;if(se==="FeatureCollection")for(ee=0;ee<U.features.length;ee++)te(U.features[ee],N);else if(se==="GeometryCollection")for(ee=0;ee<U.geometries.length;ee++)te(U.geometries[ee],N);else if(se==="Feature")te(U.geometry,N);else if(se==="Polygon")ce(U.coordinates,N);else if(se==="MultiPolygon")for(ee=0;ee<U.coordinates.length;ee++)ce(U.coordinates[ee],N);return U});const Ee=o.VectorTileFeature.prototype.toGeoJSON;var Xe={exports:{}},ut=o.pointGeometry,at=o.vectorTile.VectorTileFeature,Ie=ct;function ct(te,U){this.options=U||{},this.features=te,this.length=te.length}function ve(te,U){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=U||4096}ct.prototype.feature=function(te){return new ve(this.features[te],this.options.extent)},ve.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var U=0;U<te.length;U++){for(var N=te[U],ee=[],se=0;se<N.length;se++)ee.push(new ut(N[se][0],N[se][1]));this.geometry.push(ee)}return this.geometry},ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,U=1/0,N=-1/0,ee=1/0,se=-1/0,fe=0;fe<te.length;fe++)for(var be=te[fe],xe=0;xe<be.length;xe++){var pe=be[xe];U=Math.min(U,pe.x),N=Math.max(N,pe.x),ee=Math.min(ee,pe.y),se=Math.max(se,pe.y)}return[U,ee,N,se]},ve.prototype.toGeoJSON=at.prototype.toGeoJSON;var Oe=o.pbf,Ze=Ie;function He(te){var U=new Oe;return function(N,ee){for(var se in N.layers)ee.writeMessage(3,Be,N.layers[se])}(te,U),U.finish()}function Be(te,U){var N;U.writeVarintField(15,te.version||1),U.writeStringField(1,te.name||""),U.writeVarintField(5,te.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<te.length;N++)ee.feature=te.feature(N),U.writeMessage(2,Ut,ee);var se=ee.keys;for(N=0;N<se.length;N++)U.writeStringField(3,se[N]);var fe=ee.values;for(N=0;N<fe.length;N++)U.writeMessage(4,vi,fe[N])}function Ut(te,U){var N=te.feature;N.id!==void 0&&U.writeVarintField(1,N.id),U.writeMessage(2,Pe,te),U.writeVarintField(3,N.type),U.writeMessage(4,Ot,N)}function Pe(te,U){var N=te.feature,ee=te.keys,se=te.values,fe=te.keycache,be=te.valuecache;for(var xe in N.properties){var pe=N.properties[xe],Ce=fe[xe];if(pe!==null){Ce===void 0&&(ee.push(xe),fe[xe]=Ce=ee.length-1),U.writeVarint(Ce);var nt=typeof pe;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(pe=JSON.stringify(pe));var ht=nt+":"+pe,et=be[ht];et===void 0&&(se.push(pe),be[ht]=et=se.length-1),U.writeVarint(et)}}}function tt(te,U){return(U<<3)+(7&te)}function St(te){return te<<1^te>>31}function Ot(te,U){for(var N=te.loadGeometry(),ee=te.type,se=0,fe=0,be=N.length,xe=0;xe<be;xe++){var pe=N[xe],Ce=1;ee===1&&(Ce=pe.length),U.writeVarint(tt(1,Ce));for(var nt=ee===3?pe.length-1:pe.length,ht=0;ht<nt;ht++){ht===1&&ee!==1&&U.writeVarint(tt(2,nt-1));var et=pe[ht].x-se,Wt=pe[ht].y-fe;U.writeVarint(St(et)),U.writeVarint(St(Wt)),se+=et,fe+=Wt}ee===3&&U.writeVarint(tt(7,1))}}function vi(te,U){var N=typeof te;N==="string"?U.writeStringField(1,te):N==="boolean"?U.writeBooleanField(7,te):N==="number"&&(te%1!=0?U.writeDoubleField(3,te):te<0?U.writeSVarintField(6,te):U.writeVarintField(5,te))}Xe.exports=He,Xe.exports.fromVectorTileJs=He,Xe.exports.fromGeojsonVt=function(te,U){U=U||{};var N={};for(var ee in te)N[ee]=new Ze(te[ee].features,U),N[ee].name=ee,N[ee].version=U.version,N[ee].extent=U.extent;return He({layers:N})},Xe.exports.GeoJSONWrapper=Ze;var qt=o.getDefaultExportFromCjs(Xe.exports);const ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},je=Math.fround||(dt=new Float32Array(1),te=>(dt[0]=+te,dt[0]));var dt;const gt=3,Nt=5,Ai=6;class ti{constructor(U){this.options=Object.assign(Object.create(ri),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:N,minZoom:ee,maxZoom:se}=this.options;N&&console.time("total time");const fe=`prepare ${U.length} points`;N&&console.time(fe),this.points=U;const be=[];for(let pe=0;pe<U.length;pe++){const Ce=U[pe];if(!Ce.geometry)continue;const[nt,ht]=Ce.geometry.coordinates,et=je(An(nt)),Wt=je(Mn(ht));be.push(et,Wt,1/0,pe,-1,1),this.options.reduce&&be.push(0)}let xe=this.trees[se+1]=this._createTree(be);N&&console.timeEnd(fe);for(let pe=se;pe>=ee;pe--){const Ce=+Date.now();xe=this.trees[pe]=this._createTree(this._cluster(xe,pe)),N&&console.log("z%d: %d clusters in %dms",pe,xe.numItems,+Date.now()-Ce)}return N&&console.timeEnd("total time"),this}getClusters(U,N){let ee=((U[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,U[1]));let fe=U[2]===180?180:((U[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)ee=-180,fe=180;else if(ee>fe){const ht=this.getClusters([ee,se,180,be],N),et=this.getClusters([-180,se,fe,be],N);return ht.concat(et)}const xe=this.trees[this._limitZoom(N)],pe=xe.range(An(ee),Mn(be),An(fe),Mn(se)),Ce=xe.data,nt=[];for(const ht of pe){const et=this.stride*ht;nt.push(Ce[et+Nt]>1?Ji(Ce,et,this.clusterProps):this.points[Ce[et+gt]])}return nt}getChildren(U){const N=this._getOriginId(U),ee=this._getOriginZoom(U),se="No cluster with the specified id.",fe=this.trees[ee];if(!fe)throw new Error(se);const be=fe.data;if(N*this.stride>=be.length)throw new Error(se);const xe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),pe=fe.within(be[N*this.stride],be[N*this.stride+1],xe),Ce=[];for(const nt of pe){const ht=nt*this.stride;be[ht+4]===U&&Ce.push(be[ht+Nt]>1?Ji(be,ht,this.clusterProps):this.points[be[ht+gt]])}if(Ce.length===0)throw new Error(se);return Ce}getLeaves(U,N,ee){const se=[];return this._appendLeaves(se,U,N=N||10,ee=ee||0,0),se}getTile(U,N,ee){const se=this.trees[this._limitZoom(U)],fe=Math.pow(2,U),{extent:be,radius:xe}=this.options,pe=xe/be,Ce=(ee-pe)/fe,nt=(ee+1+pe)/fe,ht={features:[]};return this._addTileFeatures(se.range((N-pe)/fe,Ce,(N+1+pe)/fe,nt),se.data,N,ee,fe,ht),N===0&&this._addTileFeatures(se.range(1-pe/fe,Ce,1,nt),se.data,fe,ee,fe,ht),N===fe-1&&this._addTileFeatures(se.range(0,Ce,pe/fe,nt),se.data,-1,ee,fe,ht),ht.features.length?ht:null}getClusterExpansionZoom(U){let N=this._getOriginZoom(U)-1;for(;N<=this.options.maxZoom;){const ee=this.getChildren(U);if(N++,ee.length!==1)break;U=ee[0].properties.cluster_id}return N}_appendLeaves(U,N,ee,se,fe){const be=this.getChildren(N);for(const xe of be){const pe=xe.properties;if(pe&&pe.cluster?fe+pe.point_count<=se?fe+=pe.point_count:fe=this._appendLeaves(U,pe.cluster_id,ee,se,fe):fe<se?fe++:U.push(xe),U.length===ee)break}return fe}_createTree(U){const N=new o.KDBush(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<U.length;ee+=this.stride)N.add(U[ee],U[ee+1]);return N.finish(),N.data=U,N}_addTileFeatures(U,N,ee,se,fe,be){for(const xe of U){const pe=xe*this.stride,Ce=N[pe+Nt]>1;let nt,ht,et;if(Ce)nt=vn(N,pe,this.clusterProps),ht=N[pe],et=N[pe+1];else{const jt=this.points[N[pe+gt]];nt=jt.properties;const[Kt,oi]=jt.geometry.coordinates;ht=An(Kt),et=Mn(oi)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(ht*fe-ee)),Math.round(this.options.extent*(et*fe-se))]],tags:nt};let Vt;Vt=Ce||this.options.generateId?N[pe+gt]:this.points[N[pe+gt]].id,Vt!==void 0&&(Wt.id=Vt),be.features.push(Wt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,N){const{radius:ee,extent:se,reduce:fe,minPoints:be}=this.options,xe=ee/(se*Math.pow(2,N)),pe=U.data,Ce=[],nt=this.stride;for(let ht=0;ht<pe.length;ht+=nt){if(pe[ht+2]<=N)continue;pe[ht+2]=N;const et=pe[ht],Wt=pe[ht+1],Vt=U.within(pe[ht],pe[ht+1],xe),jt=pe[ht+Nt];let Kt=jt;for(const oi of Vt){const Gi=oi*nt;pe[Gi+2]>N&&(Kt+=pe[Gi+Nt])}if(Kt>jt&&Kt>=be){let oi,Gi=et*jt,rn=Wt*jt,Mi=-1;const on=((ht/nt|0)<<5)+(N+1)+this.points.length;for(const ur of Vt){const wn=ur*nt;if(pe[wn+2]<=N)continue;pe[wn+2]=N;const Sn=pe[wn+Nt];Gi+=pe[wn]*Sn,rn+=pe[wn+1]*Sn,pe[wn+4]=on,fe&&(oi||(oi=this._map(pe,ht,!0),Mi=this.clusterProps.length,this.clusterProps.push(oi)),fe(oi,this._map(pe,wn)))}pe[ht+4]=on,Ce.push(Gi/Kt,rn/Kt,1/0,on,-1,Kt),fe&&Ce.push(Mi)}else{for(let oi=0;oi<nt;oi++)Ce.push(pe[ht+oi]);if(Kt>1)for(const oi of Vt){const Gi=oi*nt;if(!(pe[Gi+2]<=N)){pe[Gi+2]=N;for(let rn=0;rn<nt;rn++)Ce.push(pe[Gi+rn])}}}}return Ce}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,N,ee){if(U[N+Nt]>1){const be=this.clusterProps[U[N+Ai]];return ee?Object.assign({},be):be}const se=this.points[U[N+gt]].properties,fe=this.options.map(se);return ee&&fe===se?Object.assign({},fe):fe}}function Ji(te,U,N){return{type:"Feature",id:te[U+gt],properties:vn(te,U,N),geometry:{type:"Point",coordinates:[(ee=te[U],360*(ee-.5)),$n(te[U+1])]}};var ee}function vn(te,U,N){const ee=te[U+Nt],se=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,fe=te[U+Ai],be=fe===-1?{}:Object.assign({},N[fe]);return Object.assign(be,{cluster:!0,cluster_id:te[U+gt],point_count:ee,point_count_abbreviated:se})}function An(te){return te/360+.5}function Mn(te){const U=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return N<0?0:N>1?1:N}function $n(te){const U=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function xt(te,U,N,ee){for(var se,fe=ee,be=N-U>>1,xe=N-U,pe=te[U],Ce=te[U+1],nt=te[N],ht=te[N+1],et=U+3;et<N;et+=3){var Wt=Ft(te[et],te[et+1],pe,Ce,nt,ht);if(Wt>fe)se=et,fe=Wt;else if(Wt===fe){var Vt=Math.abs(et-be);Vt<xe&&(se=et,xe=Vt)}}fe>ee&&(se-U>3&&xt(te,U,se,ee),te[se+2]=fe,N-se>3&&xt(te,se,N,ee))}function Ft(te,U,N,ee,se,fe){var be=se-N,xe=fe-ee;if(be!==0||xe!==0){var pe=((te-N)*be+(U-ee)*xe)/(be*be+xe*xe);pe>1?(N=se,ee=fe):pe>0&&(N+=be*pe,ee+=xe*pe)}return(be=te-N)*be+(xe=U-ee)*xe}function vt(te,U,N,ee){var se={id:te===void 0?null:te,type:U,geometry:N,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var be=fe.geometry,xe=fe.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")lt(fe,be);else if(xe==="Polygon"||xe==="MultiLineString")for(var pe=0;pe<be.length;pe++)lt(fe,be[pe]);else if(xe==="MultiPolygon")for(pe=0;pe<be.length;pe++)for(var Ce=0;Ce<be[pe].length;Ce++)lt(fe,be[pe][Ce])}(se),se}function lt(te,U){for(var N=0;N<U.length;N+=3)te.minX=Math.min(te.minX,U[N]),te.minY=Math.min(te.minY,U[N+1]),te.maxX=Math.max(te.maxX,U[N]),te.maxY=Math.max(te.maxY,U[N+1])}function ci(te,U,N,ee){if(U.geometry){var se=U.geometry.coordinates,fe=U.geometry.type,be=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),xe=[],pe=U.id;if(N.promoteId?pe=U.properties[N.promoteId]:N.generateId&&(pe=ee||0),fe==="Point")At(se,xe);else if(fe==="MultiPoint")for(var Ce=0;Ce<se.length;Ce++)At(se[Ce],xe);else if(fe==="LineString")ei(se,xe,be,!1);else if(fe==="MultiLineString"){if(N.lineMetrics){for(Ce=0;Ce<se.length;Ce++)ei(se[Ce],xe=[],be,!1),te.push(vt(pe,"LineString",xe,U.properties));return}bi(se,xe,be,!1)}else if(fe==="Polygon")bi(se,xe,be,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(Ce=0;Ce<U.geometry.geometries.length;Ce++)ci(te,{id:pe,geometry:U.geometry.geometries[Ce],properties:U.properties},N,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<se.length;Ce++){var nt=[];bi(se[Ce],nt,be,!0),xe.push(nt)}}te.push(vt(pe,fe,xe,U.properties))}}function At(te,U){U.push(tn(te[0])),U.push($i(te[1])),U.push(0)}function ei(te,U,N,ee){for(var se,fe,be=0,xe=0;xe<te.length;xe++){var pe=tn(te[xe][0]),Ce=$i(te[xe][1]);U.push(pe),U.push(Ce),U.push(0),xe>0&&(be+=ee?(se*Ce-pe*fe)/2:Math.sqrt(Math.pow(pe-se,2)+Math.pow(Ce-fe,2))),se=pe,fe=Ce}var nt=U.length-3;U[2]=1,xt(U,0,nt,N),U[nt+2]=1,U.size=Math.abs(be),U.start=0,U.end=U.size}function bi(te,U,N,ee){for(var se=0;se<te.length;se++){var fe=[];ei(te[se],fe,N,ee),U.push(fe)}}function tn(te){return te/360+.5}function $i(te){var U=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return N<0?0:N>1?1:N}function Ci(te,U,N,ee,se,fe,be,xe){if(ee/=U,fe>=(N/=U)&&be<ee)return te;if(be<N||fe>=ee)return null;for(var pe=[],Ce=0;Ce<te.length;Ce++){var nt=te[Ce],ht=nt.geometry,et=nt.type,Wt=se===0?nt.minX:nt.minY,Vt=se===0?nt.maxX:nt.maxY;if(Wt>=N&&Vt<ee)pe.push(nt);else if(!(Vt<N||Wt>=ee)){var jt=[];if(et==="Point"||et==="MultiPoint")lr(ht,jt,N,ee,se);else if(et==="LineString")fr(ht,jt,N,ee,se,!1,xe.lineMetrics);else if(et==="MultiLineString")gi(ht,jt,N,ee,se,!1);else if(et==="Polygon")gi(ht,jt,N,ee,se,!0);else if(et==="MultiPolygon")for(var Kt=0;Kt<ht.length;Kt++){var oi=[];gi(ht[Kt],oi,N,ee,se,!0),oi.length&&jt.push(oi)}if(jt.length){if(xe.lineMetrics&&et==="LineString"){for(Kt=0;Kt<jt.length;Kt++)pe.push(vt(nt.id,et,jt[Kt],nt.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(jt.length===1?(et="LineString",jt=jt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=jt.length===3?"Point":"MultiPoint"),pe.push(vt(nt.id,et,jt,nt.tags))}}}return pe.length?pe:null}function lr(te,U,N,ee,se){for(var fe=0;fe<te.length;fe+=3){var be=te[fe+se];be>=N&&be<=ee&&(U.push(te[fe]),U.push(te[fe+1]),U.push(te[fe+2]))}}function fr(te,U,N,ee,se,fe,be){for(var xe,pe,Ce=Dr(te),nt=se===0?no:Ei,ht=te.start,et=0;et<te.length-3;et+=3){var Wt=te[et],Vt=te[et+1],jt=te[et+2],Kt=te[et+3],oi=te[et+4],Gi=se===0?Wt:Vt,rn=se===0?Kt:oi,Mi=!1;be&&(xe=Math.sqrt(Math.pow(Wt-Kt,2)+Math.pow(Vt-oi,2))),Gi<N?rn>N&&(pe=nt(Ce,Wt,Vt,Kt,oi,N),be&&(Ce.start=ht+xe*pe)):Gi>ee?rn<ee&&(pe=nt(Ce,Wt,Vt,Kt,oi,ee),be&&(Ce.start=ht+xe*pe)):Cn(Ce,Wt,Vt,jt),rn<N&&Gi>=N&&(pe=nt(Ce,Wt,Vt,Kt,oi,N),Mi=!0),rn>ee&&Gi<=ee&&(pe=nt(Ce,Wt,Vt,Kt,oi,ee),Mi=!0),!fe&&Mi&&(be&&(Ce.end=ht+xe*pe),U.push(Ce),Ce=Dr(te)),be&&(ht+=xe)}var on=te.length-3;Wt=te[on],Vt=te[on+1],jt=te[on+2],(Gi=se===0?Wt:Vt)>=N&&Gi<=ee&&Cn(Ce,Wt,Vt,jt),on=Ce.length-3,fe&&on>=3&&(Ce[on]!==Ce[0]||Ce[on+1]!==Ce[1])&&Cn(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&U.push(Ce)}function Dr(te){var U=[];return U.size=te.size,U.start=te.start,U.end=te.end,U}function gi(te,U,N,ee,se,fe){for(var be=0;be<te.length;be++)fr(te[be],U,N,ee,se,fe,!1)}function Cn(te,U,N,ee){te.push(U),te.push(N),te.push(ee)}function no(te,U,N,ee,se,fe){var be=(fe-U)/(ee-U);return te.push(fe),te.push(N+(se-N)*be),te.push(1),be}function Ei(te,U,N,ee,se,fe){var be=(fe-N)/(se-N);return te.push(U+(ee-U)*be),te.push(fe),te.push(1),be}function Et(te,U){for(var N=[],ee=0;ee<te.length;ee++){var se,fe=te[ee],be=fe.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")se=Zt(fe.geometry,U);else if(be==="MultiLineString"||be==="Polygon"){se=[];for(var xe=0;xe<fe.geometry.length;xe++)se.push(Zt(fe.geometry[xe],U))}else if(be==="MultiPolygon")for(se=[],xe=0;xe<fe.geometry.length;xe++){for(var pe=[],Ce=0;Ce<fe.geometry[xe].length;Ce++)pe.push(Zt(fe.geometry[xe][Ce],U));se.push(pe)}N.push(vt(fe.id,be,se,fe.tags))}return N}function Zt(te,U){var N=[];N.size=te.size,te.start!==void 0&&(N.start=te.start,N.end=te.end);for(var ee=0;ee<te.length;ee+=3)N.push(te[ee]+U,te[ee+1],te[ee+2]);return N}function Qi(te,U){if(te.transformed)return te;var N,ee,se,fe=1<<te.z,be=te.x,xe=te.y;for(N=0;N<te.features.length;N++){var pe=te.features[N],Ce=pe.geometry,nt=pe.type;if(pe.geometry=[],nt===1)for(ee=0;ee<Ce.length;ee+=2)pe.geometry.push(dn(Ce[ee],Ce[ee+1],U,fe,be,xe));else for(ee=0;ee<Ce.length;ee++){var ht=[];for(se=0;se<Ce[ee].length;se+=2)ht.push(dn(Ce[ee][se],Ce[ee][se+1],U,fe,be,xe));pe.geometry.push(ht)}}return te.transformed=!0,te}function dn(te,U,N,ee,se,fe){return[Math.round(N*(te*ee-se)),Math.round(N*(U*ee-fe))]}function nn(te,U,N,ee,se){for(var fe=U===se.maxZoom?0:se.tolerance/((1<<U)*se.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:ee,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<te.length;xe++){be.numFeatures++,Xn(be,te[xe],fe,se);var pe=te[xe].minX,Ce=te[xe].minY,nt=te[xe].maxX,ht=te[xe].maxY;pe<be.minX&&(be.minX=pe),Ce<be.minY&&(be.minY=Ce),nt>be.maxX&&(be.maxX=nt),ht>be.maxY&&(be.maxY=ht)}return be}function Xn(te,U,N,ee){var se=U.geometry,fe=U.type,be=[];if(fe==="Point"||fe==="MultiPoint")for(var xe=0;xe<se.length;xe+=3)be.push(se[xe]),be.push(se[xe+1]),te.numPoints++,te.numSimplified++;else if(fe==="LineString")bn(be,se,te,N,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(xe=0;xe<se.length;xe++)bn(be,se[xe],te,N,fe==="Polygon",xe===0);else if(fe==="MultiPolygon")for(var pe=0;pe<se.length;pe++){var Ce=se[pe];for(xe=0;xe<Ce.length;xe++)bn(be,Ce[xe],te,N,!0,xe===0)}if(be.length){var nt=U.tags||null;if(fe==="LineString"&&ee.lineMetrics){for(var ht in nt={},U.tags)nt[ht]=U.tags[ht];nt.mapbox_clip_start=se.start/se.size,nt.mapbox_clip_end=se.end/se.size}var et={geometry:be,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:nt};U.id!==null&&(et.id=U.id),te.features.push(et)}}function bn(te,U,N,ee,se,fe){var be=ee*ee;if(ee>0&&U.size<(se?be:ee))N.numPoints+=U.length/3;else{for(var xe=[],pe=0;pe<U.length;pe+=3)(ee===0||U[pe+2]>be)&&(N.numSimplified++,xe.push(U[pe]),xe.push(U[pe+1])),N.numPoints++;se&&function(Ce,nt){for(var ht=0,et=0,Wt=Ce.length,Vt=Wt-2;et<Wt;Vt=et,et+=2)ht+=(Ce[et]-Ce[Vt])*(Ce[et+1]+Ce[Vt+1]);if(ht>0===nt)for(et=0,Wt=Ce.length;et<Wt/2;et+=2){var jt=Ce[et],Kt=Ce[et+1];Ce[et]=Ce[Wt-2-et],Ce[et+1]=Ce[Wt-1-et],Ce[Wt-2-et]=jt,Ce[Wt-1-et]=Kt}}(xe,fe),te.push(xe)}}function cr(te,U){var N=(U=this.options=function(se,fe){for(var be in fe)se[be]=fe[be];return se}(Object.create(this.options),U)).debug;if(N&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(se,fe){var be=[];if(se.type==="FeatureCollection")for(var xe=0;xe<se.features.length;xe++)ci(be,se.features[xe],fe,xe);else ci(be,se.type==="Feature"?se:{geometry:se},fe);return be}(te,U);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(se,fe){var be=fe.buffer/fe.extent,xe=se,pe=Ci(se,1,-1-be,be,0,-1,2,fe),Ce=Ci(se,1,1-be,2+be,0,-1,2,fe);return(pe||Ce)&&(xe=Ci(se,1,-be,1+be,0,-1,2,fe)||[],pe&&(xe=Et(pe,1).concat(xe)),Ce&&(xe=xe.concat(Et(Ce,-1)))),xe}(ee,U),ee.length&&this.splitTile(ee,0,0,0),N&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pr(te,U,N){return 32*((1<<te)*N+U)+te}function mr(te,U){const N=te.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const ee=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!ee)return U(null,null);const se=new class{constructor(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=be.length,this._features=be}feature(be){return new class{constructor(xe){this._feature=xe,this.extent=o.EXTENT,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){const xe=[];for(const pe of this._feature.geometry)xe.push([new o.Point(pe[0],pe[1])]);return xe}{const xe=[];for(const pe of this._feature.geometry){const Ce=[];for(const nt of pe)Ce.push(new o.Point(nt[0],nt[1]));xe.push(Ce)}return xe}}toGeoJSON(xe,pe,Ce){return Ee.call(this,xe,pe,Ce)}}(this._features[be])}}(ee.features);let fe=qt(se);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),U(null,{vectorTile:se,rawData:fe.buffer})}cr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},cr.prototype.splitTile=function(te,U,N,ee,se,fe,be){for(var xe=[te,U,N,ee],pe=this.options,Ce=pe.debug;xe.length;){ee=xe.pop(),N=xe.pop(),U=xe.pop(),te=xe.pop();var nt=1<<U,ht=pr(U,N,ee),et=this.tiles[ht];if(!et&&(Ce>1&&console.time("creation"),et=this.tiles[ht]=nn(te,U,N,ee,pe),this.tileCoords.push({z:U,x:N,y:ee}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,N,ee,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));var Wt="z"+U;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(et.source=te,se){if(U===pe.maxZoom||U===se)continue;var Vt=1<<se-U;if(N!==Math.floor(fe/Vt)||ee!==Math.floor(be/Vt))continue}else if(U===pe.indexMaxZoom||et.numPoints<=pe.indexMaxPoints)continue;if(et.source=null,te.length!==0){Ce>1&&console.time("clipping");var jt,Kt,oi,Gi,rn,Mi,on=.5*pe.buffer/pe.extent,ur=.5-on,wn=.5+on,Sn=1+on;jt=Kt=oi=Gi=null,rn=Ci(te,nt,N-on,N+wn,0,et.minX,et.maxX,pe),Mi=Ci(te,nt,N+ur,N+Sn,0,et.minX,et.maxX,pe),te=null,rn&&(jt=Ci(rn,nt,ee-on,ee+wn,1,et.minY,et.maxY,pe),Kt=Ci(rn,nt,ee+ur,ee+Sn,1,et.minY,et.maxY,pe),rn=null),Mi&&(oi=Ci(Mi,nt,ee-on,ee+wn,1,et.minY,et.maxY,pe),Gi=Ci(Mi,nt,ee+ur,ee+Sn,1,et.minY,et.maxY,pe),Mi=null),Ce>1&&console.timeEnd("clipping"),xe.push(jt||[],U+1,2*N,2*ee),xe.push(Kt||[],U+1,2*N,2*ee+1),xe.push(oi||[],U+1,2*N+1,2*ee),xe.push(Gi||[],U+1,2*N+1,2*ee+1)}}},cr.prototype.getTile=function(te,U,N){var ee=this.options,se=ee.extent,fe=ee.debug;if(te<0||te>24)return null;var be=1<<te,xe=pr(te,U=(U%be+be)%be,N);if(this.tiles[xe])return Qi(this.tiles[xe],se);fe>1&&console.log("drilling down to z%d-%d-%d",te,U,N);for(var pe,Ce=te,nt=U,ht=N;!pe&&Ce>0;)Ce--,nt=Math.floor(nt/2),ht=Math.floor(ht/2),pe=this.tiles[pr(Ce,nt,ht)];return pe&&pe.source?(fe>1&&console.log("found parent tile z%d-%d-%d",Ce,nt,ht),fe>1&&console.time("drilling down"),this.splitTile(pe.source,Ce,nt,ht,te,U,N),fe>1&&console.timeEnd("drilling down"),this.tiles[xe]?Qi(this.tiles[xe],se):null):null};class Lr extends o.VectorTileWorkerSource{constructor(U,N,ee,se,fe){super(U,N,ee,se,mr),fe&&(this.loadGeoJSON=fe)}loadData(U,N){const ee=U&&U.request,se=ee&&ee.collectResourceTiming;this.loadGeoJSON(U,(fe,be)=>{if(fe||!be)return N(fe);if(typeof be!="object")return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{ye(be,!0);try{if(U.filter){const pe=o.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));be={type:"FeatureCollection",features:be.features.filter(nt=>pe.value.evaluate({zoom:0},nt))}}this._geoJSONIndex=U.cluster?new ti(function({superclusterOptions:pe,clusterProperties:Ce}){if(!Ce||!pe)return pe;const nt={},ht={},et={accumulated:null,zoom:0},Wt={properties:null},Vt=Object.keys(Ce);for(const jt of Vt){const[Kt,oi]=Ce[jt],Gi=o.createExpression(oi),rn=o.createExpression(typeof Kt=="string"?[Kt,["accumulated"],["get",jt]]:Kt);nt[jt]=Gi.value,ht[jt]=rn.value}return pe.map=jt=>{Wt.properties=jt;const Kt={};for(const oi of Vt)Kt[oi]=nt[oi].evaluate(et,Wt);return Kt},pe.reduce=(jt,Kt)=>{Wt.properties=Kt;for(const oi of Vt)et.accumulated=jt[oi],jt[oi]=ht[oi].evaluate(et,Wt)},pe}(U)).load(be.features):function(pe,Ce){return new cr(pe,Ce)}(be,U.geojsonVtOptions)}catch(pe){return N(pe)}this.loaded={};const xe={};if(se){const pe=o.getPerformanceMeasurement(ee);pe&&(xe.resourceTiming={},xe.resourceTiming[U.source]=JSON.parse(JSON.stringify(pe)))}N(null,xe)}})}reloadTile(U,N){const ee=this.loaded;return ee&&ee[U.uid]?super.reloadTile(U,N):this.loadTile(U,N)}loadGeoJSON(U,N){if(U.request)o.getJSON(U.request,N);else{if(typeof U.data!="string")return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(U.data))}catch{return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(ee){N(ee)}}getClusterChildren(U,N){try{N(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(ee){N(ee)}}getClusterLeaves(U,N){try{N(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(ee){N(ee)}}}class qr{constructor(U){this.self=U,this.actor=new o.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Lr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,ee)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=ee},this.self.registerRTLTextPlugin=N=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=N.applyArabicShaping,o.plugin.processBidirectionalText=N.processBidirectionalText,o.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(U,N,ee){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],ee()}checkIfReady(U,N,ee){ee()}setReferrer(U,N){this.referrer=N}spriteLoaded(U,N){this.isSpriteLoaded[U]=N;for(const ee in this.workerSources[U]){const se=this.workerSources[U][ee];for(const fe in se)se[fe]instanceof o.VectorTileWorkerSource&&(se[fe].isSpriteLoaded=N,se[fe].fire(new o.Event("isSpriteLoaded")))}}setImages(U,N,ee){this.availableImages[U]=N;for(const se in this.workerSources[U]){const fe=this.workerSources[U][se];for(const be in fe)fe[be].availableImages=N}ee()}enableTerrain(U,N,ee){this.terrain=N,ee()}setProjection(U,N){this.projections[U]=o.getProjection(N)}setLayers(U,N,ee){this.getLayerIndex(U).replace(N),ee()}updateLayers(U,N,ee){this.getLayerIndex(U).update(N.layers,N.removedIds),ee()}loadTile(U,N,ee){const se=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;se.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,N.type,N.source).loadTile(se,ee)}loadDEMTile(U,N,ee){const se=this.enableTerrain?o.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(U,N.source).loadTile(se,ee)}reloadTile(U,N,ee){const se=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;se.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,N.type,N.source).reloadTile(se,ee)}abortTile(U,N,ee){this.getWorkerSource(U,N.type,N.source).abortTile(N,ee)}removeTile(U,N,ee){this.getWorkerSource(U,N.type,N.source).removeTile(N,ee)}removeSource(U,N,ee){if(!this.workerSources[U]||!this.workerSources[U][N.type]||!this.workerSources[U][N.type][N.source])return;const se=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],se.removeSource!==void 0?se.removeSource(N,ee):ee()}loadWorkerSource(U,N,ee){try{this.self.importScripts(N.url),ee()}catch(se){ee(se.toString())}}syncRTLPluginState(U,N,ee){try{o.plugin.setState(N);const se=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&se!=null){this.self.importScripts(se);const fe=o.plugin.isParsed();ee(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),fe)}}catch(se){ee(se.toString())}}getAvailableImages(U){let N=this.availableImages[U];return N||(N=[]),N}getLayerIndex(U){let N=this.layerIndexes[U];return N||(N=this.layerIndexes[U]=new Q),N}getWorkerSource(U,N,ee){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][N]||(this.workerSources[U][N]={}),!this.workerSources[U][N][ee]){const se={send:(fe,be,xe,pe,Ce,nt)=>{this.actor.send(fe,be,xe,U,Ce,nt)},scheduler:this.actor.scheduler};this.workerSources[U][N][ee]=new this.workerSourceTypes[N](se,this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])}return this.workerSources[U][N][ee]}getDEMWorkerSource(U,N){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][N]||(this.demWorkerSources[U][N]=new H),this.demWorkerSources[U][N]}enforceCacheSizeLimit(U,N){o.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(U,N,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qr(self)),qr}),k(["./shared"],function(o){function L(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let s=0;s<l.length;s++)if(!L(l[s],n[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&n!==null){if(typeof n!="object"||Object.keys(l).length!==Object.keys(n).length)return!1;for(const s in l)if(!L(l[s],n[s]))return!1;return!0}return l===n}var F=Q;function Q(l){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,p,_=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(_);try{p=new Worker(v),u=!0}catch{u=!1}return p&&p.terminate(),URL.revokeObjectURL(v),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var p=u.getContext("2d");if(!p)return!1;var _=p.getImageData(0,0,1,1);return _&&_.width===u.width}()?(H[s=n&&n.failIfMajorPerformanceCaveat]===void 0&&(H[s]=function(u){var p,_=function(v){var b=document.createElement("canvas"),E=Object.create(Q.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=v,b.getContext("webgl",E)||b.getContext("experimental-webgl",E)}(u);if(!_)return!1;try{p=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!p||_.isContextLost())&&(_.shaderSource(p,"void main() {}"),_.compileShader(p),_.getShaderParameter(p,_.COMPILE_STATUS)===!0)}(s)),H[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(l)}var H={};function ce(l,n,s){const u=o.window.document.createElement(l);return n!==void 0&&(u.className=n),s&&s.appendChild(u),u}function de(l,n,s){const u=o.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const p of Object.keys(n))u.setAttributeNS(null,p,n[p]);return s&&s.appendChild(u),u}Q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ye=o.window.document&&o.window.document.documentElement.style,Ee=ye&&ye.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Xe;function ut(){ye&&Ee&&(Xe=ye[Ee],ye[Ee]="none")}function at(){ye&&Ee&&(ye[Ee]=Xe)}function Ie(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",Ie,!0)}function ct(){o.window.addEventListener("click",Ie,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ie,!0)},0)}function ve(l,n){const s=l.getBoundingClientRect();return He(l,s,n)}function Oe(l,n){const s=l.getBoundingClientRect(),u=[];for(let p=0;p<n.length;p++)u.push(He(l,s,n[p]));return u}function Ze(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function He(l,n,s){const u=l.offsetWidth===n.width?1:l.offsetWidth/n.width;return new o.Point((s.clientX-n.left)*u,(s.clientY-n.top)*u)}function Be(l,n){var s=n[0],u=n[1],p=n[2],_=n[3],v=s*_-p*u;return v?(l[0]=_*(v=1/v),l[1]=-u*v,l[2]=-p*v,l[3]=s*v,l):null}function Ut(l){const{userImage:n}=l;return!!(n&&n.render&&n.render())&&(l.data.replace(new Uint8Array(n.data.buffer)),!0)}class Pe extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,s){this._validate(n,s)&&(this.images[n]=s)}_validate(n,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),u=!1),u}_validateStretch(n,s){if(!n)return!0;let u=0;for(const p of n){if(p[0]<u||p[1]<p[0]||s<p[1])return!1;u=p[1]}return!0}_validateContent(n,s){return!(n&&(n.length!==4||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,s){s.version=this.images[n].version+1,this.images[n]=s,this.updatedImages[n]=!0}removeImage(n){const s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,s){let u=!0;if(!this.isLoaded())for(const p of n)this.images[p]||(u=!1);this.isLoaded()||u?this._notify(n,s):this.requestors.push({ids:n,callback:s})}_notify(n,s){const u={};for(const p of n){this.images[p]||this.fire(new o.Event("styleimagemissing",{id:p}));const _=this.images[p];_?u[p]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:n,height:s}=this.atlasImage;return{width:n,height:s}}getPattern(n){const s=this.patterns[n],u=this.getImage(n);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},_=new o.ImagePosition(p,u);this.patterns[n]={bin:p,position:_}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,s.RGBA),this.atlasTexture&&this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const _ in this.patterns)n.push(this.patterns[_].bin);const{w:s,h:u}=o.potpack(n),p=this.atlasImage;p.resize({width:s||1,height:u||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],b=v.x+1,E=v.y+1,I=this.images[_].data,C=I.width,R=I.height;o.RGBAImage.copy(I,p,{x:0,y:0},{x:b,y:E},{width:C,height:R}),o.RGBAImage.copy(I,p,{x:0,y:R-1},{x:b,y:E-1},{width:C,height:1}),o.RGBAImage.copy(I,p,{x:0,y:0},{x:b,y:E+R},{width:C,height:1}),o.RGBAImage.copy(I,p,{x:C-1,y:0},{x:b-1,y:E},{width:1,height:R}),o.RGBAImage.copy(I,p,{x:0,y:0},{x:b+C,y:E},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const s of n){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.images[s];Ut(u)&&this.updateImage(s,u)}}}const tt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(l,n){return function([s,u,p]){const _=o.degToRad(u+90),v=o.degToRad(p);return{x:s*Math.cos(_)*Math.sin(v),y:s*Math.sin(_)*Math.sin(v),z:s*Math.cos(v),azimuthal:u,polar:p}}(l.expression.evaluate(n))}interpolate(l,n,s){return{x:o.number(l.x,n.x,s),y:o.number(l.y,n.y,s),z:o.number(l.z,n.z,s),azimuthal:o.number(l.azimuthal,n.azimuthal,s),polar:o.number(l.polar,n.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class St extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(tt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s={}){if(!this._validate(o.validateLight,n,s))for(const u in n){const p=n[u];o.endsWith(u,"-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||u.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Ot=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)});let vi=class extends o.Evented{constructor(l,n){super(),this._transitionable=new o.Transitionable(Ot),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(l){for(const n in l){const s=l[n];o.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),s):this._transitionable.setValue(n,s)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}};function qt(l,n,s,u){const p=o.smoothstep(45,65,s),[_,v]=ri(l,u),b=o.length(n);let E=1-Math.min(1,Math.exp((b-_)/(v-_)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*p*l.alpha}function ri(l,n){const s=.5/Math.tan(.5*n);return[l.range[0]+s,l.range[1]+s]}const je=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])});class dt extends o.Evented{constructor(n,s){super(),this._transitionable=new o.Transitionable(je),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const n=this._transform,s=n.projection.name==="globe",u=o.globeToMercatorTransition(n.zoom),p=this.properties.get("range"),_=[.5,3];return{range:s?[o.number(_[0],p[0],u),o.number(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,s={}){if(!this._validate(o.validateFog,n,s)){for(const u of Object.keys(o.spec.fog))n&&n[u]===void 0&&(n[u]=o.spec.fog[u].default);for(const u in n){const p=n[u];o.endsWith(u,"-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,n))*s.a}getOpacityAtLatLng(n,s){return this._transform.projection.supportsFog?function(u,p,_){const v=o.MercatorCoordinate.fromLngLat(p),b=_.elevation?_.elevation.getAtPointOrZero(v):0,E=[v.x,v.y,b];return o.transformMat4(E,E,_.mercatorFogMatrix),qt(u,E,_.pitch,_._fov)}(this.state,n,s):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?ri(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||u.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class gt{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const u=this.workerPool.acquire(this.id);for(let p=0;p<u.length;p++){const _=new gt.Actor(u[p],s,this.id);_.name=`Worker ${p}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,u){o.asyncAll(this.actors,(p,_)=>{p.send(n,s,_)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Nt(l,n,s){return n*(o.EXTENT/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}gt.Actor=o.Actor;class Ai{constructor(n,s,u,p){this.screenBounds=n,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,s){let u,p;if(n instanceof o.Point||typeof n[0]=="number"){const _=o.Point.convert(n);u=[_],p=s.isPointAboveHorizon(_)}else{const _=o.Point.convert(n[0]),v=o.Point.convert(n[1]);u=[_,v],p=o.polygonizeBounds(_,v).every(b=>s.isPointAboveHorizon(b))}return new Ai(u,s.getCameraPoint(),p,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(p[3]=this.cameraPoint)),o.bufferConvexPolygon(p,n)}bufferedCameraGeometryGlobe(n){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.Point(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,u,n),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>u.y))+((_.x>s.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(n,s,u,p=0){const _=n.queryPadding/s._pixelsPerMercatorPixel+1,v=u?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let b=n.tileID.wrap+(v.unwrapped?p:0);const E=v.polygon.map(X=>o.getTilePoint(n.tileTransform,X,b));if(!o.polygonIntersectsBox(E,0,0,o.EXTENT,o.EXTENT))return;b=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const I=this.screenGeometryMercator.polygon.map(X=>o.getTileVec3(n.tileTransform,X,b)),C=I.map(X=>new o.Point(X[0],X[1])),R=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),V=o.getTileVec3(n.tileTransform,R,b),q=I.map(X=>{const B=o.sub(X,X,V);return o.normalize(B,B),new o.Ray(V,B)}),W=Nt(n,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:q,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Z=o.getBounds(E),Z.min.x=o.clamp(Z.min.x,0,o.EXTENT),Z.min.y=o.clamp(Z.min.y,0,o.EXTENT),Z.max.x=o.clamp(Z.max.x,0,o.EXTENT),Z.max.y=o.clamp(Z.max.y,0,o.EXTENT),Z),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:W};var Z}_bufferedScreenMercator(n,s){const u=vn(n);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),s):{polygon:this.bufferedScreenGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(n,s){const u=vn(n);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),s):{polygon:this.bufferedCameraGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(n,s){const u=function(_,v){const b=o.multiply([],v.pixelMatrix,v.globeMatrix),E=[0,-o.GLOBE_RADIUS,0,1],I=[0,o.GLOBE_RADIUS,0,1],C=[0,0,0,1];o.transformMat4$1(E,E,b),o.transformMat4$1(I,I,b),o.transformMat4$1(C,C,b);const R=new o.Point(E[0]/E[3],E[1]/E[3]),V=new o.Point(I[0]/I[3],I[1]/I[3]),q=o.polygonContainsPoint(_,R)&&E[3]<C[3],W=o.polygonContainsPoint(_,V)&&I[3]<C[3];if(!q&&!W)return null;const Z=function(ue,ge,me){for(let Se=1;Se<ue.length;Se++){const Je=Ji(ge.pointCoordinate3D(ue[Se-1]).x),we=Ji(ge.pointCoordinate3D(ue[Se]).x);if(me<0){if(Je<we)return{idx:Se,t:-Je/(we-1-Je)}}else if(we<Je)return{idx:Se,t:(1-Je)/(we+1-Je)}}return null}(_,v,q?-1:1);if(!Z)return null;const{idx:X,t:B}=Z;let G=X>1?ti(_.slice(0,X),v):[],J=X<_.length?ti(_.slice(X),v):[];G=G.map(ue=>new o.Point(Ji(ue.x),ue.y)),J=J.map(ue=>new o.Point(Ji(ue.x),ue.y));const $=[...G];$.length===0&&$.push(J[J.length-1]);const le=o.number($[$.length-1].y,(J.length===0?G[0]:J[0]).y,B);let he;return he=q?[new o.Point(0,le),new o.Point(0,0),new o.Point(1,0),new o.Point(1,le)]:[new o.Point(1,le),new o.Point(1,1),new o.Point(0,1),new o.Point(0,le)],$.push(...he),J.length===0?$.push(G[0]):$.push(...J),{polygon:$.map(ue=>new o.MercatorCoordinate(ue.x,ue.y)),unwrapped:!1}}(n,s);if(u)return u;const p=function(_,v){let b=!1,E=-1/0,I=0;for(let R=0;R<_.length-1;R++)_[R].x>E&&(E=_[R].x,I=R);for(let R=0;R<_.length-1;R++){const V=(I+R)%(_.length-1),q=_[V],W=_[V+1];Math.abs(q.x-W.x)>.5&&(q.x<W.x?(q.x+=1,V===0&&(_[_.length-1].x+=1)):(W.x+=1,V+1===_.length-1&&(_[0].x+=1)),b=!0)}const C=o.mercatorXfromLng(v.center.lng);return b&&C<Math.abs(C-1)&&_.forEach(R=>{R.x-=1}),{polygon:_,unwrapped:b}}(ti(n,s).map(_=>new o.Point(Ji(_.x),_.y)),s);return{polygon:p.polygon.map(_=>new o.MercatorCoordinate(_.x,_.y)),unwrapped:p.unwrapped}}}function ti(l,n){return o.resample(l,s=>{const u=n.pointCoordinate3D(s);s.x=u.x,s.y=u.y},1/256)}function Ji(l){return l<0?1+l%1:l%1}function vn(l){return 100*l|0}function An(l,n,s,u,p){const _=function(v,b){if(v)return p(v);if(b){l.url&&b.tiles&&l.tiles&&delete l.tiles;const E=o.pick(o.extend(b,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(I=>I.id)),E.tiles=n.canonicalizeTileset(E,l.url),p(null,E)}};return l.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(l.url,null,s,u),o.ResourceType.Source),_):o.exported.frame(()=>_(null,l))}class Mn{constructor(n,s,u){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),u=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return n.x>=u&&n.x<_&&n.y>=p&&n.y<v}}class $n{constructor(n,s,u){this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ft{constructor(n,s,u,p){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=n;const _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let u=0;u<this.attributes.length;u++){const p=s.attributes[this.attributes[u].name];p!==void 0&&n.enableVertexAttribArray(p)}}setVertexAttribPointers(n,s,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],v=s.attributes[_.name];v!==void 0&&n.vertexAttribPointer(v,_.components,n[xt[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lt extends vt{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ci extends vt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class At extends vt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ei extends vt{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class bi extends vt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class tn extends vt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class $i extends vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ci extends vt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class lr extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class fr extends vt{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Dr extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class gi extends vt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Cn extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class no extends vt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ei extends vt{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Et extends vt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Zt extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class Qi extends vt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class dn extends vt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let nn,Xn=class extends vt{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class bn extends vt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class cr extends vt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class pr extends vt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class mr extends vt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Lr extends vt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class qr extends vt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class te extends vt{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class U extends vt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class N extends vt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ee extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class se extends vt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class fe extends vt{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class be extends fe{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class xe extends fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class pe extends xe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ce{constructor(n,s,u,p){this.context=n,this.width=s,this.height=u;const _=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new be(n,_),p&&(this.depthAttachment=new xe(n,_))}destroy(){const n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}n.deleteFramebuffer(this.framebuffer)}}class nt{constructor(n,s=!1){if(this.gl=n,this.isWebGL2=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),s){const u=n;this.extVertexArrayObject={createVertexArrayOES:u.createVertexArray.bind(n),deleteVertexArrayOES:u.deleteVertexArray.bind(n),bindVertexArrayOES:u.bindVertexArray.bind(n)}}this.clearColor=new lt(this),this.clearDepth=new ci(this),this.clearStencil=new At(this),this.colorMask=new ei(this),this.depthMask=new bi(this),this.stencilMask=new tn(this),this.stencilFunc=new $i(this),this.stencilOp=new Ci(this),this.stencilTest=new lr(this),this.depthRange=new fr(this),this.depthTest=new Dr(this),this.depthFunc=new gi(this),this.blend=new Cn(this),this.blendFunc=new no(this),this.blendColor=new Ei(this),this.blendEquation=new Et(this),this.cullFace=new Zt(this),this.cullFaceSide=new Qi(this),this.frontFace=new dn(this),this.program=new Xn(this),this.activeTexture=new bn(this),this.viewport=new cr(this),this.bindFramebuffer=new pr(this),this.bindRenderbuffer=new mr(this),this.bindTexture=new Lr(this),this.bindVertexBuffer=new qr(this),this.bindElementBuffer=new te(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new U(this),this.pixelStoreUnpack=new N(this),this.pixelStoreUnpackPremultiplyAlpha=new ee(this),this.pixelStoreUnpackFlipY=new se(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),s||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(s||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=s||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s){return new $n(this,n,s)}createVertexBuffer(n,s,u){return new Ft(this,n,s,u)}createRenderbuffer(n,s,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,n,s,u),this.bindRenderbuffer.set(null),_}createFramebuffer(n,s,u){return new Ce(this,n,s,u)}clear({color:n,depth:s,stencil:u}){const p=this.gl;let _=0;n&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(_)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){L(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ht extends o.Evented{constructor(n,s,u,p){if(super(),this.id=n,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(s,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(n){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=An(this._options,this.map._requestManager,s,u,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.ErrorEvent(p))):_&&(o.extend(this,_),_.bounds&&(this.tileBounds=new Mn(_.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(n,s){const u=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(u,o.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=s:n.request=n.actor.send("reloadTile",p,_.bind(this));else if(n.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=o.loadVectorTile.call({deduped:this._deduped},p,(b,E)=>{b||!E?_.call(this,b):(p.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},n.actor&&n.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);n.request={cancel:v}}function _(v,b){return delete n.request,n.aborted?s(null):v&&v.status!==404?s(v):(b&&b.resourceTiming&&(n.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&n.setExpiryData(b),n.loadVectorData(b,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class et extends o.Evented{constructor(n,s,u,p){super(),this.id=n,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=An(this._options,this.map._requestManager,null,null,(s,u)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.ErrorEvent(s)):u&&(o.extend(this,u),u.bounds&&(this.tileBounds=new Mn(u.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(u.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(s)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,s){const u=o.exported.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(p,o.ResourceType.Tile),(_,v,b,E)=>(delete n.request,n.aborted?(n.state="unloaded",s(null)):_?(n.state="errored",s(_)):v?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:b,expires:E}),n.setTexture(v,this.map.painter),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(n,s,u){n.setTexture(s,u)}static unloadTileData(n,s){n.texture&&s.saveTileTexture(n.texture)}abortTile(n,s){n.request&&(n.request.cancel(),delete n.request),s()}unloadTile(n,s){n.texture&&this.map.painter.saveTileTexture(n.texture),s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wt(l,n,s,u,p,_,v,b){const E=[l,s,p,n,u,_,1,1,1],I=[v,b,1],C=o.adjoint([],E),[R,V,q]=o.transformMat3(I,I,o.transpose(C,C));return o.multiply$1(E,[R,0,0,0,V,0,0,0,q],E)}class Vt extends o.Evented{constructor(n,s,u,p){super(),this.id=n,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s,this._dirty=!1}load(n,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(u,p)=>{if(this._imageRequest=null,this._loaded=!0,u)this.fire(new o.ErrorEvent(u));else if(p){const{HTMLImageElement:_}=o.window;this.image=p instanceof _?o.exported.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const s=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let p=1/0,_=1/0,v=-1/0,b=-1/0;for(const R of u)p=Math.min(p,R.x),_=Math.min(_,R.y),v=Math.max(v,R.x),b=Math.max(b,R.y);const E=Math.max(v-p,b-_),I=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),C=Math.pow(2,I);return new o.CanonicalTileID(I,Math.floor((p+v)/2*C),Math.floor((_+b)/2*C))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const E in this.tiles){const I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[u,p,_,v]=this.coordinates.map(E=>{const I=s.projection.project(E[0],E[1]);return o.getTilePoint(s,I)._round()});this.perspectiveTransform=function(E,I,C,R,V,q,W,Z,X,B){const G=Wt(0,0,E,0,0,I,E,I),J=Wt(C,R,V,q,W,Z,X,B);return o.multiply$1(J,o.adjoint(G,G),J),[J[6]/J[8]*E/o.EXTENT,J[7]/J[8]*I/o.EXTENT]}(this.width,this.height,u.x,u.y,p.x,p.y,v.x,v.y,_.x,_.y);const b=this._boundsArray=new o.StructArrayLayout4i8;b.emplaceBack(u.x,u.y,0,0),b.emplaceBack(p.x,p.y,o.EXTENT,0),b.emplaceBack(v.x,v.y,0,o.EXTENT),b.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(b,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,s=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const jt={vector:ht,raster:et,"raster-dem":class extends et{constructor(l,n,s,u){super(l,n,s,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(l,n){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(l.state="errored",n(p)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",n(null))}l.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),(function(p,_,v,b){if(delete l.request,l.aborted)l.state="unloaded",n(null);else if(p)l.state="errored",n(p);else if(_){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:v,expires:b});const E=o.window.ImageBitmap&&_ instanceof o.window.ImageBitmap&&(nn==null&&(nn=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),nn),I=1-(_.width-o.prevPowerOfTwo(_.width))/2;I<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const C=E?_:o.exported.getImageData(_,I),R={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:C,encoding:this.encoding,padding:I};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",R,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const n=l.canonical,s=Math.pow(2,n.z),u=(n.x-1+s)%s,p=n.x===0?l.wrap-1:l.wrap,_=(n.x+1+s)%s,v=n.x+1===s?l.wrap+1:l.wrap,b={};return b[new o.OverscaledTileID(l.overscaledZ,p,n.z,u,n.y).key]={backfilled:!1},b[new o.OverscaledTileID(l.overscaledZ,v,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(b[new o.OverscaledTileID(l.overscaledZ,p,n.z,u,n.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},b[new o.OverscaledTileID(l.overscaledZ,v,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<s&&(b[new o.OverscaledTileID(l.overscaledZ,p,n.z,u,n.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},b[new o.OverscaledTileID(l.overscaledZ,v,n.z,_,n.y+1).key]={backfilled:!1}),b}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends o.Evented{constructor(l,n,s,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const p=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},n),this}getClusterChildren(l,n){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},n),this}getClusterLeaves(l,n,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:n,offset:s},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=o.extend({},this.workerOptions),n=this._data;typeof n=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(s,u)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(p.resourceTiming=u.resourceTiming[this.id]),this.fire(new o.Event("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,n){const s=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(s,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,p)=>(delete l.request,l.unloadVectorData(),l.aborted?n(null):u?n(u):(l.loadVectorData(p,this.map.painter,s==="reloadTile"),n(null))),void 0,s==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Vt{constructor(l,n,s,u){super(l,n,s,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const n of l.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const n=this.video.seekable;l<n.start(0)||l>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,n=l.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(l,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Vt,canvas:class extends Vt{constructor(l,n,s,u){super(l,n,s,u),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.Evented{constructor(l,n,s,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=n,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mn(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:n,y:s,z:u}=l.canonical;return this._implementation.hasTile({x:n,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,n){const{x:s,y:u,z:p}=l.tileID.canonical,_=new o.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:p},{signal:_.signal})).then((function(v){return delete l.request,l.aborted?(l.state="unloaded",n(null)):v===void 0?(l.state="errored",n(null)):v===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",n(null)):function(b){return b instanceof o.window.ImageData||b instanceof o.window.HTMLCanvasElement||b instanceof o.window.ImageBitmap||b instanceof o.window.HTMLImageElement}(v)?(this.loadTileData(l,v),l.state="loaded",void n(null)):(l.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.code!==20&&(l.state="errored",n(v))}),l.request.cancel=()=>_.abort()}loadTileData(l,n){et.loadTileData(l,n,this._map.painter)}unloadTileData(l){et.unloadTileData(l,this._map.painter)}unloadTile(l,n){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:s,y:u,z:p}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:p})}n()}abortTile(l,n){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Kt=function(l,n,s,u){const p=new jt[n.type](l,n,s,u);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],p),p};function oi(l,n){const s=o.identity([]);return o.scale(s,s,[.5*l.width,.5*-l.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,l.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(s)}function Gi(l,n,s,u,p,_,v,b=!1){const E=l.tilesIn(u,v,b);E.sort(Mi);const I=[];for(const R of E)I.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,s,l._state,R,p,_,oi(l.transform,R.tile.tileID),b)});const C=function(R){const V={},q={};for(const W of R){const Z=W.queryResults,X=W.wrappedTileID,B=q[X]=q[X]||{};for(const G in Z){const J=Z[G],$=B[G]=B[G]||{},le=V[G]=V[G]||[];for(const he of J)$[he.featureIndex]||($[he.featureIndex]=!0,le.push(he))}}return V}(I);for(const R in C)C[R].forEach(V=>{const q=V.feature,W=q.layer;W&&W.type!=="background"&&W.type!=="sky"&&(q.source=W.source,W["source-layer"]&&(q.sourceLayer=W["source-layer"]),q.state=q.id!==void 0?l.getFeatureState(W["source-layer"],q.id):{})});return C}function rn(l,n){const s=l.getRenderableIds().map(_=>l.getTileByID(_)),u=[],p={};for(let _=0;_<s.length;_++){const v=s[_],b=v.tileID.canonical.key;p[b]||(p[b]=!0,v.querySourceFeatures(u,n))}return u}function Mi(l,n){const s=l.tileID,u=n.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function on(){return Ls.workerClass!=null?new Ls.workerClass:new o.window.Worker(Ls.workerUrl)}const ur="mapboxgl_preloaded_worker_pool";class wn{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<wn.workerCount;)this.workers.push(new on);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ur]}numActive(){return Object.keys(this.active).length}}let Sn;function Zr(){return Sn||(Sn=new wn),Sn}function Ks(l,n){const s={};for(const u in l)u!=="ref"&&(s[u]=l[u]);return o.refProperties.forEach(u=>{u in n&&(s[u]=n[u])}),s}function Js(l){l=l.slice();const n=Object.create(null);for(let s=0;s<l.length;s++)n[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Ks(l[s],n[l[s].ref]));return l}wn.workerCount=2;const ui={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function $s(l,n,s){s.push({command:ui.addSource,args:[l,n[l]]})}function Zo(l,n,s){n.push({command:ui.removeSource,args:[l]}),s[l]=!0}function Qs(l,n,s,u){Zo(l,s,u),$s(l,n,s)}function Wo(l,n,s){let u;for(u in l[s])if(l[s].hasOwnProperty(u)&&u!=="data"&&!L(l[s][u],n[s][u]))return!1;for(u in n[s])if(n[s].hasOwnProperty(u)&&u!=="data"&&!L(l[s][u],n[s][u]))return!1;return!0}function _r(l,n,s,u,p,_){let v;for(v in n=n||{},l=l||{})l.hasOwnProperty(v)&&(L(l[v],n[v])||s.push({command:_,args:[u,v,n[v],p]}));for(v in n)n.hasOwnProperty(v)&&!l.hasOwnProperty(v)&&(L(l[v],n[v])||s.push({command:_,args:[u,v,n[v],p]}))}function Hn(l){return l.id}function ea(l,n){return l[n.id]=n,l}class ta{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.clamp(n,0,1);let s=1,u=this._distances[s];const p=n*this.paddedLength+this.padding;for(;u<p&&s<this._distances.length;)u=this._distances[++s];const _=s-1,v=this._distances[_],b=u-v,E=b>0?(p-v)/b:0;return this.points[_].mult(1-E).add(this.points[s].mult(E))}}class ro{constructor(n,s,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/u),this.yCellCount=Math.ceil(s/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,u,p,_){this._forEachCell(s,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(n,s,u,p){this._forEachCell(s-p,u-p,s+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(u),this.circles.push(p)}_insertBoxCell(n,s,u,p,_,v){this.boxCells[_].push(v)}_insertCircleCell(n,s,u,p,_,v){this.circleCells[_].push(v)}_query(n,s,u,p,_,v){if(u<0||n>this.width||p<0||s>this.height)return!_&&[];const b=[];if(n<=0&&s<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let E=0;E<this.boxKeys.length;E++)b.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const I=this.circles[3*E],C=this.circles[3*E+1],R=this.circles[3*E+2];b.push({key:this.circleKeys[E],x1:I-R,y1:C-R,x2:I+R,y2:C+R})}return v?b.filter(v):b}return this._forEachCell(n,s,u,p,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},v),_?b.length>0:b}_queryCircle(n,s,u,p,_){const v=n-u,b=n+u,E=s-u,I=s+u;if(b<0||v>this.width||I<0||E>this.height)return!p&&[];const C=[];return this._forEachCell(v,E,b,I,this._queryCellCircle,C,{hitTest:p,circle:{x:n,y:s,radius:u},seenUids:{box:{},circle:{}}},_),p?C.length>0:C}query(n,s,u,p,_){return this._query(n,s,u,p,!1,_)}hitTest(n,s,u,p,_){return this._query(n,s,u,p,!0,_)}hitTestCircle(n,s,u,p){return this._queryCircle(n,s,u,!0,p)}_queryCell(n,s,u,p,_,v,b,E){const I=b.seenUids,C=this.boxCells[_];if(C!==null){const V=this.bboxes;for(const q of C)if(!I.box[q]){I.box[q]=!0;const W=4*q;if(n<=V[W+2]&&s<=V[W+3]&&u>=V[W+0]&&p>=V[W+1]&&(!E||E(this.boxKeys[q]))){if(b.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[q],x1:V[W],y1:V[W+1],x2:V[W+2],y2:V[W+3]})}}}const R=this.circleCells[_];if(R!==null){const V=this.circles;for(const q of R)if(!I.circle[q]){I.circle[q]=!0;const W=3*q;if(this._circleAndRectCollide(V[W],V[W+1],V[W+2],n,s,u,p)&&(!E||E(this.circleKeys[q]))){if(b.hitTest)return v.push(!0),!0;{const Z=V[W],X=V[W+1],B=V[W+2];v.push({key:this.circleKeys[q],x1:Z-B,y1:X-B,x2:Z+B,y2:X+B})}}}}}_queryCellCircle(n,s,u,p,_,v,b,E){const I=b.circle,C=b.seenUids,R=this.boxCells[_];if(R!==null){const q=this.bboxes;for(const W of R)if(!C.box[W]){C.box[W]=!0;const Z=4*W;if(this._circleAndRectCollide(I.x,I.y,I.radius,q[Z+0],q[Z+1],q[Z+2],q[Z+3])&&(!E||E(this.boxKeys[W])))return v.push(!0),!0}}const V=this.circleCells[_];if(V!==null){const q=this.circles;for(const W of V)if(!C.circle[W]){C.circle[W]=!0;const Z=3*W;if(this._circlesCollide(q[Z],q[Z+1],q[Z+2],I.x,I.y,I.radius)&&(!E||E(this.circleKeys[W])))return v.push(!0),!0}}}_forEachCell(n,s,u,p,_,v,b,E){const I=this._convertToXCellCoord(n),C=this._convertToYCellCoord(s),R=this._convertToXCellCoord(u),V=this._convertToYCellCoord(p);for(let q=I;q<=R;q++)for(let W=C;W<=V;W++)if(_.call(this,n,s,u,p,this.xCellCount*W+q,v,b,E))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,u,p,_,v){const b=p-n,E=_-s,I=u+v;return I*I>b*b+E*E}_circleAndRectCollide(n,s,u,p,_,v,b){const E=(v-p)/2,I=Math.abs(n-(p+E));if(I>E+u)return!1;const C=(b-_)/2,R=Math.abs(s-(_+C));if(R>C+u)return!1;if(I<=E||R<=C)return!0;const V=I-E,q=R-C;return V*V+q*q<=u*u}}const hr={unknown:0,flipRequired:1,flipNotRequired:2},Xo=Math.tan(85*Math.PI/180);function Le(l,n,s,u,p,_,v){const b=o.create();if(s)if(_.name==="globe"){const E=o.calculateGlobeLabelMatrix(p,n);o.multiply(b,b,E)}else{const E=Be([],v);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3],u||o.rotateZ(b,b,p.angle)}else o.multiply(b,p.labelPlaneMatrix,l);return b}function Rr(l,n,s,u,p,_,v){const b=Le(l,n,s,u,p,_,v);return _.name==="globe"&&s||(b[2]=b[6]=b[10]=b[14]=0),b}function sn(l,n,s,u,p,_,v){if(s){if(_.name==="globe"){const b=Le(l,n,s,u,p,_,v);return o.invert(b,b),o.multiply(b,l,b),b}{const b=o.clone(l),E=o.identity([]);return E[0]=v[0],E[1]=v[1],E[4]=v[2],E[5]=v[3],o.multiply(b,b,E),u||o.rotateZ(b,b,-p.angle),b}}return p.glCoordMatrix}function Tn(l,n,s,u){const p=[l,n,s,1];s?o.transformMat4$1(p,p,u):rt(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Qa(l,n){return Math.min(.5+l/n*.5,1.5)}function gr(l,n){const s=l[0]/l[3],u=l[1]/l[3];return s>=-n[0]&&s<=n[0]&&u>=-n[1]&&u<=n[1]}function ia(l,n,s,u,p,_,v,b,E,I){const C=s.transform,R=u?l.textSizeData:l.iconSizeData,V=o.evaluateSizeForZoom(R,s.transform.zoom),q=C.projection.name==="globe",W=[256/s.width*2+1,256/s.height*2+1],Z=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();let X=null;q&&(X=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const B=l.lineVertexArray,G=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,J=s.transform.width/s.transform.height;let $,le=!1;for(let he=0;he<G.length;he++){const ue=G.get(he),{numGlyphs:ge,writingMode:me}=ue;if(me!==o.WritingMode.vertical||le||$===o.WritingMode.horizontal||(le=!0),$=me,(ue.hidden||me===o.WritingMode.vertical)&&!le){ae(ge,Z);continue}le=!1;const Se=new o.Point(ue.tileAnchorX,ue.tileAnchorY);let{x:Je,y:we,z:Ue}=C.projection.projectTilePoint(Se.x,Se.y,I.canonical);if(E){const[Gt,wt,Lt]=E(Se);Je+=Gt,we+=wt,Ue+=Lt}const ke=[Je,we,Ue,1];if(o.transformMat4$1(ke,ke,n),!gr(ke,W)){ae(ge,Z);continue}const Ye=Qa(s.transform.cameraToCenterDistance,ke[3]),Me=o.evaluateSizeForFeature(R,V,ue),Fe=v?Me/Ye:Me*Ye,Qe=Tn(Je,we,Ue,p);if(Qe[3]<=0){ae(ge,Z);continue}let Ge={};const it=v?null:E,It=pt(ue,Fe,!1,b,n,p,_,l.glyphOffsetArray,B,Z,X,Qe,Se,Ge,J,it,C.projection,I,v);le=It.useVertical,it&&It.needsFlipping&&(Ge={}),(It.notEnoughRoom||le||It.needsFlipping&&pt(ue,Fe,!0,b,n,p,_,l.glyphOffsetArray,B,Z,X,Qe,Se,Ge,J,it,C.projection,I,v).notEnoughRoom)&&ae(ge,Z)}u?(l.text.dynamicLayoutVertexBuffer.updateData(Z),X&&l.text.globeExtVertexBuffer.updateData(X)):(l.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&l.icon.globeExtVertexBuffer.updateData(X))}function el(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z){const{lineStartIndex:X,glyphStartIndex:B,segment:G}=b,J=B+b.numGlyphs,$=X+b.lineLength,le=n.getoffsetX(B),he=n.getoffsetX(J-1),ue=Yn(l*le,s,u,p,_,v,G,X,$,E,I,C,R,V,!0,q,W,Z);if(!ue)return null;const ge=Yn(l*he,s,u,p,_,v,G,X,$,E,I,C,R,V,!0,q,W,Z);return ge?{first:ue,last:ge}:null}function Eo(l,n,s,u){return l===o.WritingMode.horizontal&&Math.abs(u)>Math.abs(s)?{useVertical:!0}:l===o.WritingMode.vertical?u>0?{needsFlipping:!0}:null:n!==hr.unknown&&function(p,_){return p===0||Math.abs(_/p)>Xo}(s,u)?n===hr.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function pt(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z,X,B,G){const J=n/24,$=l.lineOffsetX*J,le=l.lineOffsetY*J,{lineStartIndex:he,glyphStartIndex:ue,numGlyphs:ge,segment:me,writingMode:Se,flipState:Je}=l,we=he+l.lineLength,Ue=ke=>{if(C){const[Qe,Ge,it]=ke.up,It=I.length;o.updateGlobeVertexNormal(C,It+0,Qe,Ge,it),o.updateGlobeVertexNormal(C,It+1,Qe,Ge,it),o.updateGlobeVertexNormal(C,It+2,Qe,Ge,it),o.updateGlobeVertexNormal(C,It+3,Qe,Ge,it)}const[Ye,Me,Fe]=ke.point;o.addDynamicAttributes(I,Ye,Me,Fe,ke.angle)};if(ge>1){const ke=el(J,b,$,le,s,R,V,l,E,_,q,Z,!1,X,B,G);if(!ke)return{notEnoughRoom:!0};if(u&&!s){let[Ye,Me,Fe]=ke.first.point,[Qe,Ge,it]=ke.last.point;[Ye,Me]=Tn(Ye,Me,Fe,v),[Qe,Ge]=Tn(Qe,Ge,it,v);const It=Eo(Se,Je,(Qe-Ye)*W,Ge-Me);if(l.flipState=It&&It.needsFlipping?hr.flipRequired:hr.flipNotRequired,It)return It}Ue(ke.first);for(let Ye=ue+1;Ye<ue+ge-1;Ye++){const Me=Yn(J*b.getoffsetX(Ye),$,le,s,R,V,me,he,we,E,_,q,Z,!1,!1,X,B,G);if(!Me)return I.length-=4*(Ye-ue),{notEnoughRoom:!0};Ue(Me)}Ue(ke.last)}else{if(u&&!s){const Ye=Tn(V.x,V.y,0,p),Me=he+me+1,Fe=new o.Point(E.getx(Me),E.gety(Me)),Qe=Tn(Fe.x,Fe.y,0,p),Ge=Qe[3]>0?Qe:ii(V,Fe,Ye,1,p,void 0,X,B.canonical),it=Eo(Se,Je,(Ge[0]-Ye[0])*W,Ge[1]-Ye[1]);if(l.flipState=it&&it.needsFlipping?hr.flipRequired:hr.flipNotRequired,it)return it}const ke=Yn(J*b.getoffsetX(ue),$,le,s,R,V,me,he,we,E,_,q,Z,!1,!1,X,B,G);if(!ke)return{notEnoughRoom:!0};Ue(ke)}return{}}function ai(l,n,s,u,p){const{x:_,y:v,z:b}=u.projectTilePoint(l.x,l.y,n);if(!p)return Tn(_,v,b,s);const[E,I,C]=p(l);return Tn(_+E,v+I,b+C,s)}function ii(l,n,s,u,p,_,v,b){const E=ai(l.sub(n)._unit()._add(l),b,p,v,_);return o.sub(E,s,E),o.normalize(E,E),o.scaleAndAdd(E,s,E,u)}function Yn(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z,X,B){const G=u?l-n:l+n;let J=G>0?1:-1,$=0;u&&(J*=-1,$=Math.PI),J<0&&($+=Math.PI);let le=b+v+(J>0?0:1)|0,he=p,ue=p,ge=0,me=0;const Se=Math.abs(G),Je=[],we=[];let Ue=_,ke=Ue;const Ye=()=>ii(ke,Ue,ue,Se-ge+1,C,V,Z,X.canonical);for(;ge+me<=Se;){if(le+=J,le<b||le>=E)return null;if(ue=he,ke=Ue,Je.push(ue),q&&we.push(ke),Ue=new o.Point(I.getx(le),I.gety(le)),he=R[le],!he){const Lt=ai(Ue,X.canonical,C,Z,V);he=Lt[3]>0?R[le]=Lt:Ye()}ge+=me,me=o.distance(ue,he)}W&&V&&(R[le]&&(he=Ye(),me=o.distance(ue,he)),R[le]=he);const Me=(Se-ge)/me,Fe=Ue.sub(ke)._mult(Me)._add(ke),Qe=o.sub([],he,ue),Ge=o.scaleAndAdd([],ue,Qe,Me);let it=[0,0,1],It=Qe[0],Gt=Qe[1];if(B&&(it=Z.upVector(X.canonical,Fe.x,Fe.y),it[0]!==0||it[1]!==0||it[2]!==1)){const Lt=[it[2],0,-it[0]],li=o.cross([],it,Lt);o.normalize(Lt,Lt),o.normalize(li,li),It=o.dot(Qe,Lt),Gt=o.dot(Qe,li)}if(s){const Lt=o.cross([],it,Qe);o.normalize(Lt,Lt),o.scaleAndAdd(Ge,Ge,Lt,s*J)}const wt=$+Math.atan2(Gt,It);return Je.push(Ge),q&&we.push(Fe),{point:Ge,angle:wt,path:Je,tilePath:we,up:it}}function ae(l,n){const s=n.length,u=s+4*l;n.resize(u),n.float32.fill(-1/0,4*s,4*u)}function rt(l,n,s){const u=n[0],p=n[1];return l[0]=s[0]*u+s[4]*p+s[12],l[1]=s[1]*u+s[5]*p+s[13],l[3]=s[3]*u+s[7]*p+s[15],l}const hi=100;class Kn{constructor(n,s,u=new ro(n.width+200,n.height+200,25),p=new ro(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+hi,this.screenBottomBoundary=n.height+hi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=s}placeCollisionBox(n,s,u,p,_,v,b,E){let I=u.projectedAnchorX,C=u.projectedAnchorY,R=u.projectedAnchorZ;const V=u.elevation,q=u.tileID,W=n.getProjection();if(V&&q){const[he,ue,ge]=W.upVector(q.canonical,u.tileAnchorX,u.tileAnchorY),me=W.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=he*V*me,C+=ue*V*me,R+=ge*V*me}const Z=this.projectAndGetPerspectiveRatio(b,I,C,R,u.tileID,W.name==="globe"||!!V||this.transform.pitch>0,W),X=v*Z.perspectiveRatio,B=(u.x1*s+p.x-u.padding)*X+Z.point.x,G=(u.y1*s+p.y-u.padding)*X+Z.point.y,J=(u.x2*s+p.x+u.padding)*X+Z.point.x,$=(u.y2*s+p.y+u.padding)*X+Z.point.y,le=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(B,G,J,$)||!_&&this.grid.hitTest(B,G,J,$,E)||le?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[B,G,J,$],offscreen:this.isOffscreen(B,G,J,$),occluded:!1}}placeCollisionCircles(n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z){const X=[],B=this.transform.elevation,G=n.getProjection(),J=B?B.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,G):null,$=new o.Point(u.tileAnchorX,u.tileAnchorY);let{x:le,y:he,z:ue}=G.projectTilePoint($.x,$.y,Z.canonical);if(J){const[Fe,Qe,Ge]=J($);le+=Fe,he+=Qe,ue+=Ge}const ge=G.name==="globe",me=this.projectAndGetPerspectiveRatio(b,le,he,ue,Z,ge||!!B||this.transform.pitch>0,G),{perspectiveRatio:Se}=me,Je=(R?v/Se:v*Se)/o.ONE_EM,we=Tn(le,he,ue,E),Ue=me.signedDistanceFromCamera>0?el(Je,_,u.lineOffsetX*Je,u.lineOffsetY*Je,!1,we,$,u,p,E,{},B&&!R?J:null,R&&!!B,G,Z,R):null;let ke=!1,Ye=!1,Me=!0;if(Ue&&!me.occluded){const Fe=.5*q*Se+W,Qe=new o.Point(-100,-100),Ge=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),it=new ta,{first:It,last:Gt}=Ue,wt=It.path.length;let Lt=[];for(let Ct=wt-1;Ct>=1;Ct--)Lt.push(It.path[Ct]);for(let Ct=1;Ct<Gt.path.length;Ct++)Lt.push(Gt.path[Ct]);const li=2.5*Fe;I&&(Lt=Lt.map(([Ct,Ti,Ii],ki)=>(J&&!ge&&(Ii=J(ki<wt-1?It.tilePath[wt-1-ki]:Gt.tilePath[ki-wt+2])[2]),Tn(Ct,Ti,Ii,I))),Lt.some(Ct=>Ct[3]<=0)&&(Lt=[]));let si=[];if(Lt.length>0){let Ct=1/0,Ti=-1/0,Ii=1/0,ki=-1/0;for(const zi of Lt)Ct=Math.min(Ct,zi[0]),Ii=Math.min(Ii,zi[1]),Ti=Math.max(Ti,zi[0]),ki=Math.max(ki,zi[1]);Ti>=Qe.x&&Ct<=Ge.x&&ki>=Qe.y&&Ii<=Ge.y&&(si=[Lt.map(zi=>new o.Point(zi[0],zi[1]))],(Ct<Qe.x||Ti>Ge.x||Ii<Qe.y||ki>Ge.y)&&(si=o.clipLine(si,Qe.x,Qe.y,Ge.x,Ge.y)))}for(const Ct of si){it.reset(Ct,.25*Fe);let Ti=0;Ti=it.length<=.5*Fe?1:Math.ceil(it.paddedLength/li)+1;for(let Ii=0;Ii<Ti;Ii++){const ki=Ii/Math.max(Ti-1,1),zi=it.lerp(ki),jn=zi.x+hi,kn=zi.y+hi;X.push(jn,kn,Fe,0);const br=jn-Fe,Yr=kn-Fe,Hi=jn+Fe,Pi=kn+Fe;if(Me=Me&&this.isOffscreen(br,Yr,Hi,Pi),Ye=Ye||this.isInsideGrid(br,Yr,Hi,Pi),!s&&this.grid.hitTestCircle(jn,kn,Fe,V)&&(ke=!0,!C))return{circles:[],offscreen:!1,collisionDetected:ke,occluded:!1}}}}return{circles:!C&&ke||!Ye?[]:X,offscreen:Me,collisionDetected:ke,occluded:me.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,p=1/0,_=-1/0,v=-1/0;for(const C of n){const R=new o.Point(C.x+hi,C.y+hi);u=Math.min(u,R.x),p=Math.min(p,R.y),_=Math.max(_,R.x),v=Math.max(v,R.y),s.push(R)}const b=this.grid.query(u,p,_,v).concat(this.ignoredGrid.query(u,p,_,v)),E={},I={};for(const C of b){const R=C.key;if(E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;const V=[new o.Point(C.x1,C.y1),new o.Point(C.x2,C.y1),new o.Point(C.x2,C.y2),new o.Point(C.x1,C.y2)];o.polygonIntersectsPolygon(s,V)&&(E[R.bucketInstanceId][R.featureIndex]=!0,I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]=[]),I[R.bucketInstanceId].push(R.featureIndex))}return I}insertCollisionBox(n,s,u,p,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,u,p,_){const v=s?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let E=0;E<n.length;E+=4)v.insertCircle(b,n[E],n[E+1],n[E+2])}projectAndGetPerspectiveRatio(n,s,u,p,_,v,b){const E=[s,u,p,1];let I=!1;p||this.transform.pitch>0?(o.transformMat4$1(E,E,n),this.fogState&&_&&b.name!=="globe"&&(I=function(V,q,W,Z,X,B){const G=B.calculateFogTileMatrix(X),J=[q,W,Z];return o.transformMat4(J,J,G),qt(V,J,B.pitch,B._fov)}(this.fogState,s,u,p,_.toUnwrapped(),this.transform)>.9)):rt(E,E,n);const C=E[3];return{point:new o.Point((E[0]/C+1)/2*this.transform.width+hi,(-E[1]/C+1)/2*this.transform.height+hi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/C*.5,1.5),signedDistanceFromCamera:C,occluded:v&&E[2]>C||I}}isOffscreen(n,s,u,p){return u<hi||n>=this.screenRightBoundary||p<hi||s>this.screenBottomBoundary}isInsideGrid(n,s,u,p){return u>=0&&n<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}function Qn(l,n,s){const u=n.createTileMatrix(l,l.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),l.projMatrix,u)}function cn(l,n,s){if(n.projection.name===s.projection.name)return l.projMatrix;const u=s.clone();return u.setProjection(n.projection),Qn(u,n.getProjection(),l)}function Xi(l,n,s){return n.name===s.projection.name?l.projMatrix:Qn(s,n,l)}class Hu{constructor(n,s,u,p){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class oo{constructor(n,s,u,p,_,v=!1){this.text=new Hu(n?n.text:null,s,u,_),this.icon=new Hu(n?n.icon:null,s,p,_),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class na{constructor(n,s,u,p=!1){this.text=n,this.icon=s,this.skipFade=u,this.clipped=p}}class ra{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class cc{constructor(n,s,u,p,_){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class Yu{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[n]}}function oa(l,n,s,u,p){const{horizontalAlign:_,verticalAlign:v}=o.getAnchorAlignment(l),b=-(_-.5)*n,E=-(v-.5)*s,I=o.evaluateVariableOffset(l,u);return new o.Point(b+I[0]*p,E+I[1]*p)}function sa(l,n,s,u,p){const _=new o.Point(l,n);return s&&_._rotate(u?p:-p),_}class tl{constructor(n,s,u,p,_){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Kn(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Yu(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,s,u,p){const _=u.getBucket(s),v=u.latestFeatureIndex;if(!_||!v||s.id!==_.layerIds[0])return;const b=_.layers[0].layout,E=u.collisionBoxArray,I=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),C=u.tileSize/o.EXTENT,R=u.tileID.toUnwrapped();this.transform.setProjection(_.projection);const V=(q=u.tileID,W=_.getProjection(),Z=this.transform,W.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):Qn(Z,W,q));var q,W,Z;const X=b.get("text-pitch-alignment")==="map",B=b.get("text-rotation-alignment")==="map";s.compileFilter();const G=s.dynamicFilter(),J=s.dynamicFilterNeedsFeature(),$=this.transform.calculatePixelsToTileUnitsMatrix(u),le=Rr(V,u.tileID.canonical,X,B,this.transform,_.getProjection(),$);let he=null;if(X){const me=sn(V,u.tileID.canonical,X,B,this.transform,_.getProjection(),$);he=o.multiply([],this.transform.labelPlaneMatrix,me)}let ue=null;G&&u.latestFeatureIndex&&(ue={unwrappedTileID:R,dynamicFilter:G,dynamicFilterNeedsFeature:J,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new cc(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,u.tileID);const ge={bucket:_,layout:b,posMatrix:V,textLabelPlaneMatrix:le,labelToScreenMatrix:he,clippingData:ue,scale:I,textPixelRatio:C,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const me of _.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:Je,symbolInstanceEnd:we}=me;n.push({sortKey:Se,symbolInstanceStart:Je,symbolInstanceEnd:we,parameters:ge})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z,X,B,G){const{textOffset0:J,textOffset1:$,crossTileID:le}=V,he=[J,$],ue=oa(n,u,p,he,_),ge=this.collisionIndex.placeCollisionBox(W,_,s,sa(ue.x,ue.y,v,b,this.transform.angle),R,E,I,C.predicate);if(X){const me=W.getSymbolInstanceIconSize(G,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,me,X,sa(ue.x,ue.y,v,b,this.transform.angle),R,E,I,C.predicate).box.length===0)return}if(ge.box.length>0){let me;return this.prevPlacement&&this.prevPlacement.variableOffsets[le]&&this.prevPlacement.placements[le]&&this.prevPlacement.placements[le].text&&(me=this.prevPlacement.variableOffsets[le].anchor),this.variableOffsets[le]={textOffset:he,width:u,height:p,anchor:n,textScale:_,prevAnchor:me},this.markUsedJustification(W,n,V,Z),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Z,V),this.placedOrientations[le]=Z),{shift:ue,placedGlyphBoxes:ge}}}placeLayerBucketPart(n,s,u,p){const{bucket:_,layout:v,posMatrix:b,textLabelPlaneMatrix:E,labelToScreenMatrix:I,clippingData:C,textPixelRatio:R,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:Z,collisionGroup:X}=n.parameters,B=v.get("text-optional"),G=v.get("icon-optional"),J=v.get("text-allow-overlap"),$=v.get("icon-allow-overlap"),le=v.get("text-rotation-alignment")==="map",he=v.get("text-pitch-alignment")==="map",ue=v.get("icon-text-fit")!=="none",ge=v.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let me=J&&($||!_.hasIconData()||G),Se=$&&(J||!_.hasTextData()||B);!_.collisionArrays&&q&&_.deserializeCollisionBoxes(q),u&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,q);const Je=(we,Ue,ke)=>{const{crossTileID:Ye,numVerticalGlyphVertices:Me}=we;if(C){const Hi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Pi=null;if(C.dynamicFilterNeedsFeature){const yi=this.retainedQueryData[_.bucketInstanceId];Pi=C.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:yi.bucketIndex,sourceLayerIndex:yi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,C.dynamicFilter)(Hi,Pi,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.Point(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(C.unwrappedTileID)))return this.placements[Ye]=new na(!1,!1,!1,!0),void s.add(Ye)}if(s.has(Ye))return;if(V)return void(this.placements[Ye]=new na(!1,!1,!1));let Fe=!1,Qe=!1,Ge=!0,it=!1,It=!1,Gt=null,wt={box:null,offscreen:null,occluded:null},Lt={box:null,offscreen:null,occluded:null},li=null,si=null,Ct=null,Ti=0,Ii=0,ki=0;ke.textFeatureIndex?Ti=ke.textFeatureIndex:we.useRuntimeCollisionCircles&&(Ti=we.featureIndex),ke.verticalTextFeatureIndex&&(Ii=ke.verticalTextFeatureIndex);const zi=Hi=>{Hi.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Pi=this.transform.elevation;(Pi||Hi.elevation)&&(Hi.elevation=Pi?Pi.getAtTileOffset(Hi.tileID,Hi.tileAnchorX,Hi.tileAnchorY):0)},jn=ke.textBox;if(jn){zi(jn);const Hi=yi=>{let fn=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!yi&&this.prevPlacement){const Jn=this.prevPlacement.placedOrientations[Ye];Jn&&(this.placedOrientations[Ye]=Jn,fn=Jn,this.markUsedOrientation(_,fn,we))}return fn},Pi=(yi,fn)=>{if(_.allowVerticalPlacement&&Me>0&&ke.verticalTextBox){for(const Jn of _.writingModes)if(Jn===o.WritingMode.vertical?(wt=fn(),Lt=wt):wt=yi(),wt&&wt.box&&wt.box.length)break}else wt=yi()};if(v.get("text-variable-anchor")){let yi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye]){const qi=this.prevPlacement.variableOffsets[Ye];yi.indexOf(qi.anchor)>0&&(yi=yi.filter(ir=>ir!==qi.anchor),yi.unshift(qi.anchor))}const fn=(qi,ir,Cl)=>{const ts=_.getSymbolInstanceTextSize(W,we,this.transform.zoom,Ue),Sa=(qi.x2-qi.x1)*ts+2*qi.padding,fo=(qi.y2-qi.y1)*ts+2*qi.padding,Ao=ue&&!$?ir:null;Ao&&zi(Ao);let is={box:[],offscreen:!1,occluded:!1};const Il=J?2*yi.length:yi.length;for(let Aa=0;Aa<Il;++Aa){const Qc=this.attemptAnchorPlacement(yi[Aa%yi.length],qi,Sa,fo,ts,le,he,R,b,X,Aa>=yi.length,we,Ue,_,Cl,Ao,W,Z);if(Qc&&(is=Qc.placedGlyphBoxes,is&&is.box&&is.box.length)){Fe=!0,Gt=Qc.shift;break}}return is};Pi(()=>fn(jn,ke.iconBox,o.WritingMode.horizontal),()=>{const qi=ke.verticalTextBox;return qi&&zi(qi),_.allowVerticalPlacement&&!(wt&&wt.box&&wt.box.length)&&Me>0&&qi?fn(qi,ke.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wt&&(Fe=wt.box,Ge=wt.offscreen,it=wt.occluded);const Jn=Hi(!(!wt||!wt.box));if(!Fe&&this.prevPlacement){const qi=this.prevPlacement.variableOffsets[Ye];qi&&(this.variableOffsets[Ye]=qi,this.markUsedJustification(_,qi.anchor,we,Jn))}}else{const yi=(fn,Jn)=>{const qi=_.getSymbolInstanceTextSize(W,we,this.transform.zoom,Ue),ir=this.collisionIndex.placeCollisionBox(_,qi,fn,new o.Point(0,0),J,R,b,X.predicate);return ir&&ir.box&&ir.box.length&&(this.markUsedOrientation(_,Jn,we),this.placedOrientations[Ye]=Jn),ir};Pi(()=>yi(jn,o.WritingMode.horizontal),()=>{const fn=ke.verticalTextBox;return _.allowVerticalPlacement&&Me>0&&fn?(zi(fn),yi(fn,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Hi(!!(wt&&wt.box&&wt.box.length))}}if(li=wt,Fe=li&&li.box&&li.box.length>0,Ge=li&&li.offscreen,it=li&&li.occluded,we.useRuntimeCollisionCircles){const Hi=_.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),Pi=o.evaluateSizeForFeature(_.textSizeData,W,Hi),yi=v.get("text-padding");si=this.collisionIndex.placeCollisionCircles(_,J,Hi,_.lineVertexArray,_.glyphOffsetArray,Pi,b,E,I,u,he,X.predicate,we.collisionCircleDiameter*Pi/o.ONE_EM,yi,this.retainedQueryData[_.bucketInstanceId].tileID),Fe=J||si.circles.length>0&&!si.collisionDetected,Ge=Ge&&si.offscreen,it=si.occluded}if(ke.iconFeatureIndex&&(ki=ke.iconFeatureIndex),ke.iconBox){const Hi=Pi=>{zi(Pi);const yi=ue&&Gt?sa(Gt.x,Gt.y,le,he,this.transform.angle):new o.Point(0,0),fn=_.getSymbolInstanceIconSize(Z,this.transform.zoom,we.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,fn,Pi,yi,$,R,b,X.predicate)};Lt&&Lt.box&&Lt.box.length&&ke.verticalIconBox?(Ct=Hi(ke.verticalIconBox),Qe=Ct.box.length>0):(Ct=Hi(ke.iconBox),Qe=Ct.box.length>0),Ge=Ge&&Ct.offscreen,It=Ct.occluded}const kn=B||we.numHorizontalGlyphVertices===0&&Me===0,br=G||we.numIconVertices===0;if(kn||br?br?kn||(Qe=Qe&&Fe):Fe=Qe&&Fe:Qe=Fe=Qe&&Fe,Fe&&li&&li.box&&this.collisionIndex.insertCollisionBox(li.box,v.get("text-ignore-placement"),_.bucketInstanceId,Lt&&Lt.box&&Ii?Ii:Ti,X.ID),Qe&&Ct&&this.collisionIndex.insertCollisionBox(Ct.box,v.get("icon-ignore-placement"),_.bucketInstanceId,ki,X.ID),si&&(Fe&&this.collisionIndex.insertCollisionCircles(si.circles,v.get("text-ignore-placement"),_.bucketInstanceId,Ti,X.ID),u)){const Hi=_.bucketInstanceId;let Pi=this.collisionCircleArrays[Hi];Pi===void 0&&(Pi=this.collisionCircleArrays[Hi]=new ra);for(let yi=0;yi<si.circles.length;yi+=4)Pi.circles.push(si.circles[yi+0]),Pi.circles.push(si.circles[yi+1]),Pi.circles.push(si.circles[yi+2]),Pi.circles.push(si.collisionDetected?1:0)}const Yr=_.projection.name!=="globe";me=me&&(Yr||!it),Se=Se&&(Yr||!It),this.placements[Ye]=new na(Fe||me,Qe||Se,Ge||_.justReloaded),s.add(Ye)};if(ge){const we=_.getSortedSymbolIndexes(this.transform.angle);for(let Ue=we.length-1;Ue>=0;--Ue){const ke=we[Ue];Je(_.symbolInstances.get(ke),ke,_.collisionArrays[ke])}}else for(let we=n.symbolInstanceStart;we<n.symbolInstanceEnd;we++)Je(_.symbolInstances.get(we),we,_.collisionArrays[we]);if(u&&_.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[_.bucketInstanceId];o.invert(we.invProjMatrix,b),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(n,s,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E,crossTileID:I}=u,C=o.getAnchorJustification(s),R=p===o.WritingMode.vertical?E:C==="left"?_:C==="center"?v:C==="right"?b:-1;_>=0&&(n.text.placedSymbolArray.get(_).crossTileID=R>=0&&_!==R?0:I),v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=R>=0&&v!==R?0:I),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=R>=0&&b!==R?0:I),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=R>=0&&E!==R?0:I)}markUsedOrientation(n,s,u){const p=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,_=s===o.WritingMode.vertical?s:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:I}=u,C=n.text.placedSymbolArray;v>=0&&(C.get(v).placedOrientation=p),b>=0&&(C.get(b).placedOrientation=p),E>=0&&(C.get(E).placedOrientation=p),I>=0&&(C.get(I).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(n):1,_=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const E in this.placements){const I=this.placements[E],C=_[E];C?(this.opacities[E]=new oo(C,p,I.text,I.icon,null,I.clipped),u=u||I.text!==C.text.placed||I.icon!==C.icon.placed):(this.opacities[E]=new oo(null,p,I.text,I.icon,I.skipFade,I.clipped),u=u||I.text||I.icon)}for(const E in _){const I=_[E];if(!this.opacities[E]){const C=new oo(I,p,!1,!1);C.isHidden()||(this.opacities[E]=C,u=u||I.text.placed||I.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);u?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){const u=new Set;for(const p of s){const _=p.getBucket(n);_&&p.latestFeatureIndex&&n.id===_.layerIds[0]&&this.updateBucketOpacities(_,u,p.collisionBoxArray)}}updateBucketOpacities(n,s,u){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const p=n.layers[0].layout,_=!!n.layers[0].dynamicFilter(),v=new oo(null,0,!1,!1,!0),b=p.get("text-allow-overlap"),E=p.get("icon-allow-overlap"),I=p.get("text-variable-anchor"),C=p.get("text-rotation-alignment")==="map",R=p.get("text-pitch-alignment")==="map",V=p.get("icon-text-fit")!=="none",q=new oo(null,0,b&&(E||!n.hasIconData()||p.get("icon-optional")),E&&(b||!n.hasTextData()||p.get("text-optional")),!0);!n.collisionArrays&&u&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(u);const W=(X,B,G)=>{for(let J=0;J<B/4;J++)X.opacityVertexArray.emplaceBack(G)};let Z=0;for(let X=0;X<n.symbolInstances.length;X++){const B=n.symbolInstances.get(X),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:J,crossTileID:$,numIconVertices:le}=B,he=s.has($);let ue=this.opacities[$];he?ue=v:ue||(ue=q,this.opacities[$]=ue),s.add($);const ge=G>0||J>0,me=le>0,Se=this.placedOrientations[$],Je=Se===o.WritingMode.vertical,we=Se===o.WritingMode.horizontal||Se===o.WritingMode.horizontalOnly;if(!ge&&!me||ue.isHidden()||Z++,ge){const Ue=aa(ue.text);W(n.text,G,Je?an:Ue),W(n.text,J,we?an:Ue);const ke=ue.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:Me,rightJustifiedTextSymbolIndex:Fe,verticalPlacedTextSymbolIndex:Qe}=B,Ge=n.text.placedSymbolArray,it=ke||Je?1:0;Ye>=0&&(Ge.get(Ye).hidden=it),Me>=0&&(Ge.get(Me).hidden=it),Fe>=0&&(Ge.get(Fe).hidden=it),Qe>=0&&(Ge.get(Qe).hidden=ke||we?1:0);const It=this.variableOffsets[$];It&&this.markUsedJustification(n,It.anchor,B,Se);const Gt=this.placedOrientations[$];Gt&&(this.markUsedJustification(n,"left",B,Gt),this.markUsedOrientation(n,Gt,B))}if(me){const Ue=aa(ue.icon),{placedIconSymbolIndex:ke,verticalPlacedIconSymbolIndex:Ye}=B,Me=n.icon.placedSymbolArray,Fe=ue.icon.isHidden()?1:0;ke>=0&&(W(n.icon,le,Je?an:Ue),Me.get(ke).hidden=Fe),Ye>=0&&(W(n.icon,B.numVerticalIconVertices,we?an:Ue),Me.get(Ye).hidden=Fe)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ue=n.collisionArrays[X];if(Ue){let ke=new o.Point(0,0),Ye=!0;if(Ue.textBox||Ue.verticalTextBox){if(I){const Fe=this.variableOffsets[$];Fe?(ke=oa(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textScale),C&&ke._rotate(R?this.transform.angle:-this.transform.angle)):Ye=!1}_&&(Ye=!ue.clipped),Ue.textBox&&ys(n.textCollisionBox.collisionVertexArray,ue.text.placed,!Ye||Je,ke.x,ke.y),Ue.verticalTextBox&&ys(n.textCollisionBox.collisionVertexArray,ue.text.placed,!Ye||we,ke.x,ke.y)}const Me=Ye&&!!(!we&&Ue.verticalIconBox);Ue.iconBox&&ys(n.iconCollisionBox.collisionVertexArray,ue.icon.placed,Me,V?ke.x:0,V?ke.y:0),Ue.verticalIconBox&&ys(n.iconCollisionBox.collisionVertexArray,ue.icon.placed,!Me,V?ke.x:0,V?ke.y:0)}}}if(n.fullyClipped=Z===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=X.invProjMatrix,n.placementViewportMatrix=X.viewportMatrix,n.collisionCircleArray=X.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>n}setStale(){this.stale=!0}}function ys(l,n,s,u,p){l.emplaceBack(n?1:0,s?1:0,u||0,p||0),l.emplaceBack(n?1:0,s?1:0,u||0,p||0),l.emplaceBack(n?1:0,s?1:0,u||0,p||0),l.emplaceBack(n?1:0,s?1:0,u||0,p||0)}const er=Math.pow(2,25),un=Math.pow(2,24),uc=Math.pow(2,17),hc=Math.pow(2,16),tr=Math.pow(2,9),yr=Math.pow(2,8),Ku=Math.pow(2,1);function aa(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const n=l.placed?1:0,s=Math.floor(127*l.opacity);return s*er+n*un+s*uc+n*hc+s*tr+n*yr+s*Ku+n}const an=0;class la{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,s,u,p,_){const v=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(v,p,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,E)=>b.sortKey-E.sortKey));this._currentPartIndex<v.length;){const b=v[this._currentPartIndex];if(s.placeLayerBucketPart(b,this._seenCrossTileIDs,u,b.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class dc{constructor(n,s,u,p,_,v,b,E){this.placement=new tl(n,_,v,b,E),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(n,s,u){const p=o.exported.now(),_=()=>{const v=o.exported.now()-p;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=s[n[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new la(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ho=512/o.EXTENT/2;class Ln{constructor(n,s,u){this.tileID=n,this.bucketInstanceId=u,this.index=new o.KDBush(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=n.canonical.x*o.EXTENT,_=n.canonical.y*o.EXTENT;for(let v=0;v<s.length;v++){const{key:b,crossTileID:E,tileAnchorX:I,tileAnchorY:C}=s.get(v),R=Math.floor((p+I)*Ho),V=Math.floor((_+C)*Ho);this.index.add(R,V),this.keys.push(b),this.crossTileIDs.push(E)}this.index.finish()}findMatches(n,s,u){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),_=Ho/Math.pow(2,s.canonical.z-this.tileID.canonical.z),v=s.canonical.x*o.EXTENT,b=s.canonical.y*o.EXTENT;for(let E=0;E<n.length;E++){const I=n.get(E);if(I.crossTileID)continue;const{key:C,tileAnchorX:R,tileAnchorY:V}=I,q=Math.floor((v+R)*_),W=Math.floor((b+V)*_),Z=this.index.range(q-p,W-p,q+p,W+p);for(const X of Z){const B=this.crossTileIDs[X];if(this.keys[X]===C&&!u.has(B)){u.add(B),I.crossTileID=B;break}}}}}class fc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(s!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const v in p){const b=p[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),_[b.tileID.key]=b}this.indexes[u]=_}this.lng=n}addBucket(n,s,u){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const p=this.usedCrossTileIDs[n.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>n.overscaledZ)for(const b in v){const E=v[b];E.tileID.isChildOf(n)&&E.findMatches(s.symbolInstances,n,p)}else{const b=v[n.scaledTo(Number(_)).key];b&&b.findMatches(s.symbolInstances,n,p)}}for(let _=0;_<s.symbolInstances.length;_++){const v=s.symbolInstances.get(_);v.crossTileID||(v.crossTileID=u.generate(),p.add(v.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ln(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const u of s.crossTileIDs)this.usedCrossTileIDs[n].delete(u)}removeStaleBuckets(n){let s=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)n[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],s=!0)}return s}}class so{constructor(){this.layerIndexes={},this.crossTileIDs=new fc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,u,p){let _=this.layerIndexes[n.id];_===void 0&&(_=this.layerIndexes[n.id]=new pc);let v=!1;const b={};p.name!=="globe"&&_.handleWrapJump(u);for(const E of s){const I=E.getBucket(n);I&&n.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(E.tileID,I,this.crossTileIDs)&&(v=!0),b[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(b)&&(v=!0),v}pruneUnusedLayers(n){const s={};n.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const Mo=(l,n)=>o.emitValidationErrors(l,n&&n.filter(s=>s.identifier!=="source.canvas")),il=o.pick(ui,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qd=o.pick(ui,["setCenter","setZoom","setBearing","setPitch"]),mc={version:8,layers:[],sources:{}},xs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Wr extends o.Evented{constructor(n,s={}){super(),this.map=n,this.dispatcher=new gt(Zr(),this),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.crossTileSymbolIndex=new so,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const u=this;this._rtlTextPluginCallback=Wr.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,v)=>{if(o.triggerPluginCompletionEvent(_),v&&v.every(b=>b))for(const b in u._sourceCaches){const E=u._sourceCaches[b],I=E.getSource().type;I!=="vector"&&I!=="geojson"||E.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getSource(p.sourceId);if(_&&_.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===_.id&&this._validateLayer(b)}})}loadURL(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const u=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,s.accessToken);const p=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(p,(_,v)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):v&&this._load(v,u)})}loadJSON(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(mc,!1)}_updateLayerCount(n,s){const u=s?1:-1;n.is3D()&&(this._num3DLayers+=u),n.type==="circle"&&(this._numCircleLayers+=u),n.type==="symbol"&&(this._numSymbolLayers+=u)}_load(n,s){if(s&&Mo(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=o.clone$1(n),this._updateMapProjection();for(const p in n.sources)this.addSource(p,n.sources[p],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const u=Js(this.stylesheet.layers);this._order=u.map(p=>p.id),this._layers={},this._serializedLayers={};for(const p of u){const _=o.createStyleLayer(p);_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(s,u,p){let _,v,b;const E=o.exported.devicePixelRatio>1?"@2x":"";let I=o.getJSON(u.transformRequest(u.normalizeSpriteURL(s,E,".json"),o.ResourceType.SpriteJSON),(V,q)=>{I=null,b||(b=V,_=q,R())}),C=o.getImage(u.transformRequest(u.normalizeSpriteURL(s,E,".png"),o.ResourceType.SpriteImage),(V,q)=>{C=null,b||(b=V,v=q,R())});function R(){if(b)p(b);else if(_&&v){const V=o.exported.getImageData(v),q={};for(const W in _){const{width:Z,height:X,x:B,y:G,sdf:J,pixelRatio:$,stretchX:le,stretchY:he,content:ue}=_[W],ge=new o.RGBAImage({width:Z,height:X});o.RGBAImage.copy(V,ge,{x:B,y:G},{x:0,y:0},{width:Z,height:X}),q[W]={data:ge,pixelRatio:$,sdf:J,stretchX:le,stretchY:he,content:ue}}p(null,q)}}return{cancel(){I&&(I.cancel(),I=null),C&&(C.cancel(),C=null)}}}(n,this.map._requestManager,(s,u)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(u)for(const p in u)this.imageManager.addImage(p,u[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const s=this.getSource(n.source);if(!s)return;const u=n.sourceLayer;u&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const s=[];for(const u of n){const p=this._layers[u];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():xs[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(p.length||_.length)&&this._updateWorkerLayers(p,_);for(const v in this._updatedSources){const b=this._updatedSources[v];b==="reload"?this._reloadSource(v):b==="clear"&&this._clearSource(v)}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const u={};for(const p in this._sourceCaches){const _=this._sourceCaches[p];u[p]=_.used,_.used=!1}for(const p of this._order){const _=this._layers[p];if(_.recalculate(n,this._availableImages),!_.isHidden(n.zoom)){const b=this._getLayerSourceCache(_);b&&(b.used=!0)}const v=this.map.painter;if(v){const b=_.getProgramIds();if(!b)continue;const E=_.getProgramConfiguration(n.zoom);for(const I of b)v.useProgram(I,E)}}for(const p in u){const _=this._sourceCaches[p];u[p]!==_.used&&_.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Mo(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=Js(n.layers);const s=function(p,_){if(!p)return[{command:ui.setStyle,args:[_]}];let v=[];try{if(!L(p.version,_.version))return[{command:ui.setStyle,args:[_]}];L(p.center,_.center)||v.push({command:ui.setCenter,args:[_.center]}),L(p.zoom,_.zoom)||v.push({command:ui.setZoom,args:[_.zoom]}),L(p.bearing,_.bearing)||v.push({command:ui.setBearing,args:[_.bearing]}),L(p.pitch,_.pitch)||v.push({command:ui.setPitch,args:[_.pitch]}),L(p.sprite,_.sprite)||v.push({command:ui.setSprite,args:[_.sprite]}),L(p.glyphs,_.glyphs)||v.push({command:ui.setGlyphs,args:[_.glyphs]}),L(p.transition,_.transition)||v.push({command:ui.setTransition,args:[_.transition]}),L(p.light,_.light)||v.push({command:ui.setLight,args:[_.light]}),L(p.fog,_.fog)||v.push({command:ui.setFog,args:[_.fog]}),L(p.projection,_.projection)||v.push({command:ui.setProjection,args:[_.projection]});const b={},E=[];(function(R,V,q,W){let Z;for(Z in V=V||{},R=R||{})R.hasOwnProperty(Z)&&(V.hasOwnProperty(Z)||Zo(Z,q,W));for(Z in V){if(!V.hasOwnProperty(Z))continue;const X=V[Z];R.hasOwnProperty(Z)?L(R[Z],X)||(R[Z].type==="geojson"&&X.type==="geojson"&&Wo(R,V,Z)?q.push({command:ui.setGeoJSONSourceData,args:[Z,X.data]}):Qs(Z,V,q,W)):$s(Z,V,q)}})(p.sources,_.sources,E,b);const I=[];p.layers&&p.layers.forEach(R=>{R.source&&b[R.source]?v.push({command:ui.removeLayer,args:[R.id]}):I.push(R)});let C=p.terrain;C&&b[C.source]&&(v.push({command:ui.setTerrain,args:[void 0]}),C=void 0),v=v.concat(E),L(C,_.terrain)||v.push({command:ui.setTerrain,args:[_.terrain]}),function(R,V,q){V=V||[];const W=(R=R||[]).map(Hn),Z=V.map(Hn),X=R.reduce(ea,{}),B=V.reduce(ea,{}),G=W.slice(),J=Object.create(null);let $,le,he,ue,ge,me,Se;for($=0,le=0;$<W.length;$++)he=W[$],B.hasOwnProperty(he)?le++:(q.push({command:ui.removeLayer,args:[he]}),G.splice(G.indexOf(he,le),1));for($=0,le=0;$<Z.length;$++)he=Z[Z.length-1-$],G[G.length-1-$]!==he&&(X.hasOwnProperty(he)?(q.push({command:ui.removeLayer,args:[he]}),G.splice(G.lastIndexOf(he,G.length-le),1)):le++,me=G[G.length-$],q.push({command:ui.addLayer,args:[B[he],me]}),G.splice(G.length-$,0,he),J[he]=!0);for($=0;$<Z.length;$++)if(he=Z[$],ue=X[he],ge=B[he],!J[he]&&!L(ue,ge))if(L(ue.source,ge.source)&&L(ue["source-layer"],ge["source-layer"])&&L(ue.type,ge.type)){for(Se in _r(ue.layout,ge.layout,q,he,null,ui.setLayoutProperty),_r(ue.paint,ge.paint,q,he,null,ui.setPaintProperty),L(ue.filter,ge.filter)||q.push({command:ui.setFilter,args:[he,ge.filter]}),L(ue.minzoom,ge.minzoom)&&L(ue.maxzoom,ge.maxzoom)||q.push({command:ui.setLayerZoomRange,args:[he,ge.minzoom,ge.maxzoom]}),ue)ue.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?_r(ue[Se],ge[Se],q,he,Se.slice(6),ui.setPaintProperty):L(ue[Se],ge[Se])||q.push({command:ui.setLayerProperty,args:[he,Se,ge[Se]]}));for(Se in ge)ge.hasOwnProperty(Se)&&!ue.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?_r(ue[Se],ge[Se],q,he,Se.slice(6),ui.setPaintProperty):L(ue[Se],ge[Se])||q.push({command:ui.setLayerProperty,args:[he,Se,ge[Se]]}))}else q.push({command:ui.removeLayer,args:[he]}),me=G[G.lastIndexOf(he)+1],q.push({command:ui.addLayer,args:[ge,me]})}(I,_.layers,v)}catch(b){console.warn("Unable to compute style diff:",b),v=[{command:ui.setStyle,args:[_]}]}return v}(this.serialize(),n).filter(p=>!(p.command in qd));if(s.length===0)return!1;const u=s.filter(p=>!(p.command in il));if(u.length>0)throw new Error(`Unimplemented: ${u.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&p.command!=="setProjection"&&this[p.command].apply(this,p.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,s){return this.getImage(n)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,s),this._afterImageUpdated(n),this)}updateImage(n,s){this.imageManager.updateImage(n,s)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,s,u={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${n}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=Kt(n,s,this.dispatcher,this);p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:p.serialize(),sourceId:n}));const _=v=>{const b=(v?"symbol:":"other:")+n,E=this._sourceCaches[b]=new o.SourceCache(b,p,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[n]=E,E.style=this,E.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const s=this.getSource(n);if(!s)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(n);for(const p of u)delete this._sourceCaches[p.id],delete this._updatedSources[p.id],p.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,s){this._checkLoaded(),this.getSource(n).setData(s),this._changed=!0}getSource(n){const s=this._getSourceCache(n);return s&&s.getSource()}_getSources(){const n=[];for(const s in this._otherSourceCaches){const u=this._getSourceCache(s);u&&n.push(u.getSource())}return n}addLayer(n,s,u={}){this._checkLoaded();const p=n.id;if(this.getLayer(p))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(n.type==="custom"){if(Mo(this,o.validateCustomStyleLayer(n)))return;_=o.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(p,n.source),n=o.clone$1(n),n=o.extend(n,{source:p})),this._validate(o.validateLayer,`layers.${p}`,n,{arrayIndex:-1},u))return;_=o.createStyleLayer(n),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const b=this._getLayerSourceCache(_);if(this._removedLayers[p]&&_.source&&b&&_.type!=="custom"){const E=this._removedLayers[p];delete this._removedLayers[p],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",b.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,s){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===s)return;const u=this._order.indexOf(n);this._order.splice(u,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(p,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const s=this._layers[n];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const u=this._order.indexOf(n);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const s in this._layers)if(this._layers[s].type===n)return!0;return!1}setLayerZoomRange(n,s,u){this._checkLoaded();const p=this.getLayer(n);p?p.minzoom===s&&p.maxzoom===u||(s!=null&&(p.minzoom=s),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,s,u={}){this._checkLoaded();const p=this.getLayer(n);if(p){if(!L(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.validateFilter,`layers.${p.id}.filter`,s,{layerType:p.type},u)||(p.filter=o.clone$1(s),this._updateLayer(p)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const s=this.getLayer(n);return s&&o.clone$1(s.filter)}setLayoutProperty(n,s,u,p={}){this._checkLoaded();const _=this.getLayer(n);_?L(_.getLayoutProperty(s),u)||(_.setLayoutProperty(s,u,p),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,s){const u=this.getLayer(n);if(u)return u.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,s,u,p={}){this._checkLoaded();const _=this.getLayer(n);_?L(_.getPaintProperty(s),u)||(_.setPaintProperty(s,u,p)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,s){const u=this.getLayer(n);return u&&u.getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const u=n.source,p=n.sourceLayer,_=this.getSource(u);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const v=_.type;if(v==="geojson"&&p)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!p)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const b=this._getSourceCaches(u);for(const E of b)E.setFeatureState(p,n.id,s)}removeFeatureState(n,s){this._checkLoaded();const u=n.source,p=this.getSource(u);if(!p)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const _=p.type,v=_==="vector"?n.sourceLayer:void 0;if(_==="vector"&&!v)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const b=this._getSourceCaches(u);for(const E of b)E.removeFeatureState(v,n.id,s)}getFeatureState(n){this._checkLoaded();const s=n.source,u=n.sourceLayer,p=this.getSource(s);if(p){if(p.type!=="vector"||u)return n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(u,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const s in this._sourceCaches){const u=this._sourceCaches[s].getSource();n[u.id]||(n[u.id]=u.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const s=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",s.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const s=v=>this._layers[v].type==="fill-extrusion",u={},p=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b)){u[b]=v;for(const E of n){const I=E[b];if(I)for(const C of I)p.push(C)}}}p.sort((v,b)=>b.intersectionZ-v.intersectionZ);const _=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b))for(let E=p.length-1;E>=0;E--){const I=p[E].feature;if(u[I.layer.id]<v)break;_.push(I),p.pop()}else for(const E of n){const I=E[b];if(I)for(const C of I)_.push(C.feature)}}return _}queryRenderedFeatures(n,s,u){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of s.layers){const I=this._layers[E];if(!I)return this.fire(new o.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[I.source]=!0}}const _=[];s.availableImages=this._availableImages;const v=s&&s.layers?s.layers.some(E=>{const I=this.getLayer(E);return I&&I.is3D()}):this.has3DLayers(),b=Ai.createFromScreenPoints(n,u);for(const E in this._sourceCaches){const I=this._sourceCaches[E].getSource().id;s.layers&&!p[I]||_.push(Gi(this._sourceCaches[E],this._layers,this._serializedLayers,b,s,u,v,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(E,I,C,R,V,q,W){const Z={},X=q.queryRenderedSymbols(R),B=[];for(const G of Object.keys(X).map(Number))B.push(W[G]);B.sort(Mi);for(const G of B){const J=G.featureIndex.lookupSymbolFeatures(X[G.bucketInstanceId],I,G.bucketIndex,G.sourceLayerIndex,V.filter,V.layers,V.availableImages,E);for(const $ in J){const le=Z[$]=Z[$]||[],he=J[$];he.sort((ue,ge)=>{const me=G.featureSortOrder;if(me){const Se=me.indexOf(ue.featureIndex);return me.indexOf(ge.featureIndex)-Se}return ge.featureIndex-ue.featureIndex});for(const ue of he)le.push(ue)}}for(const G in Z)Z[G].forEach(J=>{const $=J.feature,le=C(E[G]);if(!le)return;const he=le.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=he});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),b.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const u=this._getSourceCaches(n);let p=[];for(const _ of u)p=p.concat(rn(_,s));return p}addSourceType(n,s,u){return Wr.getSourceType(n)?u(new Error(`A source type called "${n}" already exists.`)):(Wr.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(n,s={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const v in n)if(!L(n[v],u[v])){p=!0;break}if(!p)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,s=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let u=n;if(s===1){if(typeof u.source=="object"){const p="terrain-dem-src";this.addSource(p,u.source),u=o.clone$1(u),u=o.extend(u,{source:p})}if(this._validate(o.validateTerrain,"terrain",u))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,s)}else{const p=this.terrain,_=p.get();for(const v of Object.keys(o.spec.terrain))!u.hasOwnProperty(v)&&o.spec.terrain[v].default&&(u[v]=o.spec.terrain[v].default);for(const v in u)if(!L(u[v],_[v])){p.set(u),this.stylesheet.terrain=u;const b=this._setTransitionParameters({duration:0});p.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const s=this.fog=new dt(n,this.map.transform);this.stylesheet.fog=n;const u=this._setTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,u=s.get();Object.keys(n).length===0&&s.set(n);for(const p in n)if(!L(n[p],u[p])){s.set(n),this.stylesheet.fog=n;const _=this._setTransitionParameters({duration:0});s.updateTransitions(_);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:o.exported.now(),transition:o.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(u=>this.isLayerDraped(this._layers[u])),s=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...s)}_createTerrain(n,s){const u=this.terrain=new vi(n,s);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const p=this._setTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="symbol"&&this._updateLayer(s)}}_validate(n,s,u,p,_={}){return(!_||_.validate!==!1)&&Mo(this,n.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:u,styleSpec:o.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const s=this._getSourceCaches(n);for(const u of s)u.clearTiles()}_reloadSource(n){const s=this._getSourceCaches(n);for(const u of s)u.resume(),u.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const s in this._sourceCaches)this._sourceCaches[s].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const s=this._sourceCaches[n];s.resume(),s.reload()}}_updatePlacement(n,s,u,p,_=!1){let v=!1,b=!1;const E={};for(const I of this._order){const C=this._layers[I];if(C.type!=="symbol")continue;if(!E[C.source]){const V=this._getLayerSourceCache(C);if(!V)continue;E[C.source]=V.getRenderableIds(!0).map(q=>V.getTileByID(q)).sort((q,W)=>W.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(W.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(C,E[C.source],n.center.lng,n.projection);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new dc(n,this._order,_,s,u,p,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const I of this._order){const C=this._layers[I];C.type==="symbol"&&this.placement.updateLayerOpacities(C,E[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};p(this._otherSourceCaches[s.source]),p(this._symbolSourceCaches[s.source])}getGlyphs(n,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(n,s,u){return o.makeRequest(s,u)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const s=[];return this._otherSourceCaches[n]&&s.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&s.push(this._symbolSourceCaches[n]),s}_isSourceCacheLoaded(n){const s=this._getSourceCaches(n);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):s.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wr.getSourceType=function(l){return jt[l]},Wr.setSourceType=function(l,n){jt[l]=n},Wr.registerForPluginStateChange=o.registerForPluginStateChange;var _c=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Yo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ao=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ca=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,lo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let nl={},vs={};const ua=[];bs(_c,ua),bs(ao,ua),bs(ca,ua),bs(lo,ua),nl=wi("",ao),vs=wi(lo,ca);const Ju=wi(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),rl=_c,gc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var yc={background:wi(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:wi(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:wi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:wi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:wi(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:wi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:wi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:wi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:wi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:wi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:wi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxGradient:wi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxCapture:wi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:wi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function bs(l,n){const s=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of s)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)n.includes(_)||n.push(_)}}function wi(l,n){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),p={},_=[...ua];return bs(l,_),bs(n,_),{fragmentSource:l=l.replace(s,(v,b,E,I,C)=>(p[C]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${C}
varying ${E} ${I} ${C};
#else
uniform ${E} ${I} u_${C};
#endif
`:`
#ifdef HAS_UNIFORM_u_${C}
    ${E} ${I} ${C} = u_${C};
#endif
`)),vertexSource:n=n.replace(s,(v,b,E,I,C)=>{const R=I==="float"?"vec2":"vec4",V=C.match(/color/)?"color":R;return p[C]?b==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
attribute ${E} ${R} a_${C};
varying ${E} ${I} ${C};
#else
uniform ${E} ${I} u_${C};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    ${C} = a_${C};
#else
    ${E} ${I} ${C} = u_${C};
#endif
`:`
#ifndef HAS_UNIFORM_u_${C}
    ${C} = unpack_mix_${V}(a_${C}, u_${C}_t);
#else
    ${E} ${I} ${C} = u_${C};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
attribute ${E} ${R} a_${C};
#else
uniform ${E} ${I} u_${C};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    ${E} ${I} ${C} = a_${C};
#else
    ${E} ${I} ${C} = u_${C};
#endif
`:`
#ifndef HAS_UNIFORM_u_${C}
    ${E} ${I} ${C} = unpack_mix_${V}(a_${C}, u_${C}_t);
#else
    ${E} ${I} ${C} = u_${C};
#endif
`}),staticAttributes:u,usedDefines:_}}class Zd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,s,u,p,_,v,b){this.context=n;let E=this.boundPaintVertexBuffers.length!==p.length;for(let C=0;!E&&C<p.length;C++)this.boundPaintVertexBuffers[C]!==p[C]&&(E=!0);let I=this.boundDynamicVertexBuffers.length!==b.length;for(let C=0;!I&&C<b.length;C++)this.boundDynamicVertexBuffers[C]!==b[C]&&(I=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||E||I||this.boundIndexBuffer!==_||this.boundVertexOffset!==v)this.freshBind(s,u,p,_,v,b);else{n.bindVertexArrayOES.set(this.vao);for(const C of b)C&&C.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(n,s,u,p,_,v){let b;const E=n.numAttributes,I=this.context,C=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),b=0,this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=v;else{b=I.currentNumAttributes||0;for(let R=E;R<b;R++)C.disableVertexAttribArray(R)}s.enableAttributes(C,n),s.bind(),s.setVertexAttribPointers(C,n,_);for(const R of u)R.enableAttributes(C,n),R.bind(),R.setVertexAttribPointers(C,n,_);for(const R of v)R&&(R.enableAttributes(C,n),R.bind(),R.setVertexAttribPointers(C,n,_));p&&p.bind(),I.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function xc(l,n){const s=Math.pow(2,n.canonical.z),u=n.canonical.y;return[new o.MercatorCoordinate(0,u/s).toLngLat().lat,new o.MercatorCoordinate(0,(u+1)/s).toLngLat().lat]}function $u(l,n,s,u,p,_,v){const b=l.context,E=b.gl,I=s.fbo;if(!I)return;l.prepareDrawTile();const C=l.useProgram("hillshade");b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get());const R=((Z,X,B,G)=>{const J=B.paint.get("hillshade-shadow-color"),$=B.paint.get("hillshade-highlight-color"),le=B.paint.get("hillshade-accent-color");let he=B.paint.get("hillshade-illumination-direction")*(Math.PI/180);B.paint.get("hillshade-illumination-anchor")==="viewport"&&(he-=Z.transform.angle);const ue=!Z.options.moving;return{u_matrix:G||Z.transform.calculateProjMatrix(X.tileID.toUnwrapped(),ue),u_image:0,u_latrange:xc(0,X.tileID),u_light:[B.paint.get("hillshade-exaggeration"),he],u_shadow:J,u_highlight:$,u_accent:le}})(l,s,u,l.terrain?n.projMatrix:null);l.prepareDrawProgram(b,C,n.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=l.getTileBoundsBuffers(s);C.draw(b,E.TRIANGLES,p,_,v,o.CullFaceMode.disabled,R,u.id,V,q,W)}function vc(l,n,s){if(!n.needsDEMTextureUpload)return;const u=l.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||l.getTileTexture(s.stride);const _=s.getPixels();n.demTexture?n.demTexture.update(_,{premultiply:!1}):n.demTexture=new o.Texture(u,_,p.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Qu(l,n,s,u,p,_){const v=l.context,b=v.gl;if(!n.dem)return;const E=n.dem;if(v.activeTexture.set(b.TEXTURE1),vc(l,n,E),!n.demTexture)return;n.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const I=E.dim;v.activeTexture.set(b.TEXTURE0);let C=n.fbo;if(!C){const W=new o.Texture(v,{width:I,height:I,data:null},b.RGBA);W.bind(b.LINEAR,b.CLAMP_TO_EDGE),C=n.fbo=v.createFramebuffer(I,I,!0),C.colorAttachment.set(W.texture)}v.bindFramebuffer.set(C.framebuffer),v.viewport.set([0,0,I,I]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:V,tileBoundsSegments:q}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,u,p,_,o.CullFaceMode.disabled,((W,Z)=>{const X=Z.stride,B=o.create();return o.ortho(B,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(B,B,[0,-o.EXTENT,0]),{u_matrix:B,u_image:1,u_dimension:[X,X],u_zoom:W.overscaledZ,u_unpack:Z.unpackVector}})(n.tileID,E),s.id,R,V,q),n.needsHillshadePrepare=!1}const bc=l=>({u_matrix:new o.UniformMatrix4f(l),u_image0:new o.Uniform1i(l),u_skirt_height:new o.Uniform1f(l)}),ws=(l,n)=>({u_matrix:l,u_image0:0,u_skirt_height:n}),ol=(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:I,u_globe_pos:C,u_globe_radius:R,u_viewport:V,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:q});function Ts(l,n){return l!=null&&n!=null&&!(!l.hasData()||!n.hasData())&&l.demTexture!=null&&n.demTexture!=null&&l.tileID.key!==n.tileID.key}const co=new class{constructor(){this.operations={}}newMorphing(l,n,s,u,p){if(l in this.operations){const _=this.operations[l];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[l]={startTime:u,phase:0,duration:p,from:n,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const n=this.operations[l];return{from:n.from,to:n.to,phase:n.phase}}update(l){for(const n in this.operations){const s=this.operations[n];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[n];break}}}_nextOp(l,n){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=n,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Ko={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function sl(l){return 6*Math.pow(1.5,22-l)}function eh(l,n){const s=1<<l.z;return!n&&(l.x===0||l.x===s-1)||l.y===0||l.y===s-1}const ha=l=>({u_matrix:l});function wc(l,n,s,u,p){if(p>0){const _=o.exported.now(),v=(_-l.timeAdded)/p,b=n?(_-n.timeAdded)/p:-1,E=s.getSource(),I=u.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),C=!n||Math.abs(n.tileID.overscaledZ-I)>Math.abs(l.tileID.overscaledZ-I),R=C&&l.refreshedUponExpiration?1:o.clamp(C?v:1-b,0,1);return l.refreshedUponExpiration&&v>=1&&(l.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Tc extends o.SourceCache{constructor(n){const s={type:"raster-dem",maxzoom:n.transform.maxZoom},u=new gt(Zr(),null),p=Kt("mock-dem",s,u,n.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,s){n.state="loaded",s(null)}}class al extends o.SourceCache{constructor(n){const s=Kt("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new gt(Zr(),null),n.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,s,u){if(n.freezeTileCoverage)return;this.transform=n;const p=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,v)=>{if(_[v.key]="",!this._tiles[v.key]){const b=new o.Tile(v,this._source.tileSize*v.overscaleFactor(),n.tileZoom);b.state="loaded",this._tiles[v.key]=b}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(n){const s=this.proxyCachedFBO[n];if(s!==void 0){const u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ll extends o.OverscaledTileID{constructor(n,s,u){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class Ec extends o.Elevation{constructor(n,s){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=function(E){const I=new o.StructArrayLayout2i4,C=new o.StructArrayLayout3ui6,R=131;I.reserve(17161),C.reserve(33800);const V=o.EXTENT/128,q=o.EXTENT+V/2,W=q+V;for(let X=-V;X<W;X+=V)for(let B=-V;B<W;B+=V){const G=B<0||B>q||X<0||X>q?24575:0,J=o.clamp(Math.round(B),0,o.EXTENT),$=o.clamp(Math.round(X),0,o.EXTENT);I.emplaceBack(J+G,$)}const Z=(X,B)=>{const G=B*R+X;C.emplaceBack(G+1,G,G+R),C.emplaceBack(G+R,G+R+1,G+1)};for(let X=1;X<129;X++)for(let B=1;B<129;B++)Z(B,X);return[0,129].forEach(X=>{for(let B=0;B<130;B++)Z(B,X),Z(X,B)}),[I,C,32768]}(),v=n.context;this.gridBuffer=v.createVertexBuffer(u,o.posAttributes.members),this.gridIndexBuffer=v.createIndexBuffer(p),this.gridSegments=o.SegmentVector.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new al(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const b=v.gl;this._overlapStencilMode=new o.StencilMode({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Tc(s.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,s,u){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const p=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(p.get("source")),this._exaggeration=p.get("exaggeration");const _=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const v=this.getScaledDemTileSize();this.sourceCache.update(s,v,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=s.getIds().map(E=>{const I=s.getTileByID(E).tileID;return I.projMatrix=u.calculateProjMatrix(I.toUnwrapped()),I});(function(E,I){const C=I.transform.pointCoordinate(I.transform.getCameraPoint()),R=new o.Point(C.x,C.y);E.sort((V,q)=>{if(q.overscaledZ-V.overscaledZ)return q.overscaledZ-V.overscaledZ;const W=new o.Point(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Z=new o.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),X=R.mult(1<<V.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(Z)})})(p,this.painter),this._previousZoom=u.zoom;const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const v=this._style._sourceCaches;for(const E in v){const I=v[E];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,n[E],_),I.usedForTerrain))continue;const C=n[E];I.getSource().reparseOverscaled&&this._assignTerrainTiles(C)}this.proxiedCoords[s.id]=p.map(E=>new ll(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const b={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const I=this.terrainTileForTile[E.key];if(!I)continue;const C=I.tileID.key;C in b||(this._visibleDemTiles.push(I),b[C]=C)}}_assignTerrainTiles(n){this._initializing||n.forEach(s=>{if(this.terrainTileForTile[s.key])return;const u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)})}_prepareDEMTextures(){const n=this.painter.context,s=n.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(n.activeTexture.set(s.TEXTURE1),vc(this.painter,p,_))}}_prepareDemTileUniforms(n,s,u,p){if(!s||s.demTexture==null)return!1;const _=n.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-_.z),b=p||"";return u[`u_dem_tl${b}`]=[_.x*v%1,_.y*v%1],u[`u_dem_scale${b}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,s=n.gl;if(!this._emptyDepthBufferTexture){const u=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(n,u,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const s=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&n++,u+_},0);return n?s/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,s=n.gl;n.activeTexture.set(s.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new o.Texture(n,p,s.RGBA,{premultiply:!1}),_}setupElevationDraw(n,s,u){const p=this.painter.context,_=p.gl,v=(b=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(b),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var b;v.u_dem_size=this.sourceCache.getSource().tileSize,v.u_exaggeration=this.exaggeration();let E=null,I=null,C=1;if(u&&u.morphing&&this._useVertexMorphing){const R=u.morphing.srcDemTile,V=u.morphing.dstDemTile;C=u.morphing.phase,R&&V&&(this._prepareDemTileUniforms(n,R,v,"_prev")&&(I=R),this._prepareDemTileUniforms(n,V,v)&&(E=V))}if(I&&E?(p.activeTexture.set(_.TEXTURE2),E.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),p.activeTexture.set(_.TEXTURE4),I.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),v.u_dem_lerp=C):(E=this.terrainTileForTile[n.tileID.key],p.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(n,E,v)?E.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),p.activeTexture.set(_.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),v.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&E){const R=(1<<E.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=R}if(u&&u.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(p,v),this.painter.transform.projection.name==="globe"){const R=this.globeUniformValues(this.painter.transform,n.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(p,R)}}globeUniformValues(n,s,u){const p=n.projection;return{u_tile_tl_up:p.upVector(s,0,0),u_tile_tr_up:p.upVector(s,o.EXTENT,0),u_tile_br_up:p.upVector(s,o.EXTENT,o.EXTENT),u_tile_bl_up:p.upVector(s,0,o.EXTENT),u_tile_up_scale:u?o.globeMetersToEcef(1):p.upVectorScale(s,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const s=this.painter,u=this.painter.context;n.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,v,b,E){if(p.transform.projection.name==="globe")(function(I,C,R,V,q){const W=I.context,Z=W.gl;let X,B;const G=I.options.showTerrainWireframe?2:0,J=I.transform,$=o.globeUseCustomAntiAliasing(I,W,J),le=(Ye,Me)=>{if(B===Ye)return;const Fe=[Ko[Ye],"PROJECTION_GLOBE_VIEW"];$&&Fe.push("CUSTOM_ANTIALIASING"),Me&&Fe.push(Ko[G]),X=I.useProgram("globeRaster",null,Fe),B=Ye},he=I.colorModeForRenderPass(),ue=new o.DepthMode(Z.LEQUAL,o.DepthMode.ReadWrite,I.depthRangeFor3D);co.update(q);const ge=o.calculateGlobeMercatorMatrix(J),me=[o.mercatorXfromLng(J.center.lng),o.mercatorYfromLat(J.center.lat)],Se=G?[!1,!0]:[!1],Je=I.globeSharedBuffers,we=[J.width*o.exported.devicePixelRatio,J.height*o.exported.devicePixelRatio],Ue=Float32Array.from(J.globeMatrix),ke={useDenormalizedUpVectorScale:!0};if(Se.forEach(Ye=>{const Me=I.transform,Fe=sl(Me.zoom)*C.exaggeration();B=-1;const Qe=Ye?Z.LINES:Z.TRIANGLES;for(const Ge of V){const it=R.getTile(Ge),It=o.StencilMode.disabled,Gt=C.prevTerrainTileForTile[Ge.key],wt=C.terrainTileForTile[Ge.key];Ts(Gt,wt)&&co.newMorphing(Ge.key,Gt,wt,q,250),W.activeTexture.set(Z.TEXTURE0),it.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Lt=co.getMorphValuesForProxy(Ge.key),li=Lt?1:0;Lt&&o.extend$1(ke,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:o.easeCubicInOut(Lt.phase)}});const si=o.tileCornersToBounds(Ge.canonical),Ct=o.getLatitudinalLod(si.getCenter().lat),Ti=o.getGridMatrix(Ge.canonical,si,Ct,Me.worldSize/Me._pixelsPerMercatorPixel),Ii=o.globeNormalizeECEF(o.globeTileBounds(Ge.canonical)),ki=ol(Me.projMatrix,Ue,ge,Ii,o.globeToMercatorTransition(Me.zoom),me,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,we,Fe,Ti);if(le(li,Ye),C.setupElevationDraw(it,X,ke),I.prepareDrawProgram(W,X,Ge.toUnwrapped()),Je){const[zi,jn,kn]=Ye?Je.getWirefameBuffers(I.context,Ct):Je.getGridBuffers(Ct,Fe!==0);X.draw(W,Qe,ue,It,he,o.CullFaceMode.backCCW,ki,"globe_raster",zi,jn,kn)}}}),Je){const Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];$&&Ye.push("CUSTOM_ANTIALIASING"),X=I.useProgram("globeRaster",null,Ye);for(const Me of V){const{x:Fe,y:Qe,z:Ge}=Me.canonical,it=Qe===0,It=Qe===(1<<Ge)-1,[Gt,wt,Lt,li]=Je.getPoleBuffers(Ge);if(li&&(it||It)){const si=R.getTile(Me);W.activeTexture.set(Z.TEXTURE0),si.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Ct=o.globePoleMatrixForTile(Ge,Fe,J);const Ti=o.globeNormalizeECEF(o.globeTileBounds(Me.canonical)),Ii=(ki,zi)=>ki.draw(W,Z.TRIANGLES,ue,o.StencilMode.disabled,he,o.CullFaceMode.disabled,ol(J.projMatrix,Ct,Ct,Ti,0,me,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,we,0),"globe_pole_raster",zi,Lt,li);C.setupElevationDraw(si,X,ke),I.prepareDrawProgram(W,X,Me.toUnwrapped()),it&&Ii(X,Gt),It&&(Ct=o.scale(o.create(),Ct,[1,-1,1]),Ii(X,wt))}}}})(p,_,v,b,E);else{const I=p.context,C=I.gl;let R,V;const q=p.options.showTerrainWireframe?2:0,W=(J,$)=>{if(V===J)return;const le=[Ko[J]];$&&le.push(Ko[q]),R=p.useProgram("terrainRaster",null,le),V=J},Z=p.colorModeForRenderPass(),X=new o.DepthMode(C.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D);co.update(E);const B=p.transform,G=sl(B.zoom)*_.exaggeration();(q?[!1,!0]:[!1]).forEach(J=>{V=-1;const $=J?C.LINES:C.TRIANGLES,[le,he]=J?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const ue of b){const ge=v.getTile(ue),me=o.StencilMode.disabled,Se=_.prevTerrainTileForTile[ue.key],Je=_.terrainTileForTile[ue.key];Ts(Se,Je)&&co.newMorphing(ue.key,Se,Je,E,250),I.activeTexture.set(C.TEXTURE0),ge.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const we=co.getMorphValuesForProxy(ue.key),Ue=we?1:0;let ke;we&&(ke={morphing:{srcDemTile:we.from,dstDemTile:we.to,phase:o.easeCubicInOut(we.phase)}});const Ye=ws(ue.projMatrix,eh(ue.canonical,B.renderWorldCopies)?G/10:G);W(Ue,J),_.setupElevationDraw(ge,R,ke),p.prepareDrawProgram(I,R,ue.toUnwrapped()),R.draw(I,$,X,me,Z,o.CullFaceMode.backCCW,Ye,"terrain_raster",_.gridBuffer,le,he)}})}}(s,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const s=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],v=this._drapedRenderBatches.shift(),b=[],E=s.style.order;let I=0;for(const C of _){const R=p.getTileByID(C.proxyTileKey),V=p.proxyCachedFBO[C.key]?p.proxyCachedFBO[C.key][n]:void 0,q=V!==void 0?p.renderCache[V]:this.pool[I++],W=V!==void 0;if(R.texture=q.tex,W&&!q.dirty){b.push(R.tileID);continue}let Z;u.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(u.clear({color:o.Color.transparent,stencil:0}),q.dirty=!1);for(let X=v.start;X<=v.end;++X){const B=s.style._layers[E[X]];if(B.isHidden(s.transform.zoom))continue;const G=s.style._getLayerSourceCache(B),J=G?this.proxyToSource[C.key][G.id]:[C];if(!J)continue;const $=J;u.viewport.set([0,0,q.fb.width,q.fb.height]),Z!==(G?G.id:null)&&(this._setupStencil(q,J,B,G),Z=G?G.id:null),s.renderLayer(s,G,B,$)}this.renderedToTile?(q.dirty=!0,b.push(R.tileID)):W||--I,I===5&&(I=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}renderCacheEfficiency(n){const s=n.order.length;if(s===0)return{efficiency:100};let u,p=0,_=0,v=!1;for(let b=0;b<s;++b){const E=n._layers[n.order[b]];this._style.isLayerDraped(E)?(v&&++p,++_):v||(v=!0,u=E.id)}return _===0?{efficiency:100}:{efficiency:100*(1-p/_),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{n=Math.min(n,s.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,s,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const v=_.tileID,b=1<<v.overscaledZ,{x:E,y:I}=v.canonical,C=E/b,R=(E+1)/b,V=I/b,q=(I+1)/b;return{minx:C,miny:V,maxx:R,maxy:q,t:_.dem.tree.raycastRoot(C,V,R,q,n,s,u),tile:_}});p.sort((_,v)=>(_.t!==null?_.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const v=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,n,s,u);if(v!=null)return v}return null}_createFBO(){const n=this.painter.context,s=n.gl,u=this.drapeBufferSize;n.activeTexture.set(s.TEXTURE0);const p=new o.Texture(n,{width:u[0],height:u[1],data:null},s.RGBA);p.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=n.createFramebuffer(u[0],u[1],!1);return _.colorAttachment.set(p.texture),_.depthAttachment=new pe(n,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const s=this._style._layers[n],u=s.isHidden(this.painter.transform.zoom);return s.type==="custom"?!u&&s.shouldRedrape():!u&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const u of this._style._getSources())if(u instanceof ht){n=!0;break}if(!n)return;const s={};for(let u=0;u<this._style.order.length;++u){const p=this._style._layers[this._style.order[u]],_=this._style._getLayerSourceCache(p);if(_&&!s[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.ZoomDependentExpression){s[_.id]=!0;for(const v of this.proxyCoords){const b=this.proxyToSource[v.key][_.id];if(b)for(const E of b)this._clearRenderCacheForTile(_.id,E)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof et){n=!0;break}if(!n)return;const s={};for(let u=0;u<this._style.order.length;++u){const p=this._style._layers[this._style.order[u]],_=this._style._getLayerSourceCache(p);if(!_||s[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const v=p.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][_.id];if(E)for(const I of E){const C=wc(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,v);(C.opacity!==1||C.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const n=this._style.order,s=n.length;if(s===0)return;const u=[];let p,_=0,v=this._style._layers[n[_]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++_<s;)v=this._style._layers[n[_]];for(;_<s;++_){const b=this._style._layers[n[_]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?p===void 0&&(p=_):p!==void 0&&(u.push({start:p,end:_-1}),p=void 0))}p!==void 0&&u.push({start:p,end:_-1}),this._drapedRenderBatches=u}_setupRenderCache(n){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<v.length;++b){const E=Object.values(v[b]);s.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let v=u.length-1;v>=0;v--){const b=u[v];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const E=n[b.key],I=this.proxyToSource[b.key];let C=0;for(const R in I){const V=I[R],q=E[R];if(!q||q.length!==V.length||V.some((W,Z)=>W!==q[Z]||p[R]&&p[R].hasOwnProperty(W.key))){C=-1;break}++C}for(const R in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][R]].dirty=C<0||C!==Object.values(E).length}}const _=[...this._drapedRenderBatches];_.sort((v,b)=>b.end-b.start-(v.end-v.start));for(const v of _)for(const b of u){if(s.proxyCachedFBO[b.key])continue;let E=s.renderCachePool.pop();E===void 0&&s.renderCache.length<50&&(E=s.renderCache.length,s.renderCache.push(this._createFBO())),E!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][v.start]=E,s.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(n,s,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,v=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(u.isTileClipped())b=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,s){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const v=u.useProgram("clippingMask");for(const b of n){const E=u._tileClippingMaskIDs[b.key]=--s;v.draw(p,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},E,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ha(b.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(n){const s=this.painter.transform;if(n.x<0||n.x>s.width||n.y<0||n.y>s.height)return null;const u=[n.x,n.y,1,1];o.transformMat4$1(u,u,s.pixelMatrixInverse),o.scale$1(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;const p=s._camera.position,_=o.mercatorZfromAltitude(1,s.center.lat),v=[p[0],p[1],p[2]/_,0],b=o.subtract([],u.slice(0,3),v);o.normalize(b,b);const E=this.raycast(v,b,this._exaggeration);return E!==null&&E?(o.scaleAndAdd(v,v,b,E),v[3]=v[2],v[2]*=_,v):null}drawDepth(){const n=this.painter,s=n.context,u=this.proxySourceCache,p=Math.ceil(n.width),_=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const v=s.gl,b=s.createFramebuffer(p,_,!0);s.activeTexture.set(v.TEXTURE0);const E=new o.Texture(s,{width:p,height:_,data:null},v.RGBA);E.bind(v.NEAREST,v.CLAMP_TO_EDGE),b.colorAttachment.set(E.texture);const I=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,p,_);b.depthAttachment.set(I),this._depthFBO=b,this._depthTexture=E}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,p,_]),function(v,b,E,I){if(v.transform.projection.name==="globe")return;const C=v.context,R=C.gl;C.clear({depth:1});const V=v.useProgram("terrainDepth"),q=new o.DepthMode(R.LESS,o.DepthMode.ReadWrite,v.depthRangeFor3D);for(const W of I){const Z=E.getTile(W),X=ws(W.projMatrix,0);b.setupElevationDraw(Z,V),V.draw(C,R.TRIANGLES,q,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,X,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(n,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,s,u){if(n.getSource()instanceof Vt)return this._setupProxiedCoordsForImageSource(n,s,u);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const p=this.proxiedCoords[n.id]=[],_=this.proxyCoords;for(let b=0;b<_.length;b++){const E=_[b],I=this._findTileCoveringTileID(E,n);if(I){const C=this._createProxiedId(E,I,u[E.key]&&u[E.key][n.id]);p.push(C),this.proxyToSource[E.key][n.id]=[C]}}let v=!1;for(let b=0;b<s.length;b++){const E=n.getTile(s[b]);if(!E||!E.hasData())continue;const I=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==E.tileID.canonical.z){const C=this.proxyToSource[I.tileID.key][n.id],R=this._createProxiedId(I.tileID,E,u[I.tileID.key]&&u[I.tileID.key][n.id]);C?C.splice(C.length-1,0,R):this.proxyToSource[I.tileID.key][n.id]=[R],p.push(R),v=!0}}this._sourceTilesOverlap[n.id]=v}_setupProxiedCoordsForImageSource(n,s,u){if(!n.getSource().loaded())return;const p=this.proxiedCoords[n.id]=[],_=this.proxyCoords,v=n.getSource(),b=new o.Point(v.tileID.x,v.tileID.y)._div(1<<v.tileID.z),E=v.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((C,R)=>(C.min.x=Math.min(C.min.x,R.x-b.x),C.min.y=Math.min(C.min.y,R.y-b.y),C.max.x=Math.max(C.max.x,R.x-b.x),C.max.y=Math.max(C.max.y,R.y-b.y),C),{min:new o.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(C,R)=>{const V=C.wrap+C.canonical.x/(1<<C.canonical.z),q=C.canonical.y/(1<<C.canonical.z),W=o.EXTENT/(1<<C.canonical.z),Z=R.wrap+R.canonical.x/(1<<R.canonical.z),X=R.canonical.y/(1<<R.canonical.z);return V+W<Z+E.min.x||V>Z+E.max.x||q+W<X+E.min.y||q>X+E.max.y};for(let C=0;C<_.length;C++){const R=_[C];for(let V=0;V<s.length;V++){const q=n.getTile(s[V]);if(!q||!q.hasData()||I(R,q.tileID))continue;const W=this._createProxiedId(R,q,u[R.key]&&u[R.key][n.id]),Z=this.proxyToSource[R.key][n.id];Z?Z.push(W):this.proxyToSource[R.key][n.id]=[W],p.push(W)}}}_createProxiedId(n,s,u){let p=this.orthoMatrix;if(u){const _=u.find(v=>v.key===s.tileID.key);if(_)return _}if(s.tileID.key!==n.key){const _=n.canonical.z-s.tileID.canonical.z;let v,b,E;p=o.create();const I=s.tileID.wrap-n.wrap<<n.overscaledZ;_>0?(v=o.EXTENT>>_,b=v*((s.tileID.canonical.x<<_)-n.canonical.x+I),E=v*((s.tileID.canonical.y<<_)-n.canonical.y)):(v=o.EXTENT<<-_,b=o.EXTENT*(s.tileID.canonical.x-(n.canonical.x+I<<-_)),E=o.EXTENT*(s.tileID.canonical.y-(n.canonical.y<<-_))),o.ortho(p,0,v,0,v,0,1),o.translate(p,p,[b,E,0])}return new ll(s.tileID,n.key,p)}_findTileCoveringTileID(n,s){let u=s.getTile(n);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[s.id],_=p[n.key];if(u=_?s.getTileByID(_):null,u&&u.hasData()||_===null)return u;let v=u?u.tileID:n,b=v.overscaledZ;const E=s.getSource().minzoom,I=[];if(!_){const R=s.getSource().maxzoom;if(n.canonical.z>=R){const V=n.canonical.z-R;s.getSource().reparseOverscaled?(b=Math.max(n.canonical.z+2,s.transform.tileZoom),v=new o.OverscaledTileID(b,n.wrap,R,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(b=R,v=new o.OverscaledTileID(b,n.wrap,R,n.canonical.x>>V,n.canonical.y>>V))}v.key!==n.key&&(I.push(v.key),u=s.getTile(v))}const C=R=>{I.forEach(V=>{p[V]=R}),I.length=0};for(b-=1;b>=E&&(!u||!u.hasData());b--){u&&C(u.tileID.key);const R=v.calculateScaledKey(b);if(u=s.getTileByID(R),u&&u.hasData())break;const V=p[R];if(V===null)break;V===void 0?I.push(R):u=s.getTileByID(V)}return C(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,s){let u=this._tilesDirty[n];u||(u=this._tilesDirty[n]={}),u[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(s){let u=0;const p=new o.StructArrayLayout2ui4,_=131;for(let v=1;v<129;v++){for(let b=1;b<129;b++)u=v*_+b,p.emplaceBack(u,u+1),p.emplaceBack(u,u+_),p.emplaceBack(u+1,u+_),v===128&&p.emplaceBack(u+_,u+_+1);p.emplaceBack(u+1,u+1+_)}return p}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class di{static cacheKey(n,s,u,p){let _=`${s}${p?p.cacheKey:""}`;for(const v of u)n.usedDefines.includes(v)&&(_+=`/${v}`);return _}constructor(n,s,u,p,_,v){const b=n.gl;this.program=b.createProgram();const E=function(B){const G=[];for(let J=0;J<B.length;J++){if(B[J]===null)continue;const $=B[J].split(" ");G.push($.pop())}return G}(u.staticAttributes),I=p?p.getBinderAttributes():[],C=E.concat(I);let R=p?p.defines():[];R=R.concat(v.map(B=>`#define ${B}`));const V=n.isWebGL2?`#version 300 es
`:"",q=V+R.concat(n.extStandardDerivatives&&V.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(gc):gc,gc,rl,Ju.fragmentSource,vs.fragmentSource,u.fragmentSource).join(`
`),W=V+R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,rl,Ju.vertexSource,vs.vertexSource,nl.vertexSource,u.vertexSource).join(`
`),Z=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(Z,q),b.compileShader(Z),b.attachShader(this.program,Z);const X=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(X,W),b.compileShader(X),b.attachShader(this.program,X),this.attributes={},this.numAttributes=C.length;for(let B=0;B<this.numAttributes;B++)C[B]&&(b.bindAttribLocation(this.program,B,C[B]),this.attributes[C[B]]=B);b.linkProgram(this.program),b.deleteShader(X),b.deleteShader(Z),this.fixedUniforms=_(n),this.binderUniforms=p?p.getUniforms(n):[],v.includes("TERRAIN")&&(this.terrainUniforms=(B=>({u_dem:new o.Uniform1i(B),u_dem_prev:new o.Uniform1i(B),u_dem_unpack:new o.Uniform4f(B),u_dem_tl:new o.Uniform2f(B),u_dem_scale:new o.Uniform1f(B),u_dem_tl_prev:new o.Uniform2f(B),u_dem_scale_prev:new o.Uniform1f(B),u_dem_size:new o.Uniform1f(B),u_dem_lerp:new o.Uniform1f(B),u_exaggeration:new o.Uniform1f(B),u_depth:new o.Uniform1i(B),u_depth_size_inv:new o.Uniform2f(B),u_meter_to_dem:new o.Uniform1f(B),u_label_plane_matrix_inv:new o.UniformMatrix4f(B)}))(n)),v.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new o.Uniform3f(B),u_tile_tr_up:new o.Uniform3f(B),u_tile_br_up:new o.Uniform3f(B),u_tile_bl_up:new o.Uniform3f(B),u_tile_up_scale:new o.Uniform1f(B)}))(n)),v.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new o.UniformMatrix4f(B),u_fog_range:new o.Uniform2f(B),u_fog_color:new o.Uniform4f(B),u_fog_horizon_blend:new o.Uniform1f(B),u_fog_temporal_offset:new o.Uniform1f(B),u_frustum_tl:new o.Uniform3f(B),u_frustum_tr:new o.Uniform3f(B),u_frustum_br:new o.Uniform3f(B),u_frustum_bl:new o.Uniform3f(B),u_globe_pos:new o.Uniform3f(B),u_globe_radius:new o.Uniform1f(B),u_globe_transition:new o.Uniform1f(B),u_is_globe:new o.Uniform1i(B),u_viewport:new o.Uniform2f(B)}))(n))}}setTerrainUniformValues(n,s){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)u[p]&&u[p].set(this.program,p,s[p])}}setGlobeUniformValues(n,s){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)u[p]&&u[p].set(this.program,p,s[p])}}setFogUniformValues(n,s){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)u[p].set(this.program,p,s[p])}}draw(n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z){const X=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(u),n.setStencilMode(p),n.setColorMode(_),n.setCullFace(v);for(const G of Object.keys(this.fixedUniforms))this.fixedUniforms[G].set(this.program,G,b[G]);W&&W.setUniforms(this.program,n,this.binderUniforms,V,{zoom:q});const B={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[s];for(const G of R.get()){const J=G.vaos||(G.vaos={});(J[E]||(J[E]=new Zd)).bind(n,this,I,W?W.getPaintVertexBuffers():[],C,G.vertexOffset,Z||[]),X.drawElements(s,G.primitiveLength*B,X.UNSIGNED_SHORT,G.primitiveOffset*B*2)}}}function da(l,n){const s=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,l.transform.tileZoom)/s,p=u*(n.tileID.canonical.x+n.tileID.wrap*s),_=u*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/Nt(n,1,l.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const th=o.create(),Mc=(l,n,s,u,p,_,v,b,E,I,C)=>{const R=n.style.light,V=R.properties.get("position"),q=[V.x,V.y,V.z],W=o.create$1();R.properties.get("anchor")==="viewport"&&(o.fromRotation(W,-n.transform.angle),o.transformMat3(q,q,W));const Z=R.properties.get("color"),X=n.transform,B={u_matrix:l,u_lightpos:q,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:th,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:_};return X.projection.name==="globe"&&(B.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],B.u_zoom_transition=E,B.u_inv_rot_matrix=C,B.u_merc_center=I,B.u_up_dir=X.projection.upVector(new o.CanonicalTileID(0,0,0),I[0]*o.EXTENT,I[1]*o.EXTENT),B.u_height_lift=b),B},ih=(l,n,s,u,p,_,v,b,E,I,C,R)=>{const V=Mc(l,n,s,u,p,_,v,E,I,C,R),q={u_height_factor:-Math.pow(2,v.overscaledZ)/b.tileSize/8};return o.extend(V,da(n,b),q)},Jo=l=>({u_matrix:l}),Sc=(l,n,s)=>o.extend(Jo(l),da(n,s)),Wd=(l,n)=>({u_matrix:l,u_world:n}),Xd=(l,n,s,u)=>o.extend(Sc(l,n,s),{u_world:u}),Hd=o.create(),Ac=(l,n,s,u,p,_)=>{const v=l.transform,b=v.projection.name==="globe";let E;if(_.paint.get("circle-pitch-alignment")==="map")if(b){const C=o.globePixelsToTileUnits(v.zoom,n.canonical)*v._pixelsPerMercatorPixel;E=Float32Array.from([C,0,0,C])}else E=v.calculatePixelsToTileUnitsMatrix(s);else E=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:l.translatePosMatrix(n.projMatrix,s,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Hd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){I.u_inv_rot_matrix=u,I.u_merc_center=p,I.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],I.u_zoom_transition=o.globeToMercatorTransition(v.zoom);const C=p[0]*o.EXTENT,R=p[1]*o.EXTENT;I.u_up_dir=v.projection.upVector(new o.CanonicalTileID(0,0,0),C,R)}return I},Cc=l=>{const n=[];return l.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Ic=(l,n,s,u)=>{const p=o.EXTENT/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:n.getCameraToCenterDistance(u),u_extrude_scale:[n.pixelsToGLUnits[0]/p,n.pixelsToGLUnits[1]/p]}},cl=(l,n,s=1)=>({u_matrix:l,u_color:n,u_overlay:0,u_overlay_scale:s}),nh=o.create(),rh=(l,n,s,u,p,_,v)=>{const b=l.transform,E=b.projection.name==="globe",I=E?o.globePixelsToTileUnits(b.zoom,n.canonical)*b._pixelsPerMercatorPixel:Nt(s,1,_),C={u_matrix:n.projMatrix,u_extrude_scale:I,u_intensity:v,u_inv_rot_matrix:nh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){C.u_inv_rot_matrix=u,C.u_merc_center=p,C.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],C.u_zoom_transition=o.globeToMercatorTransition(b.zoom);const R=p[0]*o.EXTENT,V=p[1]*o.EXTENT;C.u_up_dir=b.projection.upVector(new o.CanonicalTileID(0,0,0),R,V)}return C},Yd=(l,n,s,u,p,_,v)=>{const b=l.transform,E=b.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:kc(l,n,s,u),u_pixels_to_tile_units:E,u_device_pixel_ratio:_,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:pa(s)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Es(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:v}},fa=(l,n,s,u,p)=>{const _=l.transform;return{u_matrix:kc(l,n,s,u),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:Es(n,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Es(l,n){return 1/Nt(l,1,n.tileZoom)}function kc(l,n,s,u){return l.translatePosMatrix(u||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function pa(l){const n=l.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const zc=(l,n,s,u,p,_)=>{return{u_matrix:l,u_tl_parent:n,u_scale_parent:s,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(b=p.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(v=p.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Xr(p.paint.get("raster-hue-rotate")),u_perspective_transform:_};var v,b};function Xr(l){l*=Math.PI/180;const n=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const ul=o.create(),Pc=(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z)=>{const X=p.transform,B={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:X.width/X.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+E,u_pitch_with_map:+u,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ul,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ul,u_up_vector:[0,-1,0]};return Z.name==="globe"&&(B.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],B.u_zoom_transition=R,B.u_inv_rot_matrix=q,B.u_merc_center=V,B.u_camera_forward=X._camera.forward(),B.u_ecef_origin=o.globeECEFOrigin(X.globeMatrix,C.toUnwrapped()),B.u_tile_matrix=Float32Array.from(X.globeMatrix),B.u_up_vector=W),B},hl=(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z,X)=>o.extend(Pc(l,n,s,u,p,_,v,b,E,I,R,V,q,W,Z,X),{u_gamma_scale:u?p.transform.cameraToCenterDistance*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+C}),oh=(l,n,s,u,p,_,v,b,E,I,C,R,V,q,W,Z)=>o.extend(hl(l,n,s,u,p,_,v,b,!0,E,!0,C,R,V,q,W,Z),{u_texsize_icon:I,u_texture_icon:1}),Dc=(l,n,s)=>({u_matrix:l,u_opacity:n,u_color:s}),Kd=(l,n,s,u,p)=>o.extend(function(_,v,b){const E=v.imageManager.getPattern(_.toString()),{width:I,height:C}=v.imageManager.getPixelSize(),R=Math.pow(2,b.tileID.overscaledZ),V=b.tileSize*Math.pow(2,v.transform.tileZoom)/R,q=V*(b.tileID.canonical.x+b.tileID.wrap*R),W=V*b.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[I,C],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/Nt(b,1,v.transform.tileZoom),u_pixel_coord_upper:[q>>16,W>>16],u_pixel_coord_lower:[65535&q,65535&W]}}(u,s,p),{u_matrix:l,u_opacity:n}),Lc={fillExtrusion:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_height_factor:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l)}),fill:l=>({u_matrix:new o.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),fillOutline:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),collisionBox:l=>({u_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new o.UniformMatrix4f(l),u_inv_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_viewport_size:new o.Uniform2f(l)}),debug:l=>({u_color:new o.UniformColor(l),u_matrix:new o.UniformMatrix4f(l),u_overlay:new o.Uniform1i(l),u_overlay_scale:new o.Uniform1f(l)}),clippingMask:l=>({u_matrix:new o.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new o.Uniform1f(l),u_intensity:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),heatmapTexture:l=>({u_image:new o.Uniform1i(l),u_color_ramp:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l)}),hillshade:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_latrange:new o.Uniform2f(l),u_light:new o.Uniform2f(l),u_shadow:new o.UniformColor(l),u_highlight:new o.UniformColor(l),u_accent:new o.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_dimension:new o.Uniform2f(l),u_zoom:new o.Uniform1f(l),u_unpack:new o.Uniform4f(l)}),line:l=>({u_matrix:new o.UniformMatrix4f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_units_to_pixels:new o.Uniform2f(l),u_dash_image:new o.Uniform1i(l),u_gradient_image:new o.Uniform1i(l),u_image_height:new o.Uniform1f(l),u_texsize:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l),u_trim_offset:new o.Uniform2f(l)}),linePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_texsize:new o.Uniform2f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_units_to_pixels:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l)}),raster:l=>({u_matrix:new o.UniformMatrix4f(l),u_tl_parent:new o.Uniform2f(l),u_scale_parent:new o.Uniform1f(l),u_fade_t:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_image0:new o.Uniform1i(l),u_image1:new o.Uniform1i(l),u_brightness_low:new o.Uniform1f(l),u_brightness_high:new o.Uniform1f(l),u_saturation_factor:new o.Uniform1f(l),u_contrast_factor:new o.Uniform1f(l),u_spin_weights:new o.Uniform3f(l),u_perspective_transform:new o.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_texture:new o.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_is_halo:new o.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texsize_icon:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_texture_icon:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_is_halo:new o.Uniform1i(l)}),background:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_color:new o.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_pattern_tl:new o.Uniform2f(l),u_pattern_br:new o.Uniform2f(l),u_texsize:new o.Uniform2f(l),u_pattern_size:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),terrainRaster:bc,terrainDepth:bc,skybox:l=>({u_matrix:new o.UniformMatrix4f(l),u_sun_direction:new o.Uniform3f(l),u_cubemap:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new o.UniformMatrix4f(l),u_color_ramp:new o.Uniform1i(l),u_center_direction:new o.Uniform3f(l),u_radius:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new o.UniformMatrix3f(l),u_sun_direction:new o.Uniform3f(l),u_sun_intensity:new o.Uniform1f(l),u_color_tint_r:new o.Uniform4f(l),u_color_tint_m:new o.Uniform4f(l),u_luminance:new o.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new o.UniformMatrix4f(l),u_globe_matrix:new o.UniformMatrix4f(l),u_normalize_matrix:new o.UniformMatrix4f(l),u_merc_matrix:new o.UniformMatrix4f(l),u_zoom_transition:new o.Uniform1f(l),u_merc_center:new o.Uniform2f(l),u_image0:new o.Uniform1i(l),u_grid_matrix:new o.UniformMatrix3f(l),u_skirt_height:new o.Uniform1f(l),u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_globe_pos:new o.Uniform3f(l),u_globe_radius:new o.Uniform1f(l),u_viewport:new o.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_horizon:new o.Uniform1f(l),u_transition:new o.Uniform1f(l),u_fadeout_range:new o.Uniform1f(l),u_color:new o.Uniform4f(l),u_high_color:new o.Uniform4f(l),u_space_color:new o.Uniform4f(l),u_star_intensity:new o.Uniform1f(l),u_star_density:new o.Uniform1f(l),u_star_size:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l),u_horizon_angle:new o.Uniform1f(l),u_rotation_matrix:new o.UniformMatrix4f(l)})};let dl;function ma(l,n,s,u,p,_,v){const b=l.context,E=b.gl,I=l.transform,C=l.useProgram("collisionBox"),R=[];let V=0,q=0;for(let $=0;$<u.length;$++){const le=u[$],he=n.getTile(le),ue=he.getBucket(s);if(!ue)continue;const ge=cn(le,ue,I);let me=ge;p[0]===0&&p[1]===0||(me=l.translatePosMatrix(ge,he,p,_));const Se=v?ue.textCollisionBox:ue.iconCollisionBox,Je=ue.collisionCircleArray;if(Je.length>0){const we=o.create(),Ue=me;o.mul(we,ue.placementInvProjMatrix,I.glCoordMatrix),o.mul(we,we,ue.placementViewportMatrix),R.push({circleArray:Je,circleOffset:q,transform:Ue,invTransform:we,projection:ue.getProjection()}),V+=Je.length/4,q=V}Se&&(l.terrain&&l.terrain.setupElevationDraw(he,C),C.draw(b,E.LINES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,Ic(me,I,he,ue.getProjection()),s.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,I.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!v||!R.length)return;const W=l.useProgram("collisionCircle"),Z=new o.StructArrayLayout2f1f2i16;Z.resize(4*V),Z._trim();let X=0;for(const $ of R)for(let le=0;le<$.circleArray.length/4;le++){const he=4*le,ue=$.circleArray[he+0],ge=$.circleArray[he+1],me=$.circleArray[he+2],Se=$.circleArray[he+3];Z.emplace(X++,ue,ge,me,Se,0),Z.emplace(X++,ue,ge,me,Se,1),Z.emplace(X++,ue,ge,me,Se,2),Z.emplace(X++,ue,ge,me,Se,3)}(!dl||dl.length<2*V)&&(dl=function($){const le=2*$,he=new o.StructArrayLayout3ui6;he.resize(le),he._trim();for(let ue=0;ue<le;ue++){const ge=6*ue;he.uint16[ge+0]=4*ue+0,he.uint16[ge+1]=4*ue+1,he.uint16[ge+2]=4*ue+2,he.uint16[ge+3]=4*ue+2,he.uint16[ge+4]=4*ue+3,he.uint16[ge+5]=4*ue+0}return he}(V));const B=b.createIndexBuffer(dl,!0),G=b.createVertexBuffer(Z,o.collisionCircleLayout.members,!0);for(const $ of R){const le={u_matrix:$.transform,u_inv_matrix:$.invTransform,u_camera_to_center_distance:(J=I).getCameraToCenterDistance($.projection),u_viewport_size:[J.width,J.height]};W.draw(b,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,le,s.id,G,B,o.SegmentVector.simpleSegment(0,2*$.circleOffset,$.circleArray.length,$.circleArray.length/2),null,I.zoom)}var J;G.destroy(),B.destroy()}const sh=o.create();function Rc({width:l,height:n,anchor:s,textOffset:u,textScale:p},_){const{horizontalAlign:v,verticalAlign:b}=o.getAnchorAlignment(s),E=-(v-.5)*l,I=-(b-.5)*n,C=o.evaluateVariableOffset(s,u);return new o.Point((E/p+C[0])*_,(I/p+C[1])*_)}function Jd(l,n,s,u,p,_,v,b,E,I,C){const R=l.text.placedSymbolArray,V=l.text.dynamicLayoutVertexArray,q=l.icon.dynamicLayoutVertexArray,W={},Z=l.getProjection(),X=Xi(b,Z,_),B=_.elevation,G=Z.upVectorScale(b.canonical,_.center.lat,_.worldSize).metersToTile;V.clear();for(let J=0;J<R.length;J++){const $=R.get(J),{tileAnchorX:le,tileAnchorY:he,numGlyphs:ue}=$,ge=$.hidden||!$.crossTileID||l.allowVerticalPlacement&&!$.placedOrientation?null:u[$.crossTileID];if(ge){let me=0,Se=0,Je=0;if(B){const it=B?B.getAtTileOffset(b,le,he):0,[It,Gt,wt]=Z.upVector(b.canonical,le,he);me=it*It*G,Se=it*Gt*G,Je=it*wt*G}let[we,Ue,ke,Ye]=Tn($.projectedAnchorX+me,$.projectedAnchorY+Se,$.projectedAnchorZ+Je,s?X:v);const Me=Qa(_.getCameraToCenterDistance(Z),Ye);let Fe=p.evaluateSizeForFeature(l.textSizeData,I,$)*Me/o.ONE_EM;s&&(Fe*=l.tilePixelRatio/E);const Qe=Rc(ge,Fe);s?({x:we,y:Ue,z:ke}=Z.projectTilePoint(le+Qe.x,he+Qe.y,b.canonical),[we,Ue,ke]=Tn(we+me,Ue+Se,ke+Je,v)):(n&&Qe._rotate(-_.angle),we+=Qe.x,Ue+=Qe.y,ke=0);const Ge=l.allowVerticalPlacement&&$.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let it=0;it<ue;it++)o.addDynamicAttributes(V,we,Ue,ke,Ge);C&&$.associatedIconIndex>=0&&(W[$.associatedIconIndex]={x:we,y:Ue,z:ke,angle:Ge})}else ae(ue,V)}if(C){q.clear();const J=l.icon.placedSymbolArray;for(let $=0;$<J.length;$++){const le=J.get($),{numGlyphs:he}=le,ue=W[$];if(le.hidden||!ue)ae(he,q);else{const{x:ge,y:me,z:Se,angle:Je}=ue;for(let we=0;we<he;we++)o.addDynamicAttributes(q,ge,me,Se,Je)}}l.icon.dynamicLayoutVertexBuffer.updateData(q)}l.text.dynamicLayoutVertexBuffer.updateData(V)}function Bc(l,n,s){return s.iconsInText&&n?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ah(l,n,s,u,p,_,v,b,E,I,C,R){const V=l.context,q=V.gl,W=l.transform,Z=b==="map",X=E==="map",B=Z&&s.layout.get("symbol-placement")!=="point",G=Z&&!X&&!B,J=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let $=!1;const le=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),he=[o.mercatorXfromLng(W.center.lng),o.mercatorYfromLat(W.center.lat)],ue=s.layout.get("text-variable-anchor"),ge=W.projection.name==="globe",me=[],Se=[0,-1,0];let Je=Se;!ge&&!W.mercatorFromTransition||Z||(Je=function(we){const Ue=we._camera.getWorldToCamera(we.worldSize,1),ke=o.multiply([],Ue,we.globeMatrix);o.invert(ke,ke);const Ye=[0,0,0],Me=[0,1,0,0];return o.transformMat4$1(Me,Me,ke),Ye[0]=Me[0],Ye[1]=Me[1],Ye[2]=Me[2],o.normalize(Ye,Ye),Ye}(W));for(const we of u){const Ue=n.getTile(we),ke=Ue.getBucket(s);if(!ke||ke.projection.name==="mercator"&&ge)continue;const Ye=p?ke.text:ke.icon;if(!Ye||ke.fullyClipped||!Ye.segments.get().length)continue;const Me=Ye.programConfigurations.get(s.id),Fe=p||ke.sdfIcons,Qe=p?ke.textSizeData:ke.iconSizeData,Ge=X||W.pitch!==0,it=o.evaluateSizeForZoom(Qe,W.zoom);let It,Gt,wt,Lt,li=[0,0],si=null;if(p)Gt=Ue.glyphAtlasTexture,wt=q.LINEAR,It=Ue.glyphAtlasTexture.size,ke.iconsInText&&(li=Ue.imageAtlasTexture.size,si=Ue.imageAtlasTexture,Lt=Ge||l.options.rotating||l.options.zooming||Qe.kind==="composite"||Qe.kind==="camera"?q.LINEAR:q.NEAREST);else{const fo=s.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;Gt=Ue.imageAtlasTexture,wt=Fe||l.options.rotating||l.options.zooming||fo||Ge?q.LINEAR:q.NEAREST,It=Ue.imageAtlasTexture.size}const Ct=ke.projection.name==="globe",Ti=Ct?Je:Se,Ii=Ct?o.globeToMercatorTransition(W.zoom):0,ki=Xi(we,ke.getProjection(),W),zi=W.calculatePixelsToTileUnitsMatrix(Ue),jn=Le(ki,Ue.tileID.canonical,X,Z,W,ke.getProjection(),zi),kn=l.terrain&&X&&B?o.invert(o.create(),jn):sh,br=sn(ki,Ue.tileID.canonical,X,Z,W,ke.getProjection(),zi),Yr=ue&&ke.hasTextData(),Hi=s.layout.get("icon-text-fit")!=="none"&&Yr&&ke.hasIconData();if(B){const fo=W.elevation,Ao=fo?fo.getAtTileOffsetFunc(we,W.center.lat,W.worldSize,ke.getProjection()):null,is=Rr(ki,Ue.tileID.canonical,X,Z,W,ke.getProjection(),zi);ia(ke,ki,l,p,is,br,X,I,Ao,we)}const Pi=B||p&&ue||Hi,yi=l.translatePosMatrix(ki,Ue,_,v),fn=Pi?sh:jn,Jn=l.translatePosMatrix(br,Ue,_,v,!0),qi=ke.getProjection().createInversionMatrix(W,we.canonical),ir=[];l.terrainRenderModeElevated()&&X&&ir.push("PITCH_WITH_MAP_TERRAIN"),Ct&&ir.push("PROJECTION_GLOBE_VIEW"),Pi&&ir.push("PROJECTED_POS_ON_VIEWPORT");const Cl=Fe&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ts;ts=Fe?ke.iconsInText?oh(Qe.kind,it,G,X,l,yi,fn,Jn,It,li,we,Ii,he,qi,Ti,ke.getProjection()):hl(Qe.kind,it,G,X,l,yi,fn,Jn,p,It,!0,we,Ii,he,qi,Ti,ke.getProjection()):Pc(Qe.kind,it,G,X,l,yi,fn,Jn,p,It,we,Ii,he,qi,Ti,ke.getProjection());const Sa={program:l.useProgram(Bc(Fe,p,ke),Me,ir),buffers:Ye,uniformValues:ts,atlasTexture:Gt,atlasTextureIcon:si,atlasInterpolation:wt,atlasInterpolationIcon:Lt,isSDF:Fe,hasHalo:Cl,tile:Ue,labelPlaneMatrixInv:kn};if(J&&ke.canOverlap){$=!0;const fo=Ye.segments.get();for(const Ao of fo)me.push({segments:new o.SegmentVector([Ao]),sortKey:Ao.sortKey,state:Sa})}else me.push({segments:Ye.segments,sortKey:0,state:Sa})}$&&me.sort((we,Ue)=>we.sortKey-Ue.sortKey);for(const we of me){const Ue=we.state;if(l.terrain&&l.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:!ge,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),V.activeTexture.set(q.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,q.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(V.activeTexture.set(q.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Ue.isSDF){const ke=Ue.uniformValues;Ue.hasHalo&&(ke.u_is_halo=1,_a(Ue.buffers,we.segments,s,l,Ue.program,le,C,R,ke)),ke.u_is_halo=0}_a(Ue.buffers,we.segments,s,l,Ue.program,le,C,R,Ue.uniformValues)}}function _a(l,n,s,u,p,_,v,b,E){const I=u.context,C=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];p.draw(I,I.gl.TRIANGLES,_,v,b,o.CullFaceMode.disabled,E,s.id,l.layoutVertexBuffer,l.indexBuffer,n,s.paint,u.transform.zoom,l.programConfigurations.get(s.id),C)}function lh(l,n,s,u,p,_,v){const b=l.context.gl,E=s.paint.get("fill-pattern"),I=E&&E.constantOr(1);let C,R,V,q,W;v?(R=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=b.LINES):(R=I?"fillPattern":"fill",C=b.TRIANGLES);for(const Z of u){const X=n.getTile(Z);if(I&&!X.patternsLoaded())continue;const B=X.getBucket(s);if(!B)continue;l.prepareDrawTile();const G=B.programConfigurations.get(s.id),J=l.useProgram(R,G);I&&(l.context.activeTexture.set(b.TEXTURE0),X.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),G.updatePaintBuffers());const $=E.constantOr(null);if($&&X.imageAtlas){const he=X.imageAtlas.patternPositions[$.toString()];he&&G.setConstantPatternPositions(he)}const le=l.translatePosMatrix(Z.projMatrix,X,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){q=B.indexBuffer2,W=B.segments2;const he=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];V=R==="fillOutlinePattern"&&I?Xd(le,l,X,he):Wd(le,he)}else q=B.indexBuffer,W=B.segments,V=I?Sc(le,l,X):Jo(le);l.prepareDrawProgram(l.context,J,Z.toUnwrapped()),J.draw(l.context,C,p,l.stencilModeForClipping(Z),_,o.CullFaceMode.disabled,V,s.id,B.layoutVertexBuffer,q,W,s.paint,l.transform.zoom,G)}}function fl(l,n,s,u,p,_,v){const b=l.context,E=b.gl,I=l.transform,C=s.paint.get("fill-extrusion-pattern"),R=C.constantOr(1),V=s.paint.get("fill-extrusion-opacity"),q=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],W=s.layout.get("fill-extrusion-edge-radius"),Z=W>0&&!s.paint.get("fill-extrusion-rounded-roof"),X=Z?0:W,B=I.projection.name==="globe"?o.fillExtrusionHeightLift():0,G=I.projection.name==="globe",J=G?o.globeToMercatorTransition(I.zoom):0,$=[o.mercatorXfromLng(I.center.lng),o.mercatorYfromLat(I.center.lat)],le=[];G&&le.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&le.push("FAUX_AO"),Z&&le.push("ZERO_ROOF_RADIUS");for(const he of u){const ue=n.getTile(he),ge=ue.getBucket(s);if(!ge||ge.projection.name!==I.projection.name)continue;const me=ge.programConfigurations.get(s.id),Se=l.useProgram(R?"fillExtrusionPattern":"fillExtrusion",me,le);if(l.terrain){const Fe=l.terrain;if(l.style.terrainSetForDrapingOnly())Fe.setupElevationDraw(ue,Se,{useMeterToDem:!0});else{if(!ge.enableTerrain)continue;if(Fe.setupElevationDraw(ue,Se,{useMeterToDem:!0}),ch(b,n,he,ge,s,Fe),!ge.centroidVertexBuffer){const Qe=Se.attributes.a_centroid_pos;Qe!==void 0&&E.vertexAttrib2f(Qe,0,0)}}}R&&(l.context.activeTexture.set(E.TEXTURE0),ue.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),me.updatePaintBuffers());const Je=C.constantOr(null);if(Je&&ue.imageAtlas){const Fe=ue.imageAtlas.patternPositions[Je.toString()];Fe&&me.setConstantPatternPositions(Fe)}const we=l.translatePosMatrix(he.projMatrix,ue,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ue=I.projection.createInversionMatrix(I,he.canonical),ke=s.paint.get("fill-extrusion-vertical-gradient"),Ye=R?ih(we,l,ke,V,q,X,he,ue,B,J,$,Ue):Mc(we,l,ke,V,q,X,he,B,J,$,Ue);l.prepareDrawProgram(b,Se,he.toUnwrapped());const Me=[];l.terrain&&Me.push(ge.centroidVertexBuffer),G&&Me.push(ge.layoutVertexExtBuffer),Se.draw(b,b.gl.TRIANGLES,p,_,v,o.CullFaceMode.backCCW,Ye,s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,s.paint,l.transform.zoom,me,Me)}}function ch(l,n,s,u,p,_){const v=[B=>{let G=B.canonical.x-1,J=B.wrap;return G<0&&(G=(1<<B.canonical.z)-1,J--),new o.OverscaledTileID(B.overscaledZ,J,B.canonical.z,G,B.canonical.y)},B=>{let G=B.canonical.x+1,J=B.wrap;return G===1<<B.canonical.z&&(G=0,J++),new o.OverscaledTileID(B.overscaledZ,J,B.canonical.z,G,B.canonical.y)},B=>new o.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,(B.canonical.y===0?1<<B.canonical.z:B.canonical.y)-1),B=>new o.OverscaledTileID(B.overscaledZ,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y===(1<<B.canonical.z)-1?0:B.canonical.y+1)],b=B=>{const G=n.getSource().minzoom,J=le=>{const he=n.getTileByID(le);if(he&&he.hasData())return he.getBucket(p)},$=[0,-1,1];for(const le of $){if(B.overscaledZ+le<G)continue;const he=J(B.calculateScaledKey(B.overscaledZ+le));if(he)return he}},E=[0,0,0],I=(B,G)=>(E[0]=Math.min(B.min.y,G.min.y),E[1]=Math.max(B.max.y,G.max.y),E[2]=o.EXTENT-G.min.x>B.max.x?G.min.x-o.EXTENT:B.max.x,E),C=(B,G)=>(E[0]=Math.min(B.min.x,G.min.x),E[1]=Math.max(B.max.x,G.max.x),E[2]=o.EXTENT-G.min.y>B.max.y?G.min.y-o.EXTENT:B.max.y,E),R=[(B,G)=>I(B,G),(B,G)=>I(G,B),(B,G)=>C(B,G),(B,G)=>C(G,B)],V=new o.Point(0,0);let q,W,Z;const X=(B,G,J,$,le)=>{const he=[[$?J:B,$?B:J,0],[$?J:G,$?G:J,0]],ue=le<0?o.EXTENT+le:le,ge=[$?ue:(B+G)/2,$?(B+G)/2:ue,0];return J===0&&le<0||J!==0&&le>0?_.getForTilePoints(Z,[ge],!0,W):he.push(ge),_.getForTilePoints(s,he,!0,q),Math.max(he[0][2],he[1][2],ge[2])/_.exaggeration()};for(let B=0;B<4;B++){const G=(B<2?1:5)-B,J=u.borders[B];if(J.length===0)continue;const $=Z=v[B](s),le=b($);if(!(le&&le instanceof o.FillExtrusionBucket&&le.enableTerrain)||u.borderDoneWithNeighborZ[B]===le.canonical.z&&le.borderDoneWithNeighborZ[G]===u.canonical.z||(W=_.findDEMTileFor($),!W||!W.dem))continue;if(!q){const me=_.findDEMTileFor(s);if(!me||!me.dem)return;q=me}const he=le.borders[G];let ue=0;const ge=le.borderDoneWithNeighborZ[G]!==u.canonical.z;if(u.canonical.z===le.canonical.z){for(let me=0;me<J.length;me++){const Se=u.featuresOnBorder[J[me]],Je=Se.borders[B];let we;for(;ue<he.length&&(we=le.featuresOnBorder[he[ue]],!(we.borders[G][1]>Je[0]+3));)ge&&le.encodeCentroid(void 0,we,!1),ue++;if(we&&ue<he.length){const Ue=ue;let ke=0;for(;!(we.borders[G][0]>Je[1]-3)&&(ke++,++ue!==he.length);)we=le.featuresOnBorder[he[ue]];if(we=le.featuresOnBorder[he[Ue]],Se.intersectsCount()>1||we.intersectsCount()>1||ke!==1){ke!==1&&(ue=Ue),u.encodeCentroid(void 0,Se,!1),ge&&le.encodeCentroid(void 0,we,!1);continue}const Ye=R[B](Se,we),Me=B%2?o.EXTENT-1:0;V.x=X(Ye[0],Math.min(o.EXTENT-1,Ye[1]),Me,B<2,Ye[2]),V.y=0,u.encodeCentroid(V,Se,!1),ge&&le.encodeCentroid(V,we,!1)}else u.encodeCentroid(void 0,Se,!1)}u.borderDoneWithNeighborZ[B]=le.canonical.z,u.needsCentroidUpdate=!0,ge&&(le.borderDoneWithNeighborZ[G]=u.canonical.z,le.needsCentroidUpdate=!0)}else{for(const me of J)u.encodeCentroid(void 0,u.featuresOnBorder[me],!1);if(ge){for(const me of he)le.encodeCentroid(void 0,le.featuresOnBorder[me],!1);le.borderDoneWithNeighborZ[G]=u.canonical.z,le.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[B]=le.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const Ms=new o.Color(1,0,0,1),$d=new o.Color(0,1,0,1),Qd=new o.Color(0,0,1,1),ef=new o.Color(1,0,1,1),tf=new o.Color(0,1,1,1);function nf(l,n,s){const u=l.context,p=l.transform,_=u.gl,v=p.projection.name==="globe",b=v?["PROJECTION_GLOBE_VIEW"]:null;let E=s.projMatrix;if(v&&o.globeToMercatorTransition(p.zoom)>0){const Se=o.transitionTileAABBinECEF(s.canonical,p),Je=o.globeDenormalizeECEF(Se);E=o.multiply(new Float32Array(16),p.globeMatrix,Je),o.multiply(E,p.projMatrix,E)}const I=l.useProgram("debug",null,b),C=n.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(C,I);const R=o.DepthMode.disabled,V=o.StencilMode.disabled,q=l.colorModeForRenderPass(),W="$debug";u.activeTexture.set(_.TEXTURE0),l.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),v?C._makeGlobeTileDebugBuffers(l.context,p):C._makeDebugTileBoundsBuffers(l.context,p.projection);const Z=C._tileDebugBuffer||l.debugBuffer,X=C._tileDebugIndexBuffer||l.debugIndexBuffer,B=C._tileDebugSegments||l.debugSegments;I.draw(u,_.LINE_STRIP,R,V,q,o.CullFaceMode.disabled,cl(E,o.Color.red),W,Z,X,B,null,null,null,[C._globeTileDebugBorderBuffer]);const G=C.latestRawTileData,J=Math.floor((G&&G.byteLength||0)/1024),$=n.getTile(s).tileSize,le=512/Math.min($,512)*(s.overscaledZ/p.zoom)*.5;let he=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(he+=` => ${s.overscaledZ}`),he+=` ${J}kb`,function(Se,Je){Se.initDebugOverlayCanvas();const we=Se.debugOverlayCanvas,Ue=Se.context.gl,ke=Se.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,we.width,we.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Je,5,5),ke.strokeText(Je,5,5),Se.debugOverlayTexture.update(we),Se.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(l,he);const ue=C._tileDebugTextBuffer||l.debugBuffer,ge=C._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,me=C._tileDebugTextSegments||l.debugSegments;I.draw(u,_.TRIANGLES,R,V,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,cl(E,o.Color.transparent,le),W,ue,ge,me,null,null,null,[C._globeTileDebugTextBuffer])}function uh(l,n,s,u){Ss(l,0,n+s/2,l.transform.width,s,u)}function pl(l,n,s,u){Ss(l,n-s/2,0,s,l.transform.height,u)}function Ss(l,n,s,u,p,_){const v=l.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(n*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,u*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}const hh=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:dh}=hh;function uo(l,n,s,u){l.emplaceBack(n,s,u)}class ml{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,uo(this.vertexArray,-1,-1,1),uo(this.vertexArray,1,-1,1),uo(this.vertexArray,-1,1,1),uo(this.vertexArray,1,1,1),uo(this.vertexArray,-1,-1,-1),uo(this.vertexArray,1,-1,-1),uo(this.vertexArray,-1,1,-1),uo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,dh),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function xr(l,n,s,u,p,_){const v=l.gl,b=n.paint.get("sky-atmosphere-color"),E=n.paint.get("sky-atmosphere-halo-color"),I=n.paint.get("sky-atmosphere-sun-intensity"),C=((R,V,q,W,Z)=>({u_matrix_3f:R,u_sun_direction:V,u_sun_intensity:q,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),u),p,I,b,E);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+_,n.skyboxTexture,0),s.draw(l,v.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,C,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ga=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fh{constructor(n){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const u=new o.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(s,ga.members),this.indexBuffer=n.createIndexBuffer(u),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const $o={symbol:function(l,n,s,u,p){if(l.renderPass!=="translucent")return;const _=o.StencilMode.disabled,v=l.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(b,E,I,C,R,V,q){const W=E.transform,Z=R==="map",X=V==="map";for(const B of b){const G=C.getTile(B),J=G.getBucket(I);if(!J||!J.text||!J.text.segments.get().length)continue;const $=o.evaluateSizeForZoom(J.textSizeData,W.zoom),le=Xi(B,J.getProjection(),W),he=W.calculatePixelsToTileUnitsMatrix(G),ue=Le(le,G.tileID.canonical,X,Z,W,J.getProjection(),he),ge=I.layout.get("icon-text-fit")!=="none"&&J.hasIconData();if($){const me=Math.pow(2,W.zoom-G.tileID.overscaledZ);Jd(J,Z,X,q,o.symbolSize,W,ue,B,me,$,ge)}}}(u,l,s,n,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&ah(l,n,s,u,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,v),s.paint.get("text-opacity").constantOr(1)!==0&&ah(l,n,s,u,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,v),n.map.showCollisionBoxes&&(ma(l,n,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),ma(l,n,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,n,s,u){if(l.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const E=l.context,I=E.gl,C=l.transform,R=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),V=o.StencilMode.disabled,q=l.colorModeForRenderPass(),W=C.projection.name==="globe",Z=[o.mercatorXfromLng(C.center.lng),o.mercatorYfromLat(C.center.lat)],X=[];for(let G=0;G<u.length;G++){const J=u[G],$=n.getTile(J),le=$.getBucket(s);if(!le||le.projection.name!==C.projection.name)continue;const he=le.programConfigurations.get(s.id),ue=Cc(s);W&&ue.push("PROJECTION_GLOBE_VIEW");const ge=l.useProgram("circle",he,ue),me=le.layoutVertexBuffer,Se=le.globeExtVertexBuffer,Je=le.indexBuffer,we=C.projection.createInversionMatrix(C,J.canonical),Ue={programConfiguration:he,program:ge,layoutVertexBuffer:me,globeExtVertexBuffer:Se,indexBuffer:Je,uniformValues:Ac(l,J,$,we,Z,s),tile:$};if(b){const ke=le.segments.get();for(const Ye of ke)X.push({segments:new o.SegmentVector([Ye]),sortKey:Ye.sortKey,state:Ue})}else X.push({segments:le.segments,sortKey:0,state:Ue})}b&&X.sort((G,J)=>G.sortKey-J.sortKey);const B={useDepthForOcclusion:!W};for(const G of X){const{programConfiguration:J,program:$,layoutVertexBuffer:le,globeExtVertexBuffer:he,indexBuffer:ue,uniformValues:ge,tile:me}=G.state,Se=G.segments;l.terrain&&l.terrain.setupElevationDraw(me,$,B),l.prepareDrawProgram(E,$,me.tileID.toUnwrapped()),$.draw(E,I.TRIANGLES,R,V,q,o.CullFaceMode.disabled,ge,s.id,le,ue,Se,s.paint,C.zoom,J,[he])}},heatmap:function(l,n,s,u){if(s.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,_=p.gl,v=o.StencilMode.disabled,b=new o.ColorMode([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(q,W,Z,X){const B=q.gl,G=W.width*X,J=W.height*X;q.activeTexture.set(B.TEXTURE1),q.viewport.set([0,0,G,J]);let $=Z.heatmapFbo;if(!$||$&&($.width!==G||$.height!==J)){$&&$.destroy();const le=B.createTexture();B.bindTexture(B.TEXTURE_2D,le),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),$=Z.heatmapFbo=q.createFramebuffer(G,J,!1),function(he,ue,ge,me,Se,Je){const we=he.gl;we.texImage2D(we.TEXTURE_2D,0,he.isWebGL2&&he.extRenderToTextureHalfFloat?we.RGBA16F:we.RGBA,Se,Je,0,we.RGBA,he.extRenderToTextureHalfFloat?he.isWebGL2?we.HALF_FLOAT:he.extTextureHalfFloat.HALF_FLOAT_OES:we.UNSIGNED_BYTE,null),me.colorAttachment.set(ge)}(q,0,le,$,G,J)}else B.bindTexture(B.TEXTURE_2D,$.colorAttachment.get()),q.bindFramebuffer.set($.framebuffer)})(p,l,s,l.transform.projection.name==="globe"?.5:.25),p.clear({color:o.Color.transparent});const E=l.transform,I=E.projection.name==="globe",C=I?["PROJECTION_GLOBE_VIEW"]:null,R=I?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,V=[o.mercatorXfromLng(E.center.lng),o.mercatorYfromLat(E.center.lat)];for(let q=0;q<u.length;q++){const W=u[q];if(n.hasRenderableParent(W))continue;const Z=n.getTile(W),X=Z.getBucket(s);if(!X||X.projection.name!==E.projection.name)continue;const B=X.programConfigurations.get(s.id),G=l.useProgram("heatmap",B,C),{zoom:J}=l.transform;l.terrain&&l.terrain.setupElevationDraw(Z,G),l.prepareDrawProgram(p,G,W.toUnwrapped());const $=E.projection.createInversionMatrix(E,W.canonical);G.draw(p,_.TRIANGLES,o.DepthMode.disabled,v,b,R,rh(l,W,Z,$,V,J,s.paint.get("heatmap-intensity")),s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,l.transform.zoom,B,I?[X.globeExtVertexBuffer]:null)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,_){const v=p.context,b=v.gl,E=_.heatmapFbo;if(!E)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E.colorAttachment.get()),v.activeTexture.set(b.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new o.Texture(v,_.colorRamp,b.RGBA)),I.bind(b.LINEAR,b.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(v,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,((C,R,V,q)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(l,s))},line:function(l,n,s,u){if(l.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const v=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=l.colorModeForRenderPass(),E=l.terrain&&l.terrain.renderingToTexture?1:o.exported.devicePixelRatio,I=s.paint.get("line-dasharray"),C=I.constantOr(1),R=s.layout.get("line-cap"),V=s.paint.get("line-pattern"),q=V.constantOr(1),W=s.paint.get("line-gradient"),Z=q?"linePattern":"line",X=l.context,B=X.gl,G=($=>{const le=[];pa($)&&le.push("RENDER_LINE_DASH"),$.paint.get("line-gradient")&&le.push("RENDER_LINE_GRADIENT");const he=$.paint.get("line-trim-offset");he[0]===0&&he[1]===0||le.push("RENDER_LINE_TRIM_OFFSET");const ue=$.paint.get("line-pattern").constantOr(1),ge=$.paint.get("line-opacity").constantOr(1)!==1;return!ue&&ge&&le.push("RENDER_LINE_ALPHA_DISCARD"),le})(s);let J=G.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(J=!1);for(const $ of u){const le=n.getTile($);if(q&&!le.patternsLoaded())continue;const he=le.getBucket(s);if(!he)continue;l.prepareDrawTile();const ue=he.programConfigurations.get(s.id),ge=l.useProgram(Z,ue,G),me=V.constantOr(null);if(me&&le.imageAtlas){const Fe=le.imageAtlas.patternPositions[me.toString()];Fe&&ue.setConstantPatternPositions(Fe)}const Se=I.constantOr(null),Je=R.constantOr(null);if(!q&&Se&&Je&&le.lineAtlas){const Fe=le.lineAtlas.getDash(Se,Je);Fe&&ue.setConstantPatternPositions(Fe)}let[we,Ue]=s.paint.get("line-trim-offset");(Je==="round"||Je==="square")&&we!==Ue&&(we===0&&(we-=1),Ue===1&&(Ue+=1));const ke=l.terrain?$.projMatrix:null,Ye=q?fa(l,le,s,ke,E):Yd(l,le,s,ke,he.lineClipsArray.length,E,[we,Ue]);if(W){const Fe=he.gradients[s.id];let Qe=Fe.texture;if(s.gradientVersion!==Fe.version){let Ge=256;if(s.stepInterpolant){const it=n.getSource().maxzoom,It=$.canonical.z===it?Math.ceil(1<<l.transform.maxZoom-$.canonical.z):1;Ge=o.clamp(o.nextPowerOfTwo(he.maxLineLength/o.EXTENT*1024*It),256,X.maxTextureSize)}Fe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Ge,image:Fe.gradient||void 0,clips:he.lineClipsArray}),Fe.texture?Fe.texture.update(Fe.gradient):Fe.texture=new o.Texture(X,Fe.gradient,B.RGBA),Fe.version=s.gradientVersion,Qe=Fe.texture}X.activeTexture.set(B.TEXTURE1),Qe.bind(s.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}C&&(X.activeTexture.set(B.TEXTURE0),le.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),ue.updatePaintBuffers()),q&&(X.activeTexture.set(B.TEXTURE0),le.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ue.updatePaintBuffers()),l.prepareDrawProgram(X,ge,$.toUnwrapped());const Me=Fe=>{ge.draw(X,B.TRIANGLES,v,Fe,b,o.CullFaceMode.disabled,Ye,s.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,s.paint,l.transform.zoom,ue,[he.layoutVertexBuffer2])};if(J){const Fe=l.stencilModeForClipping($).ref;Fe===0&&l.terrain&&X.clear({stencil:0});const Qe={func:B.EQUAL,mask:255};Ye.u_alpha_discard_threshold=.8,Me(new o.StencilMode(Qe,Fe,255,B.KEEP,B.KEEP,B.INVERT)),Ye.u_alpha_discard_threshold=0,Me(new o.StencilMode(Qe,Fe,255,B.KEEP,B.KEEP,B.KEEP))}else Me(l.stencilModeForClipping($))}J&&(l.resetStencilClippingMasks(),l.terrain&&X.clear({stencil:0}))},fill:function(l,n,s,u){const p=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=l.colorModeForRenderPass(),b=s.paint.get("fill-pattern"),E=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&p.constantOr(o.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===E){const I=l.depthModeForSublayer(1,l.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);lh(l,n,s,u,I,v,!1)}if(l.renderPass==="translucent"&&s.paint.get("fill-antialias")){const I=l.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);lh(l,n,s,u,I,v,!0)}},"fill-extrusion":function(l,n,s,u){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&l.renderPass==="translucent"){const _=new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))fl(l,n,s,u,_,o.StencilMode.disabled,o.ColorMode.disabled),fl(l,n,s,u,_,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const v=l.colorModeForRenderPass();fl(l,n,s,u,_,o.StencilMode.disabled,v)}}},hillshade:function(l,n,s,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const p=l.context,_=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),v=l.colorModeForRenderPass(),b=l.terrain&&l.terrain.renderingToTexture,[E,I]=l.renderPass!=="translucent"||b?[{},u]:l.stencilConfigForOverlap(u);for(const C of I){const R=n.getTile(C);if(R.needsHillshadePrepare&&l.renderPass==="offscreen")Qu(l,R,s,_,o.StencilMode.disabled,v);else if(l.renderPass==="translucent"){const V=b&&l.terrain?l.terrain.stencilModeForRTTOverlap(C):E[C.overscaledZ];$u(l,C,R,s,_,V,v)}}p.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,n,s,u,p,_){if(l.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!u.length)return;const v=l.context,b=v.gl,E=n.getSource(),I=l.useProgram("raster"),C=l.colorModeForRenderPass(),R=l.terrain&&l.terrain.renderingToTexture,[V,q]=E instanceof Vt||R?[{},u]:l.stencilConfigForOverlap(u),W=q[q.length-1].overscaledZ,Z=!l.options.moving;for(const X of q){const B=R?o.DepthMode.disabled:l.depthModeForSublayer(X.overscaledZ-W,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,b.LESS),G=X.toUnwrapped(),J=n.getTile(X);if(R&&(!J||!J.hasData()))continue;const $=R?X.projMatrix:l.transform.calculateProjMatrix(G,Z),le=l.terrain&&R?l.terrain.stencilModeForRTTOverlap(X):V[X.overscaledZ],he=_?0:s.paint.get("raster-fade-duration");J.registerFadeDuration(he);const ue=n.findLoadedParent(X,0),ge=wc(J,ue,n,l.transform,he);let me,Se;l.terrain&&l.terrain.prepareDrawTile();const Je=s.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;v.activeTexture.set(b.TEXTURE0),J.texture.bind(Je,b.CLAMP_TO_EDGE),v.activeTexture.set(b.TEXTURE1),ue?(ue.texture.bind(Je,b.CLAMP_TO_EDGE),me=Math.pow(2,ue.tileID.overscaledZ-J.tileID.overscaledZ),Se=[J.tileID.canonical.x*me%1,J.tileID.canonical.y*me%1]):J.texture.bind(Je,b.CLAMP_TO_EDGE),J.texture.useMipmap&&v.extTextureFilterAnisotropic&&l.transform.pitch>20&&b.texParameterf(b.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax);const we=zc($,Se||[0,0],me||1,ge,s,E instanceof Vt?E.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(v,I,G),E instanceof Vt)E.boundsBuffer&&E.boundsSegments&&I.draw(v,b.TRIANGLES,B,o.StencilMode.disabled,C,o.CullFaceMode.disabled,we,s.id,E.boundsBuffer,l.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:ke,tileBoundsSegments:Ye}=l.getTileBoundsBuffers(J);I.draw(v,b.TRIANGLES,B,le,C,o.CullFaceMode.disabled,we,s.id,Ue,ke,Ye)}}l.resetStencilClippingMasks()},background:function(l,n,s,u){const p=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const v=l.context,b=v.gl,E=l.transform,I=E.tileSize,C=s.paint.get("background-pattern");if(l.isPatternMissing(C))return;const R=!C&&p.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==R)return;const V=o.StencilMode.disabled,q=l.depthModeForSublayer(0,R==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),W=l.colorModeForRenderPass(),Z=l.useProgram(C?"backgroundPattern":"background");let X,B=u;B||(X=l.getBackgroundTiles(),B=Object.values(X).map(G=>G.tileID)),C&&(v.activeTexture.set(b.TEXTURE0),l.imageManager.bind(l.context));for(const G of B){const J=G.toUnwrapped(),$=u?G.projMatrix:l.transform.calculateProjMatrix(J);l.prepareDrawTile();const le=n?n.getTile(G):X?X[G.key]:new o.Tile(G,I,E.zoom,l),he=C?Kd($,_,l,C,{tileID:G,tileSize:I}):Dc($,_,p);l.prepareDrawProgram(v,Z,J);const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:ge,tileBoundsSegments:me}=l.getTileBoundsBuffers(le);Z.draw(v,b.TRIANGLES,q,V,W,o.CullFaceMode.disabled,he,s.id,ue,ge,me)}},sky:function(l,n,s){const u=l.transform,p=u.projection.name==="mercator"||u.projection.name==="globe"?1:o.smoothstep(7,8,u.zoom),_=s.paint.get("sky-opacity")*p;if(_===0)return;const v=l.context,b=s.paint.get("sky-type"),E=new o.DepthMode(v.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),I=l.frameCounter/1e3%1;b==="atmosphere"?l.renderPass==="offscreen"?s.needsSkyboxCapture(l)&&(function(C,R,V,q){const W=C.context,Z=W.gl;let X=R.skyboxFbo;if(!X){X=R.skyboxFbo=W.createFramebuffer(32,32,!1),R.skyboxGeometry=new ml(W),R.skyboxTexture=W.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,R.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let $=0;$<6;++$)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+$,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(X.framebuffer),W.viewport.set([0,0,32,32]);const B=R.getCenter(C,!0),G=C.useProgram("skyboxCapture"),J=new Float64Array(16);o.identity(J),o.rotateY(J,J,.5*-Math.PI),xr(W,R,G,J,B,0),o.identity(J),o.rotateY(J,J,.5*Math.PI),xr(W,R,G,J,B,1),o.identity(J),o.rotateX(J,J,.5*-Math.PI),xr(W,R,G,J,B,2),o.identity(J),o.rotateX(J,J,.5*Math.PI),xr(W,R,G,J,B,3),o.identity(J),xr(W,R,G,J,B,4),o.identity(J),o.rotateY(J,J,Math.PI),xr(W,R,G,J,B,5),W.viewport.set([0,0,C.width,C.height])}(l,s),s.markSkyboxValid(l)):l.renderPass==="sky"&&function(C,R,V,q,W){const Z=C.context,X=Z.gl,B=C.transform,G=C.useProgram("skybox");Z.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,R.skyboxTexture);const J=(($,le,he,ue,ge)=>({u_matrix:$,u_sun_direction:le,u_cubemap:0,u_opacity:ue,u_temporal_offset:ge}))(B.skyboxMatrix,R.getCenter(C,!1),0,q,W);C.prepareDrawProgram(Z,G),G.draw(Z,X.TRIANGLES,V,o.StencilMode.disabled,C.colorModeForRenderPass(),o.CullFaceMode.backCW,J,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,s,E,_,I):b==="gradient"&&l.renderPass==="sky"&&function(C,R,V,q,W){const Z=C.context,X=Z.gl,B=C.transform,G=C.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new ml(Z)),Z.activeTexture.set(X.TEXTURE0);let J=R.colorRampTexture;J||(J=R.colorRampTexture=new o.Texture(Z,R.colorRamp,X.RGBA)),J.bind(X.LINEAR,X.CLAMP_TO_EDGE);const $=((le,he,ue,ge,me)=>({u_matrix:le,u_color_ramp:0,u_center_direction:he,u_radius:o.degToRad(ue),u_opacity:ge,u_temporal_offset:me}))(B.skyboxMatrix,R.getCenter(C,!1),R.paint.get("sky-gradient-radius"),q,W);C.prepareDrawProgram(Z,G),G.draw(Z,X.TRIANGLES,V,o.StencilMode.disabled,C.colorModeForRenderPass(),o.CullFaceMode.backCW,$,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(l,s,E,_,I)},debug:function(l,n,s){for(let u=0;u<s.length;u++)nf(l,n,s[u])},custom:function(l,n,s,u){const p=l.context,_=s.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&s.isLayerDraped()){if(l.renderPass==="offscreen"){const v=_.prerender;if(v){if(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const b=l.transform.pointMerc;v.call(_,p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(l.transform.zoom),[b.x,b.y],l.transform.pixelsPerMeterRatio)}else v.call(_,p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const b=_.renderToTile;if(b){const E=u[0].canonical,I=new o.MercatorCoordinate(E.x+u[0].wrap*(1<<E.z),E.y,E.z);p.setDepthMode(o.DepthMode.disabled),p.setStencilMode(o.StencilMode.disabled),p.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),b.call(_,p.gl,I),p.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const v=_.renderingMode==="3d"?new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(p.setDepthMode(v),l.transform.projection.name==="globe"){const b=l.transform.pointMerc;_.render(p.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(l.transform.zoom),[b.x,b.y],l.transform.pixelsPerMeterRatio)}else _.render(p.gl,l.transform.customLayerMatrix());p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class As{constructor(n,s,u=!1){this.context=new nt(n,u),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,s){const u=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ec(this,n));const p=this._terrain;this.transform.elevation=u?p:null,p.update(n,this.transform,s)}_updateFog(n){const s=n.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=s.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,s){if(this.width=n*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const n=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(u,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const p=new o.StructArrayLayout2i4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(p,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _=new o.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(_,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(v);const b=new o.StructArrayLayout1ui2;for(const I of[0,1,3,2,0])b.emplaceBack(I);this.debugIndexBuffer=n.createIndexBuffer(b),this.emptyTexture=new o.Texture(n,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=o.create();const E=this.context.gl;this.stencilClearMode=new o.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new fh(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ha(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,s,u){if(!s||this.currentStencilSource===s.id||!n.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const E of u)if(this._tileClippingMaskIDs[E.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=s.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of u){const E=s.getTile(b),I=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:V}=this.getTileBoundsBuffers(E);v.draw(p,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ha(b.projMatrix),"$clipping",C,R,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(n){const s=this.context.gl,u=n.sort((v,b)=>b.overscaledZ-v.overscaledZ),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+p]=new o.StencilMode({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[v,u]}return[{[p]:o.StencilMode.disabled},u]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,s,u){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(u||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,s){this.style=n,this.options=s,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const u=this.style.order,p=this.style._sourceCaches;for(const I in p){const C=p[I];C.used&&C.prepare(this.context)}const _={},v={},b={};for(const I in p){const C=p[I];_[I]=C.getVisibleCoordinates(),v[I]=_[I].slice().reverse(),b[I]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<u.length;I++)if(this.style._layers[u[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const I of u){const C=this.style._layers[I],R=n._getLayerSourceCache(C);if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const V=R?v[R.id]:void 0;(C.type==="custom"||C.isSky()||V&&V.length)&&this.renderLayer(this,R,C,V)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const E=this.terrain;if(E&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&E.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[u[this.currentLayer]],C=n._getLayerSourceCache(I);if(I.isSky())continue;const R=C?v[C.id]:void 0;this._renderTileClippingMasks(I,C,R),this.renderLayer(this,C,I,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,C){const R=I.context,V=R.gl,q=I.transform,W=new o.DepthMode(V.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Z=I.useProgram("globeAtmosphere",null,q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),X=o.globeToMercatorTransition(q.zoom),B=C.properties.get("color").toArray01(),G=C.properties.get("high-color").toArray01(),J=C.properties.get("space-color").toArray01PremultipliedAlpha(),$=o.identity$1([]);o.rotateY$1($,$,-o.degToRad(q._center.lng)),o.rotateX$1($,$,o.degToRad(q._center.lat)),o.rotateZ$1($,$,q.angle),o.rotateX$1($,$,-q._pitch);const le=o.fromQuat(new Float32Array(16),$),he=o.mapValue(C.properties.get("star-intensity"),0,1,0,.25),ue=5e-4,ge=o.mapValue(C.properties.get("horizon-blend"),0,1,ue,.25),me=o.globeUseCustomAntiAliasing(I,R,q)&&ge===ue?q.worldSize/(2*Math.PI*1.025)-1:q.globeRadius,Se=I.frameCounter/1e3%1,Je=o.length(q.globeCenterInViewSpace),we=Math.sqrt(Math.pow(Je,2)-Math.pow(me,2)),Ue=Math.acos(we/Je),ke=((Me,Fe,Qe,Ge,it,It,Gt,wt,Lt,li,si,Ct,Ti,Ii)=>({u_frustum_tl:Me,u_frustum_tr:Fe,u_frustum_br:Qe,u_frustum_bl:Ge,u_horizon:it,u_transition:It,u_fadeout_range:Gt,u_color:wt,u_high_color:Lt,u_space_color:li,u_star_intensity:si,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ct,u_horizon_angle:Ti,u_rotation_matrix:Ii}))(q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.frustumCorners.horizon,X,ge,B,G,J,he,Se,Ue,le);I.prepareDrawProgram(R,Z);const Ye=I.atmosphereBuffer;Ye&&Z.draw(R,V.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ke,"skybox",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const I=this.style._layers[u[this.currentLayer]],C=n._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,C,I,C?v[C.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const I=this.style._layers[u[this.currentLayer]],C=n._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=C?(I.type==="symbol"?b:v)[C.id]:void 0;this._renderTileClippingMasks(I,C,C?_[C.id]:void 0),this.renderLayer(this,C,I,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;o.values(this.style._layers).forEach(C=>{const R=n._getLayerSourceCache(C);R&&!C.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<R.getSource().maxzoom)&&(I=R)}),I&&this.options.showTileBoundaries&&$o.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const C=I.transform.padding;uh(I,I.transform.height-(C.top||0),3,Ms),uh(I,C.bottom||0,3,$d),pl(I,C.left||0,3,Qd),pl(I,I.transform.width-(C.right||0),3,ef);const R=I.transform.centerPoint;(function(V,q,W,Z){Ss(V,q-1,W-10,2,20,Z),Ss(V,q-10,W-1,20,2,Z)})(I,R.x,I.transform.height-R.y,tf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,s,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(u.type)||n.terrain&&u.type==="custom")&&$o[u.type](n,s,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let u=this.gpuTimers[n.id];u||(u=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),u.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,u.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,s=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),n.beginQueryEXT(n.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const s={};for(const u in n){const p=n[u],_=this.context.extTimerQuery,v=_.getQueryObjectEXT(p.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(p.query),s[u]=v}return s}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let u=0;for(const p of n)u+=s.getQueryObjectEXT(p,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(p);return u}translatePosMatrix(n,s,u,p,_){if(!u[0]&&!u[1])return n;const v=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),C=Math.cos(v);u=[u[0]*C-u[1]*I,u[0]*I+u[1]*C]}const b=[_?u[0]:Nt(s,u[0],this.transform.zoom),_?u[1]:Nt(s,u[1],this.transform.zoom),0],E=new Float32Array(16);return o.translate(E,n,b),E}saveTileTexture(n){const s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,s=this.terrain&&this.terrain.exaggeration()===0,u=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),s&&p.push("ZERO_EXAGGERATION"),u&&!n&&u.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),n&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(n,s,u){this.cache=this.cache||{};const p=u||[],_=this.currentGlobalDefines().concat(p),v=di.cacheKey(yc[n],n,_,s);return this.cache[v]||(this.cache[v]=new di(this.context,n,yc[n],s,Lc[n],_)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,s,u){if(this.terrain&&this.terrain.renderingToTexture)return;const p=this.style.fog;if(p){const _=p.getOpacity(this.transform.pitch),v=((b,E,I,C,R,V,q,W,Z,X,B)=>{const G=b.transform,J=E.properties.get("color").toArray01();J[3]=C;const $=b.frameCounter/1e3%1;return{u_fog_matrix:I?G.calculateFogTileMatrix(I):b.identityMat,u_fog_range:E.getFovAdjustedRange(G._fov),u_fog_color:J,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:$,u_frustum_tl:R,u_frustum_tr:V,u_frustum_br:q,u_frustum_bl:W,u_globe_pos:Z,u_globe_radius:X,u_viewport:B,u_globe_transition:o.globeToMercatorTransition(G.zoom),u_is_globe:+(G.projection.name==="globe")}})(this,p,u,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(n,v)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)s[p.key]=n[p.key]||new o.Tile(p,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class _l{constructor(n=0,s=0,u=0,p=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=u,this.right=p}interpolate(n,s,u){return s.top!=null&&n.top!=null&&(this.top=o.number(n.top,s.top,u)),s.bottom!=null&&n.bottom!=null&&(this.bottom=o.number(n.bottom,s.bottom,u)),s.left!=null&&n.left!=null&&(this.left=o.number(n.left,s.left,u)),s.right!=null&&n.right!=null&&(this.right=o.number(n.right,s.right,u)),this}getCenter(n,s){const u=o.clamp((this.left+n-this.right)/2,0,n),p=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.Point(u,p)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new _l(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gl(l,n){const s=o.getColumn(l,3);o.fromQuat(l,n),o.setColumn(l,3,s)}function mi(l,n){const s=o.identity$1([]);return o.rotateZ$1(s,s,-n),o.rotateX$1(s,s,-l),s}function ya(l,n){const s=[l[0],l[1],0],u=[n[0],n[1],0];if(o.length(s)>=1e-15){const v=o.normalize([],s);o.scale$2(u,v,o.dot(u,v)),n[0]=u[0],n[1]=u[1]}const p=o.cross([],n,l);if(o.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return mi(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}class ph{constructor(n,s){this.position=n,this.orientation=s}get position(){return this._position}set position(n){if(n){const s=n instanceof o.MercatorCoordinate?n:new o.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(n,s){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,_=o.MercatorCoordinate.fromLngLat(n,p),v=[_.x-u.x,_.y-u.y,_.z-u.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=ya(v,s)}setPitchBearing(n,s){this.orientation=mi(o.degToRad(n),o.degToRad(-s))}}class yl{constructor(n,s){this._transform=o.identity([]),this.orientation=s,this.position=n}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var s;n&&o.setColumn(this._transform,3,[(s=n)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.identity$1([]),n&&gl(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,s){this._orientation=mi(n,s),gl(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,s){const u=new Float64Array(16);return o.invert(u,this.getWorldToCamera(n,s)),u}getWorldToCameraPosition(n,s,u){const p=this.position;o.scale$2(p,p,-n);const _=new Float64Array(16);return o.fromScaling(_,[u,u,u]),o.translate(_,_,p),_[10]*=s,_}getWorldToCamera(n,s){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return o.conjugate(p,this._orientation),o.scale$2(_,_,-n),o.fromQuat(u,p),o.translate(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(n,s,u,p){const _=new Float64Array(16);return o.perspective(_,n,s,u,p),_}getDistanceToElevation(n,s=!1){const u=n===0?0:o.mercatorZfromAltitude(n,s?o.latFromMercatorY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new yl([...this.position],[...this.orientation])}}function Cs(l,n){const s=xl(l.projection,l.zoom,l.width,l.height),u=function(_,v,b,E,I){const C=new o.LngLat(b.lng-180*ho,b.lat),R=new o.LngLat(b.lng+180*ho,b.lat),V=_.project(C.lng,C.lat),q=_.project(R.lng,R.lat),W=-Math.atan2(q.y-V.y,q.x-V.x),Z=o.MercatorCoordinate.fromLngLat(b);Z.y=o.clamp(Z.y,-1+ho,1-ho);const X=Z.toLngLat(),B=_.project(X.lng,X.lat),G=o.MercatorCoordinate.fromLngLat(X);G.x+=ho;const J=G.toLngLat(),$=_.project(J.lng,J.lat),le=vl($.x-B.x,$.y-B.y,W),he=o.MercatorCoordinate.fromLngLat(X);he.y+=ho;const ue=he.toLngLat(),ge=_.project(ue.lng,ue.lat),me=vl(ge.x-B.x,ge.y-B.y,W),Se=Math.abs(le.x)/Math.abs(me.y),Je=o.identity([]);o.rotateZ(Je,Je,-W*(1-(I?0:E)));const we=o.identity([]);return o.scale(we,we,[1,1-(1-Se)*E,1]),we[4]=-me.x/me.y*E,o.rotateZ(we,we,W),o.multiply(we,Je,we),we}(l.projection,0,l.center,s,n),p=mh(l);return o.scale(u,u,[p,p,1]),u}function mh(l){const n=l.projection,s=xl(l.projection,l.zoom,l.width,l.height),u=_h(n,l.center),p=_h(n,o.LngLat.convert(n.center));return Math.pow(2,u*s+(1-s)*p)}function xl(l,n,s,u,p=1/0){const _=l.range;if(!_)return 0;const v=Math.min(p,Math.max(s,u)),b=Math.log(v/1024)/Math.LN2;return o.smoothstep(_[0]+b,_[1]+b,n)}const ho=1/4e4;function _h(l,n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=new o.LngLat(n.lng-180*ho,s),p=new o.LngLat(n.lng+180*ho,s),_=l.project(u.lng,s),v=l.project(p.lng,s),b=o.MercatorCoordinate.fromLngLat(u),E=o.MercatorCoordinate.fromLngLat(p),I=v.x-_.x,C=v.y-_.y,R=E.x-b.x,V=E.y-b.y,q=Math.sqrt((R*R+V*V)/(I*I+C*C));return Math.log(q)/Math.LN2}function vl(l,n,s){const u=Math.cos(s),p=Math.sin(s);return{x:l*u-n*p,y:l*p+n*u}}class Is{constructor(n,s,u,p,_,v,b){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(v),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _l,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new yl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Is(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,s=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(n||u)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const u=!L(s,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=n!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const s=-n*Math.PI/180;var u;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(u=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(p,_,v){var b=_[0],E=_[1],I=_[2],C=_[3],R=Math.sin(v),V=Math.cos(v);p[0]=b*V+I*R,p[1]=E*V+C*R,p[2]=b*-R+I*V,p[3]=E*-R+C*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const s=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let v=0;v<s.length;v++){const b=new o.Point(s[v][0]*this.width,u+s[v][1]*(this.height-u)),E=n.pointCoordinate(b);if(!E)continue;const I=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);p+=E[3]*I,_+=I}return _===0?NaN:p/_}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,p=this._mercatorZfromZoom(n),_=this._mercatorZfromZoom(this._maxZoom),v=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let u;u=n.z<this._camera.position[2]?[s.x,s.y,s.z]:[n.x,n.y,n.z];const p=o.length(o.sub([],this._camera.position,u));return o.clamp(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let s=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(n.orientation)),n.position){const u=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,s=new ph;return s.position=new o.MercatorCoordinate(n[0],n[1],n[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const s=o.transformQuat([],[0,0,-1],n),u=o.transformQuat([],[0,-1,0],n);if(u[2]<0)return!1;const p=ya(s,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(n){const s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;n[2]=o.clamp(n[2],p/u,p/s),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,u){this._unmodified=!1,this._edgeInsets.interpolate(n,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(n){const s=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.Point(0,0)),p=this.pointCoordinate(new o.Point(this.width,0)),_=this.pointCoordinate(new o.Point(this.width,this.height)),v=this.pointCoordinate(new o.Point(0,this.height)),b=Math.floor(Math.min(u.x,p.x,_.x,v.x)),E=Math.floor(Math.max(u.x,p.x,_.x,v.x)),I=1;for(let C=b-I;C<=E+I;C++)C!==0&&s.push(new o.UnwrappedTileID(C,n))}return s}coveringTiles(n){let s=this.coveringZoomLevel(n);const u=s,p=this.elevation&&!n.isTerrainDEM,_=this.projection.name==="mercator";if(n.minzoom!==void 0&&s<n.minzoom)return[];n.maxzoom!==void 0&&s>n.maxzoom&&(s=n.maxzoom);const v=this.locationCoordinate(this.center),b=this.center.lat,E=1<<s,I=[E*v.x,E*v.y,0],C=this.projection.name==="globe",R=!C,V=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,R),q=C?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=E*o.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),X=[E*q.x,E*q.y,Z*(R?1:W)],B=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),G=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,J=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,$=n.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?mh(this):1,he=Me=>{const Qe=new o.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),Ge=new o.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),it=Me.toLngLat(),It=Qe.toLngLat(),Gt=Ge.toLngLat(),wt=this.locationCoordinate(it),Lt=this.locationCoordinate(It),li=this.locationCoordinate(Gt),si=Math.hypot(Lt.x-wt.x,Lt.y-wt.y),Ct=Math.hypot(li.x-wt.x,li.y-wt.y);return Math.sqrt(si*Ct)*le/25e-6},ue=Me=>{const Fe=J,Qe=$;return{aabb:o.tileAABB(this,E,0,0,0,Me,Qe,Fe,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:Fe,wrap:Me,fullyVisible:!1}},ge=[];let me=[];const Se=s,Je=n.reparseOverscaled?u:s,we=Me=>Me*Me,Ue=we((Z-this._centerAltitude)*W),ke=Me=>{if(!this._elevation||!Me.tileID||!_)return;const Fe=this._elevation.getMinMaxForTile(Me.tileID),Qe=Me.aabb;Fe?(Qe.min[2]=Fe.min,Qe.max[2]=Fe.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Me.shouldSplit=Ye(Me),Me.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Ye=Me=>{if(Me.zoom<G)return!0;if(Me.zoom===Se)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const Fe=Me.aabb.distanceX(X),Qe=Me.aabb.distanceY(X);let Ge=Ue,it=1;if(C){Ge=we(Me.aabb.distanceZ(X));const wt=Math.pow(2,Me.zoom),Lt=o.latFromMercatorY((Me.y+1)/wt),li=o.latFromMercatorY(Me.y/wt),si=Math.min(Math.max(b,Lt),li),Ct=o.circumferenceAtLatitude(si)/o.circumferenceAtLatitude(b);if(it=si===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ct/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===Se-1&&Ct>=.9)return!0}else if(p&&(Ge=we(Me.aabb.distanceZ(X)*W)),this.projection.isReprojectedInTileSpace&&u<=5){const wt=Math.pow(2,Me.zoom),Lt=he(new o.MercatorCoordinate((Me.x+.5)/wt,(Me.y+.5)/wt));it=Lt>.85?1:Lt}const It=Fe*Fe+Qe*Qe+Ge,Gt=we((1<<Se-Me.zoom)*B*it*((wt,Lt)=>{if(Lt*we(.707)<wt)return 1;const li=Math.sqrt(Lt/wt);return li/(1.4144271570014144+(Math.pow(1.1,li-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ge,Ue),It));return It<Gt};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)ge.push(ue(-Me)),ge.push(ue(Me));for(ge.push(ue(0));ge.length>0;){const Me=ge.pop(),Fe=Me.x,Qe=Me.y;let Ge=Me.fullyVisible;if(!Ge){const it=Me.aabb.intersects(V);if(it===0)continue;Ge=it===2}if(Me.zoom!==Se&&Ye(Me))for(let it=0;it<4;it++){const It=(Fe<<1)+it%2,Gt=(Qe<<1)+(it>>1),wt={aabb:_?Me.aabb.quadrant(it):o.tileAABB(this,E,Me.zoom+1,It,Gt,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:It,y:Gt,wrap:Me.wrap,fullyVisible:Ge,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};p&&!C&&(wt.tileID=new o.OverscaledTileID(Me.zoom+1===Se?Je:Me.zoom+1,Me.wrap,Me.zoom+1,It,Gt),ke(wt)),ge.push(wt)}else{const it=Me.zoom===Se?Je:Me.zoom;if(n.minzoom&&n.minzoom>it)continue;const It=I[0]-(.5+Fe+(Me.wrap<<Me.zoom))*(1<<s-Me.zoom),Gt=I[1]-.5-Qe,wt=Me.tileID?Me.tileID:new o.OverscaledTileID(it,Me.wrap,Me.zoom,Fe,Qe);me.push({tileID:wt,distanceSq:It*It+Gt*Gt})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,Fe=this.horizonLineFromTop();me=me.filter(Qe=>{const Ge=[0,0,0,1],it=[o.EXTENT,o.EXTENT,0,1],It=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());o.transformMat4$1(Ge,Ge,It),o.transformMat4$1(it,it,It);const Gt=o.getAABBPointSquareDist(Ge,it);if(Gt===0)return!0;let wt=!1;const Lt=this._elevation;if(Lt&&Gt>Me&&Fe!==0){const li=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let si;n.isTerrainDEM||(si=Lt.getMinMaxForTile(Qe.tileID)),si||(si={min:$,max:J});const Ct=o.furthestTileCorner(this.rotation),Ti=[Ct[0]*o.EXTENT,Ct[1]*o.EXTENT,si.max];o.transformMat4(Ti,Ti,li),wt=(1-Ti[1])*this.height*.5<Fe}return Gt<Me||wt})}return me.sort((Me,Fe)=>Me.distanceSq-Fe.distanceSq).map(Me=>Me.tileID)}resize(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=this.projection.project(n.lng,s);return new o.Point(u.x*this.worldSize,u.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,s){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;u=(s.x-_.x)/b,p=(s.y-_.y)/b}else{const b=this.pointCoordinate(s),E=this.pointCoordinate(_);u=b.x-E.x,p=b.y-E.y}const v=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(v.x-u,v.y-p))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,s){const u=s?o.mercatorZfromAltitude(s,n.lat):void 0,p=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(p.x,p.y,u)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,s){const u=s??this._centerAltitude,p=[n.x,n.y,0,1],_=[n.x,n.y,1,1];o.transformMat4$1(p,p,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse);const v=_[3];o.scale$1(p,p,1/p[3]),o.scale$1(_,_,1/v);const b=p[2],E=_[2];return{p0:p,p1:_,t:b===E?0:(u-b)/(E-b)}}screenPointToMercatorRay(n){const s=[n.x,n.y,0,1],u=[n.x,n.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(u,u,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(u,u,1/u[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,u[2]=o.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(u,u,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],u,s)))}rayIntersectionCoordinate(n){const{p0:s,p1:u,t:p}=n,_=o.mercatorZfromAltitude(s[2],this._center.lat),v=o.mercatorZfromAltitude(u[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],u[0],p)/this.worldSize,o.number(s[1],u[1],p)/this.worldSize,o.number(_,v,p))}pointCoordinate(n,s=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,s)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let s=this.projection.pointCoordinate3D(this,n.x,n.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let u=0,p=this.horizonLineFromTop();if(n.y>p)return this.pointCoordinate(n);const _=.02*p,v=n.clone();for(let b=0;b<10&&p-u>_;b++){v.y=o.number(u,p,.66);const E=this.projection.pointCoordinate3D(this,v.x,v.y);E?(p=v.y,s=E):u=v.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const s=this.pointCoordinate(n);return s.y>=0&&s.y<=1}_coordinatePoint(n,s){const u=s&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,p=[n.x*this.worldSize,n.y*this.worldSize,u+n.toAltitude(),1];return o.transformMat4$1(p,p,this.pixelMatrix),p[3]>0?new o.Point(p[0]/p[3],p[1]/p[3]):new o.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.Point(s,n)),v=this.pointLocation3D(new o.Point(p,n)),b=this.pointLocation3D(new o.Point(p,u)),E=this.pointLocation3D(new o.Point(s,u));let I=Math.min(_.lng,v.lng,b.lng,E.lng),C=Math.max(_.lng,v.lng,b.lng,E.lng),R=Math.min(_.lat,v.lat,b.lat,E.lat),V=Math.max(_.lat,v.lat,b.lat,E.lat);const q=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,Z=(X,B,G,J,$)=>{const le=(X+G)/2,he=(B+J)/2,ue=new o.Point(le,he),{lng:ge,lat:me}=this.pointLocation3D(ue),Se=Math.max(0,I-ge,R-me,ge-C,me-V);I=Math.min(I,ge),C=Math.max(C,ge),R=Math.min(R,me),V=Math.max(V,me),($<W||Se>q)&&(Z(X,B,le,he,$+1),Z(le,he,G,J,$+1))};if(Z(s,n,p,n,1),Z(p,n,p,u,1),Z(p,u,s,u,1),Z(s,u,s,n,1),this.projection.name==="globe"){const[X,B]=o.polesInViewport(this);X?(V=90,C=180,I=-180):B&&(R=-90,C=180,I=-180)}return new o.LngLatBounds(new o.LngLat(I,R),new o.LngLat(C,V))}_getBoundsRectangular(n,s){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=new o.Point(p,u),E=new o.Point(v,u),I=new o.Point(v,_),C=new o.Point(p,_);let R=this.pointCoordinate(b,n),V=this.pointCoordinate(E,n);const q=this.pointCoordinate(I,s),W=this.pointCoordinate(C,s),Z=(X,B)=>(B.y-X.y)/(B.x-X.x);return R.y>1&&V.y>=0?R=new o.MercatorCoordinate((1-W.y)/Z(W,R)+W.x,1):R.y<0&&V.y<=1&&(R=new o.MercatorCoordinate(-W.y/Z(W,R)+W.x,0)),V.y>1&&R.y>=0?V=new o.MercatorCoordinate((1-q.y)/Z(q,V)+q.x,1):V.y<0&&R.y<=1&&(V=new o.MercatorCoordinate(-q.y/Z(q,V)+q.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=n.visibleDemTiles.reduce((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*n.exaggeration(),s.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return n?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,s){return this.projection.createTileMatrix(this,s,n)}calculateDistanceTileData(n){const s=n.key,u=this._distanceTileDataCache;if(u[s])return u[s];const p=n.canonical,_=1/this.height,v=this.cameraWorldSize,b=v/this.zoomScale(p.z),E=(p.x+Math.pow(2,p.z)*n.wrap)*b,I=p.y*b,C=this.point;C.x*=v/this.worldSize,C.y*=v/this.worldSize;const R=this.angle,V=Math.sin(-R),q=-Math.cos(-R);return u[s]={bearing:[V,q],center:[(C.x-E)*_,(C.y-I)*_],scale:b/o.EXTENT*_},u[s]}calculateFogTileMatrix(n){const s=n.key,u=this._fogTileMatrixCache;if(u[s])return u[s];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.multiply(p,this.worldToFogMatrix,p),u[s]=new Float32Array(p),u[s]}calculateProjMatrix(n,s=!1){const u=n.key,p=s?this._alignedProjMatrixCache:this._projMatrixCache;if(p[u])return p[u];const _=this.calculatePosMatrix(n,this.worldSize);return o.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,_),p[u]=new Float32Array(_),p[u]}calculatePixelsToTileUnitsMatrix(n){const s=n.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];const p=function(_,v){const{scale:b}=_.tileTransform,E=b*o.EXTENT/(_.tileSize*Math.pow(2,v.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return I=new Float32Array(4),V=(C=v.inverseAdjustmentMatrix)[1],q=C[2],W=C[3],X=(R=[E,E])[1],I[0]=C[0]*(Z=R[0]),I[1]=V*Z,I[2]=q*X,I[3]=W*X,I;var I,C,R,V,q,W,Z,X}(n,this);return u[s]=p,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,s=o.fromScaling([],[n,n,n]);return o.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),p=this._camera.forward(),_=o.mercatorZfromAltitude(1,this._center.lat);u[2]/=_,p[2]/=_,o.normalize(p,p);const v=n.raycast(u,p,n.exaggeration());if(v){const b=o.scaleAndAdd([],u,p,v),E=new o.MercatorCoordinate(b[0],b[1],o.mercatorZfromAltitude(b[2],o.latFromMercatorY(b[1]))),I=(E.z+o.length([E.x-u[0],E.y-u[1],E.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const s=this._elevation,u=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=s.getAtPointOrZero(new o.MercatorCoordinate(...p)),v=this.pixelsPerMeter/this.worldSize*_,b=this._minimumHeightOverTerrain(),E=p[2]-v;if(E<=b)if(E<0||n){const I=this.locationCoordinate(this._center,this._centerAltitude),C=[p[0],p[1],I.z-p[2]],R=o.length(C);C[2]-=(b-E)/this._pixelsPerMercatorPixel;const V=o.length(C);if(V===0)return;o.scale$2(C,C,R/V*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],I.z*this._pixelsPerMercatorPixel-C[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const V=this.center;return V.lat=o.clamp(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(V.lng=o.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const s=this._unmodified,{x:u,y:p}=this.point;let _=0,v=u,b=p;const E=this.width/2,I=this.height/2,C=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(p-I<C&&(b=C+I),p+I>R&&(b=R-I),R-C<this.height&&(_=Math.max(_,this.height/(R-C)),b=(R+C)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,W=this.worldSize/2-(V+q)/2;v=(u+W+this.worldSize)%this.worldSize-W,v-E<V&&(v=V+E),v+E>q&&(v=q-E),q-V<this.width&&(_=Math.max(_,this.width/(q-V)),v=(q+V)/2)}v===u&&b===p||(this.center=this.unproject(new o.Point(v,b))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const u=xl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,u),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this.projection.zAxisUnit==="meters"?s:1,_=this._camera.getWorldToCamera(this.worldSize,p),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-n.x/this.width,v[9]=2*n.y/this.height;let b=o.mul([],v,_);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),ue=o.identity([]);o.translate(ue,ue,[he.x*this.worldSize,he.y*this.worldSize,0]),o.multiply(ue,ue,Cs(this)),o.translate(ue,ue,[-he.x*this.worldSize,-he.y*this.worldSize,0]),o.multiply(b,b,ue),this.inverseAdjustmentMatrix=function(ge){const me=Cs(ge,!0);return Be([],[me[0],me[1],me[4],me[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],b,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=b,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=o.invert([],v);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);o.identity(I),o.scale(I,I,[1,-1,1]),o.rotateX(I,I,this._pitch),o.rotateZ(I,I,this.angle);const C=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;C[8]=2*-n.x/this.width,C[9]=2*(n.y+R)/this.height,this.skyboxMatrix=o.multiply(I,C,I);const V=this.point,q=V.x,W=V.y,Z=this.width%2/2,X=this.height%2/2,B=Math.cos(this.angle),G=Math.sin(this.angle),J=q-Math.round(q)+B*Z+G*X,$=W-Math.round(W)+B*X+G*Z,le=new Float64Array(b);if(o.translate(le,le,[J>.5?J-1:J,$>.5?$-1:$,0]),this.alignedProjMatrix=le,b=o.create(),o.scale(b,b,[this.width/2,-this.height/2,1]),o.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=o.create(),o.scale(b,b,[1,-1,1]),o.translate(b,b,[-1,-1,0]),o.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=o.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(he,he,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[n,n,s];o.scale$2(_,_,p),o.scale$2(u,u,-1),o.multiply$2(u,u,_);const v=o.create();o.translate(v,v,u),o.scale(v,v,_),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,s,p)}_computeCameraPosition(n){const s=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-n/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,n/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=n[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((s-u)/p,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),b=Math.max((n[2]-_)/Math.cos(u),v),E=this._zoomFromMercatorZ(b);o.scaleAndAdd(n,n,s,b),this._pitch=o.clamp(u,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(p,-Math.PI,Math.PI),this._setZoom(o.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let s=0,u=o.GLOBE_ZOOM_THRESHOLD_MAX,p=0,_=1/0;for(;u-s>1e-6&&u>s;){const v=s+.5*(u-s),b=this.tileSize*Math.pow(2,v),E=this.getCameraToCenterDistance(this.projection,v,b),I=this.scaleZoom(E/(n*this.tileSize)),C=Math.abs(v-I);C<_&&(_=C,p=v),v<I?s=v:u=v}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,s){const u=Math.min(n.x,s.x),p=Math.max(n.x,s.x),_=Math.min(n.y,s.y),v=Math.max(n.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.Point(u,_),new o.Point(p,v),new o.Point(u,v),new o.Point(p,_)],E=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const C of b){const R=this.pointRayIntersection(C);if(R.t<0)return!0;const V=this.rayIntersectionCoordinate(R);if(V.x<E||V.y<0||V.x>I||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.Point(0,0),new o.Point(this.width,this.height))}zoomDeltaToMovement(n,s){const u=o.length(o.sub([],this._camera.position,n)),p=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([s,u,p],_){const v=[s,u,p,1];o.transformMat4$1(v,v,_);const b=v[3]=Math.max(v[3],1e-6);return v[0]/=b,v[1]/=b,v[2]/=b,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,n))}}getCameraToCenterDistance(n,s=this.zoom,u=this.worldSize){const p=xl(n,s,this.width,this.height,1024),_=n.pixelSpaceConversion(this.center.lat,u,p);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(n,n,this.globeMatrix),n}}function ks(l,n){let s=!1,u=null;const p=()=>{u=null,s&&(l(),u=setTimeout(p,n),s=!1)};return()=>(s=!0,u||p(),u)}class Oc{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ks(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const s=xa(n);if(this._hashName){const u=this._hashName;let p=!1;const _=o.window.location.hash.slice(1).split("&").map(v=>{const b=v.split("=")[0];return b===u?(p=!0,`${b}=${s}`):v}).filter(v=>v);return p||_.push(`${u}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let s;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(s[3]||0):n.getBearing();return n.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}function xa(l,n){const s=l.getCenter(),u=Math.round(100*l.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),v=Math.round(s.lng*_)/_,b=Math.round(s.lat*_)/_,E=l.getBearing(),I=l.getPitch();let C=n?`/${v}/${b}/${u}`:`${u}/${b}/${v}`;return(E||I)&&(C+="/"+Math.round(10*E)/10),I&&(C+=`/${Math.round(I)}`),C}const va={linearity:.3,easing:o.bezier(0,0,.3,1)},bl=o.extend({deceleration:2500,maxSpeed:1400},va),wl=o.extend({deceleration:20,maxSpeed:1400},va),yt=o.extend({deceleration:1e3,maxSpeed:360},va),Br=o.extend({deceleration:1e3,maxSpeed:90},va);class gh{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=o.exported.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const _=wa(s.pan.mag(),u,o.extend({},bl,n||{}));p.offset=s.pan.mult(_.amount/s.pan.mag()),p.center=this._map.transform.center,ba(p,_)}if(s.zoom){const _=wa(s.zoom,u,wl);p.zoom=this._map.transform.zoom+_.amount,ba(p,_)}if(s.bearing){const _=wa(s.bearing,u,yt);p.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),ba(p,_)}if(s.pitch){const _=wa(s.pitch,u,Br);p.pitch=this._map.transform.pitch+_.amount,ba(p,_)}if(p.zoom||p.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function ba(l,n){(!l.duration||l.duration<n.duration)&&(l.duration=n.duration,l.easing=n.easing)}function wa(l,n,s){const{maxSpeed:u,linearity:p,deceleration:_}=s,v=o.clamp(l*p/(n/1e3),-u,u),b=Math.abs(v)/(_*p);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class In extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u,p={}){const _=ve(s.getCanvasContainer(),u),v=s.unproject(_);super(n,o.extend({point:_,lngLat:v,originalEvent:u},p)),this._defaultPrevented=!1,this.target=s}}class Ta extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){const p=n==="touchend"?u.changedTouches:u.touches,_=Oe(s.getCanvasContainer(),p),v=_.map(E=>s.unproject(E)),b=_.reduce((E,I,C,R)=>E.add(I.div(R.length)),new o.Point(0,0));super(n,{points:_,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Tl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){super(n,{originalEvent:u}),this._defaultPrevented=!1}}class Fc{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Tl(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new In(n.type,this._map,n))}mouseup(n){this._map.fire(new In(n.type,this._map,n))}preclick(n){const s=o.extend({},n);s.type="preclick",this._map.fire(new In(s.type,this._map,s))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(n),this._map.fire(new In(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new In(n.type,this._map,n))}mouseover(n){this._map.fire(new In(n.type,this._map,n))}mouseout(n){this._map.fire(new In(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ta(n.type,this._map,n))}touchmove(n){this._map.fire(new Ta(n.type,this._map,n))}touchend(n){this._map.fire(new Ta(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ta(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class El{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new In(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new In("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new In(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yh{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(ut(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const u=s,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=ce("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const v=Math.min(p.x,u.x),b=Math.max(p.x,u.x),E=Math.min(p.y,u.y),I=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${E}px)`,this._box.style.width=b-v+"px",this._box.style.height=I-E+"px")})}mouseupWindow(n,s){if(!this._active)return;const u=this._startPos,p=s;if(u&&n.button===0){if(this.reset(),ct(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new o.Event(n,{originalEvent:s}))}}function Ml(l,n){const s={};for(let u=0;u<l.length;u++)s[l[u].identifier]=n[u];return s}class zs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const _=new o.Point(0,0);for(const v of p)_._add(v);return _.div(p.length)}(s),this.touches=Ml(u,s)))}touchmove(n,s,u){if(this.aborted||!this.centroid)return;const p=Ml(u,s);for(const _ in this.touches){const v=p[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(n,s,u){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Uc{constructor(n){this.singleTap=new zs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,s,u){this.singleTap.touchstart(n,s,u)}touchmove(n,s,u){this.singleTap.touchmove(n,s,u)}touchend(n,s,u){const p=this.singleTap.touchend(n,s,u);if(p){const _=n.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(_&&v||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class rf{constructor(){this._zoomIn=new Uc({numTouches:1,numTaps:2}),this._zoomOut=new Uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,u){this._zoomIn.touchstart(n,s,u),this._zoomOut.touchstart(n,s,u)}touchmove(n,s,u){this._zoomIn.touchmove(n,s,u),this._zoomOut.touchmove(n,s,u)}touchend(n,s,u){const p=this._zoomIn.touchend(n,s,u),_=this._zoomOut.touchend(n,s,u);return p?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xh={0:1,2:2};class Ps{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,s){return!1}_move(n,s){return{}}mousedown(n,s){if(this._lastPoint)return;const u=Ze(n);this._correctButton(n,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(n,s){const u=this._lastPoint;if(u){if(n.preventDefault(),this._eventButton!=null&&function(p,_){const v=xh[_];return p.buttons===void 0||(p.buttons&v)!==v}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(n){this._lastPoint&&Ze(n)===this._eventButton&&(this._moved&&ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nc extends Ps{mousedown(n,s){super.mousedown(n,s),this._lastPoint&&(this._active=!0)}_correctButton(n,s){return s===0&&!n.ctrlKey}_move(n,s){return{around:s,panDelta:s.sub(n)}}}class Vc extends Ps{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const u=.8*(s.x-n.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(n){n.preventDefault()}}class jc extends Ps{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const u=-.5*(s.y-n.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(n){n.preventDefault()}}class Sl{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)}touchstart(n,s,u){return this._calculateTransform(n,s,u)}touchmove(n,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,s,u)}}touchend(n,s,u){this._calculateTransform(n,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,u){u.length>0&&(this._active=!0);const p=Ml(u,s),_=new o.Point(0,0),v=new o.Point(0,0);let b=0;for(const I in p){const C=p[I],R=this._touches[I];R&&(_._add(C),v._add(C.sub(R)),b++,p[I]=C)}if(this._touches=p,b<this._minTouches||!v.mag())return;const E=v.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ce("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ea{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,s,u){return{}}touchstart(n,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,u){const p=this._firstTwoTouches;if(!p)return;n.preventDefault();const[_,v]=p,b=Ma(u,s,_),E=Ma(u,s,v);if(!b||!E)return;const I=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],I,n)}touchend(n,s,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,v=Ma(u,s,p),b=Ma(u,s,_);v&&b||(this._active&&ct(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ma(l,n,s){for(let u=0;u<l.length;u++)if(l[u].identifier===s)return n[u]}function Gc(l,n){return Math.log(l/n)/Math.LN2}class vh extends Ea{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const u=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Gc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gc(this._distance,u),pinchAround:s}}}function qc(l,n){return 180*l.angleWith(n)/Math.PI}class bh extends Ea{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s){const u=this._vector;if(this._vector=n[0].sub(n[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:qc(this._vector,u),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=qc(n,u);return Math.abs(p)<s}}function So(l){return Math.abs(l.y)>Math.abs(l.x)}class wh extends Ea{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,So(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,u){const p=this._lastPoints;if(!p)return;const _=n[0].sub(p[0]),v=n[1].sub(p[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,v,u.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5})}gestureBeginsVertically(n,s,u){if(this._valid!==void 0)return this._valid;const p=n.mag()>=2,_=s.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=n.y>0==s.y>0;return So(n)&&So(s)&&v}}const Th={panStep:100,bearingStep:15,pitchStep:10};class of{constructor(){const n=Th;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,u=0,p=0,_=0,v=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?u=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?u=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?p=1:(n.preventDefault(),v=-1);break;case 40:n.shiftKey?p=-1:(n.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:b=>{const E=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:Eh,zoom:s?Math.round(E)+s*(n.shiftKey?2:1):E,bearing:b.getBearing()+u*this._bearingStep,pitch:b.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:b.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Eh(l){return l*(2-l)}const Zc=4.000244140625;class Mh{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const u=o.exported.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Zc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ve(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Zc?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&I!==0&&(I=1/I);const C=s(),R=Math.pow(2,C),V=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(V*I))),this._type==="wheel"&&(this._startZoom=C,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s(),p=this._startZoom,_=this._easing;let v,b=!1;if(this._type==="wheel"&&p&&_){const E=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),I=_(E);v=o.number(p,u,I),E<1?this._frameId||(this._frameId=!0):b=!0}else v=u,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:v-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=o.ease;if(this._prevEase){const u=this._prevEase,p=(o.exported.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=o.bezier(v,b,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ce("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Sh{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,s){return n.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(n.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sf{constructor(){this._tap=new Uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,s,u){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(n,s,u))}touchmove(n,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=s[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,s,u)}touchend(n,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(n,s,u)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ah{constructor(n,s,u){this._el=n,this._mousePan=s,this._touchPan=u}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class af{constructor(n,s,u){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lf{constructor(n,s,u,p){this._el=n,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vr=l=>l.zoom||l.drag||l.pitch||l.rotate;class Ch extends o.Event{}class cf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,s){const u=o.sub([],s,n);this.radius=o.length(u[2]<0?o.div([],u,this.constants):[u[0],u[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const s=o.scale$2([],n,this.radius);if(s[2]>0){const u=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),p=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),_=o.add([],s,o.scale$2([],o.sub([],o.add([],p,u),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Or(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Hr{constructor(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gh(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[p,_,v]of this._listeners)p.addEventListener(_,p===o.window.document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[n,s,u]of this._listeners)n.removeEventListener(s,n===o.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(n){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Fc(s,n));const p=s.boxZoom=new yh(s,n);this._add("boxZoom",p);const _=new rf,v=new Vn;s.doubleClickZoom=new Sh(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const b=new sf;this._add("tapDragZoom",b);const E=s.touchPitch=new wh(s);this._add("touchPitch",E);const I=new Vc(n),C=new jc(n);s.dragRotate=new af(n,I,C),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]);const R=new Nc(n),V=new Sl(s,n);s.dragPan=new Ah(u,R,V),this._add("mousePan",R),this._add("touchPan",V,["touchZoom","touchRotate"]);const q=new bh,W=new vh;s.touchZoomRotate=new lf(u,W,q,b),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new El(s));const Z=s.scrollZoom=new Mh(s,this);this._add("scrollZoom",Z,["mousePan"]);const X=s.keyboard=new of;this._add("keyboard",X);for(const B of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[B]&&s[B].enable(n[B])}_add(n,s,u){this._handlers.push({handlerName:n,handler:s,allowed:u}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,s,u){for(const p in n)if(p!==u&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const s=[];for(const u of n)this._el.contains(u.target)&&s.push(u);return s}handleEvent(n,s){this._updatingCamera=!0;const u=n.type==="renderFrame",p=u?void 0:n,_={needsRenderFrame:!1},v={},b={},E=n.touches?this._getMapTouches(n.touches):void 0,I=E?Oe(this._el,E):u?void 0:ve(this._el,n);for(const{handlerName:V,handler:q,allowed:W}of this._handlers){if(!q.isEnabled())continue;let Z;this._blockedByActive(b,W,V)?q.reset():q[s||n.type]&&(Z=q[s||n.type](n,I,E),this.mergeHandlerResult(_,v,Z,V,p),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||q.isActive())&&(b[V]=q)}const C={};for(const V in this._previousActiveHandlers)b[V]||(C[V]=p);this._previousActiveHandlers=b,(Object.keys(C).length||Or(_))&&(this._changes.push([_,v,C]),this._triggerRenderFrame()),(Object.keys(b).length||Or(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=_;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,s,u,p,_){if(!u)return;o.extend(n,u);const v={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(s.zoom=v),u.panDelta!==void 0&&(s.drag=v),u.pitchDelta!==void 0&&(s.pitch=v),u.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const n={},s={},u={};for(const[p,_,v]of this._changes)p.panDelta&&(n.panDelta=(n.panDelta||new o.Point(0,0))._add(p.panDelta)),p.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(n.around=p.around),p.aroundCoord!==void 0&&(n.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(n.pinchAround=p.pinchAround),p.noInertia&&(n.noInertia=p.noInertia),o.extend(s,_),o.extend(u,v);this._updateMapTransform(n,s,u),this._changes=[]}_updateMapTransform(n,s,u){const p=this._map,_=p.transform,v=G=>[G.x,G.y,G.z];if((G=>{const J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!Or(n)){const G=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",G!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!Or(n))return void this._fireEvents(s,u,!0);let{panDelta:b,zoomDelta:E,bearingDelta:I,pitchDelta:C,around:R,aroundCoord:V,pinchAround:q}=n;_._isCameraConstrained&&(E>0&&(E=0),_._isCameraConstrained=!1),q!==void 0&&(R=q),(E||(G=>s[G]&&!this._eventsInProgress[G])("drag"))&&R&&(this._dragOrigin=v(_.pointCoordinate3D(R)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),R=R||p.transform.centerPoint,I&&(_.bearing+=I),C&&(_.pitch+=C),_._updateCameraState();const W=[0,0,0];if(b)if(_.projection.name==="mercator"){const G=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(R).dir),J=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(R.sub(b)).dir);W[0]=J[0]-G[0],W[1]=J[1]-G[1]}else{const G=_.pointCoordinate(R);if(_.projection.name==="globe"){b=b.rotate(-_.angle);const J=_._pixelsPerMercatorPixel/_.worldSize;W[0]=-b.x*o.mercatorScale(o.latFromMercatorY(G.y))*J,W[1]=-b.y*o.mercatorScale(_.center.lat)*J}else{const J=_.pointCoordinate(R.sub(b));G&&J&&(W[0]=J.x-G.x,W[1]=J.y-G.y)}}const Z=_.zoom,X=[0,0,0];if(E){const G=v(V||_.pointCoordinate3D(R)),J={dir:o.normalize([],o.sub([],G,_._camera.position))};if(J.dir[2]<0){const $=_.zoomDeltaToMovement(G,E);o.scale$2(X,J.dir,$)}}const B=o.add(W,W,X);_._translateCameraConstrained(B),E&&Math.abs(_.zoom-Z)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,u,!0)}_fireEvents(n,s,u){const p=vr(this._eventsInProgress),_=vr(n),v={};for(const C in n){const{originalEvent:R}=n[C];this._eventsInProgress[C]||(v[`${C}start`]=R),this._eventsInProgress[C]=n[C]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const C in v)this._fireEvent(C,v[C]);_&&this._fireEvent("move",_.originalEvent);for(const C in n){const{originalEvent:R}=n[C];this._fireEvent(C,R)}const b={};let E;for(const C in this._eventsInProgress){const{handlerName:R,originalEvent:V}=this._eventsInProgress[C];this._handlersById[R].isActive()||(delete this._eventsInProgress[C],E=s[R]||V,b[`${C}end`]=E)}for(const C in b)this._fireEvent(C,b[C]);const I=vr(this._eventsInProgress);if(u&&(p||_)&&!I){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;C?(R(C.bearing||this._map.getBearing())&&(C.bearing=0),this._map.easeTo(C,{originalEvent:E})):(this._map.fire(new o.Event("moveend",{originalEvent:E})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new o.Event(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Ch("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Al extends o.Evented{constructor(n,s){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}panBy(n,s,u){return n=o.Point.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},s),u)}panTo(n,s,u){return this.easeTo(o.extend({center:n},s),u)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,u){return this.easeTo(o.extend({zoom:n},s),u)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,u){return this.easeTo(o.extend({bearing:n},s),u)}resetNorth(n,s){return this.rotateTo(0,o.extend({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}cameraForBounds(n,s){n=o.LngLatBounds.convert(n);const u=s&&s.bearing||0,p=s&&s.pitch||0,_=n.getNorthWest(),v=n.getSouthEast();return this._cameraForBounds(this.transform,_,v,u,p,s)}_extendCameraOptions(n){const s={top:0,bottom:0,right:0,left:0};if(typeof(n=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const u=n.padding;n.padding={top:u,bottom:u,right:u,left:u}}return n.padding=o.extend(s,n.padding),n}_minimumAABBFrustumDistance(n,s){const u=s.max[0]-s.min[0],p=s.max[1]-s.min[1];return u/p>n.aspect?u/(2*Math.tan(.5*n.fovX)*n.aspect):p/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,s,u,p,_,v){const b=n.clone(),E=this._extendCameraOptions(v);b.bearing=p,b.pitch=_;const I=o.LngLat.convert(s),C=o.LngLat.convert(u),R=.5*(I.lat+C.lat),V=.5*(I.lng+C.lng),q=o.latLngToECEF(R,V),W=o.normalize([],q),Z=o.normalize([],o.cross([],W,[0,1,0])),X=o.cross([],Z,W),B=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,W[0],W[1],W[2],0,0,0,0,1],G=[q,o.latLngToECEF(I.lat,I.lng),o.latLngToECEF(C.lat,I.lng),o.latLngToECEF(C.lat,C.lng),o.latLngToECEF(I.lat,C.lng),o.latLngToECEF(R,I.lng),o.latLngToECEF(R,C.lng),o.latLngToECEF(I.lat,V),o.latLngToECEF(C.lat,V)];let J=o.Aabb.fromPoints(G.map(Ge=>[o.dot(Z,Ge),o.dot(X,Ge),o.dot(W,Ge)]));const $=o.transformMat4([],J.center,B);o.squaredLength($)===0&&o.set($,0,0,1),o.normalize($,$),o.scale$2($,$,o.GLOBE_RADIUS),b.center=o.ecefToLatLng($);const le=b.getWorldToCameraMatrix(),he=o.invert(new Float64Array(16),le);J=o.Aabb.applyTransform(J,o.multiply([],le,B)),o.transformMat4($,$,le);const ue=.5*(J.max[2]-J.min[2]),ge=this._minimumAABBFrustumDistance(b,J),me=o.scale$2([],[0,0,1],ue),Se=o.add(me,$,me),Je=ge+(b.pitch===0?0:o.distance($,Se)),we=b.globeCenterInViewSpace,Ue=o.sub([],$,[we[0],we[1],we[2]]);o.normalize(Ue,Ue),o.scale$2(Ue,Ue,Je);const ke=o.add([],$,Ue);o.transformMat4(ke,ke,he);const Ye=o.earthRadius/o.GLOBE_RADIUS,Me=o.length(ke),Fe=o.mercatorZfromAltitude(Math.max(Me*Ye-o.earthRadius,Number.EPSILON),0),Qe=Math.min(b.zoomFromMercatorZAdjusted(Fe),E.maxZoom);return Qe>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(b.setProjection({name:"mercator"}),b.zoom=Qe,this._cameraForBounds(b,s,u,p,_,v)):{center:b.center,zoom:Qe,bearing:p,pitch:_}}queryTerrainElevation(n,s){const u=this.transform.elevation;return u?(s=o.extend({},{exaggerated:!0},s),u.getAtPoint(o.MercatorCoordinate.fromLngLat(n),null,s.exaggerated)):null}_cameraForBounds(n,s,u,p,_,v){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,s,u,p,_,v);const b=n.clone(),E=this._extendCameraOptions(v),I=b.padding;b.bearing=p,b.pitch=_;const C=o.LngLat.convert(s),R=o.LngLat.convert(u),V=new o.LngLat(C.lng,R.lat),q=new o.LngLat(R.lng,C.lat),W=b.project(C),Z=b.project(R),X=this.queryTerrainElevation(C),B=this.queryTerrainElevation(R),G=this.queryTerrainElevation(V),J=this.queryTerrainElevation(q),$=[[W.x,W.y,Math.min(X||0,B||0,G||0,J||0)],[Z.x,Z.y,Math.max(X||0,B||0,G||0,J||0)]];let le=o.Aabb.fromPoints($);const he=b.getWorldToCameraMatrix(),ue=o.invert(new Float64Array(16),he);le=o.Aabb.applyTransform(le,he);const ge=o.sub([],le.max,le.min),me=I.left||0,Se=I.right||0,Je=I.bottom||0,we=I.top||0,{left:Ue,right:ke,top:Ye,bottom:Me}=E.padding,Fe=.5*(me+Se),Qe=.5*(we+Je),Ge=Math.min(b.scaleZoom(b.scale*Math.min((b.width-(me+Se+Ue+ke))/ge[0],(b.height-(Je+we+Me+Ye))/ge[1])),E.maxZoom),it=b.scale/b.zoomScale(Ge);le=new o.Aabb([le.min[0]-(Ue+Fe)*it,le.min[1]-(Me+Qe)*it,le.min[2]],[le.max[0]+(ke+Fe)*it,le.max[1]+(Ye+Qe)*it,le.max[2]]);const It=.5*ge[2],Gt=this._minimumAABBFrustumDistance(b,le),wt=[0,0,1,0];o.transformMat4$1(wt,wt,he),o.normalize$2(wt,wt);const Lt=o.scale$2([],wt,Gt+It),li=o.add([],le.center,Lt),si=(typeof E.offset.x=="number"&&typeof E.offset.y=="number"?new o.Point(E.offset.x,E.offset.y):o.Point.convert(E.offset)).rotate(-o.degToRad(p));le.center[0]-=si.x*it,le.center[1]+=si.y*it,o.transformMat4(le.center,le.center,ue),o.transformMat4(li,li,ue);const Ct=[le.center[0],le.center[1],li[2]*b.pixelsPerMeter];o.scale$2(Ct,Ct,1/b.worldSize);const Ti=o.lngFromMercatorX(Ct[0]),Ii=o.latFromMercatorY(Ct[1]),ki=Math.min(b._zoomFromMercatorZ(Ct[2]),E.maxZoom),zi=new o.LngLat(Ti,Ii);return b.mercatorFromTransition&&ki<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(b.setProjection({name:"globe"}),b.zoom=ki,this._cameraForBounds(b,s,u,p,_,v)):{center:zi,zoom:ki,bearing:p,pitch:_}}fitBounds(n,s,u){const p=this.cameraForBounds(n,s);return this._fitInternal(p,s,u)}fitScreenCoordinates(n,s,u,p,_){const v=o.Point.convert(n),b=o.Point.convert(s),E=new o.Point(Math.min(v.x,b.x),Math.min(v.y,b.y)),I=new o.Point(Math.max(v.x,b.x),Math.max(v.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,b))return this;const C=this.transform.pointLocation3D(E),R=this.transform.pointLocation3D(I),V=this.transform.pointLocation3D(new o.Point(E.x,I.y)),q=this.transform.pointLocation3D(new o.Point(I.x,E.y)),W=[Math.min(C.lng,R.lng,V.lng,q.lng),Math.min(C.lat,R.lat,V.lat,q.lat)],Z=[Math.max(C.lng,R.lng,V.lng,q.lng),Math.max(C.lat,R.lat,V.lat,q.lat)],X=p&&p.pitch?p.pitch:this.getPitch(),B=this._cameraForBounds(this.transform,W,Z,u,X,p);return this._fitInternal(B,p,_)}_fitInternal(n,s,u){return n?(delete(s=o.extend(n,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(n,s){this.stop();const u=n.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,v=!1;return"zoom"in n&&u.zoom!==+n.zoom&&(p=!0,u.zoom=+n.zoom),n.center!==void 0&&(u.center=o.LngLat.convert(n.center)),"bearing"in n&&u.bearing!==+n.bearing&&(_=!0,u.bearing=+n.bearing),"pitch"in n&&u.pitch!==+n.pitch&&(v=!0,u.pitch=+n.pitch),n.padding==null||u.isPaddingEqual(n.padding)||(u.padding=n.padding),n.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),p&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),_&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),v&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Qo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,s){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.warnOnce(Qo),this;this.stop();const p=u.zoom,_=u.pitch,v=u.bearing;u.setFreeCameraOptions(n);const b=p!==u.zoom,E=_!==u.pitch,I=v!==u.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),b&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),I&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),E&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(n,s){this._stop(!1,n.easeId),((n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in n?+n.zoom:p,I="bearing"in n?this._normalizeBearing(n.bearing,_):_,C="pitch"in n?+n.pitch:v,R="padding"in n?n.padding:u.padding,V=o.Point.convert(n.offset);let q,W,Z;if(u.projection.name==="globe"){const me=o.MercatorCoordinate.fromLngLat(u.center),Se=V.rotate(-u.angle);me.x+=Se.x/u.worldSize,me.y+=Se.y/u.worldSize;const Je=me.toLngLat(),we=o.LngLat.convert(n.center||Je);this._normalizeCenter(we),q=u.centerPoint.add(Se),W=new o.Point(me.x,me.y).mult(u.worldSize),Z=new o.Point(o.mercatorXfromLng(we.lng),o.mercatorYfromLat(we.lat)).mult(u.worldSize).sub(W)}else{q=u.centerPoint.add(V);const me=u.pointLocation(q),Se=o.LngLat.convert(n.center||me);this._normalizeCenter(Se),W=u.project(me),Z=u.project(Se).sub(W)}const X=u.zoomScale(E-p);let B,G;n.around&&(B=o.LngLat.convert(n.around),G=u.locationPoint(B));const J=this._zooming||E!==p,$=this._rotating||_!==I,le=this._pitching||C!==v,he=!u.isPaddingEqual(R),ue=me=>Se=>{if(J&&(me.zoom=o.number(p,E,Se)),$&&(me.bearing=o.number(_,I,Se)),le&&(me.pitch=o.number(v,C,Se)),he&&(me.interpolatePadding(b,R,Se),q=me.centerPoint.add(V)),B)me.setLocationAtPoint(B,G);else{const Je=me.zoomScale(me.zoom-p),we=E>p?Math.min(2,X):Math.max(.5,X),Ue=Math.pow(we,1-Se),ke=me.unproject(W.add(Z.mult(Se*Ue)).mult(Je));me.setLocationAtPoint(me.renderWorldCopies?ke.wrap():ke,q)}return n.preloadOnly||this._fireMoveEvents(s),me};if(n.preloadOnly){const me=this._emulate(ue,n.duration,u);return this._preloadTiles(me),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=J,this._rotating=$,this._pitching=le,this._padding=he,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,ge),this._ease(ue(u),me=>{u.recenterOnTerrain(),this._afterEase(s,me)},n),this}_prepareEase(n,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||u.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!u.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!u.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!u.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.Event("zoomend",n)),p&&this.fire(new o.Event("rotateend",n)),_&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,s){if(this._prefersReducedMotion(n)){const Ge=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,s)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const u=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in n?o.clamp(+n.zoom,u.minZoom,u.maxZoom):p,I="bearing"in n?this._normalizeBearing(n.bearing,_):_,C="pitch"in n?+n.pitch:v,R="padding"in n?n.padding:u.padding,V=u.zoomScale(E-p),q=o.Point.convert(n.offset);let W=u.centerPoint.add(q);const Z=u.pointLocation(W),X=o.LngLat.convert(n.center||Z);this._normalizeCenter(X);const B=u.project(Z),G=u.project(X).sub(B);let J=n.curve;const $=Math.max(u.width,u.height),le=$/V,he=G.mag();if("minZoom"in n){const Ge=o.clamp(Math.min(n.minZoom,p,E),u.minZoom,u.maxZoom),it=$/u.zoomScale(Ge-p);J=Math.sqrt(it/he*2)}const ue=J*J;function ge(Ge){const it=(le*le-$*$+(Ge?-1:1)*ue*ue*he*he)/(2*(Ge?le:$)*ue*he);return Math.log(Math.sqrt(it*it+1)-it)}function me(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Se(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Je=ge(0);let we=function(Ge){return Se(Je)/Se(Je+J*Ge)},Ue=function(Ge){return $*((Se(Je)*(me(it=Je+J*Ge)/Se(it))-me(Je))/ue)/he;var it},ke=(ge(1)-Je)/J;if(Math.abs(he)<1e-6||!isFinite(ke)){if(Math.abs($-le)<1e-6)return this.easeTo(n,s);const Ge=le<$?-1:1;ke=Math.abs(Math.log(le/$))/J,Ue=function(){return 0},we=function(it){return Math.exp(Ge*J*it)}}n.duration="duration"in n?+n.duration:1e3*ke/("screenSpeed"in n?+n.screenSpeed/J:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ye=_!==I,Me=C!==v,Fe=!u.isPaddingEqual(R),Qe=Ge=>it=>{const It=it*ke,Gt=1/we(It);Ge.zoom=it===1?E:p+Ge.scaleZoom(Gt),Ye&&(Ge.bearing=o.number(_,I,it)),Me&&(Ge.pitch=o.number(v,C,it)),Fe&&(Ge.interpolatePadding(b,R,it),W=Ge.centerPoint.add(q));const wt=it===1?X:Ge.unproject(B.add(G.mult(Ue(It))).mult(Gt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?wt.wrap():wt,W),Ge._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(s),Ge};if(n.preloadOnly){const Ge=this._emulate(Qe,n.duration,u);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=Ye,this._pitching=Me,this._padding=Fe,this._prepareEase(s,!1),this._ease(Qe(u),()=>this._afterEase(s),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!n){const u=this.handlers;u&&u.stop(!1)}return this}_ease(n,s,u){u.animate===!1||u.duration===0?(n(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=u,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,s){n=o.wrap(n,-180,180);const u=Math.abs(n-s);return Math.abs(n-360-s)<u&&(n-=360),Math.abs(n+360-s)<u&&(n+=360),n}_normalizeCenter(n){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const u=n.lng-s.center.lng;n.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,s,u){const p=Math.ceil(15*s/1e3),_=[],v=n(u.clone());for(let b=0;b<=p;b++){const E=v(b/p);_.push(E.clone())}return _}}class bt{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const s=this.options&&this.options.compact;return this._map=n,this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ce("button","mapboxgl-ctrl-attrib-button",this._container),ce("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ce("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,s){const u=this._map._getUIString(`AttributionControl.${s}`);n.setAttribute("aria-label",u),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const u=s.reduce((p,_,v)=>(_.value&&(p+=`${_.key}=${_.value}${v<s.length-1?"&":""}`),p),"?");n.href=`${o.config.FEEDBACK_URL}/${u}#${xa(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style._sourceCaches;for(const p in s){const _=s[p];if(_.used){const v=_.getSource();v.attribution&&n.indexOf(v.attribution)<0&&n.push(v.attribution)}}n.sort((p,_)=>p.length-_.length),n=n.filter((p,_)=>{for(let v=_+1;v<n.length;v++)if(n[v].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const u=n.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,n.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wc{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ce("div","mapboxgl-ctrl");const s=ce("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const s in n){const u=n[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Xc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const p of u)if(p.id===n)return void(p.cancelled=!0)}run(n=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ds(l,n,s){if(l=new o.LngLat(l.lng,l.lat),n){const u=new o.LngLat(l.lng-360,l.lat),p=new o.LngLat(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),v=s.locationPoint(l).distSqr(n),b=n.x<0||n.y<0||n.x>s.width||n.y>s.height;s.locationPoint(u).distSqr(n)<v&&(b||Math.abs(u.lng-s.center.lng)<_)?l=u:s.locationPoint(p).distSqr(n)<v&&(b||Math.abs(p.lng-s.center.lng)<_)&&(l=p)}for(;Math.abs(l.lng-s.center.lng)>180;){const u=s.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}const es={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class _t extends o.Evented{constructor(n,s){if(super(),(n instanceof o.window.HTMLElement||s)&&(n=o.extend({element:n},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ce("div");const p=41,_=27,v=de("svg",{display:"block",height:p*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${p}`},this._element),b=de("radialGradient",{id:"shadowGradient"},de("defs",{},v));de("stop",{offset:"10%","stop-opacity":.4},b),de("stop",{offset:"100%","stop-opacity":.05},b),de("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},v),de("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},v),de("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},v),de("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},v),this._offset=o.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});const u=this._element.classList;for(const p in es)u.remove(`mapboxgl-marker-anchor-${p}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const s=n.code,u=n.charCode||n.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(n){const s=n.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,s=this._pos;if(!n||!s)return!1;const u=n.unproject(s),p=n.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const s=this._pos;if(!s||s.x<0||s.x>n.transform.width||s.y<0||s.y>n.transform.height)return void this._clearFadeTimer();const u=n.unproject(s);let p;n._showingGlobe()&&o.isLngLatBehindGlobe(n.transform,this._lngLat)?p=0:(p=1-n._queryFogOpacity(u),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${es[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const n=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!n||u!=="map")return"";if(!s._showingGlobe()){const E=s.getPitch();return E?`rotateX(${E}deg)`:""}const p=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),_=n.sub(o.globeCenterToScreenPoint(s.transform)),v=Math.abs(_.x)+Math.abs(_.y);if(v===0)return"";const b=p/v;return`rotateX(${-_.y*b}deg) rotateY(${_.x*b}deg)`}_calculateZTransform(){const n=this._pos,s=this._map;if(!s||!n)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(s._showingGlobe()){const _=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),v=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);u=o.radToDeg(Math.atan2(v.y,v.x))-90}else u=-s.getBearing();else if(p==="horizon"){const _=o.smoothstep(4,6,s.getZoom()),v=o.globeCenterToScreenPoint(s.transform);v.y+=_*s.transform.height;const b=n.sub(v),E=o.radToDeg(Math.atan2(b.y,b.x));u=(E>90?E-270:E+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(n){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Ds(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),n===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.Point.convert(n),this._update(),this}_onMove(n){const s=this._map;if(!s)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||s._clickTolerance;if(n.point.dist(u)<_)return;this._isDragging=!0}this._pos=n.point.sub(p),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){const s=this._map,u=this._pos;s&&u&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(u),this._pointerdownPos=n.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const s=this._map;return s&&(n?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Hc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ih(l=new o.Point(0,0),n="bottom"){if(typeof l=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(n){case"top":return new o.Point(0,l);case"top-left":return new o.Point(s,s);case"top-right":return new o.Point(-s,s);case"bottom":return new o.Point(0,-l);case"bottom-left":return new o.Point(s,-s);case"bottom-right":return new o.Point(-s,-s);case"left":return new o.Point(l,0);case"right":return new o.Point(-l,0)}return new o.Point(0,0)}return l instanceof o.Point||Array.isArray(l)?o.Point.convert(l):o.Point.convert(l[n]||[0,0])}class Yc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const s=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,s,u){this._start=this.getValue(s),this._end=n,this._startTime=s,this._endTime=s+u}}const kh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},zh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},hf={showCompass:!0,showZoom:!0,visualizePitch:!1};class df{constructor(n,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Vc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,u&&(this.mousePitch=new jc({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),ut()}move(n,s){const u=this.map,p=this.mouseRotate.mousemoveWindow(n,s),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const v=this.mousePitch.mousemoveWindow(n,s),b=v&&v.pitchDelta;b&&u.setPitch(u.getPitch()+b)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ve(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ve(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Oe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Oe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jc={maxWidth:100,unit:"metric"},$c={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ls={version:o.version,supported:F,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Al{constructor(l){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(l=o.extend({},zh,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(l.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Is(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._useWebGL2=l.useWebGL2,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Xc,this._domRenderTaskQueue=new Xc,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},kh,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=o.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Hr(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Oc(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new bt({customAttribution:l.customAttribution})),this._logoControl=new Wc,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(l,n){if(n===void 0&&(n=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[n];return n.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(l);return n>-1&&this._controls.splice(n,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),this.fire(new o.Event("resize",l)),n&&this.fire(new o.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?o.window.navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(n=>n==="auto"?o.window.navigator.language:n):l}setLanguage(l){const n=this._parseLanguage(l);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,n=l.projection.name;let s;n==="globe"&&l.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),s=!0):n==="mercator"&&l.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,n){return this._updateProjection(l||n||{name:"mercator"})}_updateProjection(l){let n;if(n=l.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(o.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(o.Point.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,n,s){if(l==="mouseenter"||l==="mouseover"){let u=!1;const p=v=>{const b=n.filter(I=>this.getLayer(I)),E=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];E.length?u||(u=!0,s.call(this,new In(l,this,v.originalEvent,{features:E}))):u=!1},_=()=>{u=!1};return{layers:new Set(n),listener:s,delegates:{mousemove:p,mouseout:_}}}if(l==="mouseleave"||l==="mouseout"){let u=!1;const p=v=>{const b=n.filter(E=>this.getLayer(E));(b.length?this.queryRenderedFeatures(v.point,{layers:b}):[]).length?u=!0:u&&(u=!1,s.call(this,new In(l,this,v.originalEvent)))},_=v=>{u&&(u=!1,s.call(this,new In(l,this,v.originalEvent)))};return{layers:new Set(n),listener:s,delegates:{mousemove:p,mouseout:_}}}{const u=p=>{const _=n.filter(b=>this.getLayer(b)),v=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];v.length&&(p.features=v,s.call(this,p),delete p.features)};return{layers:new Set(n),listener:s,delegates:{[l]:u}}}}on(l,n,s){if(s===void 0)return super.on(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(l,n,s){if(s===void 0)return super.once(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,s);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(l,n,s){if(s===void 0)return super.off(l,n);n=new Set(Array.isArray(n)?n:[n]);const u=(_,v)=>{if(_.size!==v.size)return!1;for(const b of _)if(!v.has(b))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[l]:void 0;return p&&(_=>{for(let v=0;v<_.length;v++){const b=_[v];if(b.listener===s&&u(b.layers,n)){for(const E in b.delegates)this.off(E,b.delegates[E]);return _.splice(v,1),this}}})(p),this}queryRenderedFeatures(l,n){return this.style?(n!==void 0||l===void 0||l instanceof o.Point||Array.isArray(l)||(n=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(l,n){return this.style.querySourceFeatures(l,n)}isPointOnSurface(l){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.Point.convert(l))}setStyle(l,n){return(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(l,n))}_getUIString(l){const n=this._locale[l];if(n==null)throw new Error(`Missing UI string '${l}'`);return n}_updateStyle(l,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Wr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,n){if(typeof l=="string"){const s=this._requestManager.normalizeStyleURL(l),u=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(u,(p,_)=>{p?this.fire(new o.ErrorEvent(p)):_&&this._updateDiff(_,n)})}else typeof l=="object"&&this._updateDiff(l,n)}_updateDiff(l,n){try{this.style.setState(l)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(l,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(l,n){return this._lazyInitEmptyStyle(),this.style.addSource(l,n),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const n in l){const s=l[n]._tiles;for(const u in s){const p=s[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(l,n,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,n,s)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,n,{pixelRatio:s=1,sdf:u=!1,stretchX:p,stretchY:_,content:v}={}){if(this._lazyInitEmptyStyle(),n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap){const{width:b,height:E,data:I}=o.exported.getImageData(n);this.style.addImage(l,{data:new o.RGBAImage({width:b,height:E},I),pixelRatio:s,stretchX:p,stretchY:_,content:v,sdf:u,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:E}=n,I=n;this.style.addImage(l,{data:new o.RGBAImage({width:b,height:E},new Uint8Array(I.data)),pixelRatio:s,stretchX:p,stretchY:_,content:v,sdf:u,version:0,userImage:I}),I.onAdd&&I.onAdd(this,l)}}updateImage(l,n){const s=this.style.getImage(l);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap?o.exported.getImageData(n):n,{width:p,height:_}=u;p!==void 0&&_!==void 0?p===s.data.width&&_===s.data.height?(s.data.replace(u.data,!(n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap)),this.style.updateImage(l,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,n){o.getImage(this._requestManager.transformRequest(l,o.ResourceType.Image),(s,u)=>{n(s,u instanceof o.window.HTMLImageElement?o.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(l,n){return this._lazyInitEmptyStyle(),this.style.addLayer(l,n),this._update(!0)}moveLayer(l,n){return this.style.moveLayer(l,n),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,n,s){return this.style.setLayerZoomRange(l,n,s),this._update(!0)}setFilter(l,n,s={}){return this.style.setFilter(l,n,s),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,n,s,u={}){return this.style.setPaintProperty(l,n,s,u),this._update(!0)}getPaintProperty(l,n){return this.style.getPaintProperty(l,n)}setLayoutProperty(l,n,s,u={}){return this.style.setLayoutProperty(l,n,s,u),this._update(!0)}getLayoutProperty(l,n){return this.style.getLayoutProperty(l,n)}setLight(l,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(l),this.transform):0}setFeatureState(l,n){return this.style.setFeatureState(l,n),this._update()}removeFeatureState(l,n){return this.style.removeFeatureState(l,n),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let s,u,p,_=this._container;for(;_&&(!u||!p);){const v=o.window.getComputedStyle(_).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(u=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(p=s[3])),_=_.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=p?Math.abs(n/p):n}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=ce("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ce("div","mapboxgl-canvas-container",l);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=ce("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ce("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{u[p]=ce("div",`mapboxgl-ctrl-${p}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,n){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(n),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${n}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const n=this._markers.indexOf(l);n!==-1&&this._markers.splice(n,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const n=this._popups.indexOf(l);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const l=o.extend({},F.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",l),s=n||this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);s?(this._useWebGL2&&!n&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(s,!0),this.painter=new As(s,this.transform,!!n),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(s)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let n;const s=this.painter.context.extTimerQuery,u=o.exported.now();if(this.listens("gpu-timing-frame")&&(n=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,E=this.transform.pitch,I=o.exported.now(),C=new o.EvaluationParameters(b,{now:I,fadeDuration:p,pitch:E,transition:this.style.getTransition()});this.style.update(C)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const b=o.exported.now()-u;s.endQueryEXT(s.TIME_ELAPSED_EXT,n),setTimeout(()=>{const E=s.getQueryObjectEXT(n,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:b,gpuTime:E})),o.window.performance.mark("frame-gpu",{startTime:u,detail:{gpuTime:E}})},50)}if(this.listens("gpu-timing-layer")){const b=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(b);this.fire(new o.Event("gpu-timing-layer",{layerTimes:E}))},50)}if(this.listens("gpu-timing-deferred-render")){const b=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const E=this.painter.queryGpuTimeDeferredRender(b);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:E}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(v||this._repaint)this.triggerRepaint();else{const b=!this.isMoving()&&this.loaded();if(b&&(_=this._updateAverageElevation(u,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),b&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const E=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:E})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const n of this._markers)l&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!l||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(l,n=!1){const s=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((n||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const u=this.transform.averageElevation;let p=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=l;const v=Math.abs(u-p);if(v>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(p),s(p);this._averageElevation.easeTo(p,l,300)}else if(v>1e-4)return this._averageElevation.jumpTo(p),s(p)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===o.AUTH_ERR_MSG||l.status===401)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof Wc&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const s=this.painter.context.gl,u=s.createFramebuffer();function p(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(p(l),n.canvasCopies.map(p),n.timeStamps)}_canvasPixelComparison(l,n,s){let u=s[1]-s[0];const p=l.length/4;for(let _=0;_<n.length;_++){const v=n[_];let b=0;for(let E=0;E<v.length;E+=4)v[E]===l[E]&&v[E+1]===l[E+1]&&v[E+2]===l[E+2]&&v[E+3]===l[E+3]&&(b+=1);u+=(s[_+2]-s[_+1])*(1-b/p)}return u}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(n)}))}_preloadTiles(l){const n=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(n,(s,u)=>s._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,n){o.setCacheLimits(l,n)}get version(){return o.version}},NavigationControl:class{constructor(l){this.options=o.extend({},hf,l),this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ce("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ce("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:n}):s.resetNorth({},{originalEvent:n}))}),this._compassIcon=ce("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const n=l.getZoom(),s=n===l.getMaxZoom(),u=n===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new df(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,n){const s=ce("button",l,this._container);return s.type="button",s.addEventListener("click",n),s}_setButtonTitle(l,n){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${n}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Kc,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ks(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const n=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,l(s)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>n(s.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(l){const n=this._map.getMaxBounds(),s=l.coords;return!!n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){const n=new o.LngLat(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,u=this._map.getBearing(),p=o.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(s),p,{geolocateSource:!0})}_updateMarker(l){if(l){const n=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,n=o.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ce("button","mapboxgl-ctrl-geolocate",this._container),ce("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ce("div","mapboxgl-user-location"),this._dotElement.appendChild(ce("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ce("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new _t({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ce("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _t({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bt,ScaleControl:class{constructor(l){this.options=o.extend({},Jc,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,n=this._map,s=n._containerHeight/2,u=n._containerWidth/2-l/2,p=n.unproject([u,s]),_=n.unproject([u+l,s]),v=p.distanceTo(_);if(this.options.unit==="imperial"){const b=3.2808*v;b>5280?this._setScale(l,b/5280,"mile"):this._setScale(l,b,"foot")}else this.options.unit==="nautical"?this._setScale(l,v/1852,"nautical-mile"):v>=1e3?this._setScale(l,v/1e3,"kilometer"):this._setScale(l,v,"meter")}_setScale(l,n,s){this._map._requestDomTask(()=>{const u=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const I=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*I)/I}(b),v*b}(n),p=u/n;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(u):`${u}&nbsp;${$c[s]}`,this._container.style.width=l*p+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=ce("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ce("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(Hc),l),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(o.window.document.createTextNode(l))}setHTML(l){const n=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let u;for(s.innerHTML=l;u=s.firstChild,u;)n.appendChild(u);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ce("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(l),this.options.closeButton){const s=this._closeButton=ce("button","mapboxgl-popup-close-button",n);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let n;return this._classList.delete(l)?n=!1:(this._classList.add(l),n=!0),this._updateClassList(),n}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const n=this._map,s=this._container,u=this._pos;if(!n||!s||!u)return"bottom";const p=s.offsetWidth,_=s.offsetHeight,v=u.x<p/2,b=u.x>n.transform.width-p/2;if(u.y+l<_)return v?"top-left":b?"top-right":"top";if(u.y>n.transform.height-_){if(v)return"bottom-left";if(b)return"bottom-right"}return v?"left":b?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),l.className=n.join(" ")}_update(l){const n=this._map,s=this._content;if(!n||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=ce("div","mapboxgl-popup",n.getContainer()),this._tip=ce("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ds(this._lngLat,this._pos,n.transform)),!this._trackPointer||l){const p=this._pos=this._trackPointer&&l?l:n.project(this._lngLat),_=Ih(this.options.offset),v=this._anchor=this._getAnchor(_.y),b=Ih(this.options.offset,v),E=p.add(b).round();n._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${es[v]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&n._showingGlobe()){const p=o.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(uf);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:_t,Style:Wr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:ph,Evented:o.Evented,config:o.config,prewarm:function(){Zr().acquire(ur)},clearPrewarmedResources:function(){const l=Sn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(ur),Sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return wn.workerCount},set workerCount(l){wn.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Ls});var z=S;return z})})(D0);var v2=D0.exports;const b2=x2(v2);const Pd=Math.min,Xa=Math.max,Dd=Math.round,vd=Math.floor,Hs=h=>({x:h,y:h}),w2={left:"right",right:"left",bottom:"top",top:"bottom"},T2={start:"end",end:"start"};function Cy(h,f,y){return Xa(h,Pd(f,y))}function Ud(h,f){return typeof h=="function"?h(f):h}function Ya(h){return h.split("-")[0]}function Nd(h){return h.split("-")[1]}function R0(h){return h==="x"?"y":"x"}function B0(h){return h==="y"?"height":"width"}function Vd(h){return["top","bottom"].includes(Ya(h))?"y":"x"}function O0(h){return R0(Vd(h))}function E2(h,f,y){y===void 0&&(y=!1);const w=Nd(h),S=O0(h),k=B0(S);let z=S==="x"?w===(y?"end":"start")?"right":"left":w==="start"?"bottom":"top";return f.reference[k]>f.floating[k]&&(z=Ld(z)),[z,Ld(z)]}function M2(h){const f=Ld(h);return[Wp(h),f,Wp(f)]}function Wp(h){return h.replace(/start|end/g,f=>T2[f])}function S2(h,f,y){const w=["left","right"],S=["right","left"],k=["top","bottom"],z=["bottom","top"];switch(h){case"top":case"bottom":return y?f?S:w:f?w:S;case"left":case"right":return f?k:z;default:return[]}}function A2(h,f,y,w){const S=Nd(h);let k=S2(Ya(h),y==="start",w);return S&&(k=k.map(z=>z+"-"+S),f&&(k=k.concat(k.map(Wp)))),k}function Ld(h){return h.replace(/left|right|bottom|top/g,f=>w2[f])}function C2(h){return{top:0,right:0,bottom:0,left:0,...h}}function I2(h){return typeof h!="number"?C2(h):{top:h,right:h,bottom:h,left:h}}function Rd(h){return{...h,top:h.y,left:h.x,right:h.x+h.width,bottom:h.y+h.height}}function Iy(h,f,y){let{reference:w,floating:S}=h;const k=Vd(f),z=O0(f),o=B0(z),L=Ya(f),F=k==="y",Q=w.x+w.width/2-S.width/2,H=w.y+w.height/2-S.height/2,ce=w[o]/2-S[o]/2;let de;switch(L){case"top":de={x:Q,y:w.y-S.height};break;case"bottom":de={x:Q,y:w.y+w.height};break;case"right":de={x:w.x+w.width,y:H};break;case"left":de={x:w.x-S.width,y:H};break;default:de={x:w.x,y:w.y}}switch(Nd(f)){case"start":de[z]-=ce*(y&&F?-1:1);break;case"end":de[z]+=ce*(y&&F?-1:1);break}return de}const k2=async(h,f,y)=>{const{placement:w="bottom",strategy:S="absolute",middleware:k=[],platform:z}=y,o=k.filter(Boolean),L=await(z.isRTL==null?void 0:z.isRTL(f));let F=await z.getElementRects({reference:h,floating:f,strategy:S}),{x:Q,y:H}=Iy(F,w,L),ce=w,de={},ye=0;for(let Ee=0;Ee<o.length;Ee++){const{name:Xe,fn:ut}=o[Ee],{x:at,y:Ie,data:ct,reset:ve}=await ut({x:Q,y:H,initialPlacement:w,placement:ce,strategy:S,middlewareData:de,rects:F,platform:z,elements:{reference:h,floating:f}});if(Q=at??Q,H=Ie??H,de={...de,[Xe]:{...de[Xe],...ct}},ve&&ye<=50){ye++,typeof ve=="object"&&(ve.placement&&(ce=ve.placement),ve.rects&&(F=ve.rects===!0?await z.getElementRects({reference:h,floating:f,strategy:S}):ve.rects),{x:Q,y:H}=Iy(F,ce,L)),Ee=-1;continue}}return{x:Q,y:H,placement:ce,strategy:S,middlewareData:de}};async function F0(h,f){var y;f===void 0&&(f={});const{x:w,y:S,platform:k,rects:z,elements:o,strategy:L}=h,{boundary:F="clippingAncestors",rootBoundary:Q="viewport",elementContext:H="floating",altBoundary:ce=!1,padding:de=0}=Ud(f,h),ye=I2(de),Xe=o[ce?H==="floating"?"reference":"floating":H],ut=Rd(await k.getClippingRect({element:(y=await(k.isElement==null?void 0:k.isElement(Xe)))==null||y?Xe:Xe.contextElement||await(k.getDocumentElement==null?void 0:k.getDocumentElement(o.floating)),boundary:F,rootBoundary:Q,strategy:L})),at=H==="floating"?{...z.floating,x:w,y:S}:z.reference,Ie=await(k.getOffsetParent==null?void 0:k.getOffsetParent(o.floating)),ct=await(k.isElement==null?void 0:k.isElement(Ie))?await(k.getScale==null?void 0:k.getScale(Ie))||{x:1,y:1}:{x:1,y:1},ve=Rd(k.convertOffsetParentRelativeRectToViewportRelativeRect?await k.convertOffsetParentRelativeRectToViewportRelativeRect({rect:at,offsetParent:Ie,strategy:L}):at);return{top:(ut.top-ve.top+ye.top)/ct.y,bottom:(ve.bottom-ut.bottom+ye.bottom)/ct.y,left:(ut.left-ve.left+ye.left)/ct.x,right:(ve.right-ut.right+ye.right)/ct.x}}const z2=function(h){return h===void 0&&(h={}),{name:"flip",options:h,async fn(f){var y,w;const{placement:S,middlewareData:k,rects:z,initialPlacement:o,platform:L,elements:F}=f,{mainAxis:Q=!0,crossAxis:H=!0,fallbackPlacements:ce,fallbackStrategy:de="bestFit",fallbackAxisSideDirection:ye="none",flipAlignment:Ee=!0,...Xe}=Ud(h,f);if((y=k.arrow)!=null&&y.alignmentOffset)return{};const ut=Ya(S),at=Ya(o)===o,Ie=await(L.isRTL==null?void 0:L.isRTL(F.floating)),ct=ce||(at||!Ee?[Ld(o)]:M2(o));!ce&&ye!=="none"&&ct.push(...A2(o,Ee,ye,Ie));const ve=[o,...ct],Oe=await F0(f,Xe),Ze=[];let He=((w=k.flip)==null?void 0:w.overflows)||[];if(Q&&Ze.push(Oe[ut]),H){const tt=E2(S,z,Ie);Ze.push(Oe[tt[0]],Oe[tt[1]])}if(He=[...He,{placement:S,overflows:Ze}],!Ze.every(tt=>tt<=0)){var Be,Ut;const tt=(((Be=k.flip)==null?void 0:Be.index)||0)+1,St=ve[tt];if(St)return{data:{index:tt,overflows:He},reset:{placement:St}};let Ot=(Ut=He.filter(vi=>vi.overflows[0]<=0).sort((vi,qt)=>vi.overflows[1]-qt.overflows[1])[0])==null?void 0:Ut.placement;if(!Ot)switch(de){case"bestFit":{var Pe;const vi=(Pe=He.map(qt=>[qt.placement,qt.overflows.filter(ri=>ri>0).reduce((ri,je)=>ri+je,0)]).sort((qt,ri)=>qt[1]-ri[1])[0])==null?void 0:Pe[0];vi&&(Ot=vi);break}case"initialPlacement":Ot=o;break}if(S!==Ot)return{reset:{placement:Ot}}}return{}}}};async function P2(h,f){const{placement:y,platform:w,elements:S}=h,k=await(w.isRTL==null?void 0:w.isRTL(S.floating)),z=Ya(y),o=Nd(y),L=Vd(y)==="y",F=["left","top"].includes(z)?-1:1,Q=k&&L?-1:1,H=Ud(f,h);let{mainAxis:ce,crossAxis:de,alignmentAxis:ye}=typeof H=="number"?{mainAxis:H,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...H};return o&&typeof ye=="number"&&(de=o==="end"?ye*-1:ye),L?{x:de*Q,y:ce*F}:{x:ce*F,y:de*Q}}const D2=function(h){return h===void 0&&(h=0),{name:"offset",options:h,async fn(f){const{x:y,y:w}=f,S=await P2(f,h);return{x:y+S.x,y:w+S.y,data:S}}}},L2=function(h){return h===void 0&&(h={}),{name:"shift",options:h,async fn(f){const{x:y,y:w,placement:S}=f,{mainAxis:k=!0,crossAxis:z=!1,limiter:o={fn:Xe=>{let{x:ut,y:at}=Xe;return{x:ut,y:at}}},...L}=Ud(h,f),F={x:y,y:w},Q=await F0(f,L),H=Vd(Ya(S)),ce=R0(H);let de=F[ce],ye=F[H];if(k){const Xe=ce==="y"?"top":"left",ut=ce==="y"?"bottom":"right",at=de+Q[Xe],Ie=de-Q[ut];de=Cy(at,de,Ie)}if(z){const Xe=H==="y"?"top":"left",ut=H==="y"?"bottom":"right",at=ye+Q[Xe],Ie=ye-Q[ut];ye=Cy(at,ye,Ie)}const Ee=o.fn({...f,[ce]:de,[H]:ye});return{...Ee,data:{x:Ee.x-y,y:Ee.y-w}}}}};function Ys(h){return U0(h)?(h.nodeName||"").toLowerCase():"#document"}function Gr(h){var f;return(h==null||(f=h.ownerDocument)==null?void 0:f.defaultView)||window}function gs(h){var f;return(f=(U0(h)?h.ownerDocument:h.document)||window.document)==null?void 0:f.documentElement}function U0(h){return h instanceof Node||h instanceof Gr(h).Node}function fs(h){return h instanceof Element||h instanceof Gr(h).Element}function qo(h){return h instanceof HTMLElement||h instanceof Gr(h).HTMLElement}function ky(h){return typeof ShadowRoot>"u"?!1:h instanceof ShadowRoot||h instanceof Gr(h).ShadowRoot}function Xu(h){const{overflow:f,overflowX:y,overflowY:w,display:S}=io(h);return/auto|scroll|overlay|hidden|clip/.test(f+w+y)&&!["inline","contents"].includes(S)}function R2(h){return["table","td","th"].includes(Ys(h))}function sm(h){const f=am(),y=io(h);return y.transform!=="none"||y.perspective!=="none"||(y.containerType?y.containerType!=="normal":!1)||!f&&(y.backdropFilter?y.backdropFilter!=="none":!1)||!f&&(y.filter?y.filter!=="none":!1)||["transform","perspective","filter"].some(w=>(y.willChange||"").includes(w))||["paint","layout","strict","content"].some(w=>(y.contain||"").includes(w))}function B2(h){let f=ac(h);for(;qo(f)&&!jd(f);){if(sm(f))return f;f=ac(f)}return null}function am(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function jd(h){return["html","body","#document"].includes(Ys(h))}function io(h){return Gr(h).getComputedStyle(h)}function Gd(h){return fs(h)?{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}:{scrollLeft:h.pageXOffset,scrollTop:h.pageYOffset}}function ac(h){if(Ys(h)==="html")return h;const f=h.assignedSlot||h.parentNode||ky(h)&&h.host||gs(h);return ky(f)?f.host:f}function N0(h){const f=ac(h);return jd(f)?h.ownerDocument?h.ownerDocument.body:h.body:qo(f)&&Xu(f)?f:N0(f)}function qu(h,f,y){var w;f===void 0&&(f=[]),y===void 0&&(y=!0);const S=N0(h),k=S===((w=h.ownerDocument)==null?void 0:w.body),z=Gr(S);return k?f.concat(z,z.visualViewport||[],Xu(S)?S:[],z.frameElement&&y?qu(z.frameElement):[]):f.concat(S,qu(S))}function V0(h){const f=io(h);let y=parseFloat(f.width)||0,w=parseFloat(f.height)||0;const S=qo(h),k=S?h.offsetWidth:y,z=S?h.offsetHeight:w,o=Dd(y)!==k||Dd(w)!==z;return o&&(y=k,w=z),{width:y,height:w,$:o}}function lm(h){return fs(h)?h:h.contextElement}function nc(h){const f=lm(h);if(!qo(f))return Hs(1);const y=f.getBoundingClientRect(),{width:w,height:S,$:k}=V0(f);let z=(k?Dd(y.width):y.width)/w,o=(k?Dd(y.height):y.height)/S;return(!z||!Number.isFinite(z))&&(z=1),(!o||!Number.isFinite(o))&&(o=1),{x:z,y:o}}const O2=Hs(0);function j0(h){const f=Gr(h);return!am()||!f.visualViewport?O2:{x:f.visualViewport.offsetLeft,y:f.visualViewport.offsetTop}}function F2(h,f,y){return f===void 0&&(f=!1),!y||f&&y!==Gr(h)?!1:f}function Ka(h,f,y,w){f===void 0&&(f=!1),y===void 0&&(y=!1);const S=h.getBoundingClientRect(),k=lm(h);let z=Hs(1);f&&(w?fs(w)&&(z=nc(w)):z=nc(h));const o=F2(k,y,w)?j0(k):Hs(0);let L=(S.left+o.x)/z.x,F=(S.top+o.y)/z.y,Q=S.width/z.x,H=S.height/z.y;if(k){const ce=Gr(k),de=w&&fs(w)?Gr(w):w;let ye=ce.frameElement;for(;ye&&w&&de!==ce;){const Ee=nc(ye),Xe=ye.getBoundingClientRect(),ut=io(ye),at=Xe.left+(ye.clientLeft+parseFloat(ut.paddingLeft))*Ee.x,Ie=Xe.top+(ye.clientTop+parseFloat(ut.paddingTop))*Ee.y;L*=Ee.x,F*=Ee.y,Q*=Ee.x,H*=Ee.y,L+=at,F+=Ie,ye=Gr(ye).frameElement}}return Rd({width:Q,height:H,x:L,y:F})}function U2(h){let{rect:f,offsetParent:y,strategy:w}=h;const S=qo(y),k=gs(y);if(y===k)return f;let z={scrollLeft:0,scrollTop:0},o=Hs(1);const L=Hs(0);if((S||!S&&w!=="fixed")&&((Ys(y)!=="body"||Xu(k))&&(z=Gd(y)),qo(y))){const F=Ka(y);o=nc(y),L.x=F.x+y.clientLeft,L.y=F.y+y.clientTop}return{width:f.width*o.x,height:f.height*o.y,x:f.x*o.x-z.scrollLeft*o.x+L.x,y:f.y*o.y-z.scrollTop*o.y+L.y}}function N2(h){return Array.from(h.getClientRects())}function G0(h){return Ka(gs(h)).left+Gd(h).scrollLeft}function V2(h){const f=gs(h),y=Gd(h),w=h.ownerDocument.body,S=Xa(f.scrollWidth,f.clientWidth,w.scrollWidth,w.clientWidth),k=Xa(f.scrollHeight,f.clientHeight,w.scrollHeight,w.clientHeight);let z=-y.scrollLeft+G0(h);const o=-y.scrollTop;return io(w).direction==="rtl"&&(z+=Xa(f.clientWidth,w.clientWidth)-S),{width:S,height:k,x:z,y:o}}function j2(h,f){const y=Gr(h),w=gs(h),S=y.visualViewport;let k=w.clientWidth,z=w.clientHeight,o=0,L=0;if(S){k=S.width,z=S.height;const F=am();(!F||F&&f==="fixed")&&(o=S.offsetLeft,L=S.offsetTop)}return{width:k,height:z,x:o,y:L}}function G2(h,f){const y=Ka(h,!0,f==="fixed"),w=y.top+h.clientTop,S=y.left+h.clientLeft,k=qo(h)?nc(h):Hs(1),z=h.clientWidth*k.x,o=h.clientHeight*k.y,L=S*k.x,F=w*k.y;return{width:z,height:o,x:L,y:F}}function zy(h,f,y){let w;if(f==="viewport")w=j2(h,y);else if(f==="document")w=V2(gs(h));else if(fs(f))w=G2(f,y);else{const S=j0(h);w={...f,x:f.x-S.x,y:f.y-S.y}}return Rd(w)}function q0(h,f){const y=ac(h);return y===f||!fs(y)||jd(y)?!1:io(y).position==="fixed"||q0(y,f)}function q2(h,f){const y=f.get(h);if(y)return y;let w=qu(h,[],!1).filter(o=>fs(o)&&Ys(o)!=="body"),S=null;const k=io(h).position==="fixed";let z=k?ac(h):h;for(;fs(z)&&!jd(z);){const o=io(z),L=sm(z);!L&&o.position==="fixed"&&(S=null),(k?!L&&!S:!L&&o.position==="static"&&!!S&&["absolute","fixed"].includes(S.position)||Xu(z)&&!L&&q0(h,z))?w=w.filter(Q=>Q!==z):S=o,z=ac(z)}return f.set(h,w),w}function Z2(h){let{element:f,boundary:y,rootBoundary:w,strategy:S}=h;const z=[...y==="clippingAncestors"?q2(f,this._c):[].concat(y),w],o=z[0],L=z.reduce((F,Q)=>{const H=zy(f,Q,S);return F.top=Xa(H.top,F.top),F.right=Pd(H.right,F.right),F.bottom=Pd(H.bottom,F.bottom),F.left=Xa(H.left,F.left),F},zy(f,o,S));return{width:L.right-L.left,height:L.bottom-L.top,x:L.left,y:L.top}}function W2(h){return V0(h)}function X2(h,f,y){const w=qo(f),S=gs(f),k=y==="fixed",z=Ka(h,!0,k,f);let o={scrollLeft:0,scrollTop:0};const L=Hs(0);if(w||!w&&!k)if((Ys(f)!=="body"||Xu(S))&&(o=Gd(f)),w){const F=Ka(f,!0,k,f);L.x=F.x+f.clientLeft,L.y=F.y+f.clientTop}else S&&(L.x=G0(S));return{x:z.left+o.scrollLeft-L.x,y:z.top+o.scrollTop-L.y,width:z.width,height:z.height}}function Py(h,f){return!qo(h)||io(h).position==="fixed"?null:f?f(h):h.offsetParent}function Z0(h,f){const y=Gr(h);if(!qo(h))return y;let w=Py(h,f);for(;w&&R2(w)&&io(w).position==="static";)w=Py(w,f);return w&&(Ys(w)==="html"||Ys(w)==="body"&&io(w).position==="static"&&!sm(w))?y:w||B2(h)||y}const H2=async function(h){let{reference:f,floating:y,strategy:w}=h;const S=this.getOffsetParent||Z0,k=this.getDimensions;return{reference:X2(f,await S(y),w),floating:{x:0,y:0,...await k(y)}}};function Y2(h){return io(h).direction==="rtl"}const K2={convertOffsetParentRelativeRectToViewportRelativeRect:U2,getDocumentElement:gs,getClippingRect:Z2,getOffsetParent:Z0,getElementRects:H2,getClientRects:N2,getDimensions:W2,getScale:nc,isElement:fs,isRTL:Y2};function J2(h,f){let y=null,w;const S=gs(h);function k(){clearTimeout(w),y&&y.disconnect(),y=null}function z(o,L){o===void 0&&(o=!1),L===void 0&&(L=1),k();const{left:F,top:Q,width:H,height:ce}=h.getBoundingClientRect();if(o||f(),!H||!ce)return;const de=vd(Q),ye=vd(S.clientWidth-(F+H)),Ee=vd(S.clientHeight-(Q+ce)),Xe=vd(F),at={rootMargin:-de+"px "+-ye+"px "+-Ee+"px "+-Xe+"px",threshold:Xa(0,Pd(1,L))||1};let Ie=!0;function ct(ve){const Oe=ve[0].intersectionRatio;if(Oe!==L){if(!Ie)return z();Oe?z(!1,Oe):w=setTimeout(()=>{z(!1,1e-7)},100)}Ie=!1}try{y=new IntersectionObserver(ct,{...at,root:S.ownerDocument})}catch{y=new IntersectionObserver(ct,at)}y.observe(h)}return z(!0),k}function $2(h,f,y,w){w===void 0&&(w={});const{ancestorScroll:S=!0,ancestorResize:k=!0,elementResize:z=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:L=!1}=w,F=lm(h),Q=S||k?[...F?qu(F):[],...qu(f)]:[];Q.forEach(ut=>{S&&ut.addEventListener("scroll",y,{passive:!0}),k&&ut.addEventListener("resize",y)});const H=F&&o?J2(F,y):null;let ce=-1,de=null;z&&(de=new ResizeObserver(ut=>{let[at]=ut;at&&at.target===F&&de&&(de.unobserve(f),cancelAnimationFrame(ce),ce=requestAnimationFrame(()=>{de&&de.observe(f)})),y()}),F&&!L&&de.observe(F),de.observe(f));let ye,Ee=L?Ka(h):null;L&&Xe();function Xe(){const ut=Ka(h);Ee&&(ut.x!==Ee.x||ut.y!==Ee.y||ut.width!==Ee.width||ut.height!==Ee.height)&&y(),Ee=ut,ye=requestAnimationFrame(Xe)}return y(),()=>{Q.forEach(ut=>{S&&ut.removeEventListener("scroll",y),k&&ut.removeEventListener("resize",y)}),H&&H(),de&&de.disconnect(),de=null,L&&cancelAnimationFrame(ye)}}const Q2=(h,f,y)=>{const w=new Map,S={platform:K2,...y},k={...S.platform,_c:w};return k2(h,f,{...S,platform:k})};function eT(h){let f,y;const w={autoUpdate:!0};let S=h;const k=Q=>({...w,...h||{},...Q||{}}),z=Q=>{f&&y&&(S=k(Q),Q2(f,y,S).then(H=>{Object.assign(y.style,{position:H.strategy,left:`${H.x}px`,top:`${H.y}px`}),S!=null&&S.onComputed&&S.onComputed(H)}))},o=Q=>{if("subscribe"in Q)return F(Q),{};f=Q,z()},L=(Q,H)=>{let ce;y=Q,S=k(H),setTimeout(()=>z(H),0),z(H);const de=()=>{ce&&(ce(),ce=void 0)},ye=({autoUpdate:Ee}=S||{})=>{if(de(),Ee!==!1)return $2(f,y,()=>z(S),Ee===!0?{}:Ee)};return ce=ye(),{update(Ee){z(Ee),ce=ye(Ee)},destroy(){de()}}},F=Q=>{const H=Q.subscribe(ce=>{f===void 0?(f=ce,z()):(Object.assign(f,ce),z())});d0(H)};return[o,L,z]}function tT({loadOptions:h,filterText:f,items:y,multiple:w,value:S,itemId:k,groupBy:z,filterSelectedItems:o,itemFilter:L,convertStringItemsToObjects:F,filterGroupedItems:Q,label:H}){if(y&&h)return y;if(!y)return[];y&&y.length>0&&typeof y[0]!="object"&&(y=F(y));let ce=y.filter(de=>{let ye=L(de[H],f,de);return ye&&w&&(S!=null&&S.length)&&(ye=!S.some(Ee=>o?Ee[k]===de[k]:!1)),ye});return z&&(ce=Q(ce)),ce}async function iT({dispatch:h,loadOptions:f,convertStringItemsToObjects:y,filterText:w}){let S=await f(w).catch(k=>{console.warn("svelte-select loadOptions error :>> ",k),h("error",{type:"loadOptions",details:k})});if(S&&!S.cancelled)return S?(S&&S.length>0&&typeof S[0]!="object"&&(S=y(S)),h("loaded",{items:S})):S=[],{filteredItems:S,loading:!1,focused:!0,listOpen:!0}}function nT(h){let f,y;return{c(){f=Fn("svg"),y=Fn("path"),this.h()},l(w){f=Un(w,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,class:!0});var S=Mt(f);y=Un(S,"path",{fill:!0,d:!0}),Mt(y).forEach(qe),S.forEach(qe),this.h()},h(){_e(y,"fill","currentColor"),_e(y,"d",`M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747
          3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0
          1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502
          0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0
          0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z`),_e(f,"width","100%"),_e(f,"height","100%"),_e(f,"viewBox","0 0 20 20"),_e(f,"focusable","false"),_e(f,"aria-hidden","true"),_e(f,"class","svelte-qbd276")},m(w,S){ni(w,f,S),Ke(f,y)},p:Dn,i:Dn,o:Dn,d(w){w&&qe(f)}}}class rT extends ms{constructor(f){super(),_s(this,f,null,nT,ps,{})}}function oT(h){let f,y;return{c(){f=Fn("svg"),y=Fn("path"),this.h()},l(w){f=Un(w,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,role:!0,class:!0});var S=Mt(f);y=Un(S,"path",{fill:!0,d:!0}),Mt(y).forEach(qe),S.forEach(qe),this.h()},h(){_e(y,"fill","currentColor"),_e(y,"d",`M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124
    l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z`),_e(f,"width","100%"),_e(f,"height","100%"),_e(f,"viewBox","-2 -2 50 50"),_e(f,"focusable","false"),_e(f,"aria-hidden","true"),_e(f,"role","presentation"),_e(f,"class","svelte-whdbu1")},m(w,S){ni(w,f,S),Ke(f,y)},p:Dn,i:Dn,o:Dn,d(w){w&&qe(f)}}}class Bd extends ms{constructor(f){super(),_s(this,f,null,oT,ps,{})}}function sT(h){let f,y;return{c(){f=Fn("svg"),y=Fn("circle"),this.h()},l(w){f=Un(w,"svg",{class:!0,viewBox:!0});var S=Mt(f);y=Un(S,"circle",{class:!0,cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-miterlimit":!0}),Mt(y).forEach(qe),S.forEach(qe),this.h()},h(){_e(y,"class","circle_path svelte-1p3nqvd"),_e(y,"cx","50"),_e(y,"cy","50"),_e(y,"r","20"),_e(y,"fill","none"),_e(y,"stroke","currentColor"),_e(y,"stroke-width","5"),_e(y,"stroke-miterlimit","10"),_e(f,"class","loading svelte-1p3nqvd"),_e(f,"viewBox","25 25 50 50")},m(w,S){ni(w,f,S),Ke(f,y)},p:Dn,i:Dn,o:Dn,d(w){w&&qe(f)}}}class aT extends ms{constructor(f){super(),_s(this,f,null,sT,ps,{})}}const lT=h=>({value:h[0]&8}),Dy=h=>({value:h[3]}),cT=h=>({value:h[0]&8}),Ly=h=>({value:h[3]}),uT=h=>({listOpen:h[0]&64}),Ry=h=>({listOpen:h[6]}),hT=h=>({}),By=h=>({}),dT=h=>({}),Oy=h=>({}),fT=h=>({selection:h[0]&8}),Fy=h=>({selection:h[3]});function Uy(h,f,y){const w=h.slice();return w[125]=f[y],w[127]=y,w}const pT=h=>({}),Ny=h=>({}),mT=h=>({selection:h[0]&8}),Vy=h=>({selection:h[125],index:h[127]}),_T=h=>({}),jy=h=>({}),gT=h=>({}),Gy=h=>({}),yT=h=>({}),qy=h=>({});function Zy(h,f,y){const w=h.slice();return w[125]=f[y],w[127]=y,w}const xT=h=>({item:h[0]&16777216}),Wy=h=>({item:h[125],index:h[127]}),vT=h=>({filteredItems:h[0]&16777216}),Xy=h=>({filteredItems:h[24]}),bT=h=>({}),Hy=h=>({});function Yy(h){let f,y,w,S,k,z,o,L,F=h[50]["list-prepend"]&&Ky(h);const Q=[ET,TT,wT],H=[];function ce(ye,Ee){return ye[50].list?0:ye[24].length>0?1:ye[19]?-1:2}~(w=ce(h))&&(S=H[w]=Q[w](h));let de=h[50]["list-append"]&&$y(h);return{c(){f=kt("div"),F&&F.c(),y=fi(),S&&S.c(),k=fi(),de&&de.c(),this.h()},l(ye){f=zt(ye,"DIV",{class:!0});var Ee=Mt(f);F&&F.l(Ee),y=pi(Ee),S&&S.l(Ee),k=pi(Ee),de&&de.l(Ee),Ee.forEach(qe),this.h()},h(){_e(f,"class","svelte-select-list svelte-82qwg8"),Si(f,"prefloat",h[28])},m(ye,Ee){ni(ye,f,Ee),F&&F.m(f,null),Ke(f,y),~w&&H[w].m(f,null),Ke(f,k),de&&de.m(f,null),h[90](f),z=!0,o||(L=[Za(h[49].call(null,f)),Yi(f,"scroll",h[41]),Yi(f,"pointerup",Ws(No(h[85])))],o=!0)},p(ye,Ee){ye[50]["list-prepend"]?F?(F.p(ye,Ee),Ee[1]&524288&&Bt(F,1)):(F=Ky(ye),F.c(),Bt(F,1),F.m(f,y)):F&&(Vr(),Qt(F,1,1,()=>{F=null}),jr());let Xe=w;w=ce(ye),w===Xe?~w&&H[w].p(ye,Ee):(S&&(Vr(),Qt(H[Xe],1,1,()=>{H[Xe]=null}),jr()),~w?(S=H[w],S?S.p(ye,Ee):(S=H[w]=Q[w](ye),S.c()),Bt(S,1),S.m(f,k)):S=null),ye[50]["list-append"]?de?(de.p(ye,Ee),Ee[1]&524288&&Bt(de,1)):(de=$y(ye),de.c(),Bt(de,1),de.m(f,null)):de&&(Vr(),Qt(de,1,1,()=>{de=null}),jr()),(!z||Ee[0]&268435456)&&Si(f,"prefloat",ye[28])},i(ye){z||(Bt(F),Bt(S),Bt(de),z=!0)},o(ye){Qt(F),Qt(S),Qt(de),z=!1},d(ye){ye&&qe(f),F&&F.d(),~w&&H[w].d(),de&&de.d(),h[90](null),o=!1,lc(L)}}}function Ky(h){let f;const y=h[82]["list-prepend"],w=Ir(y,h,h[81],Hy);return{c(){w&&w.c()},l(S){w&&w.l(S)},m(S,k){w&&w.m(S,k),f=!0},p(S,k){w&&w.p&&(!f||k[2]&524288)&&kr(w,y,S,S[81],f?Pr(y,S[81],k,bT):zr(S[81]),Hy)},i(S){f||(Bt(w,S),f=!0)},o(S){Qt(w,S),f=!1},d(S){w&&w.d(S)}}}function wT(h){let f;const y=h[82].empty,w=Ir(y,h,h[81],qy),S=w||MT();return{c(){S&&S.c()},l(k){S&&S.l(k)},m(k,z){S&&S.m(k,z),f=!0},p(k,z){w&&w.p&&(!f||z[2]&524288)&&kr(w,y,k,k[81],f?Pr(y,k[81],z,yT):zr(k[81]),qy)},i(k){f||(Bt(S,k),f=!0)},o(k){Qt(S,k),f=!1},d(k){S&&S.d(k)}}}function TT(h){let f,y,w=Sr(h[24]),S=[];for(let z=0;z<w.length;z+=1)S[z]=Jy(Zy(h,w,z));const k=z=>Qt(S[z],1,1,()=>{S[z]=null});return{c(){for(let z=0;z<S.length;z+=1)S[z].c();f=Ar()},l(z){for(let o=0;o<S.length;o+=1)S[o].l(z);f=Ar()},m(z,o){for(let L=0;L<S.length;L+=1)S[L]&&S[L].m(z,o);ni(z,f,o),y=!0},p(z,o){if(o[0]&1627402376|o[1]&28672|o[2]&524288){w=Sr(z[24]);let L;for(L=0;L<w.length;L+=1){const F=Zy(z,w,L);S[L]?(S[L].p(F,o),Bt(S[L],1)):(S[L]=Jy(F),S[L].c(),Bt(S[L],1),S[L].m(f.parentNode,f))}for(Vr(),L=w.length;L<S.length;L+=1)k(L);jr()}},i(z){if(!y){for(let o=0;o<w.length;o+=1)Bt(S[o]);y=!0}},o(z){S=S.filter(Boolean);for(let o=0;o<S.length;o+=1)Qt(S[o]);y=!1},d(z){z&&qe(f),qa(S,z)}}}function ET(h){let f;const y=h[82].list,w=Ir(y,h,h[81],Xy);return{c(){w&&w.c()},l(S){w&&w.l(S)},m(S,k){w&&w.m(S,k),f=!0},p(S,k){w&&w.p&&(!f||k[0]&16777216|k[2]&524288)&&kr(w,y,S,S[81],f?Pr(y,S[81],k,vT):zr(S[81]),Xy)},i(S){f||(Bt(w,S),f=!0)},o(S){Qt(w,S),f=!1},d(S){w&&w.d(S)}}}function MT(h){let f,y="No options";return{c(){f=kt("div"),f.textContent=y,this.h()},l(w){f=zt(w,"DIV",{class:!0,"data-svelte-h":!0}),Xs(f)!=="svelte-16ffy3h"&&(f.textContent=y),this.h()},h(){_e(f,"class","empty svelte-82qwg8")},m(w,S){ni(w,f,S)},p:Dn,d(w){w&&qe(f)}}}function ST(h){var w;let f=((w=h[125])==null?void 0:w[h[12]])+"",y;return{c(){y=Zi(f)},l(S){y=Wi(S,f)},m(S,k){ni(S,y,k)},p(S,k){var z;k[0]&16781312&&f!==(f=((z=S[125])==null?void 0:z[S[12]])+"")&&On(y,f)},d(S){S&&qe(y)}}}function Jy(h){let f,y,w,S,k,z,o,L;const F=h[82].item,Q=Ir(F,h,h[81],Wy),H=Q||ST(h);function ce(){return h[87](h[127])}function de(){return h[88](h[127])}function ye(){return h[89](h[125],h[127])}return{c(){f=kt("div"),y=kt("div"),H&&H.c(),k=fi(),this.h()},l(Ee){f=zt(Ee,"DIV",{class:!0,tabindex:!0,role:!0});var Xe=Mt(f);y=zt(Xe,"DIV",{class:!0});var ut=Mt(y);H&&H.l(ut),ut.forEach(qe),k=pi(Xe),Xe.forEach(qe),this.h()},h(){var Ee;_e(y,"class","item svelte-82qwg8"),Si(y,"list-group-title",h[125].groupHeader),Si(y,"active",h[45](h[125],h[3],h[13])),Si(y,"first",FT(h[127])),Si(y,"hover",h[7]===h[127]),Si(y,"group-item",h[125].groupItem),Si(y,"not-selectable",((Ee=h[125])==null?void 0:Ee.selectable)===!1),_e(f,"class","list-item svelte-82qwg8"),_e(f,"tabindex","-1"),_e(f,"role","none")},m(Ee,Xe){ni(Ee,f,Xe),Ke(f,y),H&&H.m(y,null),Ke(f,k),z=!0,o||(L=[Za(w=h[46].call(null,y,{scroll:h[45](h[125],h[3],h[13]),listDom:h[30]})),Za(S=h[47].call(null,y,{scroll:h[29]===h[127],listDom:h[30]})),Yi(f,"mouseover",ce),Yi(f,"focus",de),Yi(f,"click",Ws(ye)),Yi(f,"keydown",Ws(No(h[86])))],o=!0)},p(Ee,Xe){var ut;h=Ee,Q?Q.p&&(!z||Xe[0]&16777216|Xe[2]&524288)&&kr(Q,F,h,h[81],z?Pr(F,h[81],Xe,xT):zr(h[81]),Wy):H&&H.p&&(!z||Xe[0]&16781312)&&H.p(h,z?Xe:[-1,-1,-1,-1,-1]),w&&Vg(w.update)&&Xe[0]&1090527240&&w.update.call(null,{scroll:h[45](h[125],h[3],h[13]),listDom:h[30]}),S&&Vg(S.update)&&Xe[0]&1610612736&&S.update.call(null,{scroll:h[29]===h[127],listDom:h[30]}),(!z||Xe[0]&16777216)&&Si(y,"list-group-title",h[125].groupHeader),(!z||Xe[0]&16785416|Xe[1]&16384)&&Si(y,"active",h[45](h[125],h[3],h[13])),(!z||Xe[0]&128)&&Si(y,"hover",h[7]===h[127]),(!z||Xe[0]&16777216)&&Si(y,"group-item",h[125].groupItem),(!z||Xe[0]&16777216)&&Si(y,"not-selectable",((ut=h[125])==null?void 0:ut.selectable)===!1)},i(Ee){z||(Bt(H,Ee),z=!0)},o(Ee){Qt(H,Ee),z=!1},d(Ee){Ee&&qe(f),H&&H.d(Ee),o=!1,lc(L)}}}function $y(h){let f;const y=h[82]["list-append"],w=Ir(y,h,h[81],Gy);return{c(){w&&w.c()},l(S){w&&w.l(S)},m(S,k){w&&w.m(S,k),f=!0},p(S,k){w&&w.p&&(!f||k[2]&524288)&&kr(w,y,S,S[81],f?Pr(y,S[81],k,gT):zr(S[81]),Gy)},i(S){f||(Bt(w,S),f=!0)},o(S){Qt(w,S),f=!1},d(S){w&&w.d(S)}}}function Qy(h){let f,y,w,S,k;return{c(){f=kt("span"),y=Zi(h[32]),w=fi(),S=kt("span"),k=Zi(h[31]),this.h()},l(z){f=zt(z,"SPAN",{id:!0,class:!0});var o=Mt(f);y=Wi(o,h[32]),o.forEach(qe),w=pi(z),S=zt(z,"SPAN",{id:!0,class:!0});var L=Mt(S);k=Wi(L,h[31]),L.forEach(qe),this.h()},h(){_e(f,"id","aria-selection"),_e(f,"class","svelte-82qwg8"),_e(S,"id","aria-context"),_e(S,"class","svelte-82qwg8")},m(z,o){ni(z,f,o),Ke(f,y),ni(z,w,o),ni(z,S,o),Ke(S,k)},p(z,o){o[1]&2&&On(y,z[32]),o[1]&1&&On(k,z[31])},d(z){z&&(qe(f),qe(w),qe(S))}}}function e0(h){let f,y,w,S;const k=[CT,AT],z=[];function o(L,F){return L[9]?0:1}return f=o(h),y=z[f]=k[f](h),{c(){y.c(),w=Ar()},l(L){y.l(L),w=Ar()},m(L,F){z[f].m(L,F),ni(L,w,F),S=!0},p(L,F){let Q=f;f=o(L),f===Q?z[f].p(L,F):(Vr(),Qt(z[Q],1,1,()=>{z[Q]=null}),jr(),y=z[f],y?y.p(L,F):(y=z[f]=k[f](L),y.c()),Bt(y,1),y.m(w.parentNode,w))},i(L){S||(Bt(y),S=!0)},o(L){Qt(y),S=!1},d(L){L&&qe(w),z[f].d(L)}}}function AT(h){let f,y;const w=h[82].selection,S=Ir(w,h,h[81],Fy),k=S||IT(h);return{c(){f=kt("div"),k&&k.c(),this.h()},l(z){f=zt(z,"DIV",{class:!0});var o=Mt(f);k&&k.l(o),o.forEach(qe),this.h()},h(){_e(f,"class","selected-item svelte-82qwg8"),Si(f,"hide-selected-item",h[35])},m(z,o){ni(z,f,o),k&&k.m(f,null),y=!0},p(z,o){S?S.p&&(!y||o[0]&8|o[2]&524288)&&kr(S,w,z,z[81],y?Pr(w,z[81],o,fT):zr(z[81]),Fy):k&&k.p&&(!y||o[0]&4104)&&k.p(z,y?o:[-1,-1,-1,-1,-1]),(!y||o[1]&16)&&Si(f,"hide-selected-item",z[35])},i(z){y||(Bt(k,z),y=!0)},o(z){Qt(k,z),y=!1},d(z){z&&qe(f),k&&k.d(z)}}}function CT(h){let f,y,w=Sr(h[3]),S=[];for(let z=0;z<w.length;z+=1)S[z]=i0(Uy(h,w,z));const k=z=>Qt(S[z],1,1,()=>{S[z]=null});return{c(){for(let z=0;z<S.length;z+=1)S[z].c();f=Ar()},l(z){for(let o=0;o<S.length;o+=1)S[o].l(z);f=Ar()},m(z,o){for(let L=0;L<S.length;L+=1)S[L]&&S[L].m(z,o);ni(z,f,o),y=!0},p(z,o){if(o[0]&67116040|o[1]&32|o[2]&524288){w=Sr(z[3]);let L;for(L=0;L<w.length;L+=1){const F=Uy(z,w,L);S[L]?(S[L].p(F,o),Bt(S[L],1)):(S[L]=i0(F),S[L].c(),Bt(S[L],1),S[L].m(f.parentNode,f))}for(Vr(),L=w.length;L<S.length;L+=1)k(L);jr()}},i(z){if(!y){for(let o=0;o<w.length;o+=1)Bt(S[o]);y=!0}},o(z){S=S.filter(Boolean);for(let o=0;o<S.length;o+=1)Qt(S[o]);y=!1},d(z){z&&qe(f),qa(S,z)}}}function IT(h){let f=h[3][h[12]]+"",y;return{c(){y=Zi(f)},l(w){y=Wi(w,f)},m(w,S){ni(w,y,S)},p(w,S){S[0]&4104&&f!==(f=w[3][w[12]]+"")&&On(y,f)},d(w){w&&qe(y)}}}function kT(h){let f=h[125][h[12]]+"",y;return{c(){y=Zi(f)},l(w){y=Wi(w,f)},m(w,S){ni(w,y,S)},p(w,S){S[0]&4104&&f!==(f=w[125][w[12]]+"")&&On(y,f)},d(w){w&&qe(y)}}}function t0(h){let f,y,w,S;const k=h[82]["multi-clear-icon"],z=Ir(k,h,h[81],Ny),o=z||zT();function L(){return h[91](h[127])}return{c(){f=kt("div"),o&&o.c(),this.h()},l(F){f=zt(F,"DIV",{class:!0});var Q=Mt(f);o&&o.l(Q),Q.forEach(qe),this.h()},h(){_e(f,"class","multi-item-clear svelte-82qwg8")},m(F,Q){ni(F,f,Q),o&&o.m(f,null),y=!0,w||(S=Yi(f,"pointerup",Ws(No(L))),w=!0)},p(F,Q){h=F,z&&z.p&&(!y||Q[2]&524288)&&kr(z,k,h,h[81],y?Pr(k,h[81],Q,pT):zr(h[81]),Ny)},i(F){y||(Bt(o,F),y=!0)},o(F){Qt(o,F),y=!1},d(F){F&&qe(f),o&&o.d(F),w=!1,S()}}}function zT(h){let f,y;return f=new Bd({}),{c(){Bo(f.$$.fragment)},l(w){Oo(f.$$.fragment,w)},m(w,S){Fo(f,w,S),y=!0},i(w){y||(Bt(f.$$.fragment,w),y=!0)},o(w){Qt(f.$$.fragment,w),y=!1},d(w){Uo(f,w)}}}function i0(h){let f,y,w,S,k,z,o;const L=h[82].selection,F=Ir(L,h,h[81],Vy),Q=F||kT(h);let H=!h[11]&&!h[10]&&Bd&&t0(h);function ce(){return h[92](h[127])}return{c(){f=kt("div"),y=kt("span"),Q&&Q.c(),w=fi(),H&&H.c(),S=fi(),this.h()},l(de){f=zt(de,"DIV",{class:!0,role:!0});var ye=Mt(f);y=zt(ye,"SPAN",{class:!0});var Ee=Mt(y);Q&&Q.l(Ee),Ee.forEach(qe),w=pi(ye),H&&H.l(ye),S=pi(ye),ye.forEach(qe),this.h()},h(){_e(y,"class","multi-item-text svelte-82qwg8"),_e(f,"class","multi-item svelte-82qwg8"),_e(f,"role","none"),Si(f,"active",h[26]===h[127]),Si(f,"disabled",h[11])},m(de,ye){ni(de,f,ye),Ke(f,y),Q&&Q.m(y,null),Ke(f,w),H&&H.m(f,null),Ke(f,S),k=!0,z||(o=[Yi(f,"click",No(ce)),Yi(f,"keydown",Ws(No(h[84])))],z=!0)},p(de,ye){h=de,F?F.p&&(!k||ye[0]&8|ye[2]&524288)&&kr(F,L,h,h[81],k?Pr(L,h[81],ye,mT):zr(h[81]),Vy):Q&&Q.p&&(!k||ye[0]&4104)&&Q.p(h,k?ye:[-1,-1,-1,-1,-1]),!h[11]&&!h[10]&&Bd?H?(H.p(h,ye),ye[0]&3072&&Bt(H,1)):(H=t0(h),H.c(),Bt(H,1),H.m(f,S)):H&&(Vr(),Qt(H,1,1,()=>{H=null}),jr()),(!k||ye[0]&67108864)&&Si(f,"active",h[26]===h[127]),(!k||ye[0]&2048)&&Si(f,"disabled",h[11])},i(de){k||(Bt(Q,de),Bt(H),k=!0)},o(de){Qt(Q,de),Qt(H),k=!1},d(de){de&&qe(f),Q&&Q.d(de),H&&H.d(),z=!1,lc(o)}}}function n0(h){let f,y;const w=h[82]["loading-icon"],S=Ir(w,h,h[81],Oy),k=S||PT();return{c(){f=kt("div"),k&&k.c(),this.h()},l(z){f=zt(z,"DIV",{class:!0,"aria-hidden":!0});var o=Mt(f);k&&k.l(o),o.forEach(qe),this.h()},h(){_e(f,"class","icon loading svelte-82qwg8"),_e(f,"aria-hidden","true")},m(z,o){ni(z,f,o),k&&k.m(f,null),y=!0},p(z,o){S&&S.p&&(!y||o[2]&524288)&&kr(S,w,z,z[81],y?Pr(w,z[81],o,dT):zr(z[81]),Oy)},i(z){y||(Bt(k,z),y=!0)},o(z){Qt(k,z),y=!1},d(z){z&&qe(f),k&&k.d(z)}}}function PT(h){let f,y;return f=new aT({}),{c(){Bo(f.$$.fragment)},l(w){Oo(f.$$.fragment,w)},m(w,S){Fo(f,w,S),y=!0},i(w){y||(Bt(f.$$.fragment,w),y=!0)},o(w){Qt(f.$$.fragment,w),y=!1},d(w){Uo(f,w)}}}function r0(h){let f,y,w,S;const k=h[82]["clear-icon"],z=Ir(k,h,h[81],By),o=z||DT();return{c(){f=kt("button"),o&&o.c(),this.h()},l(L){f=zt(L,"BUTTON",{type:!0,class:!0});var F=Mt(f);o&&o.l(F),F.forEach(qe),this.h()},h(){_e(f,"type","button"),_e(f,"class","icon clear-select svelte-82qwg8")},m(L,F){ni(L,f,F),o&&o.m(f,null),y=!0,w||(S=Yi(f,"click",h[22]),w=!0)},p(L,F){z&&z.p&&(!y||F[2]&524288)&&kr(z,k,L,L[81],y?Pr(k,L[81],F,hT):zr(L[81]),By)},i(L){y||(Bt(o,L),y=!0)},o(L){Qt(o,L),y=!1},d(L){L&&qe(f),o&&o.d(L),w=!1,S()}}}function DT(h){let f,y;return f=new Bd({}),{c(){Bo(f.$$.fragment)},l(w){Oo(f.$$.fragment,w)},m(w,S){Fo(f,w,S),y=!0},i(w){y||(Bt(f.$$.fragment,w),y=!0)},o(w){Qt(f.$$.fragment,w),y=!1},d(w){Uo(f,w)}}}function o0(h){let f,y;const w=h[82]["chevron-icon"],S=Ir(w,h,h[81],Ry),k=S||LT();return{c(){f=kt("div"),k&&k.c(),this.h()},l(z){f=zt(z,"DIV",{class:!0,"aria-hidden":!0});var o=Mt(f);k&&k.l(o),o.forEach(qe),this.h()},h(){_e(f,"class","icon chevron svelte-82qwg8"),_e(f,"aria-hidden","true")},m(z,o){ni(z,f,o),k&&k.m(f,null),y=!0},p(z,o){S&&S.p&&(!y||o[0]&64|o[2]&524288)&&kr(S,w,z,z[81],y?Pr(w,z[81],o,uT):zr(z[81]),Ry)},i(z){y||(Bt(k,z),y=!0)},o(z){Qt(k,z),y=!1},d(z){z&&qe(f),k&&k.d(z)}}}function LT(h){let f,y;return f=new rT({}),{c(){Bo(f.$$.fragment)},l(w){Oo(f.$$.fragment,w)},m(w,S){Fo(f,w,S),y=!0},i(w){y||(Bt(f.$$.fragment,w),y=!0)},o(w){Qt(f.$$.fragment,w),y=!1},d(w){Uo(f,w)}}}function RT(h){let f,y;return{c(){f=kt("input"),this.h()},l(w){f=zt(w,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){_e(f,"name",h[8]),_e(f,"type","hidden"),f.value=y=h[3]?JSON.stringify(h[3]):null,_e(f,"class","svelte-82qwg8")},m(w,S){ni(w,f,S)},p(w,S){S[0]&256&&_e(f,"name",w[8]),S[0]&8&&y!==(y=w[3]?JSON.stringify(w[3]):null)&&(f.value=y)},d(w){w&&qe(f)}}}function s0(h){let f;const y=h[82].required,w=Ir(y,h,h[81],Dy),S=w||BT();return{c(){S&&S.c()},l(k){S&&S.l(k)},m(k,z){S&&S.m(k,z),f=!0},p(k,z){w&&w.p&&(!f||z[0]&8|z[2]&524288)&&kr(w,y,k,k[81],f?Pr(y,k[81],z,lT):zr(k[81]),Dy)},i(k){f||(Bt(S,k),f=!0)},o(k){Qt(S,k),f=!1},d(k){S&&S.d(k)}}}function BT(h){let f;return{c(){f=kt("select"),this.h()},l(y){f=zt(y,"SELECT",{class:!0,tabindex:!0,"aria-hidden":!0}),Mt(f).forEach(qe),this.h()},h(){_e(f,"class","required svelte-82qwg8"),f.required=!0,_e(f,"tabindex","-1"),_e(f,"aria-hidden","true")},m(y,w){ni(y,f,w)},p:Dn,d(y){y&&qe(f)}}}function OT(h){let f,y,w,S,k,z,o,L,F,Q,H,ce,de,ye,Ee,Xe,ut,at,Ie,ct,ve=h[6]&&Yy(h),Oe=h[2]&&Qy(h);const Ze=h[82].prepend,He=Ir(Ze,h,h[81],jy);let Be=h[25]&&e0(h),Ut=[{readOnly:Q=!h[17]},h[27],{placeholder:h[33]},{style:h[18]},{disabled:h[11]}],Pe={};for(let dt=0;dt<Ut.length;dt+=1)Pe=wv(Pe,Ut[dt]);let tt=h[5]&&n0(h),St=h[34]&&r0(h),Ot=h[20]&&o0(h);const vi=h[82]["input-hidden"],qt=Ir(vi,h,h[81],Ly),ri=qt||RT(h);let je=h[16]&&(!h[3]||h[3].length===0)&&s0(h);return{c(){f=kt("div"),ve&&ve.c(),y=fi(),w=kt("span"),Oe&&Oe.c(),S=fi(),k=kt("div"),He&&He.c(),z=fi(),o=kt("div"),Be&&Be.c(),L=fi(),F=kt("input"),H=fi(),ce=kt("div"),tt&&tt.c(),de=fi(),St&&St.c(),ye=fi(),Ot&&Ot.c(),Ee=fi(),ri&&ri.c(),Xe=fi(),je&&je.c(),this.h()},l(dt){f=zt(dt,"DIV",{class:!0,style:!0,role:!0});var gt=Mt(f);ve&&ve.l(gt),y=pi(gt),w=zt(gt,"SPAN",{"aria-live":!0,"aria-atomic":!0,"aria-relevant":!0,class:!0});var Nt=Mt(w);Oe&&Oe.l(Nt),Nt.forEach(qe),S=pi(gt),k=zt(gt,"DIV",{class:!0});var Ai=Mt(k);He&&He.l(Ai),Ai.forEach(qe),z=pi(gt),o=zt(gt,"DIV",{class:!0});var ti=Mt(o);Be&&Be.l(ti),L=pi(ti),F=zt(ti,"INPUT",{placeholder:!0,style:!0}),ti.forEach(qe),H=pi(gt),ce=zt(gt,"DIV",{class:!0});var Ji=Mt(ce);tt&&tt.l(Ji),de=pi(Ji),St&&St.l(Ji),ye=pi(Ji),Ot&&Ot.l(Ji),Ji.forEach(qe),Ee=pi(gt),ri&&ri.l(gt),Xe=pi(gt),je&&je.l(gt),gt.forEach(qe),this.h()},h(){_e(w,"aria-live","polite"),_e(w,"aria-atomic","false"),_e(w,"aria-relevant","additions text"),_e(w,"class","a11y-text svelte-82qwg8"),_e(k,"class","prepend svelte-82qwg8"),Ng(F,Pe),Si(F,"svelte-82qwg8",!0),_e(o,"class","value-container svelte-82qwg8"),_e(ce,"class","indicators svelte-82qwg8"),_e(f,"class",ut="svelte-select "+h[21]+" svelte-82qwg8"),_e(f,"style",h[14]),_e(f,"role","none"),Si(f,"multi",h[9]),Si(f,"disabled",h[11]),Si(f,"focused",h[2]),Si(f,"list-open",h[6]),Si(f,"show-chevron",h[20]),Si(f,"error",h[15])},m(dt,gt){ni(dt,f,gt),ve&&ve.m(f,null),Ke(f,y),Ke(f,w),Oe&&Oe.m(w,null),Ke(f,S),Ke(f,k),He&&He.m(k,null),Ke(f,z),Ke(f,o),Be&&Be.m(o,null),Ke(o,L),Ke(o,F),F.autofocus&&F.focus(),h[93](F),wd(F,h[4]),Ke(f,H),Ke(f,ce),tt&&tt.m(ce,null),Ke(ce,de),St&&St.m(ce,null),Ke(ce,ye),Ot&&Ot.m(ce,null),Ke(f,Ee),ri&&ri.m(f,null),Ke(f,Xe),je&&je.m(f,null),h[95](f),at=!0,Ie||(ct=[Yi(window,"click",h[42]),Yi(window,"keydown",h[37]),Yi(F,"keydown",h[37]),Yi(F,"blur",h[39]),Yi(F,"focus",h[38]),Yi(F,"input",h[94]),Yi(f,"pointerup",No(h[40])),Yi(f,"mousedown",No(h[83])),Za(h[48].call(null,f))],Ie=!0)},p(dt,gt){dt[6]?ve?(ve.p(dt,gt),gt[0]&64&&Bt(ve,1)):(ve=Yy(dt),ve.c(),Bt(ve,1),ve.m(f,y)):ve&&(Vr(),Qt(ve,1,1,()=>{ve=null}),jr()),dt[2]?Oe?Oe.p(dt,gt):(Oe=Qy(dt),Oe.c(),Oe.m(w,null)):Oe&&(Oe.d(1),Oe=null),He&&He.p&&(!at||gt[2]&524288)&&kr(He,Ze,dt,dt[81],at?Pr(Ze,dt[81],gt,_T):zr(dt[81]),jy),dt[25]?Be?(Be.p(dt,gt),gt[0]&33554432&&Bt(Be,1)):(Be=e0(dt),Be.c(),Bt(Be,1),Be.m(o,L)):Be&&(Vr(),Qt(Be,1,1,()=>{Be=null}),jr()),Ng(F,Pe=Cv(Ut,[(!at||gt[0]&131072&&Q!==(Q=!dt[17]))&&{readOnly:Q},gt[0]&134217728&&dt[27],(!at||gt[1]&4)&&{placeholder:dt[33]},(!at||gt[0]&262144)&&{style:dt[18]},(!at||gt[0]&2048)&&{disabled:dt[11]}])),gt[0]&16&&F.value!==dt[4]&&wd(F,dt[4]),Si(F,"svelte-82qwg8",!0),dt[5]?tt?(tt.p(dt,gt),gt[0]&32&&Bt(tt,1)):(tt=n0(dt),tt.c(),Bt(tt,1),tt.m(ce,de)):tt&&(Vr(),Qt(tt,1,1,()=>{tt=null}),jr()),dt[34]?St?(St.p(dt,gt),gt[1]&8&&Bt(St,1)):(St=r0(dt),St.c(),Bt(St,1),St.m(ce,ye)):St&&(Vr(),Qt(St,1,1,()=>{St=null}),jr()),dt[20]?Ot?(Ot.p(dt,gt),gt[0]&1048576&&Bt(Ot,1)):(Ot=o0(dt),Ot.c(),Bt(Ot,1),Ot.m(ce,null)):Ot&&(Vr(),Qt(Ot,1,1,()=>{Ot=null}),jr()),qt?qt.p&&(!at||gt[0]&8|gt[2]&524288)&&kr(qt,vi,dt,dt[81],at?Pr(vi,dt[81],gt,cT):zr(dt[81]),Ly):ri&&ri.p&&(!at||gt[0]&264)&&ri.p(dt,at?gt:[-1,-1,-1,-1,-1]),dt[16]&&(!dt[3]||dt[3].length===0)?je?(je.p(dt,gt),gt[0]&65544&&Bt(je,1)):(je=s0(dt),je.c(),Bt(je,1),je.m(f,null)):je&&(Vr(),Qt(je,1,1,()=>{je=null}),jr()),(!at||gt[0]&2097152&&ut!==(ut="svelte-select "+dt[21]+" svelte-82qwg8"))&&_e(f,"class",ut),(!at||gt[0]&16384)&&_e(f,"style",dt[14]),(!at||gt[0]&2097664)&&Si(f,"multi",dt[9]),(!at||gt[0]&2099200)&&Si(f,"disabled",dt[11]),(!at||gt[0]&2097156)&&Si(f,"focused",dt[2]),(!at||gt[0]&2097216)&&Si(f,"list-open",dt[6]),(!at||gt[0]&3145728)&&Si(f,"show-chevron",dt[20]),(!at||gt[0]&2129920)&&Si(f,"error",dt[15])},i(dt){at||(Bt(ve),Bt(He,dt),Bt(Be),Bt(tt),Bt(St),Bt(Ot),Bt(ri,dt),Bt(je),at=!0)},o(dt){Qt(ve),Qt(He,dt),Qt(Be),Qt(tt),Qt(St),Qt(Ot),Qt(ri,dt),Qt(je),at=!1},d(dt){dt&&qe(f),ve&&ve.d(),Oe&&Oe.d(),He&&He.d(dt),Be&&Be.d(),h[93](null),tt&&tt.d(),St&&St.d(),Ot&&Ot.d(),ri&&ri.d(dt),je&&je.d(),h[95](null),Ie=!1,lc(ct)}}}function a0(h){return h.map((f,y)=>({index:y,value:f,label:`${f}`}))}function FT(h){return h===0}function UT(h){return h.groupHeader&&h.selectable||h.selectable||!h.hasOwnProperty("selectable")}function NT(h,f,y){let w,S,k,z,o,L,F,Q,H,{$$slots:ce={},$$scope:de}=f;const ye=Tv(ce),Ee=Ev();let{justValue:Xe=null}=f,{filter:ut=tT}=f,{getItems:at=iT}=f,{id:Ie=null}=f,{name:ct=null}=f,{container:ve=void 0}=f,{input:Oe=void 0}=f,{multiple:Ze=!1}=f,{multiFullItemClearable:He=!1}=f,{disabled:Be=!1}=f,{focused:Ut=!1}=f,{value:Pe=null}=f,{filterText:tt=""}=f,{placeholder:St="Please select"}=f,{placeholderAlwaysShow:Ot=!1}=f,{items:vi=null}=f,{label:qt="label"}=f,{itemFilter:ri=(ae,rt,hi)=>`${ae}`.toLowerCase().includes(rt.toLowerCase())}=f,{groupBy:je=void 0}=f,{groupFilter:dt=ae=>ae}=f,{groupHeaderSelectable:gt=!1}=f,{itemId:Nt="value"}=f,{loadOptions:Ai=void 0}=f,{containerStyles:ti=""}=f,{hasError:Ji=!1}=f,{filterSelectedItems:vn=!0}=f,{required:An=!1}=f,{closeListOnChange:Mn=!0}=f,{createGroupHeaderItem:$n=(ae,rt)=>({value:ae,[qt]:ae})}=f;const xt=()=>F;let{searchable:Ft=!0}=f,{inputStyles:vt=""}=f,{clearable:lt=!0}=f,{loading:ci=!1}=f,{listOpen:At=!1}=f,ei,{debounce:bi=(ae,rt=1)=>{clearTimeout(ei),ei=setTimeout(ae,rt)}}=f,{debounceWait:tn=300}=f,{hideEmptyState:$i=!1}=f,{inputAttributes:Ci={}}=f,{listAutoWidth:lr=!0}=f,{showChevron:fr=!1}=f,{listOffset:Dr=5}=f,{hoverItemIndex:gi=0}=f,{floatingConfig:Cn={}}=f,{class:no=""}=f,Ei,Et,Zt,Qi;function dn(){if(typeof Pe=="string"){let ae=(vi||[]).find(rt=>rt[Nt]===Pe);y(3,Pe=ae||{[Nt]:Pe,label:Pe})}else Ze&&Array.isArray(Pe)&&Pe.length>0&&y(3,Pe=Pe.map(ae=>typeof ae=="string"?{value:ae,label:ae}:ae))}let nn;function Xn(){y(27,nn=Object.assign({autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:!1,tabindex:0,type:"text","aria-autocomplete":"list"},Ci)),Ie&&y(27,nn.id=Ie,nn),Ft||y(27,nn.readonly=!0,nn)}function bn(ae){const rt=[],hi={};ae.forEach(Qn=>{const cn=je(Qn);rt.includes(cn)||(rt.push(cn),hi[cn]=[],cn&&hi[cn].push(Object.assign($n(cn,Qn),{id:cn,groupHeader:!0,selectable:gt}))),hi[cn].push(Object.assign({groupItem:!!cn},Qn))});const Kn=[];return dt(rt).forEach(Qn=>{hi[Qn]&&Kn.push(...hi[Qn])}),Kn}function cr(){if(Ze){JSON.stringify(Pe)!==JSON.stringify(Et)&&se()&&Ee("input",Pe);return}(!Et||JSON.stringify(Pe[Nt])!==JSON.stringify(Et[Nt]))&&Ee("input",Pe)}function pr(){Pe&&(Array.isArray(Pe)?y(3,Pe=[...Pe]):y(3,Pe=[Pe]))}function mr(){Pe&&y(3,Pe=null)}function Lr(){const ae=F.findIndex(rt=>rt[Nt]===Pe[Nt]);te(ae,!0)}function qr(ae){Ee("hoverItem",ae)}function te(ae=0,rt){y(7,gi=ae<0?0:ae),!rt&&je&&F[gi]&&!F[gi].selectable&&ui(1)}function U(){!Ai&&tt.length===0||(Ai?bi(async function(){y(5,ci=!0);let ae=await at({dispatch:Ee,loadOptions:Ai,convertStringItemsToObjects:a0,filterText:tt});ae?(y(5,ci=ae.loading),y(6,At=At?ae.listOpen:tt.length>0),y(2,Ut=At&&ae.focused),y(51,vi=je?bn(ae.filteredItems):ae.filteredItems)):(y(5,ci=!1),y(2,Ut=!0),y(6,At=!0))},tn):(y(6,At=!0),Ze&&y(26,Ei=void 0)))}function N(ae){At&&Ee("filter",ae)}Mv(async()=>{y(77,Et=Pe),y(78,Zt=tt),y(79,Qi=Ze)});function ee(){return Ze?Pe?Pe.map(ae=>ae[Nt]):null:Pe&&Pe[Nt]}function se(){let ae=!0;if(Pe){const rt=[],hi=[];Pe.forEach(Kn=>{rt.includes(Kn[Nt])?ae=!1:(rt.push(Kn[Nt]),hi.push(Kn))}),ae||y(3,Pe=hi)}return ae}function fe(ae){let rt=ae?ae[Nt]:Pe[Nt];return vi.find(hi=>hi[Nt]===rt)}function be(ae){!ae||ae.length===0||ae.some(rt=>typeof rt!="object")||!Pe||(Ze?Pe.some(rt=>!rt||!rt[Nt]):!Pe[Nt])||(Array.isArray(Pe)?y(3,Pe=Pe.map(rt=>fe(rt)||rt)):y(3,Pe=fe()||Pe))}async function xe(ae){const rt=Pe[ae];Pe.length===1?y(3,Pe=void 0):y(3,Pe=Pe.filter(hi=>hi!==rt)),Ee("clear",rt)}function pe(ae){if(Ut)switch(ae.stopPropagation(),ae.key){case"Escape":ae.preventDefault(),Vt();break;case"Enter":if(ae.preventDefault(),At){if(F.length===0)break;const rt=F[gi];if(Pe&&!Ze&&Pe[Nt]===rt[Nt]){Vt();break}else Zr(F[gi])}break;case"ArrowDown":ae.preventDefault(),At?ui(1):(y(6,At=!0),y(26,Ei=void 0));break;case"ArrowUp":ae.preventDefault(),At?ui(-1):(y(6,At=!0),y(26,Ei=void 0));break;case"Tab":if(At&&Ut){if(F.length===0||Pe&&Pe[Nt]===F[gi][Nt])return Vt();ae.preventDefault(),Zr(F[gi]),Vt()}break;case"Backspace":if(!Ze||tt.length>0)return;if(Ze&&Pe&&Pe.length>0){if(xe(Ei!==void 0?Ei:Pe.length-1),Ei===0||Ei===void 0)break;y(26,Ei=Pe.length>Ei?Ei-1:void 0)}break;case"ArrowLeft":if(!Pe||!Ze||tt.length>0)return;Ei===void 0?y(26,Ei=Pe.length-1):Pe.length>Ei&&Ei!==0&&y(26,Ei-=1);break;case"ArrowRight":if(!Pe||!Ze||tt.length>0||Ei===void 0)return;Ei===Pe.length-1?y(26,Ei=void 0):Ei<Pe.length-1&&y(26,Ei+=1);break}}function Ce(ae){Ut&&Oe===(document==null?void 0:document.activeElement)||(ae&&Ee("focus",ae),Oe.focus(),y(2,Ut=!0))}async function nt(ae){Sn||(At||Ut)&&(Ee("blur",ae),Vt(),y(2,Ut=!1),y(26,Ei=void 0),Oe.blur())}function ht(){Be||y(6,At=!At)}function et(){Ee("clear",Pe),y(3,Pe=void 0),Vt(),Ce()}Xp(()=>{At&&y(2,Ut=!0),Ut&&Oe&&Oe.focus()});function Wt(ae){if(ae){y(4,tt="");const rt=Object.assign({},ae);if(rt.groupHeader&&!rt.selectable)return;y(3,Pe=Ze?Pe?Pe.concat([rt]):[rt]:y(3,Pe=rt)),setTimeout(()=>{Mn&&Vt(),y(26,Ei=void 0),Ee("change",Pe),Ee("select",ae)})}}function Vt(){y(4,tt=""),y(6,At=!1)}let{ariaValues:jt=ae=>`Option ${ae}, selected.`}=f,{ariaListOpen:Kt=(ae,rt)=>`You are currently focused on option ${ae}. There are ${rt} results available.`}=f,{ariaFocused:oi=()=>"Select is focused, type to refine list, press down to open the menu."}=f;function Gi(ae){let rt;return ae&&Pe.length>0?rt=Pe.map(hi=>hi[qt]).join(", "):rt=Pe[qt],jt(rt)}function rn(){if(!F||F.length===0)return"";let ae=F[gi];if(At&&ae){let rt=F?F.length:0;return Kt(ae[qt],rt)}else return oi()}let Mi=null,on;function ur(){clearTimeout(on),on=setTimeout(()=>{Sn=!1},100)}function wn(ae){!At&&!Ut&&ve&&!ve.contains(ae.target)&&!(Mi!=null&&Mi.contains(ae.target))&&nt()}d0(()=>{Mi==null||Mi.remove()});let Sn=!1;function Zr(ae){!ae||ae.selectable===!1||Wt(ae)}function Ks(ae){Sn||y(7,gi=ae)}function Js(ae){const{item:rt,i:hi}=ae;if((rt==null?void 0:rt.selectable)!==!1){if(Pe&&!Ze&&Pe[Nt]===rt[Nt])return Vt();UT(rt)&&(y(7,gi=hi),Zr(rt))}}function ui(ae){if(F.filter(Kn=>!Object.hasOwn(Kn,"selectable")||Kn.selectable===!0).length===0)return y(7,gi=0);ae>0&&gi===F.length-1?y(7,gi=0):ae<0&&gi===0?y(7,gi=F.length-1):y(7,gi=gi+ae);const hi=F[gi];if(hi&&hi.selectable===!1){(ae===1||ae===-1)&&ui(ae);return}}function $s(ae,rt,hi){if(!Ze)return rt&&rt[hi]===ae[hi]}const Zo=Wo,Qs=Wo;function Wo(ae){return{update(rt){rt.scroll&&(ur(),ae.scrollIntoView({behavior:"auto",block:"nearest"}))}}}function _r(){const{width:ae}=ve.getBoundingClientRect();y(23,Mi.style.width=lr?ae+"px":"auto",Mi)}let Hn={strategy:"absolute",placement:"bottom-start",middleware:[D2(Dr),z2(),L2()],autoUpdate:!1};const[ea,ta,ro]=eT(Hn);let hr=!0;function Xo(ae,rt){if(!ae||!rt)return y(28,hr=!0);setTimeout(()=>{y(28,hr=!1)},0)}function Le(ae){_d.call(this,h,ae)}function Rr(ae){_d.call(this,h,ae)}function sn(ae){_d.call(this,h,ae)}function Tn(ae){_d.call(this,h,ae)}const Qa=ae=>Ks(ae),gr=ae=>Ks(ae),ia=(ae,rt)=>Js({item:ae,i:rt});function el(ae){Vo[ae?"unshift":"push"](()=>{Mi=ae,y(23,Mi)})}const Eo=ae=>xe(ae),pt=ae=>He?xe(ae):{};function ai(ae){Vo[ae?"unshift":"push"](()=>{Oe=ae,y(1,Oe)})}function ii(){tt=this.value,y(4,tt)}function Yn(ae){Vo[ae?"unshift":"push"](()=>{ve=ae,y(0,ve)})}return h.$$set=ae=>{"justValue"in ae&&y(52,Xe=ae.justValue),"filter"in ae&&y(53,ut=ae.filter),"getItems"in ae&&y(54,at=ae.getItems),"id"in ae&&y(55,Ie=ae.id),"name"in ae&&y(8,ct=ae.name),"container"in ae&&y(0,ve=ae.container),"input"in ae&&y(1,Oe=ae.input),"multiple"in ae&&y(9,Ze=ae.multiple),"multiFullItemClearable"in ae&&y(10,He=ae.multiFullItemClearable),"disabled"in ae&&y(11,Be=ae.disabled),"focused"in ae&&y(2,Ut=ae.focused),"value"in ae&&y(3,Pe=ae.value),"filterText"in ae&&y(4,tt=ae.filterText),"placeholder"in ae&&y(56,St=ae.placeholder),"placeholderAlwaysShow"in ae&&y(57,Ot=ae.placeholderAlwaysShow),"items"in ae&&y(51,vi=ae.items),"label"in ae&&y(12,qt=ae.label),"itemFilter"in ae&&y(58,ri=ae.itemFilter),"groupBy"in ae&&y(59,je=ae.groupBy),"groupFilter"in ae&&y(60,dt=ae.groupFilter),"groupHeaderSelectable"in ae&&y(61,gt=ae.groupHeaderSelectable),"itemId"in ae&&y(13,Nt=ae.itemId),"loadOptions"in ae&&y(62,Ai=ae.loadOptions),"containerStyles"in ae&&y(14,ti=ae.containerStyles),"hasError"in ae&&y(15,Ji=ae.hasError),"filterSelectedItems"in ae&&y(63,vn=ae.filterSelectedItems),"required"in ae&&y(16,An=ae.required),"closeListOnChange"in ae&&y(64,Mn=ae.closeListOnChange),"createGroupHeaderItem"in ae&&y(65,$n=ae.createGroupHeaderItem),"searchable"in ae&&y(17,Ft=ae.searchable),"inputStyles"in ae&&y(18,vt=ae.inputStyles),"clearable"in ae&&y(67,lt=ae.clearable),"loading"in ae&&y(5,ci=ae.loading),"listOpen"in ae&&y(6,At=ae.listOpen),"debounce"in ae&&y(68,bi=ae.debounce),"debounceWait"in ae&&y(69,tn=ae.debounceWait),"hideEmptyState"in ae&&y(19,$i=ae.hideEmptyState),"inputAttributes"in ae&&y(70,Ci=ae.inputAttributes),"listAutoWidth"in ae&&y(71,lr=ae.listAutoWidth),"showChevron"in ae&&y(20,fr=ae.showChevron),"listOffset"in ae&&y(72,Dr=ae.listOffset),"hoverItemIndex"in ae&&y(7,gi=ae.hoverItemIndex),"floatingConfig"in ae&&y(73,Cn=ae.floatingConfig),"class"in ae&&y(21,no=ae.class),"ariaValues"in ae&&y(74,jt=ae.ariaValues),"ariaListOpen"in ae&&y(75,Kt=ae.ariaListOpen),"ariaFocused"in ae&&y(76,oi=ae.ariaFocused),"$$scope"in ae&&y(81,de=ae.$$scope)},h.$$.update=()=>{h.$$.dirty[0]&8|h.$$.dirty[1]&1048576&&Pe&&dn(),h.$$.dirty[0]&131072|h.$$.dirty[2]&256&&(Ci||!Ft)&&Xn(),h.$$.dirty[0]&512&&Ze&&pr(),h.$$.dirty[0]&512|h.$$.dirty[2]&131072&&Qi&&!Ze&&mr(),h.$$.dirty[0]&520&&Ze&&Pe&&Pe.length>1&&se(),h.$$.dirty[0]&8&&Pe&&cr(),h.$$.dirty[0]&520|h.$$.dirty[2]&32768&&!Pe&&Ze&&Et&&Ee("input",Pe),h.$$.dirty[0]&6&&!Ut&&Oe&&Vt(),h.$$.dirty[0]&16|h.$$.dirty[2]&65536&&tt!==Zt&&U(),h.$$.dirty[0]&12824|h.$$.dirty[1]&407896064|h.$$.dirty[2]&3&&y(24,F=ut({loadOptions:Ai,filterText:tt,items:vi,multiple:Ze,value:Pe,itemId:Nt,groupBy:je,label:qt,filterSelectedItems:vn,itemFilter:ri,convertStringItemsToObjects:a0,filterGroupedItems:bn})),h.$$.dirty[0]&16777800&&!Ze&&At&&Pe&&F&&Lr(),h.$$.dirty[0]&576&&At&&Ze&&y(7,gi=0),h.$$.dirty[0]&16&&tt&&y(7,gi=0),h.$$.dirty[0]&128&&qr(gi),h.$$.dirty[0]&520&&y(25,w=Ze?Pe&&Pe.length>0:Pe),h.$$.dirty[0]&33554448&&y(35,S=w&&tt.length>0),h.$$.dirty[0]&33556512|h.$$.dirty[2]&32&&y(34,k=w&&lt&&!Be&&!ci),h.$$.dirty[0]&520|h.$$.dirty[1]&100663296&&y(33,z=Ot&&Ze||Ze&&(Pe==null?void 0:Pe.length)===0?St:Pe?"":St),h.$$.dirty[0]&520&&y(32,o=Pe?Gi(Ze):""),h.$$.dirty[0]&16777412&&y(31,L=rn()),h.$$.dirty[1]&1048576&&be(vi),h.$$.dirty[0]&8712&&y(52,Xe=ee()),h.$$.dirty[0]&520|h.$$.dirty[2]&32768&&!Ze&&Et&&!Pe&&Ee("input",Pe),h.$$.dirty[0]&16777800&&At&&F&&!Ze&&!Pe&&te(),h.$$.dirty[0]&16777216&&N(F),h.$$.dirty[0]&1|h.$$.dirty[2]&2048&&ve&&(Cn==null?void 0:Cn.autoUpdate)===void 0&&y(80,Hn.autoUpdate=!0,Hn),h.$$.dirty[0]&1|h.$$.dirty[2]&264192&&ve&&Cn&&ro(Object.assign(Hn,Cn)),h.$$.dirty[0]&8388608&&y(30,Q=!!Mi),h.$$.dirty[0]&8388672&&Xo(Mi,At),h.$$.dirty[0]&8388673&&At&&ve&&Mi&&_r(),h.$$.dirty[0]&128&&y(29,H=gi),h.$$.dirty[0]&70&&Oe&&At&&!Ut&&Ce()},[ve,Oe,Ut,Pe,tt,ci,At,gi,ct,Ze,He,Be,qt,Nt,ti,Ji,An,Ft,vt,$i,fr,no,et,Mi,F,w,Ei,nn,hr,H,Q,L,o,z,k,S,xe,pe,Ce,nt,ht,ur,wn,Ks,Js,$s,Zo,Qs,ea,ta,ye,vi,Xe,ut,at,Ie,St,Ot,ri,je,dt,gt,Ai,vn,Mn,$n,xt,lt,bi,tn,Ci,lr,Dr,Cn,jt,Kt,oi,Et,Zt,Qi,Hn,de,ce,Le,Rr,sn,Tn,Qa,gr,ia,el,Eo,pt,ai,ii,Yn]}class W0 extends ms{constructor(f){super(),_s(this,f,NT,OT,ps,{justValue:52,filter:53,getItems:54,id:55,name:8,container:0,input:1,multiple:9,multiFullItemClearable:10,disabled:11,focused:2,value:3,filterText:4,placeholder:56,placeholderAlwaysShow:57,items:51,label:12,itemFilter:58,groupBy:59,groupFilter:60,groupHeaderSelectable:61,itemId:13,loadOptions:62,containerStyles:14,hasError:15,filterSelectedItems:63,required:16,closeListOnChange:64,createGroupHeaderItem:65,getFilteredItems:66,searchable:17,inputStyles:18,clearable:67,loading:5,listOpen:6,debounce:68,debounceWait:69,hideEmptyState:19,inputAttributes:70,listAutoWidth:71,showChevron:20,listOffset:72,hoverItemIndex:7,floatingConfig:73,class:21,handleClear:22,ariaValues:74,ariaListOpen:75,ariaFocused:76},null,[-1,-1,-1,-1,-1])}get getFilteredItems(){return this.$$.ctx[66]}get handleClear(){return this.$$.ctx[22]}}new TextEncoder;function VT(h){let f,y=`<svg width="16" height="16" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M47.6745 12.5486C47.8972 12.8454 48 13.1771 48 13.5436C48 13.9102 47.8972 14.207 47.6745 14.4339L24.9764 37.6683C24.6852 37.8953 24.3597 38 24 38C23.6403 38 23.349 37.8953 23.1263 37.6683L0.325482 14.4339C0.102784 14.207 0 13.9102 0 13.5436C0 13.1771 0.102784 12.8454 0.325482 12.5486L2.50107 10.3317C2.70664 10.1047 2.99786 10 3.37473 10C3.75161 10 4.05996 10.1047 4.35118 10.3317L24.0171 30.3716L43.666 10.3317C43.9572 10.1047 44.2827 10 44.6424 10C45.0021 10 45.2934 10.1047 45.5161 10.3317L47.6745 12.5486Z" fill="${u2}"></path></svg>`;return{c(){f=kt("div"),f.innerHTML=y,this.h()},l(w){f=zt(w,"DIV",{slot:!0,"data-svelte-h":!0}),Xs(f)!=="svelte-1xytim"&&(f.innerHTML=y),this.h()},h(){_e(f,"slot","chevron-icon")},m(w,S){ni(w,f,S)},p:Dn,d(w){w&&qe(f)}}}function jT(h){let f,y,w,S,k,z,o,L=`<div class="legend-row svelte-zlr1hm"><span class="legend-symbol"><svg width="12" height="12"><circle cx="6" cy="6" r="5" fill="${om}"></circle></svg></span> <span class="legend-name svelte-zlr1hm">Schools</span></div> <div class="legend-row svelte-zlr1hm"><span class="legend-symbol"><svg width="12" height="12"><circle cx="6" cy="6" r="5" fill="${qp}"></circle></svg></span> <span class="legend-name svelte-zlr1hm">Shootings</span></div>`,F;return y=new W0({props:{items:h[0],class:"school-dropdown",clearable:!1,placeholder:"Choose a school",containerStyles:"height: 5px !important;",showChevron:!0,$$slots:{"chevron-icon":[VT]},$$scope:{ctx:h}}}),y.$on("change",h[2]),{c(){f=kt("div"),Bo(y.$$.fragment),w=fi(),S=kt("div"),k=kt("div"),z=fi(),o=kt("div"),o.innerHTML=L,this.h()},l(Q){f=zt(Q,"DIV",{class:!0});var H=Mt(f);Oo(y.$$.fragment,H),w=pi(H),S=zt(H,"DIV",{class:!0});var ce=Mt(S);k=zt(ce,"DIV",{class:!0}),Mt(k).forEach(qe),z=pi(ce),o=zt(ce,"DIV",{class:!0,"data-svelte-h":!0}),Xs(o)!=="svelte-13f25to"&&(o.innerHTML=L),ce.forEach(qe),H.forEach(qe),this.h()},h(){_e(k,"class","map svelte-zlr1hm"),_e(o,"class","map-legend svelte-zlr1hm"),_e(S,"class","map-wrap"),_e(f,"class","container")},m(Q,H){ni(Q,f,H),Fo(y,f,null),Ke(f,w),Ke(f,S),Ke(S,k),h[4](k),Ke(S,z),Ke(S,o),F=!0},p(Q,[H]){const ce={};H&1&&(ce.items=Q[0]),H&131072&&(ce.$$scope={dirty:H,ctx:Q}),y.$set(ce)},i(Q){F||(Bt(y.$$.fragment,Q),F=!0)},o(Q){Qt(y.$$.fragment,Q),F=!1},d(Q){Q&&qe(f),Uo(y),h[4](null)}}}function GT(h,f,y){const{Map:w,NavigationControl:S,Popup:k,LngLat:z}=b2;let{shootings:o}=f,L;L=[{value:"one",label:"One"},{value:"two",label:"Two"},{value:"three",label:"Three"}];let F,Q,H,ce,de,ye;const Ee=new k({className:"mbPopup",closeButton:!0,offset:10});let Xe=!1;ce=-76.601,de=39.295,ye=8.8;function ut(){let ct=F.querySourceFeatures("composite",{sourceLayer:"spatial_school_list-5xwcm0"}).map(ve=>({value:ve.properties.school_name,label:Pp(ve.properties.school_name)})).sort((ve,Oe)=>{const Ze=ve.value.toUpperCase(),He=Oe.value.toUpperCase();return Ze<He?-1:Ze>He?1:0});y(0,L=ct.filter((ve,Oe,Ze)=>!Oe||ve.value!=Ze[Oe-1].value))}function at(ct){let ve=H.filter(Ze=>Ze.properties.school_name===ct.detail.value)[0];F.easeTo({center:[ve.geometry.coordinates[0],ve.geometry.coordinates[1]+.002],zoom:13});let Oe=new z(ve.geometry.coordinates[0],ve.geometry.coordinates[1]);Ee.setLngLat(Oe).setHTML(Pp(ve.properties.school_name)).addTo(F)}Xp(()=>{const ct={lng:ce,lat:de,zoom:ye};F=new w({container:Q,accessToken:"pk.eyJ1IjoicnlhbmxpdHRsZSIsImEiOiJjbGFiODV2dmcwMWlmM25wcXlrYzlwdzJzIn0.Tc5W4hPge3Q-Ql8EzRzTMw",style:"mapbox://styles/ryanlittle/clnenwitm07y701nsbp2k8b7c",center:[ct.lng,ct.lat],zoom:ct.zoom}),F.addControl(new S({showCompass:!1}),"top-right"),F.on("styledata",()=>{const ve=()=>{!F.isStyleLoaded()||o===[]?setTimeout(ve,200):(H=F.querySourceFeatures("composite",{sourceLayer:"spatial_school_list-5xwcm0"}),F.addSource("source",{type:"geojson",data:{type:"FeatureCollection",features:o},cluster:!0,clusterMaxZoom:13,clusterRadius:20}),Xe=!0,F.addLayer({id:"clusters",type:"circle",source:"source",filter:["has","point_count"],paint:{"circle-color":qp,"circle-radius":["step",["get","point_count"],10,100,15,750,20]}}),F.addLayer({id:"cluster-count",type:"symbol",source:"source",filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),F.addLayer({id:"unclustered-point",type:"circle",source:"source",filter:["!",["has","point_count"]],paint:{"circle-color":qp,"circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),F.on("click","clusters",Oe=>{const Ze=F.queryRenderedFeatures(Oe.point,{layers:["clusters"]}),He=Ze[0].properties.cluster_id;F.getSource("source").getClusterExpansionZoom(He,(Be,Ut)=>{Be||F.easeTo({center:Ze[0].geometry.coordinates,zoom:Ut})})}),F.on("mouseenter","clusters",()=>{F.getCanvas().style.cursor="pointer"}),F.on("mouseleave","clusters",()=>{F.getCanvas().style.cursor=""}),F.on("mouseenter","spatial-school-list-5xwcm0",()=>{F.getCanvas().style.cursor="pointer"}),F.on("mouseleave","spatial-school-list-5xwcm0",()=>{F.getCanvas().style.cursor=""}),F.on("click","spatial-school-list-5xwcm0",Oe=>{const Ze=Oe.features[0];let He=new z(Ze.geometry.coordinates[0],Ze.geometry.coordinates[1]);Ee.setLngLat(He).setHTML(Pp(Ze.properties.school_name)).addTo(F)}),ut())};ve()})}),Sv(()=>{const ct=()=>{Xe===!1?setTimeout(ct,200):F.getSource("source").setData({type:"FeatureCollection",features:o})};ct()});function Ie(ct){Vo[ct?"unshift":"push"](()=>{Q=ct,y(1,Q)})}return h.$$set=ct=>{"shootings"in ct&&y(3,o=ct.shootings)},[L,Q,at,o,Ie]}class qT extends ms{constructor(f){super(),_s(this,f,GT,jT,ps,{shootings:3})}}function l0(h,f,y){return h<f?f:h>y?y:h}function ZT(h){let f,y,w,S,k,z,o,L,F,Q,H,ce,de,ye,Ee,Xe,ut,at,Ie,ct,ve,Oe;return{c(){f=kt("div"),y=kt("div"),w=kt("div"),S=fi(),k=kt("div"),z=fi(),o=kt("div"),L=fi(),F=kt("div"),Q=kt("span"),H=Zi(h[4]),ce=fi(),de=kt("span"),ye=Zi(h[5]),Ee=fi(),Xe=kt("span"),ut=Zi(h[2]),at=fi(),Ie=kt("span"),ct=Zi(h[3]),this.h()},l(Ze){f=zt(Ze,"DIV",{class:!0});var He=Mt(f);y=zt(He,"DIV",{class:!0});var Be=Mt(y);w=zt(Be,"DIV",{class:!0,style:!0}),Mt(w).forEach(qe),S=pi(Be),k=zt(Be,"DIV",{class:!0,"data-which":!0,style:!0}),Mt(k).forEach(qe),z=pi(Be),o=zt(Be,"DIV",{class:!0,"data-which":!0,style:!0}),Mt(o).forEach(qe),Be.forEach(qe),He.forEach(qe),L=pi(Ze),F=zt(Ze,"DIV",{class:!0});var Ut=Mt(F);Q=zt(Ut,"SPAN",{class:!0,style:!0});var Pe=Mt(Q);H=Wi(Pe,h[4]),Pe.forEach(qe),ce=pi(Ut),de=zt(Ut,"SPAN",{class:!0,style:!0});var tt=Mt(de);ye=Wi(tt,h[5]),tt.forEach(qe),Ee=pi(Ut),Xe=zt(Ut,"SPAN",{class:!0,style:!0});var St=Mt(Xe);ut=Wi(St,h[2]),St.forEach(qe),at=pi(Ut),Ie=zt(Ut,"SPAN",{class:!0,style:!0});var Ot=Mt(Ie);ct=Wi(Ot,h[3]),Ot.forEach(qe),Ut.forEach(qe),this.h()},h(){_e(w,"class","body svelte-1vo790"),Zn(w,"left",100*h[0]+"%"),Zn(w,"right",100*(1-h[1])+"%"),_e(k,"class","handle svelte-1vo790"),_e(k,"data-which","start"),Zn(k,"left",100*h[0]+"%"),_e(o,"class","handle svelte-1vo790"),_e(o,"data-which","end"),Zn(o,"left",100*h[1]+"%"),_e(y,"class","slider svelte-1vo790"),_e(f,"class","double-range-container svelte-1vo790"),_e(Q,"class","label svelte-1vo790"),Zn(Q,"left","0%"),_e(de,"class","label svelte-1vo790"),Zn(de,"left","100%"),_e(Xe,"class","handleLabel svelte-1vo790"),Zn(Xe,"left",100*h[0]+"%"),_e(Ie,"class","handleLabel svelte-1vo790"),Zn(Ie,"left",100*h[1]+"%"),_e(F,"class","labels svelte-1vo790")},m(Ze,He){ni(Ze,f,He),Ke(f,y),Ke(y,w),h[13](w),Ke(y,S),Ke(y,k),h[14](k),Ke(y,z),Ke(y,o),h[15](y),ni(Ze,L,He),ni(Ze,F,He),Ke(F,Q),Ke(Q,H),Ke(F,ce),Ke(F,de),Ke(de,ye),Ke(F,Ee),Ke(F,Xe),Ke(Xe,ut),Ke(F,at),Ke(F,Ie),Ke(Ie,ct),ve||(Oe=[Za(Dp.call(null,w)),Yi(w,"dragmove",Ws(No(h[10]))),Za(Dp.call(null,k)),Yi(k,"dragmove",Ws(No(h[9]("start")))),Za(Dp.call(null,o)),Yi(o,"dragmove",Ws(No(h[9]("end"))))],ve=!0)},p(Ze,[He]){He&1&&Zn(w,"left",100*Ze[0]+"%"),He&2&&Zn(w,"right",100*(1-Ze[1])+"%"),He&1&&Zn(k,"left",100*Ze[0]+"%"),He&2&&Zn(o,"left",100*Ze[1]+"%"),He&16&&On(H,Ze[4]),He&32&&On(ye,Ze[5]),He&4&&On(ut,Ze[2]),He&1&&Zn(Xe,"left",100*Ze[0]+"%"),He&8&&On(ct,Ze[3]),He&2&&Zn(Ie,"left",100*Ze[1]+"%")},i:Dn,o:Dn,d(Ze){Ze&&(qe(f),qe(L),qe(F)),h[13](null),h[14](null),h[15](null),ve=!1,lc(Oe)}}}function Dp(h){let f,y;function w(z){z.type==="touchstart"&&(z=z.touches[0]),f=z.clientX,y=z.clientY,h.dispatchEvent(new CustomEvent("dragstart",{detail:{x:f,y}})),window.addEventListener("mousemove",S),window.addEventListener("mouseup",k),window.addEventListener("touchmove",S),window.addEventListener("touchend",k)}function S(z){z.type==="touchmove"&&(z=z.changedTouches[0]);const o=z.clientX-f,L=z.clientY-y;f=z.clientX,y=z.clientY,h.dispatchEvent(new CustomEvent("dragmove",{detail:{x:f,y,dx:o,dy:L}}))}function k(z){f=z.clientX,y=z.clientY,h.dispatchEvent(new CustomEvent("dragend",{detail:{x:f,y}})),window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",k),window.removeEventListener("touchmove",S),window.removeEventListener("touchend",k)}return h.addEventListener("mousedown",w),h.addEventListener("touchstart",w),{destroy(){h.removeEventListener("mousedown",w),h.removeEventListener("touchstart",w)}}}function WT(h,f,y){let{start:w=0}=f,{end:S=1}=f,{leftLabel:k}=f,{rightLabel:z}=f,{leftRange:o}=f,{rightRange:L}=f,{leftLimit:F}=f,{rightLimit:Q}=f,H,ce,de;function ye(Ie){return function(ct){const{left:ve,right:Oe}=de.getBoundingClientRect(),Ze=Oe-ve,He=Math.min(Math.max((ct.detail.x-ve)/Ze,0),1);Ie==="start"?(y(0,w=He),y(1,S=Math.max(S,He))):(y(0,w=Math.min(He,w)),y(1,S=He))}}function Ee(Ie){const{width:ct}=ce.getBoundingClientRect(),{left:ve,right:Oe}=de.getBoundingClientRect(),Ze=Oe-ve,He=H.getBoundingClientRect().left,Be=l0(He+event.detail.dx-ve,0,Ze-ct),Ut=l0(Be+ct,ct,Ze),Pe=Be/Ze,tt=Ut/Ze;y(0,w=Pe),y(1,S=tt)}function Xe(Ie){Vo[Ie?"unshift":"push"](()=>{ce=Ie,y(7,ce)})}function ut(Ie){Vo[Ie?"unshift":"push"](()=>{H=Ie,y(6,H)})}function at(Ie){Vo[Ie?"unshift":"push"](()=>{de=Ie,y(8,de)})}return h.$$set=Ie=>{"start"in Ie&&y(0,w=Ie.start),"end"in Ie&&y(1,S=Ie.end),"leftLabel"in Ie&&y(2,k=Ie.leftLabel),"rightLabel"in Ie&&y(3,z=Ie.rightLabel),"leftRange"in Ie&&y(4,o=Ie.leftRange),"rightRange"in Ie&&y(5,L=Ie.rightRange),"leftLimit"in Ie&&y(11,F=Ie.leftLimit),"rightLimit"in Ie&&y(12,Q=Ie.rightLimit)},[w,S,k,z,o,L,H,ce,de,ye,Ee,F,Q,Xe,ut,at]}class XT extends ms{constructor(f){super(),_s(this,f,WT,ZT,ps,{start:0,end:1,leftLabel:2,rightLabel:3,leftRange:4,rightRange:5,leftLimit:11,rightLimit:12})}}function c0(h,f,y){const w=h.slice();return w[11]=f[y],w}function HT(h){let f,y,w,S,k,z=Sr(h[3]),o=[];for(let L=0;L<z.length;L+=1)o[L]=u0(c0(h,z,L));return{c(){f=kt("div"),y=kt("div"),w=kt("div"),S=Zi(h[1]),k=fi();for(let L=0;L<o.length;L+=1)o[L].c();this.h()},l(L){f=zt(L,"DIV",{class:!0});var F=Mt(f);y=zt(F,"DIV",{role:!0,class:!0,"aria-labelledby":!0,style:!0,id:!0});var Q=Mt(y);w=zt(Q,"DIV",{class:!0,id:!0});var H=Mt(w);S=Wi(H,h[1]),H.forEach(qe),k=pi(Q);for(let ce=0;ce<o.length;ce+=1)o[ce].l(Q);Q.forEach(qe),F.forEach(qe),this.h()},h(){_e(w,"class","legend"),_e(w,"id",`label-${h[6]}`),_e(y,"role","radiogroup"),_e(y,"class","group-container svelte-1ch3xff"),_e(y,"aria-labelledby",`label-${h[6]}`),Zn(y,"font-size",h[4]+"px"),_e(y,"id",`group-${h[6]}`),_e(f,"class","s s--multi svelte-1ch3xff")},m(L,F){ni(L,f,F),Ke(f,y),Ke(y,w),Ke(w,S),Ke(y,k);for(let Q=0;Q<o.length;Q+=1)o[Q]&&o[Q].m(y,null)},p(L,F){if(F&2&&On(S,L[1]),F&73){z=Sr(L[3]);let Q;for(Q=0;Q<z.length;Q+=1){const H=c0(L,z,Q);o[Q]?o[Q].p(H,F):(o[Q]=u0(H),o[Q].c(),o[Q].m(y,null))}for(;Q<o.length;Q+=1)o[Q].d(1);o.length=z.length}F&16&&Zn(y,"font-size",L[4]+"px")},d(L){L&&qe(f),qa(o,L)}}}function YT(h){let f,y,w,S,k,z,o;return{c(){f=kt("div"),y=kt("span"),w=Zi(h[1]),S=fi(),k=kt("button"),this.h()},l(L){f=zt(L,"DIV",{class:!0,style:!0});var F=Mt(f);y=zt(F,"SPAN",{id:!0});var Q=Mt(y);w=Wi(Q,h[1]),Q.forEach(qe),S=pi(F),k=zt(F,"BUTTON",{role:!0,"aria-checked":!0,"aria-labelledby":!0,class:!0});var H=Mt(k);H.forEach(qe),F.forEach(qe),this.h()},h(){_e(y,"id",`switch-${h[6]}`),_e(k,"role","switch"),_e(k,"aria-checked",h[5]),_e(k,"aria-labelledby",`switch-${h[6]}`),_e(k,"class","svelte-1ch3xff"),_e(f,"class","s s--slider svelte-1ch3xff"),Zn(f,"font-size",h[4]+"px")},m(L,F){ni(L,f,F),Ke(f,y),Ke(y,w),Ke(f,S),Ke(f,k),z||(o=Yi(k,"click",h[7]),z=!0)},p(L,F){F&2&&On(w,L[1]),F&32&&_e(k,"aria-checked",L[5]),F&16&&Zn(f,"font-size",L[4]+"px")},d(L){L&&qe(f),z=!1,o()}}}function KT(h){let f,y,w,S,k,z,o="on",L,F,Q="off",H,ce;return{c(){f=kt("div"),y=kt("span"),w=Zi(h[1]),S=fi(),k=kt("button"),z=kt("span"),z.textContent=o,L=fi(),F=kt("span"),F.textContent=Q,this.h()},l(de){f=zt(de,"DIV",{class:!0});var ye=Mt(f);y=zt(ye,"SPAN",{id:!0,class:!0});var Ee=Mt(y);w=Wi(Ee,h[1]),Ee.forEach(qe),S=pi(ye),k=zt(ye,"BUTTON",{role:!0,"aria-checked":!0,"aria-labelledby":!0,class:!0});var Xe=Mt(k);z=zt(Xe,"SPAN",{class:!0,"data-svelte-h":!0}),Xs(z)!=="svelte-oik0f3"&&(z.textContent=o),L=pi(Xe),F=zt(Xe,"SPAN",{class:!0,"data-svelte-h":!0}),Xs(F)!=="svelte-10sksj5"&&(F.textContent=Q),Xe.forEach(qe),ye.forEach(qe),this.h()},h(){_e(y,"id",`switch-${h[6]}`),_e(y,"class","svelte-1ch3xff"),_e(z,"class","svelte-1ch3xff"),_e(F,"class","svelte-1ch3xff"),_e(k,"role","switch"),_e(k,"aria-checked",h[5]),_e(k,"aria-labelledby",`switch-${h[6]}`),_e(k,"class","svelte-1ch3xff"),_e(f,"class","s s--inner svelte-1ch3xff")},m(de,ye){ni(de,f,ye),Ke(f,y),Ke(y,w),Ke(f,S),Ke(f,k),Ke(k,z),Ke(k,L),Ke(k,F),H||(ce=Yi(k,"click",h[7]),H=!0)},p(de,ye){ye&2&&On(w,de[1]),ye&32&&_e(k,"aria-checked",de[5])},d(de){de&&qe(f),H=!1,ce()}}}function u0(h){let f,y,w,S=!1,k,z,o=h[11]+"",L,F,Q,H,ce,de;return H=Av(h[9][0]),{c(){f=kt("input"),k=fi(),z=kt("label"),L=Zi(o),F=fi(),this.h()},l(ye){f=zt(ye,"INPUT",{type:!0,id:!0,class:!0}),k=pi(ye),z=zt(ye,"LABEL",{for:!0,class:!0});var Ee=Mt(z);L=Wi(Ee,o),F=pi(Ee),Ee.forEach(qe),this.h()},h(){_e(f,"type","radio"),_e(f,"id",y=`${h[11]}-${h[6]}`),f.__value=w=h[11],wd(f,f.__value),_e(f,"class","svelte-1ch3xff"),_e(z,"for",Q=`${h[11]}-${h[6]}`),_e(z,"class","svelte-1ch3xff"),H.p(f)},m(ye,Ee){ni(ye,f,Ee),f.checked=f.__value===h[0],ni(ye,k,Ee),ni(ye,z,Ee),Ke(z,L),Ke(z,F),ce||(de=Yi(f,"change",h[8]),ce=!0)},p(ye,Ee){Ee&8&&y!==(y=`${ye[11]}-${ye[6]}`)&&_e(f,"id",y),Ee&8&&w!==(w=ye[11])&&(f.__value=w,wd(f,f.__value),S=!0),(S||Ee&9)&&(f.checked=f.__value===ye[0]),Ee&8&&o!==(o=ye[11]+"")&&On(L,o),Ee&8&&Q!==(Q=`${ye[11]}-${ye[6]}`)&&_e(z,"for",Q)},d(ye){ye&&(qe(f),qe(k),qe(z)),H.r(),ce=!1,de()}}}function JT(h){let f;function y(k,z){return k[2]=="inner"?KT:k[2]=="slider"?YT:HT}let w=y(h),S=w(h);return{c(){S.c(),f=Ar()},l(k){S.l(k),f=Ar()},m(k,z){S.m(k,z),ni(k,f,z)},p(k,[z]){w===(w=y(k))&&S?S.p(k,z):(S.d(1),S=w(k),S&&(S.c(),S.m(f.parentNode,f)))},i:Dn,o:Dn,d(k){k&&qe(f),S.d(k)}}}function $T(h,f,y){let{label:w}=f,{design:S="inner label"}=f,{options:k=[]}=f,{fontSize:z=16}=f,{value:o="on"}=f,L=!0;const F=Math.floor(Math.random()*100);function Q(de){const Ee=de.target.getAttribute("aria-checked");y(5,L=Ee!=="true"),y(0,o=L===!0?"on":"off")}const H=[[]];function ce(){o=this.__value,y(0,o)}return h.$$set=de=>{"label"in de&&y(1,w=de.label),"design"in de&&y(2,S=de.design),"options"in de&&y(3,k=de.options),"fontSize"in de&&y(4,z=de.fontSize),"value"in de&&y(0,o=de.value)},[o,w,S,k,z,L,F,Q,ce,H]}class QT extends ms{constructor(f){super(),_s(this,f,$T,JT,ps,{label:1,design:2,options:3,fontSize:4,value:0})}}function eE(h){let f,y=`<svg width="12" height="12" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M47.6745 12.5486C47.8972 12.8454 48 13.1771 48 13.5436C48 13.9102 47.8972 14.207 47.6745 14.4339L24.9764 37.6683C24.6852 37.8953 24.3597 38 24 38C23.6403 38 23.349 37.8953 23.1263 37.6683L0.325482 14.4339C0.102784 14.207 0 13.9102 0 13.5436C0 13.1771 0.102784 12.8454 0.325482 12.5486L2.50107 10.3317C2.70664 10.1047 2.99786 10 3.37473 10C3.75161 10 4.05996 10.1047 4.35118 10.3317L24.0171 30.3716L43.666 10.3317C43.9572 10.1047 44.2827 10 44.6424 10C45.0021 10 45.2934 10.1047 45.5161 10.3317L47.6745 12.5486Z" fill="${om}"></path></svg>`;return{c(){f=kt("div"),f.innerHTML=y,this.h()},l(w){f=zt(w,"DIV",{slot:!0,"data-svelte-h":!0}),Xs(f)!=="svelte-apxine"&&(f.innerHTML=y),this.h()},h(){_e(f,"slot","chevron-icon")},m(w,S){ni(w,f,S)},p:Dn,d(w){w&&qe(f)}}}function tE(h){let f,y,w,S=eo(h[0],h[3],h[2])+"",k,z,o=eo(h[1],h[3],h[2])+"",L,F,Q,H,ce,de,ye,Ee,Xe,ut,at="date",Ie,ct,ve,Oe,Ze,He,Be,Ut,Pe,tt,St,Ot,vi,qt,ri,je,dt,gt,Nt,Ai,ti,Ji,vn,An,Mn,$n,xt,Ft,vt="location",lt,ci,At,ei,bi,tn,$i,Ci,lr,fr;de=new W0({props:{items:h[11],class:"victim-dropdown",clearable:!1,containerStyles:`height: 18px !important; line-height: 10px !important; font-weight: 800 !important; padding: 0 4px !important; margin-right: 6px !important; background-color: ${z0}; border: none;`,value:h[6],showChevron:!0,searchable:!1,$$slots:{"chevron-icon":[eE]},$$scope:{ctx:h}}}),de.$on("change",h[19]);function Dr(Et){h[23](Et)}function gi(Et){h[24](Et)}let Cn={leftLimit:0,rightLimit:h[3],leftLabel:eo(h[0],h[3],h[2]),rightLabel:eo(h[1],h[3],h[2]),leftRange:eo(0,h[3],h[2]),rightRange:eo(1,h[3],h[2])};h[0]!==void 0&&(Cn.start=h[0]),h[1]!==void 0&&(Cn.end=h[1]),je=new XT({props:Cn}),Vo.push(()=>Ep(je,"start",Dr)),Vo.push(()=>Ep(je,"end",gi)),ti=new g2({props:{data:h[4],start:h[0],end:h[1]}});function no(Et){h[25](Et)}let Ei={label:"",design:"multi",options:["Near schools","Any"],fontSize:14};return h[7]!==void 0&&(Ei.value=h[7]),At=new QT({props:Ei}),Vo.push(()=>Ep(At,"value",no)),$i=new qT({props:{shootings:h[10]}}),{c(){f=kt("article"),y=kt("p"),w=Zi("Between "),k=Zi(S),z=Zi(" and "),L=Zi(o),F=Zi(", "),Q=Zi(h[9]),H=Zi(` high school-aged teens were 
        `),ce=kt("span"),Bo(de.$$.fragment),ye=Zi(`
        in shootings in the Baltimore area.`),Ee=fi(),Xe=kt("div"),ut=kt("div"),ut.textContent=at,Ie=fi(),ct=kt("div"),ve=kt("div"),Oe=kt("div"),Ze=Zi("12-month"),Be=fi(),Ut=kt("div"),Pe=Zi("Calendar year"),St=fi(),Ot=kt("div"),vi=Zi("School year"),ri=fi(),Bo(je.$$.fragment),Nt=fi(),Ai=kt("div"),Bo(ti.$$.fragment),Ji=fi(),vn=kt("p"),An=Zi(h[8]),Mn=Zi(" victims during that period were located within two blocks of schools"),$n=fi(),xt=kt("div"),Ft=kt("div"),Ft.textContent=vt,lt=fi(),ci=kt("div"),Bo(At.$$.fragment),bi=fi(),tn=kt("div"),Bo($i.$$.fragment),this.h()},l(Et){f=zt(Et,"ARTICLE",{class:!0});var Zt=Mt(f);y=zt(Zt,"P",{class:!0});var Qi=Mt(y);w=Wi(Qi,"Between "),k=Wi(Qi,S),z=Wi(Qi," and "),L=Wi(Qi,o),F=Wi(Qi,", "),Q=Wi(Qi,h[9]),H=Wi(Qi,` high school-aged teens were 
        `),ce=zt(Qi,"SPAN",{class:!0});var dn=Mt(ce);Oo(de.$$.fragment,dn),dn.forEach(qe),ye=Wi(Qi,`
        in shootings in the Baltimore area.`),Qi.forEach(qe),Ee=pi(Zt),Xe=zt(Zt,"DIV",{class:!0});var nn=Mt(Xe);ut=zt(nn,"DIV",{class:!0,"data-svelte-h":!0}),Xs(ut)!=="svelte-1kn80fq"&&(ut.textContent=at),Ie=pi(nn),ct=zt(nn,"DIV",{class:!0});var Xn=Mt(ct);ve=zt(Xn,"DIV",{class:!0});var bn=Mt(ve);Oe=zt(bn,"DIV",{class:!0});var cr=Mt(Oe);Ze=Wi(cr,"12-month"),cr.forEach(qe),Be=pi(bn),Ut=zt(bn,"DIV",{class:!0});var pr=Mt(Ut);Pe=Wi(pr,"Calendar year"),pr.forEach(qe),St=pi(bn),Ot=zt(bn,"DIV",{class:!0});var mr=Mt(Ot);vi=Wi(mr,"School year"),mr.forEach(qe),bn.forEach(qe),ri=pi(Xn),Oo(je.$$.fragment,Xn),Xn.forEach(qe),nn.forEach(qe),Nt=pi(Zt),Ai=zt(Zt,"DIV",{class:!0});var Lr=Mt(Ai);Oo(ti.$$.fragment,Lr),Lr.forEach(qe),Ji=pi(Zt),vn=zt(Zt,"P",{class:!0});var qr=Mt(vn);An=Wi(qr,h[8]),Mn=Wi(qr," victims during that period were located within two blocks of schools"),qr.forEach(qe),$n=pi(Zt),xt=zt(Zt,"DIV",{class:!0});var te=Mt(xt);Ft=zt(te,"DIV",{class:!0,"data-svelte-h":!0}),Xs(Ft)!=="svelte-1k6ul6g"&&(Ft.textContent=vt),lt=pi(te),ci=zt(te,"DIV",{class:!0});var U=Mt(ci);Oo(At.$$.fragment,U),U.forEach(qe),te.forEach(qe),bi=pi(Zt),tn=zt(Zt,"DIV",{class:!0});var N=Mt(tn);Oo($i.$$.fragment,N),N.forEach(qe),Zt.forEach(qe),this.h()},h(){_e(ce,"class","inline-select svelte-1yfltnz"),_e(y,"class","svelte-1yfltnz"),_e(ut,"class","slider-title slider-title-date svelte-1yfltnz"),_e(Oe,"class",He=Jl(h[5]==="12-month"?"date-button selected-button":"date-button")+" svelte-1yfltnz"),_e(Ut,"class",tt=Jl(h[5]==="calendar"?"date-button selected-button":"date-button")+" svelte-1yfltnz"),_e(Ot,"class",qt=Jl(h[5]==="school"?"date-button selected-button":"date-button")+" svelte-1yfltnz"),_e(ve,"class","date-buttons"),_e(ct,"class","slider-container slider-container-date svelte-1yfltnz"),_e(Xe,"class","slider svelte-1yfltnz"),_e(Ai,"class","stacked-area-chart-container svelte-1yfltnz"),_e(vn,"class","svelte-1yfltnz"),_e(Ft,"class","slider-title slider-title-location svelte-1yfltnz"),_e(ci,"class","slider-container slider-container-location svelte-1yfltnz"),_e(xt,"class","slider svelte-1yfltnz"),_e(tn,"class","map-container svelte-1yfltnz"),_e(f,"class","svelte-1yfltnz")},m(Et,Zt){ni(Et,f,Zt),Ke(f,y),Ke(y,w),Ke(y,k),Ke(y,z),Ke(y,L),Ke(y,F),Ke(y,Q),Ke(y,H),Ke(y,ce),Fo(de,ce,null),Ke(y,ye),Ke(f,Ee),Ke(f,Xe),Ke(Xe,ut),Ke(Xe,Ie),Ke(Xe,ct),Ke(ct,ve),Ke(ve,Oe),Ke(Oe,Ze),Ke(ve,Be),Ke(ve,Ut),Ke(Ut,Pe),Ke(ve,St),Ke(ve,Ot),Ke(Ot,vi),Ke(ct,ri),Fo(je,ct,null),Ke(f,Nt),Ke(f,Ai),Fo(ti,Ai,null),Ke(f,Ji),Ke(f,vn),Ke(vn,An),Ke(vn,Mn),Ke(f,$n),Ke(f,xt),Ke(xt,Ft),Ke(xt,lt),Ke(xt,ci),Fo(At,ci,null),Ke(f,bi),Ke(f,tn),Fo($i,tn,null),Ci=!0,lr||(fr=[Yi(Oe,"click",h[20]),Yi(Ut,"click",h[21]),Yi(Ot,"click",h[22])],lr=!0)},p(Et,[Zt]){(!Ci||Zt&13)&&S!==(S=eo(Et[0],Et[3],Et[2])+"")&&On(k,S),(!Ci||Zt&14)&&o!==(o=eo(Et[1],Et[3],Et[2])+"")&&On(L,o),(!Ci||Zt&512)&&On(Q,Et[9]);const Qi={};Zt&64&&(Qi.value=Et[6]),Zt&536870912&&(Qi.$$scope={dirty:Zt,ctx:Et}),de.$set(Qi),(!Ci||Zt&32&&He!==(He=Jl(Et[5]==="12-month"?"date-button selected-button":"date-button")+" svelte-1yfltnz"))&&_e(Oe,"class",He),(!Ci||Zt&32&&tt!==(tt=Jl(Et[5]==="calendar"?"date-button selected-button":"date-button")+" svelte-1yfltnz"))&&_e(Ut,"class",tt),(!Ci||Zt&32&&qt!==(qt=Jl(Et[5]==="school"?"date-button selected-button":"date-button")+" svelte-1yfltnz"))&&_e(Ot,"class",qt);const dn={};Zt&8&&(dn.rightLimit=Et[3]),Zt&13&&(dn.leftLabel=eo(Et[0],Et[3],Et[2])),Zt&14&&(dn.rightLabel=eo(Et[1],Et[3],Et[2])),Zt&12&&(dn.leftRange=eo(0,Et[3],Et[2])),Zt&12&&(dn.rightRange=eo(1,Et[3],Et[2])),!dt&&Zt&1&&(dt=!0,dn.start=Et[0],Tp(()=>dt=!1)),!gt&&Zt&2&&(gt=!0,dn.end=Et[1],Tp(()=>gt=!1)),je.$set(dn);const nn={};Zt&16&&(nn.data=Et[4]),Zt&1&&(nn.start=Et[0]),Zt&2&&(nn.end=Et[1]),ti.$set(nn),(!Ci||Zt&256)&&On(An,Et[8]);const Xn={};!ei&&Zt&128&&(ei=!0,Xn.value=Et[7],Tp(()=>ei=!1)),At.$set(Xn);const bn={};Zt&1024&&(bn.shootings=Et[10]),$i.$set(bn)},i(Et){Ci||(Bt(de.$$.fragment,Et),Bt(je.$$.fragment,Et),Bt(ti.$$.fragment,Et),Bt(At.$$.fragment,Et),Bt($i.$$.fragment,Et),Ci=!0)},o(Et){Qt(de.$$.fragment,Et),Qt(je.$$.fragment,Et),Qt(ti.$$.fragment,Et),Qt(At.$$.fragment,Et),Qt($i.$$.fragment,Et),Ci=!1},d(Et){Et&&qe(f),Uo(de),Uo(je),Uo(ti),Uo(At),Uo($i),lr=!1,lc(fr)}}}const h0=12;async function iE(h){return await(await fetch(h,{method:"get",headers:{"content-type":"text/csv;charset=UTF-8"}})).text()}function nE(h,f,y){let w,S,k,z,o,L,F,Q,H,ce,de,ye,Ee,Xe,ut=[];const at=Vp("%Y-%m-%d"),Ie=Vp("%Y-%m");async function ct(qt){const ri=await iE(qt);y(12,ut=c2(ri).map(je=>({...je,age:+je.age,parsedDate:at(je.date),latitude:+je.latitude,longitude:+je.longitude,year:+je.year,month:+je.month,hour:+je.hour})))}Xp(async()=>{ct("https://banner-public.s3.amazonaws.com/youth-gun-violence/shooting_victims_with_near_school.csv")});let ve,Oe,Ze;const He=[{label:"involved",value:"involved"},{label:"injured",value:"shooting"},{label:"killed",value:"homicide"}],Be=qt=>{y(6,S=qt.detail)},Ut=()=>y(5,w="12-month"),Pe=()=>y(5,w="calendar"),tt=()=>y(5,w="school");function St(qt){ve=qt,y(0,ve)}function Ot(qt){Oe=qt,y(1,Oe)}function vi(qt){Ze=qt,y(7,Ze)}return h.$$.update=()=>{var qt,ri;h.$$.dirty&4160&&y(14,k=S.value==="involved"?ut:ut.filter(je=>je.description===S.value)),h.$$.dirty&16384&&y(18,z=Rv(k,je=>je.parsedDate)),h.$$.dirty&262144&&console.log(z),h.$$.dirty&262144&&y(15,o=((qt=z[1])==null?void 0:qt.getMonth())+1),h.$$.dirty&262144&&y(16,L=(ri=z[1])==null?void 0:ri.getDate()),h.$$.dirty&262144&&y(17,F=Vu.range(z[0],z[1],h0)),h.$$.dirty&245792&&y(4,Q=F.map(je=>{const dt=at(`${je.getFullYear()}-${o.toString().padStart(2,"0")}-${L.toString().padStart(2,"0")}`);let gt;w==="12-month"?gt=Go.offset(dt,-1):w==="calendar"?gt=at(`${je.getFullYear()}-01-01`):gt=o>=9?at(`${je.getFullYear()}-09-01`):at(`${je.getFullYear()-1}-09-01`);const Nt=k.filter(ti=>gt-ti.parsedDate<=0&&ti.parsedDate-dt<0),Ai=Nt.filter(ti=>ti.age_range==="high school teen");return[{date:Ie(`${je.getFullYear()}-${je.getMonth()+1}`),victims:Nt.length-Ai.length,age_group:"Other ages"},{date:Ie(`${je.getFullYear()}-${je.getMonth()+1}`),victims:Ai.length,age_group:"High school teen, 13 to 18"}]}).flat()),h.$$.dirty&16&&y(2,H=Q.filter(je=>je.age_group==="Other ages").map(je=>je.date)),h.$$.dirty&4&&y(3,ce=H.length),h.$$.dirty&16399&&y(13,de=k.filter(je=>je.parsedDate-ju(ve,ce,H)>=0&&je.parsedDate-Vu.offset(ju(Oe,ce,H),h0+1)<0)),h.$$.dirty&8192&&y(10,ye=de.map(je=>({type:"Feature",geometry:{type:"Point",coordinates:[je.longitude,je.latitude]},properties:{date:je.parsedDate}}))),h.$$.dirty&8192&&y(9,Ee=de.filter(je=>je.age_range==="high school teen").length),h.$$.dirty&8192&&y(8,Xe=de.filter(je=>je.near_school_school_number!=="NA").length)},y(5,w="12-month"),y(6,S=He[0]),[ve,Oe,H,ce,Q,w,S,Ze,Xe,Ee,ye,He,ut,de,k,o,L,F,z,Be,Ut,Pe,tt,St,Ot,vi]}class sE extends ms{constructor(f){super(),_s(this,f,nE,tE,ps,{})}}export{sE as component};
